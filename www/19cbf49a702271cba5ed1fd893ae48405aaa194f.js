!function(a){"function"==typeof define&&define.amd?define(["feature!promises","jquery","underscore","backbone","jquerymobile","feature!es5","signaturepad"],a):a(Promise,$,_,Backbone)}(function(Promise,$,_,Backbone){var BMP=window.BMP=window.BMP||{};BMP.Forms=BMP.Forms||{};var requirejs,require,define;return function(a){function b(a,b){return r.call(a,b)}function c(a,b){var c,d,e,f,g,h,i,j,k,l,m,n=b&&b.split("/"),o=p.map,q=o&&o["*"]||{};if(a&&"."===a.charAt(0))if(b){for(a=a.split("/"),g=a.length-1,p.nodeIdCompat&&t.test(a[g])&&(a[g]=a[g].replace(t,"")),a=n.slice(0,n.length-1).concat(a),k=0;k<a.length;k+=1)if(m=a[k],"."===m)a.splice(k,1),k-=1;else if(".."===m){if(1===k&&(".."===a[2]||".."===a[0]))break;k>0&&(a.splice(k-1,2),k-=2)}a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((n||q)&&o){for(c=a.split("/"),k=c.length;k>0;k-=1){if(d=c.slice(0,k).join("/"),n)for(l=n.length;l>0;l-=1)if(e=o[n.slice(0,l).join("/")],e&&(e=e[d])){f=e,h=k;break}if(f)break;!i&&q&&q[d]&&(i=q[d],j=k)}!f&&i&&(f=i,h=j),f&&(c.splice(0,h,f),a=c.join("/"))}return a}function d(b,c){return function(){var d=s.call(arguments,0);return"string"!=typeof d[0]&&1===d.length&&d.push(null),k.apply(a,d.concat([b,c]))}}function e(a){return function(b){return c(b,a)}}function f(a){return function(b){n[a]=b}}function g(c){if(b(o,c)){var d=o[c];delete o[c],q[c]=!0,j.apply(a,d)}if(!b(n,c)&&!b(q,c))throw new Error("No "+c);return n[c]}function h(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function i(a){return function(){return p&&p.config&&p.config[a]||{}}}var j,k,l,m,n={},o={},p={},q={},r=Object.prototype.hasOwnProperty,s=[].slice,t=/\.js$/;l=function(a,b){var d,f=h(a),i=f[0];return a=f[1],i&&(i=c(i,b),d=g(i)),i?a=d&&d.normalize?d.normalize(a,e(b)):c(a,b):(a=c(a,b),f=h(a),i=f[0],a=f[1],i&&(d=g(i))),{f:i?i+"!"+a:a,n:a,pr:i,p:d}},m={require:function(a){return d(a)},exports:function(a){var b=n[a];return"undefined"!=typeof b?b:n[a]={}},module:function(a){return{id:a,uri:"",exports:n[a],config:i(a)}}},j=function(c,e,h,i){var j,k,p,r,s,t,u=[],v=typeof h;if(i=i||c,"undefined"===v||"function"===v){for(e=!e.length&&h.length?["require","exports","module"]:e,s=0;s<e.length;s+=1)if(r=l(e[s],i),k=r.f,"require"===k)u[s]=m.require(c);else if("exports"===k)u[s]=m.exports(c),t=!0;else if("module"===k)j=u[s]=m.module(c);else if(b(n,k)||b(o,k)||b(q,k))u[s]=g(k);else{if(!r.p)throw new Error(c+" missing "+k);r.p.load(r.n,d(i,!0),f(k),{}),u[s]=n[k]}p=h?h.apply(n[c],u):void 0,c&&(j&&j.exports!==a&&j.exports!==n[c]?n[c]=j.exports:p===a&&t||(n[c]=p))}else c&&(n[c]=h)},requirejs=require=k=function(b,c,d,e,f){if("string"==typeof b)return m[b]?m[b](c):g(l(b,c).f);if(!b.splice){if(p=b,p.deps&&k(p.deps,p.callback),!c)return;c.splice?(b=c,c=d,d=null):b=a}return c=c||function(){},"function"==typeof d&&(d=e,e=f),e?j(a,b,c,d):setTimeout(function(){j(a,b,c,d)},4),k},k.config=function(a){return k(a)},requirejs._defined=n,define=function(a,c,d){if("string"!=typeof a)throw new Error("See almond README: incorrect module build, no module name");c.splice||(d=c,c=[]),b(n,a)||b(o,a)||(o[a]=[a,c,d])},define.amd={jQuery:!0}}(),define("jquery",[],function(){return $}),function(){var a,b,c,d,e=function(a,b){return function(){return a.apply(b,arguments)}},f=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1},g=[].slice,h={}.hasOwnProperty,i=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};a={binders:{},components:{},formatters:{},adapters:{},config:{prefix:"rv",templateDelimiters:["{","}"],rootInterface:".",preloadData:!0,handler:function(a,b,c){return this.call(a,b,c.view.models)}}},"jQuery"in window?(d="on"in jQuery.prototype?["on","off"]:["bind","unbind"],b=d[0],c=d[1],a.Util={bindEvent:function(a,c,d){return jQuery(a)[b](c,d)},unbindEvent:function(a,b,d){return jQuery(a)[c](b,d)},getInputValue:function(a){var b;return b=jQuery(a),"checkbox"===b.attr("type")?b.is(":checked"):b.val()}}):a.Util={bindEvent:function(){return"addEventListener"in window?function(a,b,c){return a.addEventListener(b,c,!1)}:function(a,b,c){return a.attachEvent("on"+b,c)}}(),unbindEvent:function(){return"removeEventListener"in window?function(a,b,c){return a.removeEventListener(b,c,!1)}:function(a,b,c){return a.detachEvent("on"+b,c)}}(),getInputValue:function(a){var b,c,d,e;if("checkbox"===a.type)return a.checked;if("select-multiple"===a.type){for(e=[],c=0,d=a.length;d>c;c++)b=a[c],b.selected&&e.push(b.value);return e}return a.value}},a.View=function(){function b(b,c,d){var f,g,h,i,j,k,l,m,n;for(this.els=b,this.models=c,this.options=null!=d?d:{},this.update=e(this.update,this),this.publish=e(this.publish,this),this.sync=e(this.sync,this),this.unbind=e(this.unbind,this),this.bind=e(this.bind,this),this.select=e(this.select,this),this.build=e(this.build,this),this.componentRegExp=e(this.componentRegExp,this),this.bindingRegExp=e(this.bindingRegExp,this),this.els.jquery||this.els instanceof Array||(this.els=[this.els]),l=["config","binders","formatters","adapters"],j=0,k=l.length;k>j;j++){if(g=l[j],this[g]={},this.options[g]){m=this.options[g];for(f in m)h=m[f],this[g][f]=h}n=a[g];for(f in n)h=n[f],null==(i=this[g])[f]&&(i[f]=h)}this.build()}return b.prototype.bindingRegExp=function(){return new RegExp("^"+this.config.prefix+"-")},b.prototype.componentRegExp=function(){return new RegExp("^"+this.config.prefix.toUpperCase()+"-")},b.prototype.build=function(){var b,c,d,e,g,h,i,j,k,l=this;for(this.bindings=[],h=[],b=this.bindingRegExp(),d=this.componentRegExp(),c=function(b,c,d,e){var f,g,h,i,j,k,m;return j={},m=function(){var a,b,c,d;for(c=e.split("|"),d=[],a=0,b=c.length;b>a;a++)k=c[a],d.push(k.trim());return d}(),f=function(){var a,b,c,d;for(c=m.shift().split("<"),d=[],a=0,b=c.length;b>a;a++)g=c[a],d.push(g.trim());return d}(),i=f.shift(),j.formatters=m,(h=f.shift())&&(j.dependencies=h.split(/\s+/)),l.bindings.push(new a[b](l,c,d,i,j))},g=function(e){var i,j,k,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M;if(f.call(h,e)<0){if(3===e.nodeType){if(q=a.TextTemplateParser,(n=l.config.templateDelimiters)&&(u=q.parse(e.data,n)).length&&(1!==u.length||u[0].type!==q.types.text)){for(x=0,B=u.length;B>x;x++)t=u[x],s=document.createTextNode(t.value),e.parentNode.insertBefore(s,e),1===t.type&&c("TextBinding",s,null,t.value);e.parentNode.removeChild(e)}}else if(d.test(e.tagName))v=e.tagName.replace(d,"").toLowerCase(),l.bindings.push(new a.ComponentBinding(l,e,v));else if(null!=e.attributes){for(H=e.attributes,y=0,C=H.length;C>y;y++)if(i=H[y],b.test(i.name)){if(v=i.name.replace(b,""),!(k=l.binders[v])){I=l.binders;for(o in I)w=I[o],"*"!==o&&-1!==o.indexOf("*")&&(r=new RegExp("^"+o.replace("*",".+")+"$"),r.test(v)&&(k=w))}if(k||(k=l.binders["*"]),k.block){for(J=e.childNodes,z=0,D=J.length;D>z;z++)p=J[z],h.push(p);j=[i]}}for(K=j||e.attributes,A=0,E=K.length;E>A;A++)i=K[A],b.test(i.name)&&(v=i.name.replace(b,""),c("Binding",e,v,i.value))}for(L=function(){var a,b,c,d;for(c=e.childNodes,d=[],b=0,a=c.length;a>b;b++)p=c[b],d.push(p);return d}(),M=[],G=0,F=L.length;F>G;G++)m=L[G],M.push(g(m));return M}},k=this.els,i=0,j=k.length;j>i;i++)e=k[i],g(e)},b.prototype.select=function(a){var b,c,d,e,f;for(e=this.bindings,f=[],c=0,d=e.length;d>c;c++)b=e[c],a(b)&&f.push(b);return f},b.prototype.bind=function(){var a,b,c,d,e;for(d=this.bindings,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.bind());return e},b.prototype.unbind=function(){var a,b,c,d,e;for(d=this.bindings,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.unbind());return e},b.prototype.sync=function(){var a,b,c,d,e;for(d=this.bindings,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.sync());return e},b.prototype.publish=function(){var a,b,c,d,e;for(d=this.select(function(a){return a.binder.publishes}),e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.publish());return e},b.prototype.update=function(a){var b,c,d,e,f,g,h;null==a&&(a={});for(c in a)d=a[c],this.models[c]=d;for(g=this.bindings,h=[],e=0,f=g.length;f>e;e++)b=g[e],h.push(b.update(a));return h},b}(),a.Binding=function(){function b(a,b,c,d,f){this.view=a,this.el=b,this.type=c,this.keypath=d,this.options=null!=f?f:{},this.update=e(this.update,this),this.unbind=e(this.unbind,this),this.bind=e(this.bind,this),this.publish=e(this.publish,this),this.sync=e(this.sync,this),this.set=e(this.set,this),this.eventHandler=e(this.eventHandler,this),this.formattedValue=e(this.formattedValue,this),this.setBinder=e(this.setBinder,this),this.formatters=this.options.formatters||[],this.dependencies=[],this.model=void 0,this.setBinder()}return b.prototype.setBinder=function(){var a,b,c,d;if(!(this.binder=this.view.binders[this.type])){d=this.view.binders;for(a in d)c=d[a],"*"!==a&&-1!==a.indexOf("*")&&(b=new RegExp("^"+a.replace("*",".+")+"$"),b.test(this.type)&&(this.binder=c,this.args=new RegExp("^"+a.replace("*","(.+)")+"$").exec(this.type),this.args.shift()))}return this.binder||(this.binder=this.view.binders["*"]),this.binder instanceof Function?this.binder={routine:this.binder}:void 0},b.prototype.formattedValue=function(a){var b,c,d,e,f,h;for(h=this.formatters,e=0,f=h.length;f>e;e++)c=h[e],b=c.split(/\s+/),d=b.shift(),c=this.view.formatters[d],(null!=c?c.read:void 0)instanceof Function?a=c.read.apply(c,[a].concat(g.call(b))):c instanceof Function&&(a=c.apply(null,[a].concat(g.call(b))));return a},b.prototype.eventHandler=function(a){var b,c;return c=(b=this).view.config.handler,function(d){return c.call(a,this,d,b)}},b.prototype.set=function(a){var b;return a=this.formattedValue(a instanceof Function&&!this.binder["function"]?a.call(this.model):a),null!=(b=this.binder.routine)?b.call(this,this.el,a):void 0},b.prototype.sync=function(){var b,c,d,e,f,g,h,i,j;if(this.model!==this.observer.target){for(h=this.dependencies,d=0,f=h.length;f>d;d++)c=h[d],c.unobserve();if(this.dependencies=[],null!=(this.model=this.observer.target)&&(null!=(i=this.options.dependencies)?i.length:void 0))for(j=this.options.dependencies,e=0,g=j.length;g>e;e++)b=j[e],c=new a.Observer(this.view,this.model,b,this.sync),this.dependencies.push(c)}return this.set(this.observer.value())},b.prototype.publish=function(){var b,c,d,e,f,h,i,j,k;for(e=a.Util.getInputValue(this.el),i=this.formatters.slice(0).reverse(),f=0,h=i.length;h>f;f++)c=i[f],b=c.split(/\s+/),d=b.shift(),(null!=(j=this.view.formatters[d])?j.publish:void 0)&&(e=(k=this.view.formatters[d]).publish.apply(k,[e].concat(g.call(b))));return this.observer.publish(e)},b.prototype.bind=function(){var b,c,d,e,f,g,h;if(null!=(f=this.binder.bind)&&f.call(this,this.el),this.observer=new a.Observer(this.view,this.view.models,this.keypath,this.sync),this.model=this.observer.target,null!=this.model&&(null!=(g=this.options.dependencies)?g.length:void 0))for(h=this.options.dependencies,d=0,e=h.length;e>d;d++)b=h[d],c=new a.Observer(this.view,this.model,b,this.sync),this.dependencies.push(c);return this.view.config.preloadData?this.sync():void 0},b.prototype.unbind=function(){var a,b,c,d,e;for(null!=(d=this.binder.unbind)&&d.call(this,this.el),this.observer.unobserve(),e=this.dependencies,b=0,c=e.length;c>b;b++)a=e[b],a.unobserve();return this.dependencies=[]},b.prototype.update=function(a){var b;return null==a&&(a={}),this.model=this.observer.target,null!=(b=this.binder.update)?b.call(this,a):void 0},b}(),a.ComponentBinding=function(b){function c(b,c,d){var g,h,i,j,k;for(this.view=b,this.el=c,this.type=d,this.unbind=e(this.unbind,this),this.bind=e(this.bind,this),this.update=e(this.update,this),this.locals=e(this.locals,this),this.component=a.components[this.type],this.attributes={},this.inflections={},j=this.el.attributes||[],h=0,i=j.length;i>h;h++)g=j[h],k=g.name,f.call(this.component.attributes,k)>=0?this.attributes[g.name]=g.value:this.inflections[g.name]=g.value}return i(c,b),c.prototype.sync=function(){},c.prototype.locals=function(a){var b,c,d,e,f,g,h,i,j;null==a&&(a=this.view.models),f={},i=this.inflections;for(c in i)for(b=i[c],j=b.split("."),g=0,h=j.length;h>g;g++)e=j[g],f[c]=(f[c]||a)[e];for(c in a)d=a[c],null==f[c]&&(f[c]=d);return f},c.prototype.update=function(a){var b;return null!=(b=this.componentView)?b.update(this.locals(a)):void 0},c.prototype.bind=function(){var b,c;return null!=this.componentView?null!=(c=this.componentView)?c.bind():void 0:(b=this.component.build.call(this.attributes),(this.componentView=new a.View(b,this.locals(),this.view.options)).bind(),this.el.parentNode.replaceChild(b,this.el))},c.prototype.unbind=function(){var a;return null!=(a=this.componentView)?a.unbind():void 0},c}(a.Binding),a.TextBinding=function(a){function b(a,b,c,d,f){this.view=a,this.el=b,this.type=c,this.keypath=d,this.options=null!=f?f:{},this.sync=e(this.sync,this),this.formatters=this.options.formatters||[],this.dependencies=[]}return i(b,a),b.prototype.binder={routine:function(a,b){return a.data=null!=b?b:""}},b.prototype.sync=function(){return b.__super__.sync.apply(this,arguments)},b}(a.Binding),a.KeypathParser=function(){function a(){}return a.parse=function(a,b,c){var d,e,g,h,i,j;for(h=[],e={"interface":c,path:""},g=i=0,j=a.length;j>i;g=i+=1)d=a.charAt(g),f.call(b,d)>=0?(h.push(e),e={"interface":d,path:""}):e.path+=d;return h.push(e),h},a}(),a.TextTemplateParser=function(){function a(){}return a.types={text:0,binding:1},a.parse=function(a,b){var c,d,e,f,g,h,i;for(h=[],f=a.length,c=0,d=0;f>d;){if(c=a.indexOf(b[0],d),0>c){h.push({type:this.types.text,value:a.slice(d)});break}if(c>0&&c>d&&h.push({type:this.types.text,value:a.slice(d,c)}),d=c+b[0].length,c=a.indexOf(b[1],d),0>c){g=a.slice(d-b[1].length),e=h[h.length-1],(null!=e?e.type:void 0)===this.types.text?e.value+=g:h.push({type:this.types.text,value:g});break}i=a.slice(d,c).trim(),h.push({type:this.types.binding,value:i}),d=c+b[1].length}return h},a}(),a.Observer=function(){function b(a,b,c,d){this.view=a,this.model=b,this.keypath=c,this.callback=d,this.unobserve=e(this.unobserve,this),this.realize=e(this.realize,this),this.value=e(this.value,this),this.publish=e(this.publish,this),this.read=e(this.read,this),this.set=e(this.set,this),this.adapter=e(this.adapter,this),this.update=e(this.update,this),this.initialize=e(this.initialize,this),this.parse=e(this.parse,this),this.parse(),this.initialize()}return b.prototype.parse=function(){var b,c,d,e,g,h;return b=function(){var a,b;a=this.view.adapters,b=[];for(c in a)g=a[c],b.push(c);return b}.call(this),h=this.keypath[0],f.call(b,h)>=0?(e=this.keypath[0],d=this.keypath.substr(1)):(e=this.view.config.rootInterface,d=this.keypath),this.tokens=a.KeypathParser.parse(d,b,e),this.key=this.tokens.pop()},b.prototype.initialize=function(){return this.objectPath=[],this.target=this.realize(),null!=this.target?this.set(!0,this.key,this.target,this.callback):void 0},b.prototype.update=function(){var a,b;return(a=this.realize())!==this.target&&(null!=this.target&&this.set(!1,this.key,this.target,this.callback),null!=a&&this.set(!0,this.key,a,this.callback),b=this.value(),this.target=a,this.value()!==b)?this.callback():void 0},b.prototype.adapter=function(a){return this.view.adapters[a["interface"]]},b.prototype.set=function(a,b,c,d){var e;return e=a?"subscribe":"unsubscribe",this.adapter(b)[e](c,b.path,d)},b.prototype.read=function(a,b){return this.adapter(a).read(b,a.path)},b.prototype.publish=function(a){return null!=this.target?this.adapter(this.key).publish(this.target,this.key.path,a):void 0},b.prototype.value=function(){return null!=this.target?this.read(this.key,this.target):void 0},b.prototype.realize=function(){var a,b,c,d,e,f,g,h;for(a=this.model,e=null,h=this.tokens,b=f=0,g=h.length;g>f;b=++f)d=h[b],null!=a?(null!=this.objectPath[b]?a!==(c=this.objectPath[b])&&(this.set(!1,d,c,this.update),this.set(!0,d,a,this.update),this.objectPath[b]=a):(this.set(!0,d,a,this.update),this.objectPath[b]=a),a=this.read(d,a)):(null==e&&(e=b),(c=this.objectPath[b])&&this.set(!1,d,c,this.update));return null!=e&&this.objectPath.splice(e),a},b.prototype.unobserve=function(){var a,b,c,d,e,f;for(f=this.tokens,a=d=0,e=f.length;e>d;a=++d)c=f[a],(b=this.objectPath[a])&&this.set(!1,c,b,this.update);return null!=this.target?this.set(!1,this.key,this.target,this.callback):void 0},b}(),a.binders.text=function(a,b){return null!=a.textContent?a.textContent=null!=b?b:"":a.innerText=null!=b?b:""},a.binders.html=function(a,b){return a.innerHTML=null!=b?b:""},a.binders.show=function(a,b){return a.style.display=b?"":"none"},a.binders.hide=function(a,b){return a.style.display=b?"none":""},a.binders.enabled=function(a,b){return a.disabled=!b},a.binders.disabled=function(a,b){return a.disabled=!!b},a.binders.checked={publishes:!0,bind:function(b){return a.Util.bindEvent(b,"change",this.publish)},unbind:function(b){return a.Util.unbindEvent(b,"change",this.publish)},routine:function(a,b){var c;return a.checked="radio"===a.type?(null!=(c=a.value)?c.toString():void 0)===(null!=b?b.toString():void 0):!!b}},a.binders.unchecked={publishes:!0,bind:function(b){return a.Util.bindEvent(b,"change",this.publish)},unbind:function(b){return a.Util.unbindEvent(b,"change",this.publish)},routine:function(a,b){var c;return a.checked="radio"===a.type?(null!=(c=a.value)?c.toString():void 0)!==(null!=b?b.toString():void 0):!b}},a.binders.value={publishes:!0,bind:function(b){return a.Util.bindEvent(b,"change",this.publish)},unbind:function(b){return a.Util.unbindEvent(b,"change",this.publish)},routine:function(a,b){var c,d,e,g,h,i,j;if(null!=window.jQuery){if(a=jQuery(a),(null!=b?b.toString():void 0)!==(null!=(g=a.val())?g.toString():void 0))return a.val(null!=b?b:"")}else if("select-multiple"===a.type){if(null!=b){for(j=[],d=0,e=a.length;e>d;d++)c=a[d],j.push(c.selected=(h=c.value,f.call(b,h)>=0));return j}}else if((null!=b?b.toString():void 0)!==(null!=(i=a.value)?i.toString():void 0))return a.value=null!=b?b:""}},a.binders["if"]={block:!0,bind:function(a){var b,c;return null==this.marker?(b=[this.view.config.prefix,this.type].join("-").replace("--","-"),c=a.getAttribute(b),this.marker=document.createComment(" rivets: "+this.type+" "+c+" "),a.removeAttribute(b),a.parentNode.insertBefore(this.marker,a),a.parentNode.removeChild(a)):void 0},unbind:function(){var a;return null!=(a=this.nested)?a.unbind():void 0},routine:function(b,c){var d,e,f,g,h;if(!!c==(null==this.nested)){if(c){f={},h=this.view.models;for(d in h)e=h[d],f[d]=e;return g={binders:this.view.options.binders,formatters:this.view.options.formatters,adapters:this.view.options.adapters,config:this.view.options.config},(this.nested=new a.View(b,f,g)).bind(),this.marker.parentNode.insertBefore(b,this.marker.nextSibling)}return b.parentNode.removeChild(b),this.nested.unbind(),delete this.nested}},update:function(a){var b;return null!=(b=this.nested)?b.update(a):void 0}},a.binders.unless={block:!0,bind:function(b){return a.binders["if"].bind.call(this,b)},unbind:function(){return a.binders["if"].unbind.call(this)},routine:function(b,c){return a.binders["if"].routine.call(this,b,!c)},update:function(b){return a.binders["if"].update.call(this,b)}},a.binders["on-*"]={"function":!0,unbind:function(b){return this.handler?a.Util.unbindEvent(b,this.args[0],this.handler):void 0},routine:function(b,c){return this.handler&&a.Util.unbindEvent(b,this.args[0],this.handler),a.Util.bindEvent(b,this.args[0],this.handler=this.eventHandler(c))}},a.binders["each-*"]={block:!0,bind:function(a){var b;return null==this.marker?(b=[this.view.config.prefix,this.type].join("-").replace("--","-"),this.marker=document.createComment(" rivets: "+this.type+" "),this.iterated=[],a.removeAttribute(b),a.parentNode.insertBefore(this.marker,a),a.parentNode.removeChild(a)):void 0},unbind:function(a){var b,c,d,e,f;if(null!=this.iterated){for(e=this.iterated,f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push(b.unbind());return f}},routine:function(b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A;if(k=this.args[0],c=c||[],this.iterated.length>c.length)for(w=Array(this.iterated.length-c.length),q=0,t=w.length;t>q;q++)f=w[q],p=this.iterated.pop(),p.unbind(),this.marker.parentNode.removeChild(p.els[0]);for(g=r=0,u=c.length;u>r;g=++r)if(j=c[g],e={index:g},e[k]=j,null==this.iterated[g]){x=this.view.models;for(i in x)j=x[i],null==e[i]&&(e[i]=j);m=this.iterated.length?this.iterated[this.iterated.length-1].els[0]:this.marker,l={binders:this.view.options.binders,formatters:this.view.options.formatters,adapters:this.view.options.adapters,config:{}},y=this.view.options.config;for(h in y)o=y[h],l.config[h]=o;l.config.preloadData=!0,n=b.cloneNode(!0),p=new a.View(n,e,l),p.bind(),this.iterated.push(p),this.marker.parentNode.insertBefore(n,m.nextSibling)}else this.iterated[g].models[k]!==j&&this.iterated[g].update(e);if("OPTION"===b.nodeName){for(z=this.view.bindings,A=[],s=0,v=z.length;v>s;s++)d=z[s],A.push(d.el===this.marker.parentNode&&"value"===d.type?d.sync():void 0);return A}},update:function(a){var b,c,d,e,f,g,h,i;b={};for(c in a)d=a[c],c!==this.args[0]&&(b[c]=d);for(h=this.iterated,i=[],f=0,g=h.length;g>f;f++)e=h[f],i.push(e.update(b));return i}},a.binders["class-*"]=function(a,b){var c;return c=" "+a.className+" ",!b==(-1!==c.indexOf(" "+this.args[0]+" "))?a.className=b?""+a.className+" "+this.args[0]:c.replace(" "+this.args[0]+" "," ").trim():void 0},a.binders["*"]=function(a,b){return null!=b?a.setAttribute(this.type,b):a.removeAttribute(this.type)},a.adapters["."]={id:"_rv",counter:0,weakmap:{},weakReference:function(a){var b;return null==a[this.id]&&(b=this.counter++,this.weakmap[b]={callbacks:{}},Object.defineProperty(a,this.id,{value:b})),this.weakmap[a[this.id]]},stubFunction:function(a,b){var c,d,e;return d=a[b],c=this.weakReference(a),e=this.weakmap,a[b]=function(){var b,f,g,h,i,j,k,l,m,n;h=d.apply(a,arguments),k=c.pointers;for(g in k)for(f=k[g],n=null!=(l=null!=(m=e[g])?m.callbacks[f]:void 0)?l:[],i=0,j=n.length;j>i;i++)(b=n[i])();return h}},observeMutations:function(a,b,c){var d,e,g,h,i,j;if(Array.isArray(a)){if(g=this.weakReference(a),null==g.pointers)for(g.pointers={},e=["push","pop","shift","unshift","sort","reverse","splice"],i=0,j=e.length;j>i;i++)d=e[i],this.stubFunction(a,d);if(null==(h=g.pointers)[b]&&(h[b]=[]),f.call(g.pointers[b],c)<0)return g.pointers[b].push(c)}},unobserveMutations:function(a,b,c){var d,e;return Array.isArray(a&&null!=a[this.id])&&(d=null!=(e=this.weakReference(a).pointers)?e[b]:void 0)?d.splice(d.indexOf(c),1):void 0},subscribe:function(a,b,c){var d,e,g=this;return d=this.weakReference(a).callbacks,null==d[b]&&(d[b]=[],e=a[b],Object.defineProperty(a,b,{enumerable:!0,get:function(){return e},set:function(f){var h,i,j;if(f!==e){for(e=f,j=d[b],h=0,i=j.length;i>h;h++)(c=j[h])();return g.observeMutations(f,a[g.id],b)}}})),f.call(d[b],c)<0&&d[b].push(c),this.observeMutations(a[b],a[this.id],b)},unsubscribe:function(a,b,c){var d;return d=this.weakmap[a[this.id]].callbacks[b],d.splice(d.indexOf(c),1),this.unobserveMutations(a[b],a[this.id],b)},read:function(a,b){return a[b]},publish:function(a,b,c){return a[b]=c}},a.factory=function(b){return b._=a,b.binders=a.binders,b.components=a.components,b.formatters=a.formatters,b.adapters=a.adapters,b.config=a.config,b.configure=function(b){var c,d;null==b&&(b={});for(c in b)d=b[c],a.config[c]=d},b.bind=function(b,c,d){var e;return null==c&&(c={}),null==d&&(d={}),e=new a.View(b,c,d),e.bind(),e}},"object"==typeof exports?a.factory(exports):"function"==typeof define&&define.amd?define("rivets",["exports"],function(b){return a.factory(this.rivets=b),b}):a.factory(this.rivets={})}.call(this),define("views/jqm/form",[],function(){var a=Backbone.View.extend({tagName:"form",attributes:{novalidate:"novalidate"},remove:function(){return this.$el.removeData("model"),this.model.unset("_view"),Backbone.View.prototype.remove.call(this)},render:function(){var a=this.model.attributes.pages,b=$("<header></header>"),c=$("<footer></footer>");this.$el.empty(),this.$el.attr("data-form",this.model.attributes.name),this.$el.data("model",this.model),this.model.attributes.header&&(b.append(this.model.attributes.header),this.$el.append(b)),a&&"function"==typeof a["goto"]&&a["goto"](0),this.model.attributes.footer&&(c.append(this.model.attributes.footer),this.$el.append(c))}});return a}),define("views/jqm/subform",["require","views/jqm/form"],function(a){var b=a("views/jqm/form");return b.extend({tagName:"section",attributes:{},remove:function(){return this.$el.children(".ui-btn").children("button").off("click"),b.prototype.remove.call(this)},render:function(){var a,c=this.model.parentElement,d=c.attributes.minusButtonLabel;_.isEmpty(d)&&c.attributes.label&&(d=c.attributes.label),_.isEmpty(d)&&(d=c.attributes.name),a=$("<button></button>").attr({type:"button","data-icon":"minus","data-action":"remove"}).text(d),a.on("click",this.onRemoveClick.bind(this)),b.prototype.render.call(this),this.$el.prepend(a)},onRemoveClick:function(){this.model.parentElement.remove(this.model)}})}),define("views/jqm/element",["rivets"],function(a){return Backbone.View.extend({tagName:"div",attributes:{"data-role":"fieldcontain","rv-class":"m:class"},initialize:function(){var a=this.model;this.$el.attr("data-name",a.attributes.name),this.$el.attr("data-element-type",a.attributes.type),this.$el.data("model",a),this.bindRivets(),this.onChangeHidden(),a.on("change:errors",this.renderErrors,this),a.on("change:hidden",this.onChangeHidden,this)},remove:function(){return this.$el.removeData("model"),this.model.off(null,null,this),this.rivet&&this.rivet.unbind(),this.model.unset("_view"),Backbone.View.prototype.remove.call(this)},renderLabel:function(){var a=$(document.createElement("label"));a.attr({"rv-text":"m:label","class":"ui-input-text"}),this.$el.append(a)},render:function(){throw new Error("Element.render is only an interface")},renderWarning:function(){var a,b,c,d,e;a=this.model.attributes,e=window.i18n["BMP/Forms/warning"],this.$el.children("ul").length>0&&this.$el.children("ul").remove(),b=$(document.createElement("ul")),c=a.warning||{},_.isEmpty(c)||_.each(c.value,function(a){var c,f;f=_.isFunction(e[a.code])&&e[a.code],c||(c=f?f(a):JSON.stringify(a)),d=$(document.createElement("li")),d.text(c),b.append(d)}),0!==this.$el.children("ul").length||_.isEmpty(c)||this.$el.append(b)},renderErrors:function(){var a,b,c,d,e;a=this.model.attributes,e=window.i18n["BMP/Forms/validation"],this.$el.children("ul").length>0&&this.$el.children("ul").remove(),b=$(document.createElement("ul")),c=a.errors||{},_.isEmpty(c)||_.each(c.value,function(c){var f,g;d=$(document.createElement("li")),g=_.isFunction(e[c.code])&&e[c.code],"PATTERN"===c.code&&(f=a.hint||a.toolTip||a.title),f||(f=g?g(c):JSON.stringify(c)),d.text(f),b.append(d)}),0!==this.$el.children("ul").length||_.isEmpty(c)||this.$el.append(b)},onChangeHidden:function(){var a=this.model.attributes.hidden;a?this.hide():this.show()},hide:function(){this.$el.css("display","none")},show:function(){"none"===this.$el.css("display")&&this.$el.css("display","")},isHidden:function(){return this.$el&&"none"===this.$el.css("display")},bindRivets:function(){this.rivet&&this.rivet.unbind(),this.rivet=a.bind(this.el,{m:this.model})}})}),define("views/jqm/elements/subform",["require","views/jqm/element"],function(a){"use strict";var b=a("views/jqm/element");return b.extend({tagName:"section",remove:function(){return this.$el.children(".ui-btn").children("button").off("click"),this.model.attributes.forms.off("change",this.onFormsChange,this),b.prototype.remove.call(this)},render:function(){var a,b=this.model.attributes.plusButtonLabel;_.isEmpty(b)&&this.model.attributes.label&&(b=this.model.attributes.label),_.isEmpty(b)&&(b=this.model.attributes.name),a=$("<button></button>").attr({type:"button","data-icon":"plus","data-action":"add"}).text(b),a.on("click",this.onAddClick.bind(this)),this.$el.attr("data-form",b),this.$el.prepend(a),this.model.attributes.forms.on("add remove",this.onFormsChange,this),this.onFormsChange()},onAddClick:function(){this.model.add()},onFormsChange:function(){var a,b,c;a=BMP.Forms,b=this,this.model.attributes.forms.forEach(function(d){var e,f,g;d.attributes._view||(d.attributes._view=new a._views.SubForm({model:d})),c=d.attributes._view,g=d.attributes._action,"remove"!==g&&(c&&c.$el&&c.$el.children().length||(d.$form=c.$el,c.render()),e=c.$el.closest("body"),e.length&&e[0]===document.body||(f=b.$el.children("section[data-form]").last(),f.length?f.after(c.$el):b.$el.prepend(c.$el)))}),this.$el.trigger("create")}})}),define("views/jqm/section",[],function(){var a=Backbone.View.extend({tagName:"section",initialize:function(){var a=this.model.attributes;a["class"]&&this.$el.addClass(a["class"])},render:function(){var a=this;this.$el.empty(),this.model.get("elements").forEach(function(b){var c,d;d=b.attributes.type,b.attributes._view||"function"!=typeof b.initializeView||b.initializeView(),c=b.attributes._view,c.render(),"hidden"===d?a.$el.prepend(c.el):a.$el.append(c.el)})},show:function(){this.$el.show()},hide:function(){this.$el.hide()},remove:function(){var a;return this.model.get("elements").forEach(function(a){a.attributes._view.remove()}),this.model.unset("_view"),a=Backbone.View.prototype.remove.call(this),delete this.model,delete this.$el,delete this.el,a}});return a}),define("views/jqm/page",["views/jqm/section"],function(a){var b=a.extend({tagName:"section",initialize:function(){var b=this.model;this.$el.attr("data-name",b.attributes.name),a.prototype.initialize.call(this)},render:function(){a.prototype.render.call(this)}});return b}),define("views/jqm/elements/heading",["views/jqm/element"],function(a){"use strict";var b=a.extend({tagName:"header",initialize:function(){var b,c,d=this.model;this.$el.attr("data-name",d.attributes.name),this.$el.attr("data-element-type",d.attributes.type),this.$el.data("model",d),_.isNumber(d.attributes.level)&&(this.tagName="h"+d.attributes.level,b=$(document.createElement(this.tagName)),b.attr({"rv-text":"m:text"}),this.$el.append(b)),d.attributes.smallText&&(c=$(document.createElement("p")),c.attr({"rv-html":"m:smallText"}),this.$el.append(c)),a.prototype.initialize.call(this)},render:function(){this.bindRivets()}});return b}),define("views/jqm/elements/message",["views/jqm/element"],function(a){"use strict";var b=a.extend({tagName:"div",attributes:{"rv-class":"m:class"},render:function(){var a,b=this.model;b.attributes.label?(this.$el.attr({"data-role":"fieldcontain"}),this.$el.empty(),this.renderLabel(),a=$("<div></div>").attr({"rv-html":"m:html","class":"ui-input-text"}),this.$el.append(a)):this.$el.attr({"rv-html":"m:html"}),this.bindRivets()}});return b}),define("views/jqm/elements/date",["views/jqm/element"],function(a){"use strict";var b=a.extend({renderDate:function(){var a,b=this.model.attributes.name;return a=$('<input type="date" />'),a.attr({name:b+"_date","rv-value":"m:_date"}),this.$el.append(a),this},renderTime:function(){var a,b=this.model.attributes.name;return a=$('<input type="time" />'),a.attr({name:b+"_time","rv-value":"m:_time"}),this.$el.append(a),this},render:function(){var a=this.model.get("type");return this.$el.empty(),this.renderLabel(),"time"!==a&&this.renderDate(),"date"!==a&&this.renderTime(),this.bindRivets(),this}});return b}),function(a){"function"==typeof define&&define.amd?define("picker",["jquery"],a):"object"==typeof exports?module.exports=a(require("jquery")):this.Picker=a(jQuery)}(function(a){function b(f,g,i,m){function n(){return b._.node("div",b._.node("div",b._.node("div",b._.node("div",B.component.nodes(w.open),y.box),y.wrap),y.frame),y.holder,'tabindex="-1"')}function o(){z.data(g,B).addClass(y.input).val(z.data("value")?B.get("select",x.format):f.value),x.editable||z.on("focus."+w.id+" click."+w.id,function(a){a.preventDefault(),B.open()}).on("keydown."+w.id,u),e(f,{haspopup:!0,expanded:!1,readonly:!1,owns:f.id+"_root"})}function p(){e(B.$root[0],"hidden",!0)}function q(){B.$holder.on({keydown:u,"focus.toOpen":t,blur:function(){z.removeClass(y.target)},focusin:function(a){B.$root.removeClass(y.focused),
a.stopPropagation()},"mousedown click":function(b){var c=b.target;c!=B.$holder[0]&&(b.stopPropagation(),"mousedown"!=b.type||a(c).is("input, select, textarea, button, option")||(b.preventDefault(),B.$holder[0].focus()))}}).on("click","[data-pick], [data-nav], [data-clear], [data-close]",function(){var b=a(this),c=b.data(),d=b.hasClass(y.navDisabled)||b.hasClass(y.disabled),e=h();e=e&&(e.type||e.href),(d||e&&!a.contains(B.$root[0],e))&&B.$holder[0].focus(),!d&&c.nav?B.set("highlight",B.component.item.highlight,{nav:c.nav}):!d&&"pick"in c?(B.set("select",c.pick),x.closeOnSelect&&B.close(!0)):c.clear?(B.clear(),x.closeOnClear&&B.close(!0)):c.close&&B.close(!0)})}function r(){var b;x.hiddenName===!0?(b=f.name,f.name=""):(b=["string"==typeof x.hiddenPrefix?x.hiddenPrefix:"","string"==typeof x.hiddenSuffix?x.hiddenSuffix:"_submit"],b=b[0]+f.name+b[1]),B._hidden=a('<input type=hidden name="'+b+'"'+(z.data("value")||f.value?' value="'+B.get("select",x.formatSubmit)+'"':"")+">")[0],z.on("change."+w.id,function(){B._hidden.value=f.value?B.get("select",x.formatSubmit):""})}function s(){v&&l?B.$holder.find("."+y.frame).one("transitionend",function(){B.$holder[0].focus()}):B.$holder[0].focus()}function t(a){a.stopPropagation(),z.addClass(y.target),B.$root.addClass(y.focused),B.open()}function u(a){var b=a.keyCode,c=/^(8|46)$/.test(b);return 27==b?(B.close(!0),!1):void((32==b||c||!w.open&&B.component.key[b])&&(a.preventDefault(),a.stopPropagation(),c?B.clear().close():B.open()))}if(!f)return b;var v=!1,w={id:f.id||"P"+Math.abs(~~(Math.random()*new Date))},x=i?a.extend(!0,{},i.defaults,m):m||{},y=a.extend({},b.klasses(),x.klass),z=a(f),A=function(){return this.start()},B=A.prototype={constructor:A,$node:z,start:function(){return w&&w.start?B:(w.methods={},w.start=!0,w.open=!1,w.type=f.type,f.autofocus=f==h(),f.readOnly=!x.editable,f.id=f.id||w.id,"text"!=f.type&&(f.type="text"),B.component=new i(B,x),B.$root=a('<div class="'+y.picker+'" id="'+f.id+'_root" />'),p(),B.$holder=a(n()).appendTo(B.$root),q(),x.formatSubmit&&r(),o(),x.containerHidden?a(x.containerHidden).append(B._hidden):z.after(B._hidden),x.container?a(x.container).append(B.$root):z.after(B.$root),B.on({start:B.component.onStart,render:B.component.onRender,stop:B.component.onStop,open:B.component.onOpen,close:B.component.onClose,set:B.component.onSet}).on({start:x.onStart,render:x.onRender,stop:x.onStop,open:x.onOpen,close:x.onClose,set:x.onSet}),v=c(B.$holder[0]),f.autofocus&&B.open(),B.trigger("start").trigger("render"))},render:function(a){return a?(B.$holder=n(),B.$root.html(B.$holder)):B.$root.find("."+y.box).html(B.component.nodes(w.open)),B.trigger("render")},stop:function(){return w.start?(B.close(),B._hidden&&B._hidden.parentNode.removeChild(B._hidden),B.$root.remove(),z.removeClass(y.input).removeData(g),setTimeout(function(){z.off("."+w.id)},0),f.type=w.type,f.readOnly=!1,B.trigger("stop"),w.methods={},w.start=!1,B):B},open:function(c){return w.open?B:(z.addClass(y.active),e(f,"expanded",!0),setTimeout(function(){B.$root.addClass(y.opened),e(B.$root[0],"hidden",!1)},0),c!==!1&&(w.open=!0,v&&k.css("overflow","hidden").css("padding-right","+="+d()),s(),j.on("click."+w.id+" focusin."+w.id,function(a){var b=a.target;b!=f&&b!=document&&3!=a.which&&B.close(b===B.$holder[0])}).on("keydown."+w.id,function(c){var d=c.keyCode,e=B.component.key[d],f=c.target;27==d?B.close(!0):f!=B.$holder[0]||!e&&13!=d?a.contains(B.$root[0],f)&&13==d&&(c.preventDefault(),f.click()):(c.preventDefault(),e?b._.trigger(B.component.key.go,B,[b._.trigger(e)]):B.$root.find("."+y.highlighted).hasClass(y.disabled)||(B.set("select",B.component.item.highlight),x.closeOnSelect&&B.close(!0)))})),B.trigger("open"))},close:function(a){return a&&(x.editable?f.focus():(B.$holder.off("focus.toOpen").focus(),setTimeout(function(){B.$holder.on("focus.toOpen",t)},0))),z.removeClass(y.active),e(f,"expanded",!1),setTimeout(function(){B.$root.removeClass(y.opened+" "+y.focused),e(B.$root[0],"hidden",!0)},0),w.open?(w.open=!1,v&&k.css("overflow","").css("padding-right","-="+d()),j.off("."+w.id),B.trigger("close")):B},clear:function(a){return B.set("clear",null,a)},set:function(b,c,d){var e,f,g=a.isPlainObject(b),h=g?b:{};if(d=g&&a.isPlainObject(c)?c:d||{},b){g||(h[b]=c);for(e in h)f=h[e],e in B.component.item&&(void 0===f&&(f=null),B.component.set(e,f,d)),("select"==e||"clear"==e)&&z.val("clear"==e?"":B.get(e,x.format)).trigger("change");B.render()}return d.muted?B:B.trigger("set",h)},get:function(a,c){if(a=a||"value",null!=w[a])return w[a];if("valueSubmit"==a){if(B._hidden)return B._hidden.value;a="value"}if("value"==a)return f.value;if(a in B.component.item){if("string"==typeof c){var d=B.component.get(a);return d?b._.trigger(B.component.formats.toString,B.component,[c,d]):""}return B.component.get(a)}},on:function(b,c,d){var e,f,g=a.isPlainObject(b),h=g?b:{};if(b){g||(h[b]=c);for(e in h)f=h[e],d&&(e="_"+e),w.methods[e]=w.methods[e]||[],w.methods[e].push(f)}return B},off:function(){var a,b,c=arguments;for(a=0,namesCount=c.length;a<namesCount;a+=1)b=c[a],b in w.methods&&delete w.methods[b];return B},trigger:function(a,c){var d=function(a){var d=w.methods[a];d&&d.map(function(a){b._.trigger(a,B,[c])})};return d("_"+a),d(a),B}};return new A}function c(a){var b,c="position";return a.currentStyle?b=a.currentStyle[c]:window.getComputedStyle&&(b=getComputedStyle(a)[c]),"fixed"==b}function d(){if(k.height()<=i.height())return 0;var b=a('<div style="visibility:hidden;width:100px" />').appendTo("body"),c=b[0].offsetWidth;b.css("overflow","scroll");var d=a('<div style="width:100%" />').appendTo(b),e=d[0].offsetWidth;return b.remove(),c-e}function e(b,c,d){if(a.isPlainObject(c))for(var e in c)f(b,e,c[e]);else f(b,c,d)}function f(a,b,c){a.setAttribute(("role"==b?"":"aria-")+b,c)}function g(b,c){a.isPlainObject(b)||(b={attribute:c}),c="";for(var d in b){var e=("role"==d?"":"aria-")+d,f=b[d];c+=null==f?"":e+'="'+b[d]+'"'}return c}function h(){try{return document.activeElement}catch(a){}}var i=a(window),j=a(document),k=a(document.documentElement),l=null!=document.body.style.transition;return b.klasses=function(a){return a=a||"picker",{picker:a,opened:a+"--opened",focused:a+"--focused",input:a+"__input",active:a+"__input--active",target:a+"__input--target",holder:a+"__holder",frame:a+"__frame",wrap:a+"__wrap",box:a+"__box"}},b._={group:function(a){for(var c,d="",e=b._.trigger(a.min,a);e<=b._.trigger(a.max,a,[e]);e+=a.i)c=b._.trigger(a.item,a,[e]),d+=b._.node(a.node,c[0],c[1],c[2]);return d},node:function(b,c,d,e){return c?(c=a.isArray(c)?c.join(""):c,d=d?' class="'+d+'"':"",e=e?" "+e:"","<"+b+d+e+">"+c+"</"+b+">"):""},lead:function(a){return(10>a?"0":"")+a},trigger:function(a,b,c){return"function"==typeof a?a.apply(b,c||[]):a},digits:function(a){return/\d/.test(a[1])?2:1},isDate:function(a){return{}.toString.call(a).indexOf("Date")>-1&&this.isInteger(a.getDate())},isInteger:function(a){return{}.toString.call(a).indexOf("Number")>-1&&a%1===0},ariaAttr:g},b.extend=function(c,d){a.fn[c]=function(e,f){var g=this.data(c);return"picker"==e?g:g&&"string"==typeof e?b._.trigger(g[e],g,[f]):this.each(function(){var f=a(this);f.data(c)||new b(this,c,d,e)})},a.fn[c].defaults=d.defaults},b}),function(a){"function"==typeof define&&define.amd?define("picker.date",["picker","jquery"],a):"object"==typeof exports?module.exports=a(require("./picker.js"),require("jquery")):a(Picker,jQuery)}(function(a,b){function c(a,b){var c=this,d=a.$node[0],e=d.value,f=a.$node.data("value"),g=f||e,h=f?b.formatSubmit:b.format,i=function(){return d.currentStyle?"rtl"==d.currentStyle.direction:"rtl"==getComputedStyle(a.$root[0]).direction};c.settings=b,c.$node=a.$node,c.queue={min:"measure create",max:"measure create",now:"now create",select:"parse create validate",highlight:"parse navigate create validate",view:"parse create validate viewset",disable:"deactivate",enable:"activate"},c.item={},c.item.clear=null,c.item.disable=(b.disable||[]).slice(0),c.item.enable=-function(a){return a[0]===!0?a.shift():-1}(c.item.disable),c.set("min",b.min).set("max",b.max).set("now"),g?c.set("select",g,{format:h,defaultValue:!0}):c.set("select",null).set("highlight",c.item.now),c.key={40:7,38:-7,39:function(){return i()?-1:1},37:function(){return i()?1:-1},go:function(a){var b=c.item.highlight,d=new Date(b.year,b.month,b.date+a);c.set("highlight",d,{interval:a}),this.render()}},a.on("render",function(){a.$root.find("."+b.klass.selectMonth).on("change",function(){var c=this.value;c&&(a.set("highlight",[a.get("view").year,c,a.get("highlight").date]),a.$root.find("."+b.klass.selectMonth).trigger("focus"))}),a.$root.find("."+b.klass.selectYear).on("change",function(){var c=this.value;c&&(a.set("highlight",[c,a.get("view").month,a.get("highlight").date]),a.$root.find("."+b.klass.selectYear).trigger("focus"))})},1).on("open",function(){var d="";c.disabled(c.get("now"))&&(d=":not(."+b.klass.buttonToday+")"),a.$root.find("button"+d+", select").attr("disabled",!1)},1).on("close",function(){a.$root.find("button, select").attr("disabled",!0)},1)}var d=7,e=6,f=a._;c.prototype.set=function(a,b,c){var d=this,e=d.item;return null===b?("clear"==a&&(a="select"),e[a]=b,d):(e["enable"==a?"disable":"flip"==a?"enable":a]=d.queue[a].split(" ").map(function(e){return b=d[e](a,b,c)}).pop(),"select"==a?d.set("highlight",e.select,c):"highlight"==a?d.set("view",e.highlight,c):a.match(/^(flip|min|max|disable|enable)$/)&&(e.select&&d.disabled(e.select)&&d.set("select",e.select,c),e.highlight&&d.disabled(e.highlight)&&d.set("highlight",e.highlight,c)),d)},c.prototype.get=function(a){return this.item[a]},c.prototype.create=function(a,c,d){var e,g=this;return c=void 0===c?a:c,c==-(1/0)||c==1/0?e=c:b.isPlainObject(c)&&f.isInteger(c.pick)?c=c.obj:b.isArray(c)?(c=new Date(c[0],c[1],c[2]),c=f.isDate(c)?c:g.create().obj):c=f.isInteger(c)||f.isDate(c)?g.normalize(new Date(c),d):g.now(a,c,d),{year:e||c.getFullYear(),month:e||c.getMonth(),date:e||c.getDate(),day:e||c.getDay(),obj:e||c,pick:e||c.getTime()}},c.prototype.createRange=function(a,c){var d=this,e=function(a){return a===!0||b.isArray(a)||f.isDate(a)?d.create(a):a};return f.isInteger(a)||(a=e(a)),f.isInteger(c)||(c=e(c)),f.isInteger(a)&&b.isPlainObject(c)?a=[c.year,c.month,c.date+a]:f.isInteger(c)&&b.isPlainObject(a)&&(c=[a.year,a.month,a.date+c]),{from:e(a),to:e(c)}},c.prototype.withinRange=function(a,b){return a=this.createRange(a.from,a.to),b.pick>=a.from.pick&&b.pick<=a.to.pick},c.prototype.overlapRanges=function(a,b){var c=this;return a=c.createRange(a.from,a.to),b=c.createRange(b.from,b.to),c.withinRange(a,b.from)||c.withinRange(a,b.to)||c.withinRange(b,a.from)||c.withinRange(b,a.to)},c.prototype.now=function(a,b,c){return b=new Date,c&&c.rel&&b.setDate(b.getDate()+c.rel),this.normalize(b,c)},c.prototype.navigate=function(a,c,d){var e,f,g,h,i=b.isArray(c),j=b.isPlainObject(c),k=this.item.view;if(i||j){for(j?(f=c.year,g=c.month,h=c.date):(f=+c[0],g=+c[1],h=+c[2]),d&&d.nav&&k&&k.month!==g&&(f=k.year,g=k.month),e=new Date(f,g+(d&&d.nav?d.nav:0),1),f=e.getFullYear(),g=e.getMonth();new Date(f,g,h).getMonth()!==g;)h-=1;c=[f,g,h]}return c},c.prototype.normalize=function(a){return a.setHours(0,0,0,0),a},c.prototype.measure=function(a,b){var c=this;return b?"string"==typeof b?b=c.parse(a,b):f.isInteger(b)&&(b=c.now(a,b,{rel:b})):b="min"==a?-(1/0):1/0,b},c.prototype.viewset=function(a,b){return this.create([b.year,b.month,1])},c.prototype.validate=function(a,c,d){var e,g,h,i,j=this,k=c,l=d&&d.interval?d.interval:1,m=-1===j.item.enable,n=j.item.min,o=j.item.max,p=m&&j.item.disable.filter(function(a){if(b.isArray(a)){var d=j.create(a).pick;d<c.pick?e=!0:d>c.pick&&(g=!0)}return f.isInteger(a)}).length;if((!d||!d.nav&&!d.defaultValue)&&(!m&&j.disabled(c)||m&&j.disabled(c)&&(p||e||g)||!m&&(c.pick<=n.pick||c.pick>=o.pick)))for(m&&!p&&(!g&&l>0||!e&&0>l)&&(l*=-1);j.disabled(c)&&(Math.abs(l)>1&&(c.month<k.month||c.month>k.month)&&(c=k,l=l>0?1:-1),c.pick<=n.pick?(h=!0,l=1,c=j.create([n.year,n.month,n.date+(c.pick===n.pick?0:-1)])):c.pick>=o.pick&&(i=!0,l=-1,c=j.create([o.year,o.month,o.date+(c.pick===o.pick?0:1)])),!h||!i);)c=j.create([c.year,c.month,c.date+l]);return c},c.prototype.disabled=function(a){var c=this,d=c.item.disable.filter(function(d){return f.isInteger(d)?a.day===(c.settings.firstDay?d:d-1)%7:b.isArray(d)||f.isDate(d)?a.pick===c.create(d).pick:b.isPlainObject(d)?c.withinRange(d,a):void 0});return d=d.length&&!d.filter(function(a){return b.isArray(a)&&"inverted"==a[3]||b.isPlainObject(a)&&a.inverted}).length,-1===c.item.enable?!d:d||a.pick<c.item.min.pick||a.pick>c.item.max.pick},c.prototype.parse=function(a,b,c){var d=this,e={};return b&&"string"==typeof b?(c&&c.format||(c=c||{},c.format=d.settings.format),d.formats.toArray(c.format).map(function(a){var c=d.formats[a],g=c?f.trigger(c,d,[b,e]):a.replace(/^!/,"").length;c&&(e[a]=b.substr(0,g)),b=b.substr(g)}),[e.yyyy||e.yy,+(e.mm||e.m)-1,e.dd||e.d]):b},c.prototype.formats=function(){function a(a,b,c){var d=a.match(/[^\x00-\x7F]+|\w+/)[0];return c.mm||c.m||(c.m=b.indexOf(d)+1),d.length}function b(a){return a.match(/\w+/)[0].length}return{d:function(a,b){return a?f.digits(a):b.date},dd:function(a,b){return a?2:f.lead(b.date)},ddd:function(a,c){return a?b(a):this.settings.weekdaysShort[c.day]},dddd:function(a,c){return a?b(a):this.settings.weekdaysFull[c.day]},m:function(a,b){return a?f.digits(a):b.month+1},mm:function(a,b){return a?2:f.lead(b.month+1)},mmm:function(b,c){var d=this.settings.monthsShort;return b?a(b,d,c):d[c.month]},mmmm:function(b,c){var d=this.settings.monthsFull;return b?a(b,d,c):d[c.month]},yy:function(a,b){return a?2:(""+b.year).slice(2)},yyyy:function(a,b){return a?4:b.year},toArray:function(a){return a.split(/(d{1,4}|m{1,4}|y{4}|yy|!.)/g)},toString:function(a,b){var c=this;return c.formats.toArray(a).map(function(a){return f.trigger(c.formats[a],c,[0,b])||a.replace(/^!/,"")}).join("")}}}(),c.prototype.isDateExact=function(a,c){var d=this;return f.isInteger(a)&&f.isInteger(c)||"boolean"==typeof a&&"boolean"==typeof c?a===c:(f.isDate(a)||b.isArray(a))&&(f.isDate(c)||b.isArray(c))?d.create(a).pick===d.create(c).pick:b.isPlainObject(a)&&b.isPlainObject(c)?d.isDateExact(a.from,c.from)&&d.isDateExact(a.to,c.to):!1},c.prototype.isDateOverlap=function(a,c){var d=this,e=d.settings.firstDay?1:0;return f.isInteger(a)&&(f.isDate(c)||b.isArray(c))?(a=a%7+e,a===d.create(c).day+1):f.isInteger(c)&&(f.isDate(a)||b.isArray(a))?(c=c%7+e,c===d.create(a).day+1):b.isPlainObject(a)&&b.isPlainObject(c)?d.overlapRanges(a,c):!1},c.prototype.flipEnable=function(a){var b=this.item;b.enable=a||(-1==b.enable?1:-1)},c.prototype.deactivate=function(a,c){var d=this,e=d.item.disable.slice(0);return"flip"==c?d.flipEnable():c===!1?(d.flipEnable(1),e=[]):c===!0?(d.flipEnable(-1),e=[]):c.map(function(a){for(var c,g=0;g<e.length;g+=1)if(d.isDateExact(a,e[g])){c=!0;break}c||(f.isInteger(a)||f.isDate(a)||b.isArray(a)||b.isPlainObject(a)&&a.from&&a.to)&&e.push(a)}),e},c.prototype.activate=function(a,c){var d=this,e=d.item.disable,g=e.length;return"flip"==c?d.flipEnable():c===!0?(d.flipEnable(1),e=[]):c===!1?(d.flipEnable(-1),e=[]):c.map(function(a){var c,h,i,j;for(i=0;g>i;i+=1){if(h=e[i],d.isDateExact(h,a)){c=e[i]=null,j=!0;break}if(d.isDateOverlap(h,a)){b.isPlainObject(a)?(a.inverted=!0,c=a):b.isArray(a)?(c=a,c[3]||c.push("inverted")):f.isDate(a)&&(c=[a.getFullYear(),a.getMonth(),a.getDate(),"inverted"]);break}}if(c)for(i=0;g>i;i+=1)if(d.isDateExact(e[i],a)){e[i]=null;break}if(j)for(i=0;g>i;i+=1)if(d.isDateOverlap(e[i],a)){e[i]=null;break}c&&e.push(c)}),e.filter(function(a){return null!=a})},c.prototype.nodes=function(a){var b=this,c=b.settings,g=b.item,h=g.now,i=g.select,j=g.highlight,k=g.view,l=g.disable,m=g.min,n=g.max,o=function(a,b){return c.firstDay&&(a.push(a.shift()),b.push(b.shift())),f.node("thead",f.node("tr",f.group({min:0,max:d-1,i:1,node:"th",item:function(d){return[a[d],c.klass.weekdays,'scope=col title="'+b[d]+'"']}})))}((c.showWeekdaysFull?c.weekdaysFull:c.weekdaysShort).slice(0),c.weekdaysFull.slice(0)),p=function(a){return f.node("div"," ",c.klass["nav"+(a?"Next":"Prev")]+(a&&k.year>=n.year&&k.month>=n.month||!a&&k.year<=m.year&&k.month<=m.month?" "+c.klass.navDisabled:""),"data-nav="+(a||-1)+" "+f.ariaAttr({role:"button",controls:b.$node[0].id+"_table"})+' title="'+(a?c.labelMonthNext:c.labelMonthPrev)+'"')},q=function(){var d=c.showMonthsShort?c.monthsShort:c.monthsFull;return c.selectMonths?f.node("select",f.group({min:0,max:11,i:1,node:"option",item:function(a){return[d[a],0,"value="+a+(k.month==a?" selected":"")+(k.year==m.year&&a<m.month||k.year==n.year&&a>n.month?" disabled":"")]}}),c.klass.selectMonth,(a?"":"disabled")+" "+f.ariaAttr({controls:b.$node[0].id+"_table"})+' title="'+c.labelMonthSelect+'"'):f.node("div",d[k.month],c.klass.month)},r=function(){var d=k.year,e=c.selectYears===!0?5:~~(c.selectYears/2);if(e){var g=m.year,h=n.year,i=d-e,j=d+e;if(g>i&&(j+=g-i,i=g),j>h){var l=i-g,o=j-h;i-=l>o?o:l,j=h}return f.node("select",f.group({min:i,max:j,i:1,node:"option",item:function(a){return[a,0,"value="+a+(d==a?" selected":"")]}}),c.klass.selectYear,(a?"":"disabled")+" "+f.ariaAttr({controls:b.$node[0].id+"_table"})+' title="'+c.labelYearSelect+'"')}return f.node("div",d,c.klass.year)};return f.node("div",(c.selectYears?r()+q():q()+r())+p()+p(1),c.klass.header)+f.node("table",o+f.node("tbody",f.group({min:0,max:e-1,i:1,node:"tr",item:function(a){var e=c.firstDay&&0===b.create([k.year,k.month,1]).day?-7:0;return[f.group({min:d*a-k.day+e+1,max:function(){return this.min+d-1},i:1,node:"td",item:function(a){a=b.create([k.year,k.month,a+(c.firstDay?1:0)]);var d=i&&i.pick==a.pick,e=j&&j.pick==a.pick,g=l&&b.disabled(a)||a.pick<m.pick||a.pick>n.pick,o=f.trigger(b.formats.toString,b,[c.format,a]);return[f.node("div",a.date,function(b){return b.push(k.month==a.month?c.klass.infocus:c.klass.outfocus),h.pick==a.pick&&b.push(c.klass.now),d&&b.push(c.klass.selected),e&&b.push(c.klass.highlighted),g&&b.push(c.klass.disabled),b.join(" ")}([c.klass.day]),"data-pick="+a.pick+" "+f.ariaAttr({role:"gridcell",label:o,selected:d&&b.$node.val()===o?!0:null,activedescendant:e?!0:null,disabled:g?!0:null})),"",f.ariaAttr({role:"presentation"})]}})]}})),c.klass.table,'id="'+b.$node[0].id+'_table" '+f.ariaAttr({role:"grid",controls:b.$node[0].id,readonly:!0}))+f.node("div",f.node("button",c.today,c.klass.buttonToday,"type=button data-pick="+h.pick+(a&&!b.disabled(h)?"":" disabled")+" "+f.ariaAttr({controls:b.$node[0].id}))+f.node("button",c.clear,c.klass.buttonClear,"type=button data-clear=1"+(a?"":" disabled")+" "+f.ariaAttr({controls:b.$node[0].id}))+f.node("button",c.close,c.klass.buttonClose,"type=button data-close=true "+(a?"":" disabled")+" "+f.ariaAttr({controls:b.$node[0].id})),c.klass.footer)},c.defaults=function(a){return{labelMonthNext:"Next month",labelMonthPrev:"Previous month",labelMonthSelect:"Select a month",labelYearSelect:"Select a year",monthsFull:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekdaysFull:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],today:"Today",clear:"Clear",close:"Close",closeOnSelect:!0,closeOnClear:!0,format:"d mmmm, yyyy",klass:{table:a+"table",header:a+"header",navPrev:a+"nav--prev",navNext:a+"nav--next",navDisabled:a+"nav--disabled",month:a+"month",year:a+"year",selectMonth:a+"select--month",selectYear:a+"select--year",weekdays:a+"weekday",day:a+"day",disabled:a+"day--disabled",selected:a+"day--selected",highlighted:a+"day--highlighted",now:a+"day--today",infocus:a+"day--infocus",outfocus:a+"day--outfocus",footer:a+"footer",buttonClear:a+"button--clear",buttonToday:a+"button--today",buttonClose:a+"button--close"}}}(a.klasses().picker+"__"),a.extend("pickadate",c)}),function(a){"function"==typeof define&&define.amd?define("picker.time",["picker","jquery"],a):"object"==typeof exports?module.exports=a(require("./picker.js"),require("jquery")):a(Picker,jQuery)}(function(a,b){function c(a,b){var c=this,d=a.$node[0].value,e=a.$node.data("value"),f=e||d,g=e?b.formatSubmit:b.format;c.settings=b,c.$node=a.$node,c.queue={interval:"i",min:"measure create",max:"measure create",now:"now create",select:"parse create validate",highlight:"parse create validate",view:"parse create validate",disable:"deactivate",enable:"activate"},c.item={},c.item.clear=null,c.item.interval=b.interval||30,c.item.disable=(b.disable||[]).slice(0),c.item.enable=-function(a){return a[0]===!0?a.shift():-1}(c.item.disable),c.set("min",b.min).set("max",b.max).set("now"),f?c.set("select",f,{format:g}):c.set("select",null).set("highlight",c.item.now),c.key={40:1,38:-1,39:1,37:-1,go:function(a){c.set("highlight",c.item.highlight.pick+a*c.item.interval,{interval:a*c.item.interval}),this.render()}},a.on("render",function(){var c=a.$root.children(),d=c.find("."+b.klass.viewset),e=function(a){return["webkit","moz","ms","o",""].map(function(b){return(b?"-"+b+"-":"")+a})},f=function(a,b){e("transform").map(function(c){a.css(c,b)}),e("transition").map(function(c){a.css(c,b)})};d.length&&(f(c,"none"),c[0].scrollTop=~~d.position().top-2*d[0].clientHeight,f(c,""))},1).on("open",function(){a.$root.find("button").attr("disabled",!1)},1).on("close",function(){a.$root.find("button").attr("disabled",!0)},1)}var d=24,e=60,f=12,g=d*e,h=a._;c.prototype.set=function(a,b,c){var d=this,e=d.item;return null===b?("clear"==a&&(a="select"),e[a]=b,d):(e["enable"==a?"disable":"flip"==a?"enable":a]=d.queue[a].split(" ").map(function(e){return b=d[e](a,b,c)}).pop(),"select"==a?d.set("highlight",e.select,c):"highlight"==a?d.set("view",e.highlight,c):"interval"==a?d.set("min",e.min,c).set("max",e.max,c):a.match(/^(flip|min|max|disable|enable)$/)&&(e.select&&d.disabled(e.select)&&d.set("select",b,c),e.highlight&&d.disabled(e.highlight)&&d.set("highlight",b,c),"min"==a&&d.set("max",e.max,c)),d)},c.prototype.get=function(a){return this.item[a]},c.prototype.create=function(a,c,f){var i=this;return c=void 0===c?a:c,h.isDate(c)&&(c=[c.getHours(),c.getMinutes()]),b.isPlainObject(c)&&h.isInteger(c.pick)?c=c.pick:b.isArray(c)?c=+c[0]*e+ +c[1]:h.isInteger(c)||(c=i.now(a,c,f)),"max"==a&&c<i.item.min.pick&&(c+=g),"min"!=a&&"max"!=a&&(c-i.item.min.pick)%i.item.interval!==0&&(c+=i.item.interval),c=i.normalize(a,c,f),{hour:~~(d+c/e)%d,mins:(e+c%e)%e,time:(g+c)%g,pick:c%g}},c.prototype.createRange=function(a,c){var d=this,e=function(a){return a===!0||b.isArray(a)||h.isDate(a)?d.create(a):a};return h.isInteger(a)||(a=e(a)),h.isInteger(c)||(c=e(c)),h.isInteger(a)&&b.isPlainObject(c)?a=[c.hour,c.mins+a*d.settings.interval]:h.isInteger(c)&&b.isPlainObject(a)&&(c=[a.hour,a.mins+c*d.settings.interval]),{from:e(a),to:e(c)}},c.prototype.withinRange=function(a,b){return a=this.createRange(a.from,a.to),b.pick>=a.from.pick&&b.pick<=a.to.pick},c.prototype.overlapRanges=function(a,b){var c=this;return a=c.createRange(a.from,a.to),b=c.createRange(b.from,b.to),c.withinRange(a,b.from)||c.withinRange(a,b.to)||c.withinRange(b,a.from)||c.withinRange(b,a.to)},c.prototype.now=function(a,b){var c,d=this.item.interval,f=new Date,g=f.getHours()*e+f.getMinutes(),i=h.isInteger(b);return g-=g%d,c=0>b&&-d>=d*b+g,g+="min"==a&&c?0:d,i&&(g+=d*(c&&"max"!=a?b+1:b)),g},c.prototype.normalize=function(a,b){var c=this.item.interval,d=this.item.min&&this.item.min.pick||0;return b-="min"==a?0:(b-d)%c},c.prototype.measure=function(a,c,f){var g=this;return c||(c="min"==a?[0,0]:[d-1,e-1]),"string"==typeof c?c=g.parse(a,c):c===!0||h.isInteger(c)?c=g.now(a,c,f):b.isPlainObject(c)&&h.isInteger(c.pick)&&(c=g.normalize(a,c.pick,f)),c},c.prototype.validate=function(a,b,c){var d=this,e=c&&c.interval?c.interval:d.item.interval;return d.disabled(b)&&(b=d.shift(b,e)),b=d.scope(b),d.disabled(b)&&(b=d.shift(b,-1*e)),b},c.prototype.disabled=function(a){var c=this,d=c.item.disable.filter(function(d){return h.isInteger(d)?a.hour==d:b.isArray(d)||h.isDate(d)?a.pick==c.create(d).pick:b.isPlainObject(d)?c.withinRange(d,a):void 0});return d=d.length&&!d.filter(function(a){return b.isArray(a)&&"inverted"==a[2]||b.isPlainObject(a)&&a.inverted}).length,-1===c.item.enable?!d:d||a.pick<c.item.min.pick||a.pick>c.item.max.pick},c.prototype.shift=function(a,b){var c=this,d=c.item.min.pick,e=c.item.max.pick;for(b=b||c.item.interval;c.disabled(a)&&(a=c.create(a.pick+=b),!(a.pick<=d||a.pick>=e)););return a},c.prototype.scope=function(a){var b=this.item.min.pick,c=this.item.max.pick;return this.create(a.pick>c?c:a.pick<b?b:a)},c.prototype.parse=function(a,b,c){var d,f,g,i,j,k=this,l={};if(!b||"string"!=typeof b)return b;c&&c.format||(c=c||{},c.format=k.settings.format),k.formats.toArray(c.format).map(function(a){var c,d=k.formats[a],e=d?h.trigger(d,k,[b,l]):a.replace(/^!/,"").length;d&&(c=b.substr(0,e),l[a]=c.match(/^\d+$/)?+c:c),b=b.substr(e)});for(i in l)j=l[i],h.isInteger(j)?i.match(/^(h|hh)$/i)?(d=j,("h"==i||"hh"==i)&&(d%=12)):"i"==i&&(f=j):i.match(/^a$/i)&&j.match(/^p/i)&&("h"in l||"hh"in l)&&(g=!0);return(g?d+12:d)*e+f},c.prototype.formats={h:function(a,b){return a?h.digits(a):b.hour%f||f},hh:function(a,b){return a?2:h.lead(b.hour%f||f)},H:function(a,b){return a?h.digits(a):""+b.hour%24},HH:function(a,b){return a?h.digits(a):h.lead(b.hour%24)},i:function(a,b){return a?2:h.lead(b.mins)},a:function(a,b){return a?4:g/2>b.time%g?"a.m.":"p.m."},A:function(a,b){return a?2:g/2>b.time%g?"AM":"PM"},toArray:function(a){return a.split(/(h{1,2}|H{1,2}|i|a|A|!.)/g)},toString:function(a,b){var c=this;return c.formats.toArray(a).map(function(a){return h.trigger(c.formats[a],c,[0,b])||a.replace(/^!/,"")}).join("")}},c.prototype.isTimeExact=function(a,c){var d=this;return h.isInteger(a)&&h.isInteger(c)||"boolean"==typeof a&&"boolean"==typeof c?a===c:(h.isDate(a)||b.isArray(a))&&(h.isDate(c)||b.isArray(c))?d.create(a).pick===d.create(c).pick:b.isPlainObject(a)&&b.isPlainObject(c)?d.isTimeExact(a.from,c.from)&&d.isTimeExact(a.to,c.to):!1},c.prototype.isTimeOverlap=function(a,c){var d=this;return h.isInteger(a)&&(h.isDate(c)||b.isArray(c))?a===d.create(c).hour:h.isInteger(c)&&(h.isDate(a)||b.isArray(a))?c===d.create(a).hour:b.isPlainObject(a)&&b.isPlainObject(c)?d.overlapRanges(a,c):!1},c.prototype.flipEnable=function(a){var b=this.item;b.enable=a||(-1==b.enable?1:-1)},c.prototype.deactivate=function(a,c){var d=this,e=d.item.disable.slice(0);return"flip"==c?d.flipEnable():c===!1?(d.flipEnable(1),e=[]):c===!0?(d.flipEnable(-1),e=[]):c.map(function(a){for(var c,f=0;f<e.length;f+=1)if(d.isTimeExact(a,e[f])){c=!0;break}c||(h.isInteger(a)||h.isDate(a)||b.isArray(a)||b.isPlainObject(a)&&a.from&&a.to)&&e.push(a)}),e},c.prototype.activate=function(a,c){var d=this,e=d.item.disable,f=e.length;return"flip"==c?d.flipEnable():c===!0?(d.flipEnable(1),e=[]):c===!1?(d.flipEnable(-1),e=[]):c.map(function(a){var c,g,i,j;for(i=0;f>i;i+=1){if(g=e[i],d.isTimeExact(g,a)){c=e[i]=null,j=!0;break}if(d.isTimeOverlap(g,a)){b.isPlainObject(a)?(a.inverted=!0,c=a):b.isArray(a)?(c=a,c[2]||c.push("inverted")):h.isDate(a)&&(c=[a.getFullYear(),a.getMonth(),a.getDate(),"inverted"]);break}}if(c)for(i=0;f>i;i+=1)if(d.isTimeExact(e[i],a)){e[i]=null;break}if(j)for(i=0;f>i;i+=1)if(d.isTimeOverlap(e[i],a)){e[i]=null;break}c&&e.push(c)}),e.filter(function(a){return null!=a})},c.prototype.i=function(a,b){return h.isInteger(b)&&b>0?b:this.item.interval},c.prototype.nodes=function(a){var b=this,c=b.settings,d=b.item.select,e=b.item.highlight,f=b.item.view,g=b.item.disable;return h.node("ul",h.group({min:b.item.min.pick,max:b.item.max.pick,i:b.item.interval,node:"li",item:function(a){a=b.create(a);var i=a.pick,j=d&&d.pick==i,k=e&&e.pick==i,l=g&&b.disabled(a),m=h.trigger(b.formats.toString,b,[c.format,a]);return[h.trigger(b.formats.toString,b,[h.trigger(c.formatLabel,b,[a])||c.format,a]),function(a){return j&&a.push(c.klass.selected),k&&a.push(c.klass.highlighted),f&&f.pick==i&&a.push(c.klass.viewset),l&&a.push(c.klass.disabled),a.join(" ")}([c.klass.listItem]),"data-pick="+a.pick+" "+h.ariaAttr({role:"option",label:m,selected:j&&b.$node.val()===m?!0:null,activedescendant:k?!0:null,disabled:l?!0:null})]}})+h.node("li",h.node("button",c.clear,c.klass.buttonClear,"type=button data-clear=1"+(a?"":" disabled")+" "+h.ariaAttr({controls:b.$node[0].id})),"",h.ariaAttr({role:"presentation"})),c.klass.list,h.ariaAttr({role:"listbox",controls:b.$node[0].id}))},c.defaults=function(a){return{clear:"Clear",format:"h:i A",interval:30,closeOnSelect:!0,closeOnClear:!0,klass:{picker:a+" "+a+"--time",holder:a+"__holder",list:a+"__list",listItem:a+"__list-item",disabled:a+"__list-item--disabled",selected:a+"__list-item--selected",highlighted:a+"__list-item--highlighted",viewset:a+"__list-item--viewset",now:a+"__list-item--now",buttonClear:a+"__button--clear"}}}(a.klasses().picker),a.extend("pickatime",c)}),define("views/jqm/elements/date_pickadate",["views/jqm/elements/date","picker.date","picker.time"],function(a){"use strict";var b=a.extend({renderDate:function(){var a,b=this.model.attributes,c=b.name,d=this;return a=$('<input type="text" />'),a.attr({name:c+"_date","rv-value":"m:_date"}),this.$el.append(a),BMP.Forms.once("formInjected",function(){a.pickadate(d.prepareDateSettings())}),this},renderTime:function(){var a,b=this.model.attributes,c=b.name,d=this;return a=$('<input type="text" />'),a.attr({name:c+"_time","rv-value":"m:_time"}),this.$el.append(a),BMP.Forms.once("formInjected",function(){a.pickatime(d.prepareTimeSettings())}),this},render:function(){var a,b=this.model.get("type");return this.$el.empty(),this.renderLabel(),"time"!==b&&this.renderDate(),"datetime"===b&&(a=$(document.createElement("label")),a.attr({"class":"ui-input-text"}),this.$el.append(a)),"date"!==b&&this.renderTime(),this.bindRivets(),this},prepareDateSettings:function(){var a=this.model.attributes,b={};if(b.format=this.mapDateFormats[a.dateFormat]||"yyyy-mm-dd",a.dateAllowFrom)switch(a.dateAllowFrom){case"now":b.min=new Date;break;case"now_plus":b.min=parseInt(a.dateAllowFromNowPlus,10);break;case"date":b.min=new Date(a.dateAllowFromDate)}if(a.dateAllowTo)switch(a.dateAllowTo){case"now":b.max=new Date;break;case"now_plus":b.max=parseInt(a.dateAllowToNowPlus,10);break;case"date":b.max=new Date(a.dateAllowToDate)}return b},prepareTimeSettings:function(){var a=this.model.attributes,b={};return b.format=this.mapTimeFormats[a.timeFormat]||"HH:i",a.minuteStep&&(b.interval=parseInt(a.minuteStep,10)),b},mapDateFormats:{yyyy_mm_dd:"yyyy-mm-dd",mm_dd_yyyy:"mm-dd-yyyy",dd_mm_yyyy2:"dd/mm/yyyy",yyyy_mm_dd2:"yyyy/mm/dd",mm_dd_yyyy2:"mm/dd/yyyy",dd_mm_yyyy:"dd-mm-yyyy"},mapTimeFormats:{"hh:mm":"HH:i",hh_mm_ss:"HH:i",h_mm_ss:"hh:i A",h_mm:"hh:i A"}});return b}),define("views/jqm/elements/hidden",["views/jqm/element"],function(a){"use strict";var b=a.extend({initialize:function(){this.setElement($('<input type="hidden" />')[0]),a.prototype.initialize.call(this)},render:function(){var a=this.model.get("name");this.$el.attr({name:a,"rv-value":"m:value"}),this.bindRivets()}});return b}),define("views/jqm/elements/number",["views/jqm/element"],function(a){"use strict";var b=a.extend({render:function(){var a,b=this.model.attributes,c=b.name,d=b.min,e=b.max;this.$el.empty(),this.renderLabel(),_.isNumber(d)&&_.isNumber(e)&&b.useSlider?(a=$('<input type="range" />'),a.attr({"data-highlight":!0}),$(document).one("pageinit",$.proxy(this.bindRivets,this))):a=$('<input type="number" />'),a.attr({name:c,"rv-min":"m:min","rv-max":"m:max","rv-value":"m:value","rv-step":"m:step","rv-placeholder":"m:placeholderText"}),a.on("keyup",function(){this.hasOwnProperty("valueAsNumber")?isNaN(this.valueAsNumber)&&(a.prop("value",""),$(this).trigger("change")):"string"!=typeof this.value||this.value.length||(a.prop("value",""),$(this).trigger("change"))}),this.$el.append(a),this.bindRivets()},remove:function(){return this.$el.children("input").off("keyup"),a.prototype.remove.call(this)}});return b}),define("views/jqm/elements/telephone",["views/jqm/element"],function(a){
"use strict";var b=a.extend({render:function(){var a,b=this.model.get("name");this.$el.empty(),this.renderLabel(),a=$('<input type="tel" />'),a.attr({name:b,"rv-value":"m:value","rv-placeholder":"m:placeholderText"}),this.$el.append(a),this.bindRivets()}});return b}),define("views/jqm/elements/text",["views/jqm/element"],function(a){"use strict";var b=a.extend({render:function(){var a,b=this.model.get("name");this.$el.empty(),this.renderLabel(),a=$('<input type="text" />'),a.attr({name:b,"rv-value":"m:value","rv-placeholder":"m:placeholderText"}),this.$el.append(a),this.bindRivets()}});return b}),define("views/jqm/elements/password",["views/jqm/elements/text"],function(a){"use strict";var b=a.extend({render:function(){var a,b=this.model.get("name");this.$el.empty(),this.renderLabel(),a=$('<input type="password" />'),a.attr({name:b,"rv-value":"m:value","rv-placeholder":"m:placeholderText"}),this.$el.append(a),this.bindRivets()}});return b}),define("views/jqm/elements/email",["views/jqm/elements/text"],function(a){"use strict";var b=a.extend({render:function(){var a,b=this.model.get("name");this.$el.empty(),this.renderLabel(),a=$('<input type="email" />'),a.attr({name:b,"rv-value":"m:value","rv-placeholder":"m:placeholderText"}),this.$el.append(a),this.bindRivets()}});return b}),define("views/jqm/elements/url",["views/jqm/elements/text"],function(a){"use strict";var b=a.extend({render:function(){var a,b=this.model.get("name");this.$el.empty(),this.renderLabel(),a=$('<input type="text" />'),a.attr({name:b,"rv-value":"m:value","rv-placeholder":"m:placeholderText"}),this.$el.append(a),this.bindRivets()}});return b}),define("views/jqm/elements/textarea",["views/jqm/elements/text"],function(a){"use strict";var b=a.extend({render:function(){var a,b=this.model.get("name");this.$el.empty(),this.renderLabel(),a=$("<textarea></textarea>"),a.attr({name:b,"rv-value":"m:value","rv-placeholder":"m:placeholderText"}),this.$el.append(a),this.bindRivets()}});return b}),define("views/jqm/elements/boolean",["views/jqm/element"],function(a){"use strict";var b=a.extend({render:function(){var a,b=this.model;this.$el.empty(),this.renderLabel(),a=$("<select></select>"),a.attr({"rv-value":"m:value","data-role":"slider"}),_.forEach(this.model.attributes.options,function(b,c){var d=$('<option value="'+c+'">'+b+"</option>");a.append(d)}),this.$el.append(a),this.bindRivets(),b.on("change:value",this.onValueChange,this)},onValueChange:function(){this.$el.children("select").slider().slider("refresh")}});return b}),define("views/jqm/elements/choice",["views/jqm/element"],function(a){"use strict";var b=a.extend({initialize:function(){a.prototype.initialize.call(this),this.model.on("change:options",this.renderOptions,this)},renderOtherText:function(a){var b=this,c=this.model.attributes.name,d=$('<input type="text" />'),e='<label rv-text="m:label" class="ui-input-text"></label>',f=$('<div data-role="fieldcontain"></div>'),g=$('<div class="ui-input-text"></div>'),h=!!this.$el.find("div[data-role=fieldcontain]").length;f.addClass("ui-field-contain ui-body ui-br"),g.addClass("ui-shadow-inset ui-corner-all ui-btn-shadow ui-body-c"),d.attr({name:c+"_other","class":"ui-input-text ui-body-c"}),a&&!h?(f.append(e),g.append(d),f.append(g),this.$el.append(f),d.on("change",function(){b.model.set("value",b.prepModelValue())})):!a&&h&&this.$el.children("div[data-role=fieldcontain]").remove()},prepModelValue:function(){var a=this.$el.find("input[type = text]"),b=this.fetchValue(),c=this.model.attributes.other||this.model.attributes.canSpecifyOther;return a.length>0&&c&&(_.isArray(b)&&_.contains(b,"other")?(-1!==b.indexOf("other")&&b.splice(b.indexOf("other"),1),b.push(a.val()||"other")):"other"===b&&(b=a.val()||"other")),b}});return b}),define("views/jqm/elements/choicecollapsed",["views/jqm/elements/choice"],function(a){"use strict";var b=a.extend({render:function(){var a,b=this,c=this.model.attributes,d=this.model.attributes.type,e=this.model.attributes.name;this.$el.empty(),this.renderLabel(),a=$("<select></select>"),a.attr("select"===d?{name:e}:{name:e+"[]",multiple:"multiple","data-native-menu":!1}),c.nativeMenu&&a.attr({"data-role":"none"}),this.$el.append(a),this.renderOptions(),this.bindRivets(),a.on("change",function(){b.model.set("value",b.prepModelValue())}),this.model.on("change:value",this.onValueChange,this)},renderOptions:function(){var a,b=this.model.attributes,c=b.type,d=this.$el.find("select");d.empty(),d.append("select"===c?"<option>select one...</option>":"<option>select one or more...</option>"),_.forEach(b.options,function(a,b){var c=$('<option value="'+b+'">'+a+"</option>");d.append(c)}),(b.other||b.canSpecifyOther)&&(a=$('<option value="other">other</option>'),d.append(a)),!b.nativeMenu&&this.$el.children(".ui-select").length&&d.selectmenu("refresh")},onValueChange:function(){var b=!1,c=this.model.attributes,d=this.$el.find("select");"select"===c.type?$.inArray(c.value,_.keys(c.options))<0?""===c.value?d.find("option:not([value])").prop("selected",!0):(b=!0,d.val("other")):d.val(c.value):(d.val(c.value),_.difference(c.value,_.keys(c.options)).length>0&&(b=!0,d.val(_.union(c.value,["other"])))),c.nativeMenu||(d.selectmenu(),d.selectmenu("refresh")),a.prototype.renderOtherText.call(this,b),"select"===c.type?$.inArray(c.value,_.keys(c.options))<0&&"other"!==c.value&&this.$el.find("input[type = text]").val(c.value):_.difference(c.value,_.keys(c.options)).length>0&&!_.contains(c.value,"other")&&this.$el.find("input[type = text]").val(_.difference(c.value,_.keys(c.options)))},fetchValue:function(){var a=this.model.attributes,b=this.$el.find("select").val();return("select"===a.type&&"select one..."===b||_.contains(b,"select one or more..."))&&(b=""),b}});return b}),define("views/jqm/elements/choiceexpanded",["views/jqm/elements/choice"],function(a){"use strict";var b=a.extend({remove:function(){var b=this.attributes.type;return"select"!==b&&this.$el.find("input").off("click"),a.prototype.remove.call(this)},render:function(){var a,b=this.model.attributes,c=b.type;this.$el.empty(),a=$("<fieldset></fieldset>").attr({"data-role":"controlgroup"}),"horizontal"===b.layout&&a.attr({"data-type":"horizontal"}),a.prepend($("<legend></legend>").text(b.label)),this.$el.append(a),this._renderOptions(),"select"===c?(this.bindRivets(),this.model.on("change:value",this.onSelectValueChange,this)):this.model.on("change:value",this.onMultiValueChange,this)},_renderOptions:function(){var a=this,b=this.$el.children("fieldset"),c=this.model.attributes,d=c.type,e=c.options,f=c.name,g="select"===d?"radio":"checkbox",h="select"===d?f+"_"+a.cid:f+"[]",i=b.children(".ui-controlgroup-controls");b.children("label").remove(),i=b,_.forEach(e,function(a,b){var c=$("<label>"+a+"</label>"),d=$('<input type="'+g+'" />');d.attr({name:h,value:b}),c.prepend(d),i.append(c)}),(this.model.attributes.other||this.model.attributes.canSpecifyOther)&&i.append('<label><input name="'+h+'" type="'+g+'" value="other" />other</label>'),"select"===d?i.find("input").on("click",function(){a.model.set("value",a.prepModelValue())}):i.find("input").on("click",{view:this,model:this.model},this.onMultiInputClick)},renderOptions:function(){this.render(),this.$el.find("label > input").checkboxradio(),this.$el.children("fieldset").controlgroup().addClass("ui-field-contain")},onMultiInputClick:function(a){var b=a.data.view,c=a.data.model;c.set("value",b.prepModelValue())},onMultiValueChange:function(){var b=this,c=this.model,d=b.$el.find("input[type=radio],input[type=checkbox]"),e=c.attributes.value,f=!1;_.isArray(e)||(e=[]),d.each(function(a,b){var c=$(b);c.prop("checked",-1!==_.indexOf(e,c.val()))}),(_.contains(e,"other")||_.difference(e,_.keys(c.attributes.options)).length>0)&&(f=!0,b.$el.find("input[value = other]").prop("checked",!0)),d.checkboxradio().checkboxradio("refresh"),a.prototype.renderOtherText.call(this,f),_.difference(e,_.keys(c.attributes.options)).length>0&&b.$el.find("input[type = text]").val(_.difference(e,_.keys(c.attributes.options)))},onSelectValueChange:function(){var b,c,d=this,e=d.$el.find("input[type=radio],input[type=checkbox]");_.contains(_.keys(this.model.get("options")),this.model.get("value"))?this.$el.find('[value = "'+this.model.get("value")+'"]').prop("checked",!0):""===this.model.get("value")?this.$el.find("input:checked").prop("checked",!1):this.$el.find("[value = other]").prop("checked",!0),e.checkboxradio().checkboxradio("refresh"),b=this.$el.find("label[data-icon=radio-on]"),c=$.map(b,function(a){return $(a).text().trim()}),a.prototype.renderOtherText.call(this,_.contains(c,"other")),_.contains(_.keys(this.model.get("options")),this.model.get("value"))||"other"===this.model.get("value")||this.$el.find("input[type = text]").val(this.model.get("value"))},fetchValue:function(){var a,b,c=this.model.attributes;switch(c.type){case"select":a=this.$el.find("input:checked").val();break;default:b=this.$el.find("input:checked"),a=_.map(b,function(a){return $(a).val()}),a.length<=0&&(a="")}return a}});return b}),define("text",["module"],function(a){"use strict";var b,c,d,e,f,g=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],h=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,i=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,j="undefined"!=typeof location&&location.href,k=j&&location.protocol&&location.protocol.replace(/\:/,""),l=j&&location.hostname,m=j&&(location.port||void 0),n={},o=a.config&&a.config()||{};return b={version:"2.0.14",strip:function(a){if(a){a=a.replace(h,"");var b=a.match(i);b&&(a=b[1])}else a="";return a},jsEscape:function(a){return a.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:o.createXhr||function(){var a,b,c;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(b=0;3>b;b+=1){c=g[b];try{a=new ActiveXObject(c)}catch(d){}if(a){g=[c];break}}return a},parseName:function(a){var b,c,d,e=!1,f=a.lastIndexOf("."),g=0===a.indexOf("./")||0===a.indexOf("../");return-1!==f&&(!g||f>1)?(b=a.substring(0,f),c=a.substring(f+1)):b=a,d=c||b,f=d.indexOf("!"),-1!==f&&(e="strip"===d.substring(f+1),d=d.substring(0,f),c?c=d:b=d),{moduleName:b,ext:c,strip:e}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(a,c,d,e){var f,g,h,i=b.xdRegExp.exec(a);return i?(f=i[2],g=i[3],g=g.split(":"),h=g[1],g=g[0],!(f&&f!==c||g&&g.toLowerCase()!==d.toLowerCase()||(h||g)&&h!==e)):!0},finishLoad:function(a,c,d,e){d=c?b.strip(d):d,o.isBuild&&(n[a]=d),e(d)},load:function(a,c,d,e){if(e&&e.isBuild&&!e.inlineText)return void d();o.isBuild=e&&e.isBuild;var f=b.parseName(a),g=f.moduleName+(f.ext?"."+f.ext:""),h=c.toUrl(g),i=o.useXhr||b.useXhr;return 0===h.indexOf("empty:")?void d():void(!j||i(h,k,l,m)?b.get(h,function(c){b.finishLoad(a,f.strip,c,d)},function(a){d.error&&d.error(a)}):c([g],function(a){b.finishLoad(f.moduleName+"."+f.ext,f.strip,a,d)}))},write:function(a,c,d,e){if(n.hasOwnProperty(c)){var f=b.jsEscape(n[c]);d.asModule(a+"!"+c,"define(function () { return '"+f+"';});\n")}},writeFile:function(a,c,d,e,f){var g=b.parseName(c),h=g.ext?"."+g.ext:"",i=g.moduleName+h,j=d.toUrl(g.moduleName+h)+".js";b.load(i,d,function(c){var d=function(a){return e(j,a)};d.asModule=function(a,b){return e.asModule(a,j,b)},b.write(a,i,d,f)},f)}},"node"===o.env||!o.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]&&!process.versions["atom-shell"]?(c=require.nodeRequire("fs"),b.get=function(a,b,d){try{var e=c.readFileSync(a,"utf8");"\ufeff"===e[0]&&(e=e.substring(1)),b(e)}catch(f){d&&d(f)}}):"xhr"===o.env||!o.env&&b.createXhr()?b.get=function(a,c,d,e){var f,g=b.createXhr();if(g.open("GET",a,!0),e)for(f in e)e.hasOwnProperty(f)&&g.setRequestHeader(f.toLowerCase(),e[f]);o.onXhr&&o.onXhr(g,a),g.onreadystatechange=function(b){var e,f;4===g.readyState&&(e=g.status||0,e>399&&600>e?(f=new Error(a+" HTTP status: "+e),f.xhr=g,d&&d(f)):c(g.responseText),o.onXhrComplete&&o.onXhrComplete(g,a))},g.send(null)}:"rhino"===o.env||!o.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?b.get=function(a,b){var c,d,e="utf-8",f=new java.io.File(a),g=java.lang.System.getProperty("line.separator"),h=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(f),e)),i="";try{for(c=new java.lang.StringBuffer,d=h.readLine(),d&&d.length()&&65279===d.charAt(0)&&(d=d.substring(1)),null!==d&&c.append(d);null!==(d=h.readLine());)c.append(g),c.append(d);i=String(c.toString())}finally{h.close()}b(i)}:("xpconnect"===o.env||!o.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(d=Components.classes,e=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),f="@mozilla.org/windows-registry-key;1"in d,b.get=function(a,b){var c,g,h,i={};f&&(a=a.replace(/\//g,"\\")),h=new FileUtils.File(a);try{c=d["@mozilla.org/network/file-input-stream;1"].createInstance(e.nsIFileInputStream),c.init(h,1,0,!1),g=d["@mozilla.org/intl/converter-input-stream;1"].createInstance(e.nsIConverterInputStream),g.init(c,"utf-8",c.available(),e.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),g.readString(c.available(),i),g.close(),c.close(),b(i.value)}catch(j){throw new Error((h&&h.path||"")+": "+j)}}),b}),define("text!views/jqm/templates/location.html",[],function(){return'<div id="bmp-forms-location" data-role="popup" class="ui-content">\n    <form method="post" action="" class="sigPad">\n          <div id="map-canvas"></div>\n          <input type="hidden" name="output" class="output">\n        <fieldset class="ui-grid-a">\n          <div class="ui-block-a">\n              <button type="submit" data-role="button">Done</button>\n          </div>\n          <div class="ui-block-b">\n              <button data-action="cancel" data-role="button">Cancel</button>\n          </div>\n        </fieldset>\n    </form>\n</div>\n'}),define("views/jqm/elements/location",["views/jqm/element","text!views/jqm/templates/location.html"],function(a,b){"use strict";var c=a.extend({render:function(){var a,b,d,e,f=window.i18n["BMP/Forms/elements"],g=this;BMP.Forms.loadMapScript(),this.$el.empty(),this.renderLabel(),e=$('<div class="ui-grid-a"></div>'),a=$('<div class="ui-block-a"><button type="button" data-theme="c"></button></div>'),a.find("button").text(f.LOCATION_BUTTON),b=$('<div class="ui-block-b"><button data-action="clear" type="button" data-theme="c">Clear</button></div>'),e.append(a),e.append(b),d=$('<div class="ui-input-text"></div>'),d.append(e),this.$el.append(d),this.renderFigure(),a.find("button").on("click",$.proxy(c.onButtonClick,this)),b.find("button").on("click",$.proxy(c.onClear,this)),this.bindRivets(),this.model.on("change:value",this.renderFigure,this),BMP.Forms.once("formInjected",function(){g.model.on("change:value",g.setClearButton,g),g.setClearButton()})},setClearButton:function(){var a=this.model.get("value"),b=this.$el.find("[data-action=clear]");b.button(a?"enable":"disable")},renderFigure:function(){var a,b,c,d,e,f,g=this,h=g.model.attributes;if("string"==typeof h.value)try{c=JSON.parse(h.value)}catch(i){c=null}else c=h.value;g.$el.children("figure").remove(),c&&c.latitude&&c.longitude&&(a=$("<figure></figure>"),b=$("<figcaption></figcaption>").appendTo(a),e="lat: "+c.latitude+"; long: "+c.longitude,c.accuracy&&(e+="; &plusmn;"+c.accuracy+"M"),b.html(e),d=$("<img />"),f="http://maps.google.com/maps/api/staticmap?markers=",f+=c.latitude+","+c.longitude,f+="&size=300x200&zoom=20&maptype=hybrid&sensor=true",d.attr("src",f),d.css({"max-height":"7em","max-width":"100%"}),a.append(d),g.$el.append(a))},remove:function(){return this.$el.children("button").off("click"),this.model.off("change:value",this.renderFigure,this),a.prototype.remove.call(this)}},{onDone:function(a){var b=$("#bmp-forms-location").find("input").val();if(b){try{b=JSON.parse(b)}catch(c){b=void 0}this.model.set("value",b)}return $("#bmp-forms-location").popup("close"),a.preventDefault(),!1},onClear:function(a){return this.model.unset("value"),a.preventDefault(),!1},onCancel:function(a){return $("#bmp-forms-location").popup("close"),a.preventDefault(),!1},onButtonClick:function(a){var d,e,f=window.i18n["BMP/Forms/elements"],g=this,h=this.model,i=$(b),j={dismissible:!0,history:!1,afterclose:function(a,b){a&&b&&i.remove()}},k=$(window),l=k.innerWidth(),m=k.innerHeight();return $(document.body).append(i),i.find("#map-canvas").height(m-100),i.find("#map-canvas").width(l-60),d=i.children("form"),d.on("submit",$.proxy(c.onDone,this)),g.$el.find("button").first().button("disable"),g.$el.find(".ui-btn-text").first().text(f.LOCATING_SHORT),e=h.get("value"),!_.isEmpty(e)&&e.latitude&&e.longitude?(c.initializeMap(e,i),g.$el.find("button").first().button("enable"),g.$el.find(".ui-btn-text").first().text(f.LOCATION_BUTTON)):h.getGeoLocation().then(function(){e=h.get("currentlocation"),i.find("input").val(JSON.stringify(e)),c.initializeMap(e,i),g.$el.find("button").first().button("enable"),g.$el.find(".ui-btn-text").first().text(f.LOCATION_BUTTON)},function(){g.$el.find("button").first().button("enable"),g.$el.find(".ui-btn-text").first().text(f.LOCATION_BUTTON)}),d.trigger("create"),i.popup(j),i.popup("open"),d.on("click","[data-action=cancel]",$.proxy(c.onCancel,this)),a.preventDefault(),!1},initializeMap:function(a,b){var c,d,e,f,g,h=window.i18n["BMP/Forms/warning"];d=new google.maps.LatLng(a.latitude,a.longitude),e={zoom:17,center:d,mapTypeId:google.maps.MapTypeId.ROADMAP};try{c=new google.maps.Map(b.find("#map-canvas")[0],e)}catch(i){b.find("#map-canvas").text(h.ERROR_GOOGLE_MAP)}f=new google.maps.Marker({position:d,map:c,draggable:!0}),google.maps.event.addListener(f,"dragend",function(){g={latitude:f.getPosition().lat(),longitude:f.getPosition().lng(),altitude:null,accuracy:null,altitudeAccuracy:null,heading:null,speed:null},b.find("input").val(JSON.stringify(g))})}});return c}),define("views/jqm/elements/file",["views/jqm/element"],function(a){"use strict";var b,c;return c=function(a){for(var b=["bytes","KB","MB","GB"],c=0,d=1;a>1024*d&&c<b.length;)d*=1024,c+=1;return a=Math.round(10*a/d)/10,a+" "+b[c]},b=a.extend({render:function(){this.$el.empty(),this.renderLabel(),this.renderControls(),this.renderFigure(),this.bindRivets(),this.model.on("change:blob",function(){this.model.updateWarning(),_.isEmpty(this.model.attributes.warning)?this.renderWarning():this.renderFigure()},this),this.model.on("change:progress",this.renderProgress,this)},renderControls:function(){var a=$('<input type="file" />'),b=this.model.get("name");a.attr({name:b,"rv-accept":"m:accept"}),a.prop("capture",!!this.model.get("capture")),this.$el.append(a),a.on("change",function(a){this.onInputChange(a)}.bind(this))},renderFigure:function(){var a,b,d,e,f;d=this.model.attributes.blob,this.$el.children("figure").remove(),d&&(e=[],a=$("<figure></figure>"),b=$("<figcaption></figcaption>").appendTo(a),d.type&&e.push(d.type),d.size&&_.isNumber(d.size)&&e.push(c(d.size)),b.html(e.join(" &mdash; ")),_.isString(d.type)&&0===d.type.indexOf("image/")&&(f=$("<img />"),f.attr("src",d.toDataURI()),d.width&&d.height&&f.attr({height:d.height,width:d.width}),f.css({"max-height":"6em","max-width":"100%"}),a.append(f)),this.$el.append(a))},renderProgress:function(){var a,b=this.model.get("progress"),c=this.$el.children("figure").first(),d=c.children("progress");return b?(a={value:b.loaded},d.length||(d=$("<progress></progress>").appendTo(c)),b.lengthComputable?a.max=b.total:d.removeAttr("max"),void d.attr(a)):void(d.length&&d.remove())},remove:function(){return this.$el.children("input").off("change"),this.model.off("change:blob",this.renderFigure,this),this.model.off("change:progress",this.renderProgress,this),a.prototype.remove.call(this)},onInputChange:function(a){var b=this,c=a&&$(a.target),d=c.data("fileInput");d.size()&&d.getBlob().then(function(a){b.model.set("blob",a)})}})}),define("text!views/jqm/templates/signaturePad.html",[],function(){return'<div id="bmp-forms-dialog-signature" data-role="popup" class="ui-content">\n    <form method="post" action="" class="sigPad">\n        <div class="sig sigWrapper">\n            <div class="typed"></div>\n            <canvas class="pad" style="cursor: crosshair; -ms-touch-action: none;"></canvas>\n            <input type="hidden" name="output" class="output">\n        </div>\n        <fieldset class="ui-grid-a">\n            <div class="ui-block-a">\n                <button type="submit" data-role="button">Done</button>\n            </div>\n            <div class="ui-block-b">\n                <!--<button type="reset" data-role="button">Reset</button>-->\n                <button data-action="clear" data-role="button">Clear</button>\n            </div>\n        </fieldset>\n    </form>\n</div>\n'}),define("views/jqm/elements/draw",["views/jqm/elements/file","text!views/jqm/templates/signaturePad.html"],function(a,b){"use strict";var c,d;return d=a.extend({renderControls:function(){var a,b;a=$("<button />"),a.text("Signature"),b=$('<div class="ui-input-text"></div>'),b.append(a),this.$el.append(b),a.on("click",$.proxy(d.onButtonClick,this))},remove:function(){return this.$el.children("button").off("click"),this.model.off("change:blob",this.renderFigure,this),a.prototype.remove.call(this)}},{onSignatureSubmit:function(a){var b=c.getSignatureImage("image/jpeg");return this.model.setBlobFromString(b),$("#bmp-forms-dialog-signature").popup("close"),a.preventDefault(),!1},onSignatureClear:function(a){return this.model.unset("blob"),$("#bmp-forms-dialog-signature").popup("close"),a.preventDefault(),!1},onButtonClick:function(a){var e,f=$(b),g={dismissible:!0,history:!1,afterclose:function(a,b){a&&b&&(f.remove(),c=null)}},h=$(window),i=h.innerWidth(),j=h.innerHeight();return f.find("[data-role=header] > h2").text(this.model.get("label")),$(document.body).append(f),f.find("canvas").attr({height:Math.min(Math.floor(4*(i-60)/9),j-60),width:i-60}),e=f.children("form"),e.on("submit",$.proxy(d.onSignatureSubmit,this)),c=e.signaturePad({drawOnly:!0,validateFields:!1,lineWidth:0,output:null,sigNav:null,name:null,typed:null,clear:"input[type=reset]",typeIt:null,drawIt:null,typeItDesc:null,drawItDesc:null}),e.trigger("create"),f.popup(g),f.popup("open"),e.on("click","[data-action=clear]",$.proxy(d.onSignatureClear,this)),a.preventDefault(),!1}})}),define("views/jqm/elements/bg_draw",["views/jqm/elements/file"],function(a){"use strict";var b;return b=a.extend({renderControls:function(){var a,c;a=$("<button />"),a.text("Signature"),c=$('<div class="ui-input-text"></div>'),c.append(a),this.$el.append(c),a.on("click",$.proxy(b.onButtonClick,this))},remove:function(){return this.$el.children("button").off("click"),this.model.off("change:blob",this.renderFigure,this),a.prototype.remove.call(this)}},{onButtonClick:function(a){var b=this.model,c=$(a.target),d=$(window),e=c.offset(),f=c.width(),g={canvasButtonOriginX:320,canvasButtonOriginY:320,canvasWidth:600,canvasHeight:300,destinationType:window.BGTouchDraw.DestinationType.DATA_URL,encodingType:window.BGTouchDraw.EncodingType.JPEG},h=this.model.toCameraOptions()||{};return h.canvasButtonOriginX=e.left+Math.floor(f/2),h.canvasButtonOriginY=e.top-d.scrollTop(),h=$.extend({},g,h),window.navigator.bgtouchdraw.getDrawing(b.setBlobFromString.bind(b),$.noop,h),a.preventDefault(),!1}})}),define("text!views/jqm/templates/bg_image.html",[],function(){return'<div class="ui-grid-a">\n    <div class="ui-block-a">\n        <button></button>\n    </div>\n    <div class="ui-block-b">\n        <button></button>\n    </div>\n</div>'}),define("views/jqm/elements/bg_image",["views/jqm/elements/file","text!views/jqm/templates/bg_image.html"],function(a,b){"use strict";var c;return c=a.extend({renderControls:function(){var a,d,e,f;try{f=window.PictureSourceType||navigator.camera.PictureSourceType}catch(g){f=f||{}}e=$('<div class="ui-input-text"></div>'),e.append(b),a=e.find("button").first(),a.text("Camera"),a.data("SourceType",f.CAMERA),d=e.find("button").last(),d.text("Gallery"),d.data("SourceType",f.PHOTO_LIBRARY),this.$el.append(e),a.on("click",$.proxy(c.onButtonClick,this)),d.on("click",$.proxy(c.onButtonClick,this))},remove:function(){return this.$el.find("button").off("click"),this.model.off("change:blob",this.renderFigure,this),a.prototype.remove.call(this)}},{onButtonClick:function(a){var b=this.model,c=$(a.target),d=this.model.toCameraOptions()||{};return d.sourceType=c.data("SourceType"),window.navigator.camera.getPicture(b.setBlobFromString.bind(b),$.noop,d),a.preventDefault(),!1}})}),define("views/jqm/elements/button",["views/jqm/element"],function(a){"use strict";var b=a.extend({remove:function(){return this.$el.children(".ui-btn").children("button").off("click"),a.prototype.remove.call(this)},render:function(){var a,b,c=this.model.get("name"),d=this.model.attributes,e=this;b=c,_.isEmpty(d.label)||(b=d.label),this.$el.empty(),a=$("<button></button>").attr({type:"button",name:c}).text(b),a.on("click",function(){e.model.trigger("change")}),this.$el.append(a),this.bindRivets()}});return b}),define("views/jqm/elements/readonly",["views/jqm/element"],function(a){"use strict";var b=a.extend({render:function(){var a;this.$el.empty(),this.renderLabel(),a=$(document.createElement("label")),a.attr({"rv-text":"m:value","class":"ui-input-text"}),this.$el.append(a),this.bindRivets()}});return b}),define("views/jqm/elements/blob_readonly",["views/jqm/elements/file"],function(a){"use strict";var b;return b=a.extend({renderControls:function(){}})}),define("views/jqm/elements/location_readonly",["views/jqm/element","views/jqm/elements/location"],function(a,b){"use strict";var c;return c=b.extend({render:function(){this.$el.empty(),this.renderLabel(),this.bindRivets(),this.model.on("change:value",this.renderFigure,this)}})}),define("views/jqm/elements/select_readonly",["views/jqm/element"],function(a){"use strict";var b=a.extend({render:function(){var a,b,c=this,d=c.model.attributes,e=d.options;this.$el.empty(),this.renderLabel(),setTimeout(function(){b=e[d.value],a='<label class="ui-input-text">'+b+"</label>",c.$el.append(a)},100),this.bindRivets()}});return b}),define("views/jqm/elements/multi_readonly",["views/jqm/element"],function(a){"use strict";var b=a.extend({render:function(){var a,b,c=this,d=c.model.attributes,e=d.options,f=[];this.$el.empty(),this.renderLabel(),setTimeout(function(){b=d.value,_.forEach(e,function(a,c){_.contains(b,c)&&f.push(a)}),a='<label class="ui-input-text">'+f+"</label>",c.$el.append(a)},100),this.bindRivets()}});return b}),define("views/jqm/elements/webrtc_image",["views/jqm/elements/file"],function(a){"use strict";var b;return b=a.extend({renderControls:function(){var a,c;c=$('<a class="webrtc_image ui-icon-camera" data-role="button">Camera</a>'),a=$('<div class="ui-input-text"></div>'),a.append(c),this.$el.append(a),c.on("click",$.proxy(b.onButtonClick,this))},remove:function(){return a.prototype.remove.call(this)}},{onButtonClick:function(){var a,b,c,d,e,f,g,h=this,i=$('<div data-role="popup"><h1>Tap to snap</h1></div>'),j=$("<select></select>"),k=$('<video autoplay width="100%"/>'),l=$('<img style="display: none;"/>'),m=$("<div></div>"),n=$("<div></div>"),o=$('<a data-role="button" data-inline="true">Rotate</a>'),p=$('<a data-rel="back" data-role="button" data-inline="true">Cancel</a>'),q=$('<a class="ui-disabled" data-role="button" data-inline="true">Recapture</a>'),r=$('<a class="ui-disabled" data-role="button" data-inline="true">Use</a>'),s=$("<canvas></canvas>"),t=0;navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,n.append(o,p,q,r),i.append(k,l,n),this.$el.append(i),d=function(){var a,b,c,d=k[0];0===t||180===t?(a=d.videoHeight,b=d.videoWidth):(a=d.videoWidth,b=d.videoHeight),s.attr("width",b),s.attr("height",a),c=s[0].getContext("2d"),0===t?c.drawImage(d,0,0):90===t?(c.rotate(t*Math.PI/180),c.drawImage(d,0,-b)):180===t?(c.rotate(t*Math.PI/180),c.drawImage(d,-b,-a)):270===t&&(c.rotate(t*Math.PI/180),c.drawImage(d,-a,0)),l.attr("src",s[0].toDataURL("image/png")),k.hide(),l.show(),q.removeClass("ui-disabled"),r.removeClass("ui-disabled")},e=function(){l.hide(),k.show()},g=function(){h.model.setBlobFromString(s[0].toDataURL()),i.popup("close")},f=function(){var a;t=(t+90)%360,a="rotate("+t+"deg)",k.css({"-webkit-transform":a,transform:a}),90===t||270===t?k.css("padding","13% 0"):k.css("padding","0 0")},a=function(a){var c={video:!0,audio:!1};a&&(c.video={optional:[{sourceId:a}]}),navigator.getMedia(c,function(a){b=a,k.attr("src",window.URL.createObjectURL(b)),k.on("click",d),l.hide(),k.show()},function(){m.append("Please allow access to the camera"),i.prepend(m),i.popup("open")})},c=function(){b.stop&&b.stop(),i.remove(),i=j=k=l=m=n=o=p=q=r=s=null},i.popup({afteropen:function(){a(),o.on("click",f),q.on("click",e),r.on("click",g)},afterclose:function(){o.off(),q.off(),r.off(),c()}}),"undefined"!=typeof MediaStreamTrack&&"undefined"!=typeof MediaStreamTrack.getSources?MediaStreamTrack.getSources(function(b){var d,e,f=0,g=0;for(f=0;f<b.length;f++)d=b[f],"video"===d.kind&&(g++,e=d.label||"Camera "+g,j.append('<option value="'+d.id+'">'+e+"</option>"));g>1&&(i.prepend(j),j.on("change",function(){c(),a(j.val())})),i.trigger("create"),i.popup("open")}):(i.trigger("create"),i.popup("open"))}})}),define("views/forms3jqm",["require","rivets","views/jqm/form","views/jqm/subform","views/jqm/elements/subform","views/jqm/page","views/jqm/section","views/jqm/element","views/jqm/elements/heading","views/jqm/elements/message","views/jqm/elements/date","views/jqm/elements/date_pickadate","views/jqm/elements/hidden","views/jqm/elements/number","views/jqm/elements/telephone","views/jqm/elements/password","views/jqm/elements/email","views/jqm/elements/url","views/jqm/elements/text","views/jqm/elements/textarea","views/jqm/elements/boolean","views/jqm/elements/choicecollapsed","views/jqm/elements/choiceexpanded","views/jqm/elements/location","views/jqm/elements/file","views/jqm/elements/draw","views/jqm/elements/bg_draw","views/jqm/elements/bg_image","views/jqm/elements/button","views/jqm/elements/readonly","views/jqm/elements/blob_readonly","views/jqm/elements/location_readonly","views/jqm/elements/select_readonly","views/jqm/elements/multi_readonly","views/jqm/elements/webrtc_image"],function(a){var b=a("rivets");return $.mobile.page.prototype.options.keepNative="[type^=time], [type^=date]",b.adapters[":"]={subscribe:function(a,b,c){a.on("change:"+b,c)},unsubscribe:function(a,b,c){a.off("change:"+b,c)},read:function(a,b){return a.get(b)},publish:function(a,b,c){a.set(b,c)}},{Form:a("views/jqm/form"),SubForm:a("views/jqm/subform"),SubFormElement:a("views/jqm/elements/subform"),Page:a("views/jqm/page"),Section:a("views/jqm/section"),Element:a("views/jqm/element"),HeadingElement:a("views/jqm/elements/heading"),MessageElement:a("views/jqm/elements/message"),DateElement:a("views/jqm/elements/date"),DatePickadateElement:a("views/jqm/elements/date_pickadate"),HiddenElement:a("views/jqm/elements/hidden"),NumberElement:a("views/jqm/elements/number"),TelephoneElement:a("views/jqm/elements/telephone"),PasswordElement:a("views/jqm/elements/password"),EmailElement:a("views/jqm/elements/email"),URLElement:a("views/jqm/elements/url"),TextElement:a("views/jqm/elements/text"),TextAreaElement:a("views/jqm/elements/textarea"),BooleanElement:a("views/jqm/elements/boolean"),ChoiceCollapsedElement:a("views/jqm/elements/choicecollapsed"),ChoiceExpandedElement:a("views/jqm/elements/choiceexpanded"),LocationElement:a("views/jqm/elements/location"),FileElement:a("views/jqm/elements/file"),DrawElement:a("views/jqm/elements/draw"),BGDrawElement:a("views/jqm/elements/bg_draw"),BGImageElement:a("views/jqm/elements/bg_image"),ButtonElement:a("views/jqm/elements/button"),ReadOnlyElement:a("views/jqm/elements/readonly"),BlobReadOnlyElement:a("views/jqm/elements/blob_readonly"),
LocationReadOnlyElement:a("views/jqm/elements/location_readonly"),SelectReadOnlyElement:a("views/jqm/elements/select_readonly"),MultiReadOnlyElement:a("views/jqm/elements/multi_readonly"),WebRTCImageElement:a("views/jqm/elements/webrtc_image")}}),function(a,b){"use strict";"function"==typeof define&&define.amd?define("bicyclepump",[],b):"object"==typeof exports?module.exports=b():a.BicyclePump=b()}(this,function(){"use strict";var a,b,c;return b="function"==typeof setImmediate?function(a){setImmediate(a)}:"object"==typeof process&&process&&process.nextTick?process.nextTick:function(a){setTimeout(a,0)},c=function(a,c,d){var e,f,g,h,i,j;e=a.length,h=function(){return!0},d=d||h,i=function(a){a=a||new Error("inflation returned no result"),a instanceof Error?(d(a),d=h):b(function(){d(null,a)})},j=function(){b(g)},(g=function(){e-=1,(f=a[e])(c,i,j)})()},a=function(){var a;return a=[],this.addInflator=function(b){"function"==typeof b&&a.push(b)},this.removeInflator=function(b){var c;c=a.indexOf(b),a.splice(c,1)},this.getInflators=function(){var b;return b=[],b.push.apply(b,a),b},this.inflate=function(b,d){var e;if(!b)throw new Error("need something to inflate");if(!a.length)throw new Error("need to register an Inflator first");return e=function(a,b){"function"==typeof d&&d(a,b)},"function"==typeof Promise?new Promise(function(d,f){c(a,b,function(a,b){e(a,b),a?f(a):d(b)})}):void c(a,b,e)},this}}),function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define("formslib",[],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.FormsLib=a()}}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(b,c,d){(function(b){!function(){function d(a){var b=!1;return function(){if(b)throw new Error("Callback was already called.");b=!0,a.apply(e,arguments)}}var e,f,g={};e=this,null!=e&&(f=e.async),g.noConflict=function(){return e.async=f,g};var h=Object.prototype.toString,i=Array.isArray||function(a){return"[object Array]"===h.call(a)},j=function(a,b){for(var c=0;c<a.length;c+=1)b(a[c],c,a)};"undefined"!=typeof b&&b.nextTick?(g.nextTick=b.nextTick,g.setImmediate="undefined"!=typeof setImmediate?function(a){setImmediate(a)}:g.nextTick):"function"==typeof setImmediate?(g.nextTick=function(a){setImmediate(a)},g.setImmediate=g.nextTick):(g.nextTick=function(a){setTimeout(a,0)},g.setImmediate=g.nextTick),g.queue=function(a,b){function c(a,b,c,d){return a.started||(a.started=!0),i(b)||(b=[b]),0==b.length?g.setImmediate(function(){a.drain&&a.drain()}):void j(b,function(b){var e={data:b,callback:"function"==typeof d?d:null};c?a.tasks.unshift(e):a.tasks.push(e),a.saturated&&a.tasks.length===a.concurrency&&a.saturated(),g.setImmediate(a.process)})}void 0===b&&(b=1);var e=0,f={tasks:[],concurrency:b,saturated:null,empty:null,drain:null,started:!1,paused:!1,push:function(a,b){c(f,a,!1,b)},kill:function(){f.drain=null,f.tasks=[]},unshift:function(a,b){c(f,a,!0,b)},process:function(){if(!f.paused&&e<f.concurrency&&f.tasks.length){var b=f.tasks.shift();f.empty&&0===f.tasks.length&&f.empty(),e+=1;var c=function(){e-=1,b.callback&&b.callback.apply(b,arguments),f.drain&&f.tasks.length+e===0&&f.drain(),f.process()},g=d(c);a(b.data,g)}},length:function(){return f.tasks.length},running:function(){return e},idle:function(){return f.tasks.length+e===0},pause:function(){f.paused!==!0&&(f.paused=!0)},resume:function(){if(f.paused!==!1){f.paused=!1;for(var a=1;a<=f.concurrency;a++)g.setImmediate(f.process)}}};return f},g.priorityQueue=function(a,b){function c(a,b){return a.priority-b.priority}function d(a,b,c){for(var d=-1,e=a.length-1;e>d;){var f=d+(e-d+1>>>1);c(b,a[f])>=0?d=f:e=f-1}return d}function e(a,b,e,f){return a.started||(a.started=!0),i(b)||(b=[b]),0==b.length?g.setImmediate(function(){a.drain&&a.drain()}):void j(b,function(b){var h={data:b,priority:e,callback:"function"==typeof f?f:null};a.tasks.splice(d(a.tasks,h,c)+1,0,h),a.saturated&&a.tasks.length===a.concurrency&&a.saturated(),g.setImmediate(a.process)})}var f=g.queue(a,b);return f.push=function(a,b,c){e(f,a,b,c)},delete f.unshift,f},"undefined"!=typeof c&&c.exports?c.exports=g:"undefined"!=typeof a&&a.amd?a([],function(){return g}):e.async=g}()}).call(this,b("_process"))},{_process:3}],2:[function(a,b,c){function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function e(a){return"function"==typeof a}function f(a){return"number"==typeof a}function g(a){return"object"==typeof a&&null!==a}function h(a){return void 0===a}b.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(a){if(!f(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},d.prototype.emit=function(a){var b,c,d,f,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||g(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;throw TypeError('Uncaught, unspecified "error" event.')}if(c=this._events[a],h(c))return!1;if(e(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(d=arguments.length,f=new Array(d-1),i=1;d>i;i++)f[i-1]=arguments[i];c.apply(this,f)}else if(g(c)){for(d=arguments.length,f=new Array(d-1),i=1;d>i;i++)f[i-1]=arguments[i];for(j=c.slice(),d=j.length,i=0;d>i;i++)j[i].apply(this,f)}return!0},d.prototype.addListener=function(a,b){var c;if(!e(b))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,e(b.listener)?b.listener:b),this._events[a]?g(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,g(this._events[a])&&!this._events[a].warned){var c;c=h(this._maxListeners)?d.defaultMaxListeners:this._maxListeners,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())}return this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(a,b){function c(){this.removeListener(a,c),d||(d=!0,b.apply(this,arguments))}if(!e(b))throw TypeError("listener must be a function");var d=!1;return c.listener=b,this.on(a,c),this},d.prototype.removeListener=function(a,b){var c,d,f,h;if(!e(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],f=c.length,d=-1,c===b||e(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(g(c)){for(h=f;h-->0;)if(c[h]===b||c[h].listener&&c[h].listener===b){d=h;break}if(0>d)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(d,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},d.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],e(c))this.removeListener(a,c);else for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},d.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?e(this._events[a])?[this._events[a]]:this._events[a].slice():[]},d.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?e(a._events[b])?1:a._events[b].length:0}},{}],3:[function(a,b,c){function d(){if(!h){h=!0;for(var a,b=g.length;b;){a=g,g=[];for(var c=-1;++c<b;)a[c]();b=g.length}h=!1}}function e(){}var f=b.exports={},g=[],h=!1;f.nextTick=function(a){g.push(a),h||setTimeout(d,0)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.on=e,f.addListener=e,f.once=e,f.off=e,f.removeListener=e,f.removeAllListeners=e,f.emit=e,f.binding=function(a){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(a){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},{}],4:[function(b,c,d){(function(){function b(a,b,c){var d=b&&c||0,e=0;for(b=b||[],a.toLowerCase().replace(/[0-9a-f]{2}/g,function(a){16>e&&(b[d+e++]=o[a])});16>e;)b[d+e++]=0;return b}function d(a,b){var c=b||0,d=n;return d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]}function e(a,b,c){var e=b&&c||0,f=b||[];a=a||{};var g=null!=a.clockseq?a.clockseq:s,h=null!=a.msecs?a.msecs:(new Date).getTime(),i=null!=a.nsecs?a.nsecs:u+1,j=h-t+(i-u)/1e4;if(0>j&&null==a.clockseq&&(g=g+1&16383),(0>j||h>t)&&null==a.nsecs&&(i=0),i>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");t=h,u=i,s=g,h+=122192928e5;var k=(1e4*(268435455&h)+i)%4294967296;f[e++]=k>>>24&255,f[e++]=k>>>16&255,f[e++]=k>>>8&255,f[e++]=255&k;var l=h/4294967296*1e4&268435455;f[e++]=l>>>8&255,f[e++]=255&l,f[e++]=l>>>24&15|16,f[e++]=l>>>16&255,f[e++]=g>>>8|128,f[e++]=255&g;for(var m=a.node||r,n=0;6>n;n++)f[e+n]=m[n];return b?b:d(f)}function f(a,b,c){var e=b&&c||0;"string"==typeof a&&(b="binary"==a?new m(16):null,a=null),a=a||{};var f=a.random||(a.rng||g)();if(f[6]=15&f[6]|64,f[8]=63&f[8]|128,b)for(var h=0;16>h;h++)b[e+h]=f[h];return b||d(f)}var g,h=this;if("function"==typeof h.require)try{var i=h.require("crypto").randomBytes;g=i&&function(){return i(16)}}catch(j){}if(!g&&h.crypto&&crypto.getRandomValues){var k=new Uint8Array(16);g=function(){return crypto.getRandomValues(k),k}}if(!g){var l=new Array(16);g=function(){for(var a,b=0;16>b;b++)0===(3&b)&&(a=4294967296*Math.random()),l[b]=a>>>((3&b)<<3)&255;return l}}for(var m="function"==typeof h.Buffer?h.Buffer:Array,n=[],o={},p=0;256>p;p++)n[p]=(p+256).toString(16).substr(1),o[n[p]]=p;var q=g(),r=[1|q[0],q[1],q[2],q[3],q[4],q[5]],s=16383&(q[6]<<8|q[7]),t=0,u=0,v=f;if(v.v1=e,v.v4=f,v.parse=b,v.unparse=d,v.BufferClass=m,"function"==typeof a&&a.amd)a(function(){return v});else if("undefined"!=typeof c&&c.exports)c.exports=v;else{var w=h.uuid;v.noConflict=function(){return h.uuid=w,v},h.uuid=v}}).call(this)},{}],5:[function(a,b,c){"use strict";function d(a,b){function c(){4===l.readyState&&f()}function d(){var a=void 0;if(l.response?a=l.response:"text"!==l.responseType&&l.responseType||(a=l.responseText||l.responseXML),t)try{a=JSON.parse(a)}catch(b){}return a}function e(a){clearTimeout(n),a instanceof Error||(a=new Error(""+(a||"unknown"))),a.statusCode=0,b(a,k)}function f(){clearTimeout(n);var a=1223===l.status?204:l.status,c=k,e=null;0!==a?(c={body:d(),statusCode:a,method:p,headers:{},url:o,rawRequest:l},l.getAllResponseHeaders&&(c.headers=h(l.getAllResponseHeaders()))):e=new Error("Internal XMLHttpRequest Error"),b(e,c,c.body)}var k={body:void 0,headers:{},statusCode:0,method:p,url:o,rawRequest:l};if("string"==typeof a&&(a={uri:a}),a=a||{},"undefined"==typeof b)throw new Error("callback argument missing");b=g(b);var l=a.xhr||null;l||(l=a.cors||a.useXDR?new j:new i);var m,n,o=l.url=a.uri||a.url,p=l.method=a.method||"GET",q=a.body||a.data,r=l.headers=a.headers||{},s=!!a.sync,t=!1;if("json"in a&&(t=!0,r.Accept||(r.Accept="application/json"),"GET"!==p&&"HEAD"!==p&&(r["Content-Type"]="application/json",q=JSON.stringify(a.json))),l.onreadystatechange=c,l.onload=f,l.onerror=e,l.onprogress=function(){},l.ontimeout=e,l.open(p,o,!s),l.withCredentials=!!a.withCredentials,!s&&a.timeout>0&&(n=setTimeout(function(){l.abort("timeout")},a.timeout+2)),l.setRequestHeader)for(m in r)r.hasOwnProperty(m)&&l.setRequestHeader(m,r[m]);else if(a.headers)throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in a&&(l.responseType=a.responseType),"beforeSend"in a&&"function"==typeof a.beforeSend&&a.beforeSend(l),l.send(q),l}function e(){}var f=a("global/window"),g=a("once"),h=a("parse-headers"),i=f.XMLHttpRequest||e,j="withCredentials"in new i?i:f.XDomainRequest;b.exports=d},{"global/window":6,once:7,"parse-headers":11}],6:[function(a,b,c){(function(a){b.exports="undefined"!=typeof window?window:"undefined"!=typeof a?a:"undefined"!=typeof self?self:{}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],7:[function(a,b,c){function d(a){var b=!1;return function(){return b?void 0:(b=!0,a.apply(this,arguments))}}b.exports=d,d.proto=d(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return d(this)},configurable:!0})})},{}],8:[function(a,b,c){function d(a,b,c){if(!h(b))throw new TypeError("iterator must be a function");arguments.length<3&&(c=this),"[object Array]"===i.call(a)?e(a,b,c):"string"==typeof a?f(a,b,c):g(a,b,c)}function e(a,b,c){for(var d=0,e=a.length;e>d;d++)j.call(a,d)&&b.call(c,a[d],d,a)}function f(a,b,c){for(var d=0,e=a.length;e>d;d++)b.call(c,a.charAt(d),d,a)}function g(a,b,c){for(var d in a)j.call(a,d)&&b.call(c,a[d],d,a)}var h=a("is-function");b.exports=d;var i=Object.prototype.toString,j=Object.prototype.hasOwnProperty},{"is-function":9}],9:[function(a,b,c){function d(a){var b=e.call(a);return"[object Function]"===b||"function"==typeof a&&"[object RegExp]"!==b||"undefined"!=typeof window&&(a===window.setTimeout||a===window.alert||a===window.confirm||a===window.prompt)}b.exports=d;var e=Object.prototype.toString},{}],10:[function(a,b,c){function d(a){return a.replace(/^\s*|\s*$/g,"")}c=b.exports=d,c.left=function(a){return a.replace(/^\s*/,"")},c.right=function(a){return a.replace(/\s*$/,"")}},{}],11:[function(a,b,c){var d=a("trim"),e=a("for-each"),f=function(a){return"[object Array]"===Object.prototype.toString.call(a)};b.exports=function(a){if(!a)return{};var b={};return e(d(a).split("\n"),function(a){var c=a.indexOf(":"),e=d(a.slice(0,c)).toLowerCase(),g=d(a.slice(c+1));"undefined"==typeof b[e]?b[e]=g:f(b[e])?b[e].push(g):b[e]=[b[e],g]}),b}},{"for-each":8,trim:10}],12:[function(a,b,c){"use strict";var d,e=a("events"),f=e.EventEmitter,g=a("async"),h=a("node-uuid"),i=3,j="",k=new f,l=g.priorityQueue(function(a,b){var c=d({method:"POST",url:j,json:a},function(a,c,d){var e=null;c&&200===c.statusCode?e=k.makeSavedBlob(d):a=a||new Error(c.statusCode),b(a,e)});k.emit("xhr",c,a)},i);["empty","drain","saturated"].forEach(function(a){l[a]=function(){k.emit(a)}}),["length","idle","pause","resume","running"].forEach(function(a){k[a]=function(){return l[a]()}}),k.setXHR=function(b){return d=b||a("xhr")},k.setConcurrency=function(a){return l.concurrency="number"!=typeof a||isNaN(a)?i:a,l.concurrency},k.setEndpoint=function(a){return j=a&&"string"==typeof a?a:""},k.saveBlob=function(a,b){return a.blob=a.blob||h.v4(),l.push(a,10,b),a},k.makeSavedBlob=function(a){var b={blob:a.blob||a._blob,mime:a.mime||a._mime,size:a.size||a._size,file:a.file||a._data,width:a.width||a._width,height:a.height||a._height};return b},b.exports=k},{async:1,events:2,"node-uuid":4,xhr:5}],13:[function(a,b,c){"use strict";function d(a,b){var c;if(!a||"object"!=typeof a)throw new TypeError("1st argument must be an Object");if(!b||"object"!=typeof b)throw new TypeError("1st argument must be an Object");return c={},Object.keys(a).forEach(function(d){var f;if(a.hasOwnProperty(d))return b.hasOwnProperty(d)?(f=typeof b[d],-1!==e.indexOf(f)||typeof a[d]===f?void(c[d]=a[d]):void(c[d]=g[f](a[d]))):void(c[d]=a[d])}),c}var e=["array","function","object"],f=[0,"0","","false",null,void 0],g={"boolean":function(a){return-1!==f.indexOf(a)?!1:!0},number:function(a){var b;return"boolean"==typeof a?a?1:0:(b=parseFloat(a),isNaN(b)?0:b)},string:function(a){return a&&"object"==typeof a&&a.toString?a.toString():""+a}};b.exports=d},{}],14:[function(a,b,c){"use strict";function d(a){return JSON.parse(JSON.stringify(a))}b.exports=d},{}],15:[function(a,b,c){"use strict";function d(a,b){if(!a||"object"!=typeof a)throw new TypeError("1st argument must be an Object");if(!b||"object"!=typeof b)throw new TypeError("1st argument must be an Object");return Object.keys(b).forEach(function(c){var d=b[c];"string"==typeof d?d&&(a[c]=d.trim()):a[c]=d}),a}function e(a,b){var c;return c=a.filter(function(a){return-1!==b.indexOf(a.name)}),c.sort(function(a,c){var d,e;return d=b.indexOf(a.name),e=b.indexOf(c.name),d-e}),c}function f(a,b){function c(a){var c=a["default"]||{};return b&&a[b]&&d(c,a[b]),c}if(!a||"object"!=typeof a)throw new TypeError("1st argument should be an Object");if(!a["default"])throw new TypeError('Object is missing the "default" property');if(!a["default"].name||"string"!=typeof a["default"].name)throw new TypeError('"default" Object is missing the "name" String');return a=g(a),["_elements","_sections","_pages","_behaviours","_checks","_actions"].forEach(function(b){Array.isArray(a["default"][b])&&(a["default"][b]=a["default"][b].map(c))}),b?(a[b]&&(Array.isArray(a[b]._elements)&&(a["default"]._elements=e(a["default"]._elements,a[b]._elements),delete a[b]._elements),d(a["default"],a[b])),a["default"]):a["default"]}var g=a("./clone");b.exports=f},{"./clone":14}],16:[function(a,b,c){"use strict";function d(a){var b;return b=a.toLowerCase().trim(),b=b.replace(/[^a-z0-9]/g,"-"),b=b.replace(/\W(\w)/g,function(a,b){return b.toUpperCase()})}function e(a){var b,c,e=a.lastIndexOf(";"),g={};if(-1===e)return g["class"]=a,g;for(g["class"]=a.substring(e+1,a.length).trim(),a=a.substring(0,e+1),a=a.replace(/\s/g,""),a=a.replace(/\:;/g,";"),b=f.exec(a);Array.isArray(b);)c=d(b[1]),g[c]=void 0===b[2]?!0:b[2],b=f.exec(a);return g}var f=/([\w\-]+)(?:\:([^;]+))?;?/g;b.exports=e},{}],"src/formslib/main":[function(a,b,c){"use strict";b.exports={castPropertyValues:a("./castPropertyValues"),flattenDefinition:a("./flattenDefinition"),parseClass:a("./parseClass"),blobUploader:a("./blob-uploader")}},{"./blob-uploader":12,"./castPropertyValues":13,"./flattenDefinition":15,"./parseClass":16}]},{},[])("src/formslib/main")}),define("models/element",[],function(){var a;return a=Backbone.Model.extend({defaults:{page:0,"class":"",defaultValue:"",value:"",pattern:"",hidden:!1,persist:!0},idAttribute:"name",initialize:function(){var a=this.attributes,b=a.form,c=a.page,d=BMP.Forms,e=$.trim(a.section||"");a["class"]=a["class"]||a.rowClass||"",d.setAttributesFromClass(this),this.initializeView(),b&&(c=a.page=b.getPage(a.page),c&&e?(e=a.section=c.getSection(e),e.add(this)):(c.add(this),delete a.section)),this.set("value",a.defaultValue),a.label||"message"===a.type||(a.label=a.prefix?a.name+" "+a.prefix:a.name),a.required&&a.label&&"subForm"!==a.type&&(a.label+=" *"),a.label&&this.set("label",a.label),this.on("change",this.updateErrors,this)},validate:function(a){var b={};return void 0===a&&(a=this.attributes),a.required&&!a.value&&(b.value=b.value||[],b.value.push({code:"REQUIRED"})),a.pattern&&a.value&&!new RegExp(a.pattern).test(a.value)&&(b.value=b.value||[],b.value.push({code:"PATTERN",PATTERN:a.pattern})),_.isEmpty(b)?void 0:b},updateErrors:function(){this.set("errors",this.validate())},warn:function(){var a={};return a.value=a.value||[],BMP.Forms.supports.blob||a.value.push({code:"NO_BLOB_PREVIEW"}),_.isEmpty(a)?void 0:a},updateWarning:function(){this.set("warning",this.warn())},removeView:function(){var a=this.attributes;a._view&&(a._view.remove(),delete a._view)},destroy:function(a){var b=this.attributes;return delete b.form,delete b.page,delete b.section,this.id=null,this.off(null,null,this),Backbone.Model.prototype.destroy.call(this,a)},initializeView:function(){var a,b,c=BMP.Forms,d=this.attributes;switch(this.removeView(),d.type){case"subForm":a=c._views.SubFormElement;break;case"heading":a=c._views.HeadingElement;break;case"message":a=c._views.MessageElement;break;case"boolean":a=c._views.BooleanElement;break;case"hidden":a=c._views.HiddenElement;break;case"number":a=c._views.NumberElement;break;case"telephone":a=c._views.TelephoneElement;break;case"button":a=c._views.ButtonElement;break;default:a=c._views.Element}return b=new a({model:this}),this.set("_view",b),b},val:function(a){return void 0===a?this.get("value"):(this.set("value",a),a)}},{create:function(b,c){var d,e,f=BMP.Forms,g=["date","time","datetime"];if(!b||!_.isObject(b))return new a;switch(c&&(b.form=c),b.type){case"draw":e=f._models.DrawElement;break;case"file":e=f._models.FileElement;break;case"location":e=f._models.LocationElement;break;case"subForm":e=f._models.SubFormElement;break;case"heading":e=f._models.HeadingElement;break;case"message":e=f._models.MessageElement;break;case"boolean":e=f._models.BooleanElement;break;case"select":e=f._models.SelectElement;break;case"multi":e=f._models.MultiElement;break;case"hidden":e=f._models.HiddenElement;break;case"number":e=f._models.NumberElement;break;case"telephone":e=f._models.TelephoneElement;break;case"password":e=f._models.PasswordElement;break;case"email":e=f._models.EmailElement;break;case"url":e=f._models.URLElement;break;case"text":e=f._models.TextElement;break;case"button":e=f._models.ButtonElement;break;case"textarea":e=f._models.TextAreaElement;break;default:e=-1!==_.indexOf(g,b.type)?f._models.DateElement:f._models.Element}return d=new e(b)}})}),define("collections/elements",["models/element"],function(a){return Backbone.Collection.extend({model:a})}),define("models/section",["require","models/element","collections/elements"],function(a){var b,c=a("models/element");return b=c.extend({initialize:function(){var b=a("collections/elements"),c=this.attributes;c.elements=new b,this.initializeView()},initializeView:function(){var a,b=BMP.Forms;a=new b._views.Section({model:this}),this.set("_view",a)},destroy:function(a){var b=this.attributes;return b._view&&(b._view.remove(),delete b._view),delete b.form,b.elements.forEach(function(b){b.destroy(a)}),Backbone.Model.prototype.destroy.call(this,a)},add:function(a){this.attributes.elements.add(a)}},{create:function(a,c){var d;return a&&_.isObject(a)?(c&&(a.form=c),d=new b(a)):new b}})}),define("models/page",["require","collections/elements","models/section"],function(a){var b,c,d=a("collections/elements"),e=a("models/section");return b=Backbone.Collection.extend({model:e}),c=Backbone.Model.extend({defaults:{"class":""},initialize:function(){var a,c=this.attributes,f=BMP.Forms,g=c.form;f.setAttributesFromClass(this,["_sections"]),c.elements=new d,this.initializeView(),a=g.attributes._sections,a&&_.isArray(a)?(a=_.map(a,function(a){return e.create(a,g)}),a=new b(a)):a=new b,a.forEach(function(b){var c,d=b.attributes;d.section&&(c=a.get(d.section),c&&(d.section=c,c.add(b))),!d.section instanceof e&&delete d.section}),c.sections=a},initializeView:function(){var a,b=BMP.Forms;a=new b._views.Page({model:this}),this.set("_view",a)},destroy:function(a){var b=this.attributes;return b._view&&(b._view.remove(),delete b._view),delete b.form,delete b.section,b.elements.forEach(function(b){b&&b.destroy(a)}),b.elements.reset(),Backbone.Model.prototype.destroy.call(this,a)},add:function(a){a instanceof e&&this.attributes.sections.add(a),a.attributes.section?this.add(a.attributes.section):this.attributes.elements.add(a)},getSection:function(a){var b,c=this.attributes.sections;return b=c.get(a),this.add(b),b},show:function(){var a=this.attributes._view;a.show()},hide:function(){var a=this.attributes._view;a.hide()},index:function(){var a=this.attributes.form,b=a.attributes.pages;return b.indexOf(this)}},{create:function(a,b){var d;return a&&_.isObject(a)?(b&&(a.form=b),d=new c(a)):new c}})}),define("waitfor",[],function(){"use strict";function a(b,c,d){b&&b()?d():setTimeout(function(){a(b,c,d)},c||197)}return a}),define("collections/pages",["models/page","waitfor"],function(a,b){return Backbone.Collection.extend({model:a,"goto":function(a){var c,d,e;c=this,_.isNumber(a)||(a=0),c.current=null,this.forEach(function(b,d){var e,f=b.attributes.form;d===a?(c.current=b,b.initializeView(),e=b.attributes._view,e.render(),f.attributes._view.$el.append(e.el),f.attributes._view.$el.trigger("create")):(e=b.attributes._view,e&&(e.remove(),b.unset("_view")))}),e=c.current,d=e.attributes.form,b(function(){var a;return e.attributes._view&&(a=e.attributes._view.$el.closest("body")),a&&a.length&&a[0]===document.body},null,function(){BMP.Forms.trigger("formInjected",d.model),BMP.Forms.trigger("pageInjected",e)})}})}),define("models/form",["require","collections/elements","collections/pages"],function(a){var b,c=a("collections/elements"),d=a("collections/pages");return b=Backbone.Model.extend({defaults:{answerSpace:"","class":"",isPopulating:!1,uuid:""},initialize:function(){var a,b,e,f=BMP.Forms,g=this,h=f._models.Page,i=f._models.Element,j=f._models.Behaviour;f.setAttributesFromClass(this,["_actions","_checks","_behaviours","_elements","_pages","_sections"]),a=this.attributes._pages,delete this.attributes._pages,a=a&&_.isArray(a)?new d(_.map(a,function(a){return h.create(a,g)})):new d,this.attributes.pages=a,b=this.attributes._elements,delete this.attributes._elements,b=b&&_.isArray(b)?_.map(b,function(a){return i.create(a,g)}):[],this.attributes.elements=new c(b),e=this.attributes._behaviours,delete this.attributes._behaviours,e=e&&_.isArray(e)?_.map(e,function(a){return j.create(a,g)}):[],this.attributes.behaviours=e},destroy:function(a){var b=this.attributes;return b._view&&(b._view.remove(),delete b._view),delete this.$form,b.pages&&(b.pages.forEach(function(b){b.destroy(a)}),b.pages.reset()),b.behaviours&&b.behaviours.forEach(function(b){b.destroy(a)}),Backbone.Model.prototype.destroy.call(this,a)},getPage:function(a){for(var b=BMP.Forms,c=b._models.Page,d=this.get("pages");d.length<=a;)d.push(c.create({},this));return d.at(a)},getElement:function(a){var b=this.attributes.elements.get(a);return b||"id"!==a||(b=this.attributes.elements.add({name:a,type:"hidden"}),b=this.attributes.elements.get(a)),b},getRecord:function(){var a=this,b={},c=[];return new Promise(function(d){a.attributes.elements?a.attributes.elements.forEach(function(a){var d,e,f,g;if(d=a.attributes,e=d.type,d.persist){if("subForm"===e)return void c.push(new Promise(function(c){a.getRecord().then(function(d){b[a.attributes.name]=d,c()})}));if("file"===e||"draw"===e)return g=d.blob,g&&g.type&&(g.base64||g.text)&&(b[a.attributes.name]=g.base64||g.text,b[a.attributes.name+"_mimetype"]=g.type),b[a.attributes.name+"_uuid"]=d.uuid,b[a.attributes.name+"_height"]=d.height,void(b[a.attributes.name+"_width"]=d.width);if("location"===e)return f=d.value,void(f&&("string"!=typeof f&&(f=JSON.stringify(f)),b[a.attributes.name]=f));f=a.val(),(f||"number"==typeof f)&&(b[a.attributes.name]=f)}}):a.attributes.id&&(b.id=a.attributes.id),b._action=a.attributes._action,Promise.all(c).then(function(){d(b)})})},setRecord:function(a){var c=this,d=[];return new Promise(function(e,f){var g=0,h=5;return _.isObject(a)?(c.set("isPopulating",!0),_.each(a,function(e,f){var i,j,k,l=c.getElement(f);if(l)if("subForm"===l.attributes.type)"string"==typeof e&&(i="<"+f+">"+e+"</"+f+">",j=$.parseXML(i),e=b.xmlToJson(j.firstElementChild||j.documentElement),e=e[f]),d.push(l.setRecords(e));else{if(_.contains(["file","draw"],l.attributes.type)&&(k=a[f+"_mimetype"]||"image/jpeg",e=b.addMimetype(e,k),l.set("uuid",a[f+"_uuid"]||""),l.set("height",a[f+"_height"]||0),l.set("width",a[f+"_width"]||0)),"multi"===l.attributes.type&&("string"==typeof e&&(e=e.split("\n")),e=e.map(function(a){return a.trim()})),"location"===l.attributes.type){for(;"string"==typeof e&&h>g;){try{e=JSON.parse(e)}catch(m){e=void 0}g++}g>=h&&"object"!=typeof e&&(e=void 0)}l.val(e)}}),void Promise.all(d).then(function(){c.set("isPopulating",!1),e(a)},function(a){c.set("isPopulating",!1),f(a)})):void f()})},data:function(){return arguments.length?void 0:this.getRecord()},getErrors:function(){var a=this,b={};return a.attributes.elements.forEach(function(a){a.updateErrors(),_.isEmpty(a.attributes.errors)||(b[a.attributes.name]=a.attributes.errors.value)}),_.isEmpty(b)?void 0:b}},{create:function(a,c){var d;return a&&_.isObject(a)?(a._action=c,d=new b(a)):new b},addMimetype:function(a,b){return-1===a.indexOf("data:")?"data:"+b+";base64,"+a:a},xmlToJson:function(a){var c,d,e,f,g={},h=[],i={};return a.hasChildNodes()&&(c=a.childNodes,_.each(c,function(a){a.hasChildNodes()&&(e=a.childNodes,f=a.nodeName,_.each(e,function(a){a.childElementCount>0?(d=b.xmlToJson(a),i[a.nodeName]=d[a.nodeName]):null!==a.firstChild&&(i[a.nodeName]=a.firstChild.nodeValue)}),h.push(i))})),g[f]=h,g}})}),define("models/subform",["models/form"],function(a){"use strict";var b=a.extend({initialize:function(){this.parentElement=null,a.prototype.initialize.call(this)}});return b}),define("models/elements/subform",["models/subform","models/element"],function(a,b){"use strict";var c;return c=Backbone.Collection.extend({model:a}),b.extend({initialize:function(){b.prototype.initialize.call(this),this.attributes.forms=new c,this.attributes.forms.on("add remove",this.updateFieldErrors,this),this.off("change",this.updateErrors,this)},add:function(){var b=this,c=b.attributes,d=c.subForm,e=c.forms,f=c.form.attributes._action,g=BMP.Forms;return new Promise(function(c,h){g.getDefinition(d,f).then(function(d){var g;try{g=a.create(d,f),g.parentElement=b,e&&e.add(g),c()}catch(i){h(i)}},function(a){h(a)})})},indexOf:function(a){var b=this.attributes.forms;return b.models.indexOf(a)},remove:function(a){var b,c=this.attributes.forms;"number"==typeof a?b=c.at(a):a instanceof Backbone.Model&&(b=a),-1!==this.indexOf(b)&&("edit"===b.get("_action")?(b.attributes._view&&b.attributes._view.remove(),b.attributes={_action:"remove",id:b.attributes.id}):(b.destroy(),c.remove(b)))},size:function(){return this.attributes.forms.length},getForm:function(a){return this.attributes.forms.at(a)},getRecord:function(){var a;return a=this.attributes.forms.map(function(a){return a.data()}),new Promise(function(b,c){Promise.all(a).then(function(a){b(a)},function(){c()})})},setRecords:function(a){var b,c=this,d=this.attributes.forms,e=[];return new Promise(function(f,g){if(!_.isArray(a))return void f();for(;d.length>a.length;)c.remove(d.length-1);for(;d.length+e.length<a.length;)e.push(c.add());Promise.all(e).then(function(){b=[],a.forEach(function(a,c){b.push(d.at(c).setRecord(a))}),Promise.all(b).then(function(a){f(a)},function(){g()})},function(){g()})})},data:function(){return arguments.length?void 0:this.getRecord()},updateFieldErrors:function(){this.set("errors",this.validateField())},validateField:function(a){var b,c={};return void 0===a&&(a=this.attributes),b=a.forms,b&&(a.required&&0===b.length||a.minSubforms&&1===a.minSubforms&&0===b.length)&&(c.value=c.value||[],c.value.push({code:"REQUIRED"})),b&&a.maxSubforms&&b.length>a.maxSubforms&&(c.value=c.value||[],c.value.push({code:"MAXSUBFORM",MAX:a.maxSubforms})),b&&a.minSubforms&&a.minSubforms>1&&b.length<a.minSubforms&&(c.value=c.value||[],c.value.push({code:"MINSUBFORM",MIN:a.minSubforms})),_.isEmpty(c)?void 0:c},validate:function(a){var b,c,d,e=0;return void 0===a&&(a=this.attributes),d=this.validateField(a)||{},b=a.forms,b.models.forEach(function(a){c=a.getErrors(),c&&e++}),e>0&&(d.value=d.value||[],d.value.push({code:"SUBFORM"})),_.isEmpty(d)?void 0:d}})}),define("models/expression",[],function(){var a;return a=function(b){var c=this,d=JSON.parse(JSON.stringify(b));this.operator=d.operator.toLowerCase(),this.operands=d.operands||[],
this.operands.forEach(function(b,d){_.isObject(b)&&_.isString(b.operator)&&(c.operands[d]=new a(b))})},a.prototype.evaluate=function(){var b,c=["==","!=",">","<",">=","<=","contains","!contains"];if(!this.operator)throw new Error("missing operator");if(!a.fn[this.operator])throw new Error("unknown operator: "+this.operator);return b=this.operands.map(function(a){if(_.isString(a)||_.isNumber(a)||_.isBoolean(a)||_.isNull(a))return a;if(a.evaluate)return a.evaluate();throw new Error("unexpected operand type")}),1===b.length&&c.indexOf(this.operator)>-1&&b.push(""),a.fn[this.operator].apply(this,b)},a.fn={},a.fn.and=function(){var a=Array.prototype.slice.call(arguments);return a.every(function(a){return!!a})},a.fn.or=function(){var a=Array.prototype.slice.call(arguments);return a.some(function(a){return!!a})},a.fn.not=function(a){return!a},a.fn.empty=function(a){return _.isObject(a)||_.isString(a)||_.isArray(a)?_.isEmpty(a):_.isNumber(a)?_.isNaN(a):!a},a.fn["!empty"]=function(b){return!a.fn.empty.call(this,b)},a.fn["=="]=function(a,b){return a==b},a.fn["!="]=function(a,b){return a!=b},a.fn["<"]=function(a,b){return b>a},a.fn["<="]=function(a,b){return b>=a},a.fn[">"]=function(a,b){return a>b},a.fn[">="]=function(a,b){return a>=b},a.fn.contains=function(a,b){var c;if(!a||_.isEmpty(a))return!1;if("string"==typeof a)return-1!==a.indexOf(b);if(_.isArray(a))return c=!1,a.forEach(function(a){a==b&&(c=!0)}),c;throw new Error("contains: unexpected operand type")},a.fn["!contains"]=function(b,c){return!a.fn.contains.call(this,b,c)},a}),define("models/behaviour",["require","collections/elements","models/expression"],function(require){var Elements=require("collections/elements"),Behaviour,Expression=require("models/expression");return Expression.fn["formelement.value"]=function(a){return this.getElement(a).val()},Behaviour=Backbone.Model.extend({initialize:function(){var a=this.attributes;a.elements=new Elements,a.actions=Behaviour.normalizeActions(a.actions),a.actionsIfFalse=Behaviour.normalizeActions(a.actionsIfFalse),!a.trigger&&a.formElements&&(a.trigger={formElements:a.formElements}),Array.isArray(a.trigger.formElements)||(a.trigger.formElements=[a.trigger.formElements]),a.isLegacy=-1!==a.trigger.formElements.indexOf("*"),a.event=a.isLegacy?"change:value change:html":"change",this.hookupTriggers(),setTimeout(function(){a.elements.trigger(a.event)},0)},hookupTriggers:function(){var a,b=this.attributes,c=b.form,d=b.elements;d.off(b.event,this.runCheck,this),a=this.getOutputTargets(),-1!==b.trigger.formElements.indexOf("*")?d.set(c.attributes.elements.models.filter(function(b){return-1===a.indexOf(b.attributes.name)})):b.trigger.formElements.filter(function(b){return-1===a.indexOf(b)}).forEach(function(a){d.add(c.getElement(a))}),d.on(b.event,this.runCheck,this)},runCheck:function(){var a,b;return this.attributes.check?this.attributes.check&&(a=this.getCheck(this.attributes.check),a&&a.exp)?(this.bindExpressions(),b=new Expression(a.exp),this.runActions(b.evaluate()),void this.unbindExpressions()):void 0:void this.runActions(!0)},runActions:function(a){var b=this;Array.isArray(this.attributes.actions)&&this.attributes.actions.forEach(function(c){c&&c.action&&(a?b.runAction(c.action):c.autoReverse&&b.runAction(c.action,!0))}),Array.isArray(this.attributes.actionsIfFalse)&&this.attributes.actionsIfFalse.forEach(function(c){c&&c.action&&(a?c.autoReverse&&b.runAction(c.action,!0):b.runAction(c.action))})},runAction:function(a,b){var c,d=this.getAction(a),e=this.attributes.form;b&&(d=this.getReversedAction(d)),d&&(d.javascript&&(c=this.runJavaScript(e,d.javascript)),Array.isArray(d.manipulations)&&d.manipulations.forEach(function(a){e.getElement(a.target).set(_.clone(a.properties))}),void 0!==c&&d.outputTarget&&e.getElement(d.outputTarget).val(c))},runJavaScript:function(form,string){var js,result,placeholders,value;js=null,placeholders=string.match(/\[[\w\/\[\]]+\]/g),_.isArray(placeholders)&&placeholders.forEach(function(a){a=a.substring(1,a.length-1);try{value=form.getElement(a).val(),string=string.replace("["+a+"]",value)}catch(b){window.console.warn(b,string)}});try{eval("js = "+string),result=_.isFunction(js)?js.call(form):js}catch(err){window.console.warn(err,string)}return result},getCheck:function(a){try{return this.attributes.form.attributes._checks.filter(function(b){return b.name===a})[0]}catch(b){return null}},getAction:function(a){try{return this.attributes.form.attributes._actions.filter(function(b){return b.name===a})[0]}catch(b){return null}},getActionsNames:function(){return this.attributes.actions.map(function(a){return a.action}).concat(this.attributes.actionsIfFalse.map(function(a){return a.action}))},getOutputTargets:function(){var a,b,c;try{return a=this.attributes.form.attributes._actions,b=this.getActionsNames(),c=a.filter(function(a){return-1!==b.indexOf(a.name)}),c.filter(function(a){return!!a.outputTarget}).map(function(a){return a.outputTarget})}catch(d){return[]}},getReversedAction:function(a){var b;return!a||a.javascript?null:(b=!0,a=JSON.parse(JSON.stringify(a)),Array.isArray(a.manipulations)&&a.manipulations.forEach(function(a){a.properties=a.properties||{},Object.keys(a.properties).forEach(function(c){_.isBoolean(a.properties[c])?a.properties[c]=!a.properties[c]:b=!1})}),b?a:null)},destroy:function(){var a=this.attributes;a.elements.off(a.event,this.runCheck,this),a.elements.reset()},bindExpressions:function(){var a=Expression.fn["formelement.value"];Expression.fn["formelement.value"]=_.bind(Expression.fn["formelement.value"],this.attributes.form),Expression.fn["formelement.value"]._unbound=a},unbindExpressions:function(){var a=Expression.fn["formelement.value"]._unbound;delete Expression.fn["formelement.value"]._unbound,Expression.fn["formelement.value"]=a}},{create:function(a,b){var c;return a&&_.isObject(a)?(b&&(a.form=b),c=new Behaviour(a)):new Behaviour},normalizeActions:function(a){return a&&Array.isArray(a)?a.map(function(a){return a&&"string"==typeof a&&(a={action:a,autoReverse:!1}),a&&"object"==typeof a&&a.action&&"string"==typeof a.action&&"boolean"==typeof a.autoReverse?a:{}}):[]}})}),define("models/elements/heading",["models/element"],function(a){"use strict";var b=a.extend({defaults:{page:0,persist:!1,level:1},initialize:function(){var b,c,d;b=this,c={headingText:"text",headingPosition:"position",headingFontFace:"fontFace",headingSmallText:"smallText"},Object.keys(c).forEach(function(a){c[a]&&b.attributes[a]&&(b.attributes[c[a]]=b.attributes[a])}),b.attributes.hasOwnProperty("headingType")&&(d=b.attributes.headingType,"number"!=typeof d&&(d=parseInt(d,10)),"number"!=typeof d||isNaN(d)||(b.attributes.level=d+1)),a.prototype.initialize.call(this)}});return b}),define("models/elements/message",["models/element"],function(a){"use strict";var b=a.extend({defaults:{page:0,persist:!1},initialize:function(){var b=this,c={messageText:"html"};Object.keys(c).forEach(function(a){c[a]&&b.attributes[a]&&(b.attributes[c[a]]=b.attributes[a])}),a.prototype.initialize.call(this)},val:function(a){return void 0===a?this.get("html"):(this.set("html",a),a)}});return b}),!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define("moment",b):a.moment=b()}(this,function(){"use strict";function a(){return Ac.apply(null,arguments)}function b(a){Ac=a}function c(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function d(a){return"[object Array]"===Object.prototype.toString.call(a)}function e(a){return"[object Date]"===Object.prototype.toString.call(a)||a instanceof Date}function f(a,b){var c,d=[];for(c=0;c<a.length;++c)d.push(b(a[c],c));return d}function g(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function h(a,b){for(var c in b)g(b,c)&&(a[c]=b[c]);return g(b,"toString")&&(a.toString=b.toString),g(b,"valueOf")&&(a.valueOf=b.valueOf),a}function i(a,b,c,d){return ya(a,b,c,d,!0).utc()}function j(a){return null==a._isValid&&(a._isValid=!isNaN(a._d.getTime())&&a._pf.overflow<0&&!a._pf.empty&&!a._pf.invalidMonth&&!a._pf.nullInput&&!a._pf.invalidFormat&&!a._pf.userInvalidated,a._strict&&(a._isValid=a._isValid&&0===a._pf.charsLeftOver&&0===a._pf.unusedTokens.length&&void 0===a._pf.bigHour)),a._isValid}function k(a){var b=i(0/0);return null!=a?h(b._pf,a):b._pf.userInvalidated=!0,b}function l(a,b){var c,d,e;if("undefined"!=typeof b._isAMomentObject&&(a._isAMomentObject=b._isAMomentObject),"undefined"!=typeof b._i&&(a._i=b._i),"undefined"!=typeof b._f&&(a._f=b._f),"undefined"!=typeof b._l&&(a._l=b._l),"undefined"!=typeof b._strict&&(a._strict=b._strict),"undefined"!=typeof b._tzm&&(a._tzm=b._tzm),"undefined"!=typeof b._isUTC&&(a._isUTC=b._isUTC),"undefined"!=typeof b._offset&&(a._offset=b._offset),"undefined"!=typeof b._pf&&(a._pf=b._pf),"undefined"!=typeof b._locale&&(a._locale=b._locale),Cc.length>0)for(c in Cc)d=Cc[c],e=b[d],"undefined"!=typeof e&&(a[d]=e);return a}function m(b){l(this,b),this._d=new Date(+b._d),Dc===!1&&(Dc=!0,a.updateOffset(this),Dc=!1)}function n(a){return a instanceof m||null!=a&&g(a,"_isAMomentObject")}function o(a){var b=+a,c=0;return 0!==b&&isFinite(b)&&(c=b>=0?Math.floor(b):Math.ceil(b)),c}function p(a,b,c){var d,e=Math.min(a.length,b.length),f=Math.abs(a.length-b.length),g=0;for(d=0;e>d;d++)(c&&a[d]!==b[d]||!c&&o(a[d])!==o(b[d]))&&g++;return g+f}function q(){}function r(a){return a?a.toLowerCase().replace("_","-"):a}function s(a){for(var b,c,d,e,f=0;f<a.length;){for(e=r(a[f]).split("-"),b=e.length,c=r(a[f+1]),c=c?c.split("-"):null;b>0;){if(d=t(e.slice(0,b).join("-")))return d;if(c&&c.length>=b&&p(e,c,!0)>=b-1)break;b--}f++}return null}function t(a){var b=null;if(!Ec[a]&&"undefined"!=typeof module&&module&&module.exports)try{b=Bc._abbr,require("./locale/"+a),u(b)}catch(c){}return Ec[a]}function u(a,b){var c;return a&&(c="undefined"==typeof b?w(a):v(a,b),c&&(Bc=c)),Bc._abbr}function v(a,b){return null!==b?(b.abbr=a,Ec[a]||(Ec[a]=new q),Ec[a].set(b),u(a),Ec[a]):(delete Ec[a],null)}function w(a){var b;if(a&&a._locale&&a._locale._abbr&&(a=a._locale._abbr),!a)return Bc;if(!d(a)){if(b=t(a))return b;a=[a]}return s(a)}function x(a,b){var c=a.toLowerCase();Fc[c]=Fc[c+"s"]=Fc[b]=a}function y(a){return"string"==typeof a?Fc[a]||Fc[a.toLowerCase()]:void 0}function z(a){var b,c,d={};for(c in a)g(a,c)&&(b=y(c),b&&(d[b]=a[c]));return d}function A(b,c){return function(d){return null!=d?(C(this,b,d),a.updateOffset(this,c),this):B(this,b)}}function B(a,b){return a._d["get"+(a._isUTC?"UTC":"")+b]()}function C(a,b,c){return a._d["set"+(a._isUTC?"UTC":"")+b](c)}function D(a,b){var c;if("object"==typeof a)for(c in a)this.set(c,a[c]);else if(a=y(a),"function"==typeof this[a])return this[a](b);return this}function E(a,b,c){for(var d=""+Math.abs(a),e=a>=0;d.length<b;)d="0"+d;return(e?c?"+":"":"-")+d}function F(a,b,c,d){var e=d;"string"==typeof d&&(e=function(){return this[d]()}),a&&(Jc[a]=e),b&&(Jc[b[0]]=function(){return E(e.apply(this,arguments),b[1],b[2])}),c&&(Jc[c]=function(){return this.localeData().ordinal(e.apply(this,arguments),a)})}function G(a){return a.match(/\[[\s\S]/)?a.replace(/^\[|\]$/g,""):a.replace(/\\/g,"")}function H(a){var b,c,d=a.match(Gc);for(b=0,c=d.length;c>b;b++)d[b]=Jc[d[b]]?Jc[d[b]]:G(d[b]);return function(e){var f="";for(b=0;c>b;b++)f+=d[b]instanceof Function?d[b].call(e,a):d[b];return f}}function I(a,b){return a.isValid()?(b=J(b,a.localeData()),Ic[b]||(Ic[b]=H(b)),Ic[b](a)):a.localeData().invalidDate()}function J(a,b){function c(a){return b.longDateFormat(a)||a}var d=5;for(Hc.lastIndex=0;d>=0&&Hc.test(a);)a=a.replace(Hc,c),Hc.lastIndex=0,d-=1;return a}function K(a,b,c){Yc[a]="function"==typeof b?b:function(a){return a&&c?c:b}}function L(a,b){return g(Yc,a)?Yc[a](b._strict,b._locale):new RegExp(M(a))}function M(a){return a.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(a,b,c,d,e){return b||c||d||e}).replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function N(a,b){var c,d=b;for("string"==typeof a&&(a=[a]),"number"==typeof b&&(d=function(a,c){c[b]=o(a)}),c=0;c<a.length;c++)Zc[a[c]]=d}function O(a,b){N(a,function(a,c,d,e){d._w=d._w||{},b(a,d._w,d,e)})}function P(a,b,c){null!=b&&g(Zc,a)&&Zc[a](b,c._a,c,a)}function Q(a,b){return new Date(Date.UTC(a,b+1,0)).getUTCDate()}function R(a){return this._months[a.month()]}function S(a){return this._monthsShort[a.month()]}function T(a,b,c){var d,e,f;for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),d=0;12>d;d++){if(e=i([2e3,d]),c&&!this._longMonthsParse[d]&&(this._longMonthsParse[d]=new RegExp("^"+this.months(e,"").replace(".","")+"$","i"),this._shortMonthsParse[d]=new RegExp("^"+this.monthsShort(e,"").replace(".","")+"$","i")),c||this._monthsParse[d]||(f="^"+this.months(e,"")+"|^"+this.monthsShort(e,""),this._monthsParse[d]=new RegExp(f.replace(".",""),"i")),c&&"MMMM"===b&&this._longMonthsParse[d].test(a))return d;if(c&&"MMM"===b&&this._shortMonthsParse[d].test(a))return d;if(!c&&this._monthsParse[d].test(a))return d}}function U(a,b){var c;return"string"==typeof b&&(b=a.localeData().monthsParse(b),"number"!=typeof b)?a:(c=Math.min(a.date(),Q(a.year(),b)),a._d["set"+(a._isUTC?"UTC":"")+"Month"](b,c),a)}function V(b){return null!=b?(U(this,b),a.updateOffset(this,!0),this):B(this,"Month")}function W(){return Q(this.year(),this.month())}function X(a){var b,c=a._a;return c&&-2===a._pf.overflow&&(b=c[_c]<0||c[_c]>11?_c:c[ad]<1||c[ad]>Q(c[$c],c[_c])?ad:c[bd]<0||c[bd]>24||24===c[bd]&&(0!==c[cd]||0!==c[dd]||0!==c[ed])?bd:c[cd]<0||c[cd]>59?cd:c[dd]<0||c[dd]>59?dd:c[ed]<0||c[ed]>999?ed:-1,a._pf._overflowDayOfYear&&($c>b||b>ad)&&(b=ad),a._pf.overflow=b),a}function Y(b){a.suppressDeprecationWarnings===!1&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+b)}function Z(a,b){var c=!0;return h(function(){return c&&(Y(a),c=!1),b.apply(this,arguments)},b)}function $(a,b){hd[a]||(Y(b),hd[a]=!0)}function _(a){var b,c,d=a._i,e=id.exec(d);if(e){for(a._pf.iso=!0,b=0,c=jd.length;c>b;b++)if(jd[b][1].exec(d)){a._f=jd[b][0]+(e[6]||" ");break}for(b=0,c=kd.length;c>b;b++)if(kd[b][1].exec(d)){a._f+=kd[b][0];break}d.match(Vc)&&(a._f+="Z"),sa(a)}else a._isValid=!1}function aa(b){var c=ld.exec(b._i);return null!==c?void(b._d=new Date(+c[1])):(_(b),void(b._isValid===!1&&(delete b._isValid,a.createFromInputFallback(b))))}function ba(a,b,c,d,e,f,g){var h=new Date(a,b,c,d,e,f,g);return 1970>a&&h.setFullYear(a),h}function ca(a){var b=new Date(Date.UTC.apply(null,arguments));return 1970>a&&b.setUTCFullYear(a),b}function da(a){return ea(a)?366:365}function ea(a){return a%4===0&&a%100!==0||a%400===0}function fa(){return ea(this.year())}function ga(a,b,c){var d,e=c-b,f=c-a.day();return f>e&&(f-=7),e-7>f&&(f+=7),d=za(a).add(f,"d"),{week:Math.ceil(d.dayOfYear()/7),year:d.year()}}function ha(a){return ga(a,this._week.dow,this._week.doy).week}function ia(){return this._week.dow}function ja(){return this._week.doy}function ka(a){var b=this.localeData().week(this);return null==a?b:this.add(7*(a-b),"d")}function la(a){var b=ga(this,1,4).week;return null==a?b:this.add(7*(a-b),"d")}function ma(a,b,c,d,e){var f,g,h=ca(a,0,1).getUTCDay();return h=0===h?7:h,c=null!=c?c:e,f=e-h+(h>d?7:0)-(e>h?7:0),g=7*(b-1)+(c-e)+f+1,{year:g>0?a:a-1,dayOfYear:g>0?g:da(a-1)+g}}function na(a){var b=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==a?b:this.add(a-b,"d")}function oa(a,b,c){return null!=a?a:null!=b?b:c}function pa(a){var b=new Date;return a._useUTC?[b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate()]:[b.getFullYear(),b.getMonth(),b.getDate()]}function qa(a){var b,c,d,e,f=[];if(!a._d){for(d=pa(a),a._w&&null==a._a[ad]&&null==a._a[_c]&&ra(a),a._dayOfYear&&(e=oa(a._a[$c],d[$c]),a._dayOfYear>da(e)&&(a._pf._overflowDayOfYear=!0),c=ca(e,0,a._dayOfYear),a._a[_c]=c.getUTCMonth(),a._a[ad]=c.getUTCDate()),b=0;3>b&&null==a._a[b];++b)a._a[b]=f[b]=d[b];for(;7>b;b++)a._a[b]=f[b]=null==a._a[b]?2===b?1:0:a._a[b];24===a._a[bd]&&0===a._a[cd]&&0===a._a[dd]&&0===a._a[ed]&&(a._nextDay=!0,a._a[bd]=0),a._d=(a._useUTC?ca:ba).apply(null,f),null!=a._tzm&&a._d.setUTCMinutes(a._d.getUTCMinutes()-a._tzm),a._nextDay&&(a._a[bd]=24)}}function ra(a){var b,c,d,e,f,g,h;b=a._w,null!=b.GG||null!=b.W||null!=b.E?(f=1,g=4,c=oa(b.GG,a._a[$c],ga(za(),1,4).year),d=oa(b.W,1),e=oa(b.E,1)):(f=a._locale._week.dow,g=a._locale._week.doy,c=oa(b.gg,a._a[$c],ga(za(),f,g).year),d=oa(b.w,1),null!=b.d?(e=b.d,f>e&&++d):e=null!=b.e?b.e+f:f),h=ma(c,d,e,g,f),a._a[$c]=h.year,a._dayOfYear=h.dayOfYear}function sa(b){if(b._f===a.ISO_8601)return void _(b);b._a=[],b._pf.empty=!0;var c,d,e,f,g,h=""+b._i,i=h.length,j=0;for(e=J(b._f,b._locale).match(Gc)||[],c=0;c<e.length;c++)f=e[c],d=(h.match(L(f,b))||[])[0],d&&(g=h.substr(0,h.indexOf(d)),g.length>0&&b._pf.unusedInput.push(g),h=h.slice(h.indexOf(d)+d.length),j+=d.length),Jc[f]?(d?b._pf.empty=!1:b._pf.unusedTokens.push(f),P(f,d,b)):b._strict&&!d&&b._pf.unusedTokens.push(f);b._pf.charsLeftOver=i-j,h.length>0&&b._pf.unusedInput.push(h),b._pf.bigHour===!0&&b._a[bd]<=12&&(b._pf.bigHour=void 0),b._a[bd]=ta(b._locale,b._a[bd],b._meridiem),qa(b),X(b)}function ta(a,b,c){var d;return null==c?b:null!=a.meridiemHour?a.meridiemHour(b,c):null!=a.isPM?(d=a.isPM(c),d&&12>b&&(b+=12),d||12!==b||(b=0),b):b}function ua(a){var b,d,e,f,g;if(0===a._f.length)return a._pf.invalidFormat=!0,void(a._d=new Date(0/0));for(f=0;f<a._f.length;f++)g=0,b=l({},a),null!=a._useUTC&&(b._useUTC=a._useUTC),b._pf=c(),b._f=a._f[f],sa(b),j(b)&&(g+=b._pf.charsLeftOver,g+=10*b._pf.unusedTokens.length,b._pf.score=g,(null==e||e>g)&&(e=g,d=b));h(a,d||b)}function va(a){if(!a._d){var b=z(a._i);a._a=[b.year,b.month,b.day||b.date,b.hour,b.minute,b.second,b.millisecond],qa(a)}}function wa(a){var b,c=a._i,e=a._f;return a._locale=a._locale||w(a._l),null===c||void 0===e&&""===c?k({nullInput:!0}):("string"==typeof c&&(a._i=c=a._locale.preparse(c)),n(c)?new m(X(c)):(d(e)?ua(a):e?sa(a):xa(a),b=new m(X(a)),b._nextDay&&(b.add(1,"d"),b._nextDay=void 0),b))}function xa(b){var c=b._i;void 0===c?b._d=new Date:e(c)?b._d=new Date(+c):"string"==typeof c?aa(b):d(c)?(b._a=f(c.slice(0),function(a){return parseInt(a,10)}),qa(b)):"object"==typeof c?va(b):"number"==typeof c?b._d=new Date(c):a.createFromInputFallback(b)}function ya(a,b,d,e,f){var g={};return"boolean"==typeof d&&(e=d,d=void 0),g._isAMomentObject=!0,g._useUTC=g._isUTC=f,g._l=d,g._i=a,g._f=b,g._strict=e,g._pf=c(),wa(g)}function za(a,b,c,d){return ya(a,b,c,d,!1)}function Aa(a,b){var c,e;if(1===b.length&&d(b[0])&&(b=b[0]),!b.length)return za();for(c=b[0],e=1;e<b.length;++e)b[e][a](c)&&(c=b[e]);return c}function Ba(){var a=[].slice.call(arguments,0);return Aa("isBefore",a)}function Ca(){var a=[].slice.call(arguments,0);return Aa("isAfter",a)}function Da(a){var b=z(a),c=b.year||0,d=b.quarter||0,e=b.month||0,f=b.week||0,g=b.day||0,h=b.hour||0,i=b.minute||0,j=b.second||0,k=b.millisecond||0;this._milliseconds=+k+1e3*j+6e4*i+36e5*h,this._days=+g+7*f,this._months=+e+3*d+12*c,this._data={},this._locale=w(),this._bubble()}function Ea(a){return a instanceof Da}function Fa(a,b){F(a,0,0,function(){var a=this.utcOffset(),c="+";return 0>a&&(a=-a,c="-"),c+E(~~(a/60),2)+b+E(~~a%60,2)})}function Ga(a){var b=(a||"").match(Vc)||[],c=b[b.length-1]||[],d=(c+"").match(qd)||["-",0,0],e=+(60*d[1])+o(d[2]);return"+"===d[0]?e:-e}function Ha(b,c){var d,f;return c._isUTC?(d=c.clone(),f=(n(b)||e(b)?+b:+za(b))-+d,d._d.setTime(+d._d+f),a.updateOffset(d,!1),d):za(b).local()}function Ia(a){return 15*-Math.round(a._d.getTimezoneOffset()/15)}function Ja(b,c){var d,e=this._offset||0;return null!=b?("string"==typeof b&&(b=Ga(b)),Math.abs(b)<16&&(b=60*b),!this._isUTC&&c&&(d=Ia(this)),this._offset=b,this._isUTC=!0,null!=d&&this.add(d,"m"),e!==b&&(!c||this._changeInProgress?Za(this,Ua(b-e,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,a.updateOffset(this,!0),this._changeInProgress=null)),this):this._isUTC?e:Ia(this)}function Ka(a,b){return null!=a?("string"!=typeof a&&(a=-a),this.utcOffset(a,b),this):-this.utcOffset()}function La(a){return this.utcOffset(0,a)}function Ma(a){return this._isUTC&&(this.utcOffset(0,a),this._isUTC=!1,a&&this.subtract(Ia(this),"m")),this}function Na(){return this._tzm?this.utcOffset(this._tzm):"string"==typeof this._i&&this.utcOffset(Ga(this._i)),this}function Oa(a){return a=a?za(a).utcOffset():0,(this.utcOffset()-a)%60===0}function Pa(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function Qa(){if(this._a){var a=this._isUTC?i(this._a):za(this._a);return this.isValid()&&p(this._a,a.toArray())>0}return!1}function Ra(){return!this._isUTC}function Sa(){return this._isUTC}function Ta(){return this._isUTC&&0===this._offset}function Ua(a,b){var c,d,e,f=a,h=null;return Ea(a)?f={ms:a._milliseconds,d:a._days,M:a._months}:"number"==typeof a?(f={},b?f[b]=a:f.milliseconds=a):(h=rd.exec(a))?(c="-"===h[1]?-1:1,f={y:0,d:o(h[ad])*c,h:o(h[bd])*c,m:o(h[cd])*c,s:o(h[dd])*c,ms:o(h[ed])*c}):(h=sd.exec(a))?(c="-"===h[1]?-1:1,f={y:Va(h[2],c),M:Va(h[3],c),d:Va(h[4],c),h:Va(h[5],c),m:Va(h[6],c),s:Va(h[7],c),w:Va(h[8],c)}):null==f?f={}:"object"==typeof f&&("from"in f||"to"in f)&&(e=Xa(za(f.from),za(f.to)),f={},f.ms=e.milliseconds,f.M=e.months),d=new Da(f),Ea(a)&&g(a,"_locale")&&(d._locale=a._locale),d}function Va(a,b){var c=a&&parseFloat(a.replace(",","."));return(isNaN(c)?0:c)*b}function Wa(a,b){var c={milliseconds:0,months:0};return c.months=b.month()-a.month()+12*(b.year()-a.year()),a.clone().add(c.months,"M").isAfter(b)&&--c.months,c.milliseconds=+b-+a.clone().add(c.months,"M"),c}function Xa(a,b){var c;return b=Ha(b,a),a.isBefore(b)?c=Wa(a,b):(c=Wa(b,a),c.milliseconds=-c.milliseconds,c.months=-c.months),c}function Ya(a,b){return function(c,d){var e,f;return null===d||isNaN(+d)||($(b,"moment()."+b+"(period, number) is deprecated. Please use moment()."+b+"(number, period)."),f=c,c=d,d=f),c="string"==typeof c?+c:c,e=Ua(c,d),Za(this,e,a),this}}function Za(b,c,d,e){var f=c._milliseconds,g=c._days,h=c._months;e=null==e?!0:e,f&&b._d.setTime(+b._d+f*d),g&&C(b,"Date",B(b,"Date")+g*d),h&&U(b,B(b,"Month")+h*d),e&&a.updateOffset(b,g||h)}function $a(a){var b=a||za(),c=Ha(b,this).startOf("day"),d=this.diff(c,"days",!0),e=-6>d?"sameElse":-1>d?"lastWeek":0>d?"lastDay":1>d?"sameDay":2>d?"nextDay":7>d?"nextWeek":"sameElse";return this.format(this.localeData().calendar(e,this,za(b)))}function _a(){return new m(this)}function ab(a,b){var c;return b=y("undefined"!=typeof b?b:"millisecond"),"millisecond"===b?(a=n(a)?a:za(a),+this>+a):(c=n(a)?+a:+za(a),c<+this.clone().startOf(b))}function bb(a,b){var c;return b=y("undefined"!=typeof b?b:"millisecond"),"millisecond"===b?(a=n(a)?a:za(a),+a>+this):(c=n(a)?+a:+za(a),+this.clone().endOf(b)<c)}function cb(a,b,c){return this.isAfter(a,c)&&this.isBefore(b,c)}function db(a,b){var c;return b=y(b||"millisecond"),"millisecond"===b?(a=n(a)?a:za(a),+this===+a):(c=+za(a),+this.clone().startOf(b)<=c&&c<=+this.clone().endOf(b))}function eb(a){return 0>a?Math.ceil(a):Math.floor(a)}function fb(a,b,c){var d,e,f=Ha(a,this),g=6e4*(f.utcOffset()-this.utcOffset());return b=y(b),"year"===b||"month"===b||"quarter"===b?(e=gb(this,f),"quarter"===b?e/=3:"year"===b&&(e/=12)):(d=this-f,e="second"===b?d/1e3:"minute"===b?d/6e4:"hour"===b?d/36e5:"day"===b?(d-g)/864e5:"week"===b?(d-g)/6048e5:d),c?e:eb(e)}function gb(a,b){var c,d,e=12*(b.year()-a.year())+(b.month()-a.month()),f=a.clone().add(e,"months");return 0>b-f?(c=a.clone().add(e-1,"months"),d=(b-f)/(f-c)):(c=a.clone().add(e+1,"months"),d=(b-f)/(c-f)),-(e+d)}function hb(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function ib(){var a=this.clone().utc();return 0<a.year()&&a.year()<=9999?"function"==typeof Date.prototype.toISOString?this.toDate().toISOString():I(a,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):I(a,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")}function jb(b){var c=I(this,b||a.defaultFormat);return this.localeData().postformat(c)}function kb(a,b){return Ua({to:this,from:a}).locale(this.locale()).humanize(!b)}function lb(a){return this.from(za(),a)}function mb(a){var b;return void 0===a?this._locale._abbr:(b=w(a),null!=b&&(this._locale=b),this)}function nb(){return this._locale}function ob(a){switch(a=y(a)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===a&&this.weekday(0),"isoWeek"===a&&this.isoWeekday(1),"quarter"===a&&this.month(3*Math.floor(this.month()/3)),this}function pb(a){return a=y(a),void 0===a||"millisecond"===a?this:this.startOf(a).add(1,"isoWeek"===a?"week":a).subtract(1,"ms")}function qb(){return+this._d-6e4*(this._offset||0)}function rb(){return Math.floor(+this/1e3)}function sb(){return this._offset?new Date(+this):this._d}function tb(){var a=this;return[a.year(),a.month(),a.date(),a.hour(),a.minute(),a.second(),a.millisecond()]}function ub(){return j(this)}function vb(){return h({},this._pf)}function wb(){return this._pf.overflow}function xb(a,b){F(0,[a,a.length],0,b)}function yb(a,b,c){return ga(za([a,11,31+b-c]),b,c).week}function zb(a){var b=ga(this,this.localeData()._week.dow,this.localeData()._week.doy).year;return null==a?b:this.add(a-b,"y")}function Ab(a){var b=ga(this,1,4).year;return null==a?b:this.add(a-b,"y")}function Bb(){return yb(this.year(),1,4)}function Cb(){var a=this.localeData()._week;return yb(this.year(),a.dow,a.doy)}function Db(a){return null==a?Math.ceil((this.month()+1)/3):this.month(3*(a-1)+this.month()%3)}function Eb(a,b){if("string"==typeof a)if(isNaN(a)){if(a=b.weekdaysParse(a),"number"!=typeof a)return null}else a=parseInt(a,10);return a}function Fb(a){return this._weekdays[a.day()]}function Gb(a){return this._weekdaysShort[a.day()]}function Hb(a){return this._weekdaysMin[a.day()]}function Ib(a){var b,c,d;for(this._weekdaysParse||(this._weekdaysParse=[]),b=0;7>b;b++)if(this._weekdaysParse[b]||(c=za([2e3,1]).day(b),d="^"+this.weekdays(c,"")+"|^"+this.weekdaysShort(c,"")+"|^"+this.weekdaysMin(c,""),this._weekdaysParse[b]=new RegExp(d.replace(".",""),"i")),this._weekdaysParse[b].test(a))return b}function Jb(a){var b=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=a?(a=Eb(a,this.localeData()),this.add(a-b,"d")):b}function Kb(a){var b=(this.day()+7-this.localeData()._week.dow)%7;return null==a?b:this.add(a-b,"d")}function Lb(a){return null==a?this.day()||7:this.day(this.day()%7?a:a-7)}function Mb(a,b){F(a,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),b)})}function Nb(a,b){return b._meridiemParse}function Ob(a){return"p"===(a+"").toLowerCase().charAt(0)}function Pb(a,b,c){return a>11?c?"pm":"PM":c?"am":"AM"}function Qb(a){F(0,[a,3],0,"millisecond")}function Rb(){return this._isUTC?"UTC":""}function Sb(){return this._isUTC?"Coordinated Universal Time":""}function Tb(a){return za(1e3*a)}function Ub(){return za.apply(null,arguments).parseZone()}function Vb(a,b,c){var d=this._calendar[a];return"function"==typeof d?d.call(b,c):d}function Wb(a){var b=this._longDateFormat[a];return!b&&this._longDateFormat[a.toUpperCase()]&&(b=this._longDateFormat[a.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(a){return a.slice(1)}),this._longDateFormat[a]=b),b}function Xb(){return this._invalidDate}function Yb(a){return this._ordinal.replace("%d",a)}function Zb(a){return a}function $b(a,b,c,d){var e=this._relativeTime[c];return"function"==typeof e?e(a,b,c,d):e.replace(/%d/i,a)}function _b(a,b){var c=this._relativeTime[a>0?"future":"past"];return"function"==typeof c?c(b):c.replace(/%s/i,b)}function ac(a){var b,c;for(c in a)b=a[c],"function"==typeof b?this[c]=b:this["_"+c]=b;this._ordinalParseLenient=new RegExp(this._ordinalParse.source+"|"+/\d{1,2}/.source)}function bc(a,b,c,d){var e=w(),f=i().set(d,b);return e[c](f,a)}function cc(a,b,c,d,e){if("number"==typeof a&&(b=a,a=void 0),a=a||"",null!=b)return bc(a,b,c,e);var f,g=[];for(f=0;d>f;f++)g[f]=bc(a,f,c,e);return g}function dc(a,b){return cc(a,b,"months",12,"month")}function ec(a,b){return cc(a,b,"monthsShort",12,"month")}function fc(a,b){return cc(a,b,"weekdays",7,"day")}function gc(a,b){return cc(a,b,"weekdaysShort",7,"day")}function hc(a,b){return cc(a,b,"weekdaysMin",7,"day")}function ic(){var a=this._data;return this._milliseconds=Od(this._milliseconds),this._days=Od(this._days),this._months=Od(this._months),a.milliseconds=Od(a.milliseconds),a.seconds=Od(a.seconds),a.minutes=Od(a.minutes),a.hours=Od(a.hours),a.months=Od(a.months),a.years=Od(a.years),this}function jc(a,b,c,d){var e=Ua(b,c);return a._milliseconds+=d*e._milliseconds,a._days+=d*e._days,a._months+=d*e._months,a._bubble()}function kc(a,b){return jc(this,a,b,1)}function lc(a,b){return jc(this,a,b,-1)}function mc(){var a,b,c,d=this._milliseconds,e=this._days,f=this._months,g=this._data,h=0;return g.milliseconds=d%1e3,a=eb(d/1e3),g.seconds=a%60,b=eb(a/60),g.minutes=b%60,c=eb(b/60),g.hours=c%24,e+=eb(c/24),h=eb(nc(e)),e-=eb(oc(h)),f+=eb(e/30),e%=30,h+=eb(f/12),f%=12,g.days=e,g.months=f,g.years=h,this}function nc(a){return 400*a/146097}function oc(a){return 146097*a/400}function pc(a){var b,c,d=this._milliseconds;if(a=y(a),"month"===a||"year"===a)return b=this._days+d/864e5,c=this._months+12*nc(b),"month"===a?c:c/12;switch(b=this._days+Math.round(oc(this._months/12)),a){case"week":return b/7+d/6048e5;case"day":return b+d/864e5;case"hour":return 24*b+d/36e5;case"minute":return 24*b*60+d/6e4;case"second":return 24*b*60*60+d/1e3;case"millisecond":return Math.floor(24*b*60*60*1e3)+d;default:throw new Error("Unknown unit "+a)}}function qc(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*o(this._months/12)}function rc(a){return function(){return this.as(a)}}function sc(a){return a=y(a),this[a+"s"]()}function tc(a){return function(){return this._data[a]}}function uc(){return eb(this.days()/7)}function vc(a,b,c,d,e){return e.relativeTime(b||1,!!c,a,d)}function wc(a,b,c){var d=Ua(a).abs(),e=ce(d.as("s")),f=ce(d.as("m")),g=ce(d.as("h")),h=ce(d.as("d")),i=ce(d.as("M")),j=ce(d.as("y")),k=e<de.s&&["s",e]||1===f&&["m"]||f<de.m&&["mm",f]||1===g&&["h"]||g<de.h&&["hh",g]||1===h&&["d"]||h<de.d&&["dd",h]||1===i&&["M"]||i<de.M&&["MM",i]||1===j&&["y"]||["yy",j];return k[2]=b,k[3]=+a>0,k[4]=c,vc.apply(null,k)}function xc(a,b){return void 0===de[a]?!1:void 0===b?de[a]:(de[a]=b,!0)}function yc(a){var b=this.localeData(),c=wc(this,!a,b);return a&&(c=b.pastFuture(+this,c)),b.postformat(c)}function zc(){var a=ee(this.years()),b=ee(this.months()),c=ee(this.days()),d=ee(this.hours()),e=ee(this.minutes()),f=ee(this.seconds()+this.milliseconds()/1e3),g=this.asSeconds();return g?(0>g?"-":"")+"P"+(a?a+"Y":"")+(b?b+"M":"")+(c?c+"D":"")+(d||e||f?"T":"")+(d?d+"H":"")+(e?e+"M":"")+(f?f+"S":""):"P0D"}var Ac,Bc,Cc=a.momentProperties=[],Dc=!1,Ec={},Fc={},Gc=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|x|X|zz?|ZZ?|.)/g,Hc=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,Ic={},Jc={},Kc=/\d/,Lc=/\d\d/,Mc=/\d{3}/,Nc=/\d{4}/,Oc=/[+-]?\d{6}/,Pc=/\d\d?/,Qc=/\d{1,3}/,Rc=/\d{1,4}/,Sc=/[+-]?\d{1,6}/,Tc=/\d+/,Uc=/[+-]?\d+/,Vc=/Z|[+-]\d\d:?\d\d/gi,Wc=/[+-]?\d+(\.\d{1,3})?/,Xc=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,Yc={},Zc={},$c=0,_c=1,ad=2,bd=3,cd=4,dd=5,ed=6;F("M",["MM",2],"Mo",function(){return this.month()+1}),F("MMM",0,0,function(a){return this.localeData().monthsShort(this,a)}),F("MMMM",0,0,function(a){return this.localeData().months(this,a)}),x("month","M"),K("M",Pc),K("MM",Pc,Lc),K("MMM",Xc),K("MMMM",Xc),N(["M","MM"],function(a,b){b[_c]=o(a)-1}),N(["MMM","MMMM"],function(a,b,c,d){var e=c._locale.monthsParse(a,d,c._strict);null!=e?b[_c]=e:c._pf.invalidMonth=a});var fd="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),gd="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),hd={};

a.suppressDeprecationWarnings=!1;var id=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,jd=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],kd=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],ld=/^\/?Date\((\-?\d+)/i;a.createFromInputFallback=Z("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to https://github.com/moment/moment/issues/1407 for more info.",function(a){a._d=new Date(a._i+(a._useUTC?" UTC":""))}),F(0,["YY",2],0,function(){return this.year()%100}),F(0,["YYYY",4],0,"year"),F(0,["YYYYY",5],0,"year"),F(0,["YYYYYY",6,!0],0,"year"),x("year","y"),K("Y",Uc),K("YY",Pc,Lc),K("YYYY",Rc,Nc),K("YYYYY",Sc,Oc),K("YYYYYY",Sc,Oc),N(["YYYY","YYYYY","YYYYYY"],$c),N("YY",function(b,c){c[$c]=a.parseTwoDigitYear(b)}),a.parseTwoDigitYear=function(a){return o(a)+(o(a)>68?1900:2e3)};var md=A("FullYear",!1);F("w",["ww",2],"wo","week"),F("W",["WW",2],"Wo","isoWeek"),x("week","w"),x("isoWeek","W"),K("w",Pc),K("ww",Pc,Lc),K("W",Pc),K("WW",Pc,Lc),O(["w","ww","W","WW"],function(a,b,c,d){b[d.substr(0,1)]=o(a)});var nd={dow:0,doy:6};F("DDD",["DDDD",3],"DDDo","dayOfYear"),x("dayOfYear","DDD"),K("DDD",Qc),K("DDDD",Mc),N(["DDD","DDDD"],function(a,b,c){c._dayOfYear=o(a)}),a.ISO_8601=function(){};var od=Z("moment().min is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548",function(){var a=za.apply(null,arguments);return this>a?this:a}),pd=Z("moment().max is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548",function(){var a=za.apply(null,arguments);return a>this?this:a});Fa("Z",":"),Fa("ZZ",""),K("Z",Vc),K("ZZ",Vc),N(["Z","ZZ"],function(a,b,c){c._useUTC=!0,c._tzm=Ga(a)});var qd=/([\+\-]|\d\d)/gi;a.updateOffset=function(){};var rd=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,sd=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/;Ua.fn=Da.prototype;var td=Ya(1,"add"),ud=Ya(-1,"subtract");a.defaultFormat="YYYY-MM-DDTHH:mm:ssZ";var vd=Z("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(a){return void 0===a?this.localeData():this.locale(a)});F(0,["gg",2],0,function(){return this.weekYear()%100}),F(0,["GG",2],0,function(){return this.isoWeekYear()%100}),xb("gggg","weekYear"),xb("ggggg","weekYear"),xb("GGGG","isoWeekYear"),xb("GGGGG","isoWeekYear"),x("weekYear","gg"),x("isoWeekYear","GG"),K("G",Uc),K("g",Uc),K("GG",Pc,Lc),K("gg",Pc,Lc),K("GGGG",Rc,Nc),K("gggg",Rc,Nc),K("GGGGG",Sc,Oc),K("ggggg",Sc,Oc),O(["gggg","ggggg","GGGG","GGGGG"],function(a,b,c,d){b[d.substr(0,2)]=o(a)}),O(["gg","GG"],function(b,c,d,e){c[e]=a.parseTwoDigitYear(b)}),F("Q",0,0,"quarter"),x("quarter","Q"),K("Q",Kc),N("Q",function(a,b){b[_c]=3*(o(a)-1)}),F("D",["DD",2],"Do","date"),x("date","D"),K("D",Pc),K("DD",Pc,Lc),K("Do",function(a,b){return a?b._ordinalParse:b._ordinalParseLenient}),N(["D","DD"],ad),N("Do",function(a,b){b[ad]=o(a.match(Pc)[0],10)});var wd=A("Date",!0);F("d",0,"do","day"),F("dd",0,0,function(a){return this.localeData().weekdaysMin(this,a)}),F("ddd",0,0,function(a){return this.localeData().weekdaysShort(this,a)}),F("dddd",0,0,function(a){return this.localeData().weekdays(this,a)}),F("e",0,0,"weekday"),F("E",0,0,"isoWeekday"),x("day","d"),x("weekday","e"),x("isoWeekday","E"),K("d",Pc),K("e",Pc),K("E",Pc),K("dd",Xc),K("ddd",Xc),K("dddd",Xc),O(["dd","ddd","dddd"],function(a,b,c){var d=c._locale.weekdaysParse(a);null!=d?b.d=d:c._pf.invalidWeekday=a}),O(["d","e","E"],function(a,b,c,d){b[d]=o(a)});var xd="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),yd="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),zd="Su_Mo_Tu_We_Th_Fr_Sa".split("_");F("H",["HH",2],0,"hour"),F("h",["hh",2],0,function(){return this.hours()%12||12}),Mb("a",!0),Mb("A",!1),x("hour","h"),K("a",Nb),K("A",Nb),K("H",Pc),K("h",Pc),K("HH",Pc,Lc),K("hh",Pc,Lc),N(["H","HH"],bd),N(["a","A"],function(a,b,c){c._isPm=c._locale.isPM(a),c._meridiem=a}),N(["h","hh"],function(a,b,c){b[bd]=o(a),c._pf.bigHour=!0});var Ad=/[ap]\.?m?\.?/i,Bd=A("Hours",!0);F("m",["mm",2],0,"minute"),x("minute","m"),K("m",Pc),K("mm",Pc,Lc),N(["m","mm"],cd);var Cd=A("Minutes",!1);F("s",["ss",2],0,"second"),x("second","s"),K("s",Pc),K("ss",Pc,Lc),N(["s","ss"],dd);var Dd=A("Seconds",!1);F("S",0,0,function(){return~~(this.millisecond()/100)}),F(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),Qb("SSS"),Qb("SSSS"),x("millisecond","ms"),K("S",Qc,Kc),K("SS",Qc,Lc),K("SSS",Qc,Mc),K("SSSS",Tc),N(["S","SS","SSS","SSSS"],function(a,b){b[ed]=o(1e3*("0."+a))});var Ed=A("Milliseconds",!1);F("z",0,0,"zoneAbbr"),F("zz",0,0,"zoneName");var Fd=m.prototype;Fd.add=td,Fd.calendar=$a,Fd.clone=_a,Fd.diff=fb,Fd.endOf=pb,Fd.format=jb,Fd.from=kb,Fd.fromNow=lb,Fd.get=D,Fd.invalidAt=wb,Fd.isAfter=ab,Fd.isBefore=bb,Fd.isBetween=cb,Fd.isSame=db,Fd.isValid=ub,Fd.lang=vd,Fd.locale=mb,Fd.localeData=nb,Fd.max=pd,Fd.min=od,Fd.parsingFlags=vb,Fd.set=D,Fd.startOf=ob,Fd.subtract=ud,Fd.toArray=tb,Fd.toDate=sb,Fd.toISOString=ib,Fd.toJSON=ib,Fd.toString=hb,Fd.unix=rb,Fd.valueOf=qb,Fd.year=md,Fd.isLeapYear=fa,Fd.weekYear=zb,Fd.isoWeekYear=Ab,Fd.quarter=Fd.quarters=Db,Fd.month=V,Fd.daysInMonth=W,Fd.week=Fd.weeks=ka,Fd.isoWeek=Fd.isoWeeks=la,Fd.weeksInYear=Cb,Fd.isoWeeksInYear=Bb,Fd.date=wd,Fd.day=Fd.days=Jb,Fd.weekday=Kb,Fd.isoWeekday=Lb,Fd.dayOfYear=na,Fd.hour=Fd.hours=Bd,Fd.minute=Fd.minutes=Cd,Fd.second=Fd.seconds=Dd,Fd.millisecond=Fd.milliseconds=Ed,Fd.utcOffset=Ja,Fd.utc=La,Fd.local=Ma,Fd.parseZone=Na,Fd.hasAlignedHourOffset=Oa,Fd.isDST=Pa,Fd.isDSTShifted=Qa,Fd.isLocal=Ra,Fd.isUtcOffset=Sa,Fd.isUtc=Ta,Fd.isUTC=Ta,Fd.zoneAbbr=Rb,Fd.zoneName=Sb,Fd.dates=Z("dates accessor is deprecated. Use date instead.",wd),Fd.months=Z("months accessor is deprecated. Use month instead",V),Fd.years=Z("years accessor is deprecated. Use year instead",md),Fd.zone=Z("moment().zone is deprecated, use moment().utcOffset instead. https://github.com/moment/moment/issues/1779",Ka);var Gd=Fd,Hd={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},Id={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY LT",LLLL:"dddd, MMMM D, YYYY LT"},Jd="Invalid date",Kd="%d",Ld=/\d{1,2}/,Md={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},Nd=q.prototype;Nd._calendar=Hd,Nd.calendar=Vb,Nd._longDateFormat=Id,Nd.longDateFormat=Wb,Nd._invalidDate=Jd,Nd.invalidDate=Xb,Nd._ordinal=Kd,Nd.ordinal=Yb,Nd._ordinalParse=Ld,Nd.preparse=Zb,Nd.postformat=Zb,Nd._relativeTime=Md,Nd.relativeTime=$b,Nd.pastFuture=_b,Nd.set=ac,Nd.months=R,Nd._months=fd,Nd.monthsShort=S,Nd._monthsShort=gd,Nd.monthsParse=T,Nd.week=ha,Nd._week=nd,Nd.firstDayOfYear=ja,Nd.firstDayOfWeek=ia,Nd.weekdays=Fb,Nd._weekdays=xd,Nd.weekdaysMin=Hb,Nd._weekdaysMin=zd,Nd.weekdaysShort=Gb,Nd._weekdaysShort=yd,Nd.weekdaysParse=Ib,Nd.isPM=Ob,Nd._meridiemParse=Ad,Nd.meridiem=Pb,u("en",{ordinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(a){var b=a%10,c=1===o(a%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th";return a+c}}),a.lang=Z("moment.lang is deprecated. Use moment.locale instead.",u),a.langData=Z("moment.langData is deprecated. Use moment.localeData instead.",w);var Od=Math.abs,Pd=rc("ms"),Qd=rc("s"),Rd=rc("m"),Sd=rc("h"),Td=rc("d"),Ud=rc("w"),Vd=rc("M"),Wd=rc("y"),Xd=tc("milliseconds"),Yd=tc("seconds"),Zd=tc("minutes"),$d=tc("hours"),_d=tc("days"),ae=tc("months"),be=tc("years"),ce=Math.round,de={s:45,m:45,h:22,d:26,M:11},ee=Math.abs,fe=Da.prototype;fe.abs=ic,fe.add=kc,fe.subtract=lc,fe.as=pc,fe.asMilliseconds=Pd,fe.asSeconds=Qd,fe.asMinutes=Rd,fe.asHours=Sd,fe.asDays=Td,fe.asWeeks=Ud,fe.asMonths=Vd,fe.asYears=Wd,fe.valueOf=qc,fe._bubble=mc,fe.get=sc,fe.milliseconds=Xd,fe.seconds=Yd,fe.minutes=Zd,fe.hours=$d,fe.days=_d,fe.weeks=uc,fe.months=ae,fe.years=be,fe.humanize=yc,fe.toISOString=zc,fe.toString=zc,fe.toJSON=zc,fe.locale=mb,fe.localeData=nb,fe.toIsoString=Z("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",zc),fe.lang=vd,F("X",0,0,"unix"),F("x",0,0,"valueOf"),K("x",Uc),K("X",Wc),N("X",function(a,b,c){c._d=new Date(1e3*parseFloat(a,10))}),N("x",function(a,b,c){c._d=new Date(o(a))}),a.version="2.10.2",b(za),a.fn=Gd,a.min=Ba,a.max=Ca,a.utc=i,a.unix=Tb,a.months=dc,a.isDate=e,a.locale=u,a.invalid=k,a.duration=Ua,a.isMoment=n,a.weekdays=fc,a.parseZone=Ub,a.localeData=w,a.isDuration=Ea,a.monthsShort=ec,a.weekdaysMin=hc,a.defineLocale=v,a.weekdaysShort=gc,a.normalizeUnits=y,a.relativeTimeThreshold=xc;var ge=a;return ge}),define("models/elements/date",["models/element","moment"],function(a,b){"use strict";var c=a.extend({initialize:function(){var c,d,e=this.attributes,f=null,g=null;if(a.prototype.initialize.call(this),this.on("change:_date change:_time",this.prepareValue),this.on("change:value",this.prepareDateTime),e.defaultValue)switch(e.type){case"date":c=this.mapDateFormats[e.dateFormat]||"YYYY-MM-DD","now"===e.defaultValue?f=b():"now_plus"===e.defaultValue?f=b().add(parseInt(e.defaultDateNowPlus,10),"d"):"date"===e.defaultValue&&(f=b(Date.parse(e.defaultDateDate))),null!==f&&this.set("value",f.format(c));break;case"time":d=this.mapTimeFormats[e.timeFormat]||"HH:mm","now"===e.defaultValue?g=b():"now_plus"===e.defaultValue&&(g=b().add(parseInt(e.nowPlusAmount,10),"m")),null!==g&&this.set("value",g.format(d));break;case"datetime":c=this.mapDateFormats[e.dateFormat]||"YYYY-MM-DD",d=this.mapTimeFormats[e.timeFormat]||"HH:mm","now"===e.defaultValue?g=f=b():"now_plus"===e.defaultValue&&(g=f=b(),g.add("m",parseInt(e.nowPlusAmount,10))),null!==f&&(this.attributes._date=f.format(c),this.trigger("change:_date")),null!==g&&(this.attributes._time=g.format(d),this.trigger("change:_time"))}},initializeView:function(){var a,b,c=BMP.Forms,d=this.attributes;this.removeView(),d.readonly?(this.removeView(),b=c._views.ReadOnlyElement,a=new b({model:this})):a=1===parseInt(d.nativeDatetimePicker,10)||1===parseInt(d.nativeDatePicker,10)||1===parseInt(d.nativeTimePicker,10)?new c._views.DateElement({model:this}):new c._views.DatePickadateElement({model:this}),this.set("_view",a)},prepareValue:function(){var a,b,c=this.attributes.type;"date"===c?this.set("value",this.attributes._date):"time"===c?this.set("value",this.attributes._time):(a=this.attributes._date,b=this.attributes._time,a||(a="0000-00-00"),b||(b="00:00"),this.set("value",a+"T"+b))},prepareDateTime:function(){var a,b,c,d=this.attributes.type,e=this.attributes.value;"date"===d?this.set("_date",e):"time"===d?this.set("_time",e):(a=this.attributes._time,b=this.attributes._date,c=e.split("T"),c[0]&&this.set("_date",c[0],{silent:!0}),c[1]&&this.set("_time",c[1],{silent:!0}),a!==this.attributes._time&&this.trigger("change:_time"),b!==this.attributes._date&&this.trigger("change:_date"))},toDate:function(){var a,b=this.attributes.type;return"date"===b?new Date(this.attributes._date):"time"===b?(a=(new Date).toISOString(),a.replace(/T[0-9.:Z+\-]*$/,"T"+this.attributes._time)):new Date(this.attributes._date+"T"+this.attributes._time)},mapDateFormats:{yyyy_mm_dd:"YYYY-MM-DD",mm_dd_yyyy:"MM-DD-YYYY",dd_mm_yyyy2:"DD/MM/YYYY",yyyy_mm_dd2:"YYYY/MM/DD",mm_dd_yyyy2:"MM/DD/YYYY",dd_mm_yyyy:"DD-MM-YYYY"},mapTimeFormats:{"hh:mm":"HH:mm",hh_mm_ss:"HH:mm",h_mm_ss:"hh:mm A",h_mm:"hh:mm A"}});return c}),define("models/elements/hidden",["models/element"],function(a){"use strict";var b=a.extend({initialize:function(){a.prototype.initialize.call(this)}});return b}),define("models/elements/number",["models/element"],function(a){"use strict";var b=a.extend({initialize:function(){var b=this,c={maxDecimalPlaces:"maxDecimals",minDecimalPlaces:"minDecimals"};Object.keys(c).forEach(function(a){c[a]&&b.attributes[a]&&(b.attributes[c[a]]=b.attributes[a])}),a.prototype.initialize.call(this)},initializeView:function(){var b,c,d=BMP.Forms;return this.attributes.readonly?(this.removeView(),b=d._views.ReadOnlyElement,c=new b({model:this}),this.set("_view",c),c):a.prototype.initializeView.call(this)},set:function(b,c,d){var e;return null===b?this:(_.isObject(b)?(e=b,d=c):(e={},e[b]=c),d=d||{},e.hasOwnProperty("value")&&"undefined"!==e.value&&null!==e.value&&(e.value=Number(e.value)),a.prototype.set.call(this,e,d))},validators:{minValue:function(a,b){return b>a},maxValue:function(a,b){return a>b},maxDecimals:function(a,b){var c=new RegExp("^(?:(-)?\\d*\\.\\d{1,"+b+"}|\\d+)$");return c.test(a)},minDecimals:function(a,b){var c=new RegExp("^(?:(-)?\\d*\\.\\d{"+b+",}|\\d+)$");return c.test(a)}},validate:function(b){var c=a.prototype.validate.call(this)||{};return void 0===b&&(b=this.attributes),b.value&&(this.validators.maxValue(b.value,b.max)&&(c.value=c.value||[],c.value.push({code:"MAX",MAX:b.max})),this.validators.minValue(b.value,b.min)&&(c.value=c.value||[],c.value.push({code:"MIN",MIN:b.min})),b.maxDecimals&&!this.validators.maxDecimals(b.value,b.maxDecimals)&&(c.value=c.value||[],c.value.push({code:"MAXDECIMALS",MAX:b.maxDecimals})),b.minDecimals&&!this.validators.minDecimals(b.value,b.minDecimals)&&(c.value=c.value||[],c.value.push({code:"MINDECIMALS",MIN:b.minDecimals}))),_.isEmpty(c)?void 0:c}});return b}),define("models/elements/telephone",["models/element"],function(a){"use strict";var b=a.extend({initialize:function(){a.prototype.initialize.call(this)},initializeView:function(){var a,b,c=BMP.Forms;return this.attributes.readonly?(this.removeView(),a=c._views.ReadOnlyElement):a=c._views.TelephoneElement,b=new a({model:this}),this.set("_view",b),b}});return b}),define("models/elements/text",["models/element"],function(a){"use strict";var b=a.extend({initialize:function(){a.prototype.initialize.call(this)},initializeView:function(){var a,b,c=BMP.Forms;return this.attributes.readonly?(this.removeView(),a=c._views.ReadOnlyElement):a=c._views.TextElement,b=new a({model:this}),this.set("_view",b),b},validate:function(b){var c=a.prototype.validate.call(this)||{};return void 0===b&&(b=this.attributes),b.value&&b.maxLength?b.value.length>b.maxLength&&(c.value=c.value||[],c.value.push({code:"MAXLENGTH",MAX:b.maxLength})):b.value&&b.characterLimit&&b.value.length>b.characterLimit&&(c.value=c.value||[],c.value.push({code:"MAXLENGTH",MAX:b.characterLimit})),_.isEmpty(c)?void 0:c}});return b}),define("models/elements/password",["models/elements/text"],function(a){"use strict";var b=a.extend({initialize:function(){a.prototype.initialize.call(this)},initializeView:function(){var a,b,c=BMP.Forms;return this.attributes.readonly?(this.removeView(),a=c._views.ReadOnlyElement):a=c._views.PasswordElement,b=new a({model:this}),this.set("_view",b),b}});return b}),define("models/elements/email",["models/elements/text"],function(a){"use strict";var b=a.extend({initialize:function(){a.prototype.initialize.call(this)},initializeView:function(){var a,b,c=BMP.Forms;return this.attributes.readonly?(this.removeView(),a=c._views.ReadOnlyElement):a=c._views.EmailElement,b=new a({model:this}),this.set("_view",b),b},validate:function(b){var c=a.prototype.validate.call(this)||{},d=new RegExp('^(([^<>()[\\]\\.,;:\\s@\\"]+(\\.[^<>()[\\]\\.,;:\\s@\\"]+)*)|(\\".+\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$',"i");return void 0===b&&(b=this.attributes),b.value&&!d.test(b.value)&&(c.value=c.value||[],c.value.push({code:"EMAIL"})),_.isEmpty(c)?void 0:c}});return b}),define("models/elements/url",["models/elements/text"],function(a){"use strict";var b=a.extend({initialize:function(){a.prototype.initialize.call(this)},initializeView:function(){var b,c,d=BMP.Forms;return this.attributes.readonly?(this.removeView(),b=d._views.ReadOnlyElement,c=new b({model:this}),this.set("_view",c),c):a.prototype.initializeView.call(this)}});return b}),define("models/elements/textarea",["models/elements/text"],function(a){"use strict";var b=a.extend({initialize:function(){a.prototype.initialize.call(this)},initializeView:function(){var a,b,c=BMP.Forms;return this.attributes.readonly?(this.removeView(),a=c._views.ReadOnlyElement):a=c._views.TextAreaElement,b=new a({model:this}),this.set("_view",b),b}});return b}),define("models/elements/boolean",["models/element"],function(a){"use strict";var b=a.extend({initialize:function(){a.prototype.initialize.call(this)}});return b}),define("models/elements/select",["models/element"],function(a){"use strict";var b=_.clone(a.prototype.defaults);return b.mode="collapsed",b.layout="vertical",b.other=!1,b.nativeMenu=!1,a.extend({defaults:b,initialize:function(){a.prototype.initialize.call(this)},initializeView:function(){var a,b,c,d=BMP.Forms,e=this.attributes;return e.readonly?(this.removeView(),b=d._views.SelectReadOnlyElement):(c=e.mode||"collapsed",c=c[0].toUpperCase()+c.substring(1),b=d._views["Choice"+c+"Element"]),a=new b({model:this}),this.set("_view",a),a},validate:function(a){var b={},c=!1;return void 0===a&&(a=this.attributes),(a.other||a.canSpecifyOther)&&(c=!0),a.required&&(!a.value||c&&"other"===a.value&&!_.contains(a.options,"other"))&&(b.value=b.value||[],b.value.push({code:"REQUIRED"})),_.isEmpty(b)?void 0:b}})}),define("models/elements/multi",["models/elements/select"],function(a){"use strict";var b=a.extend({initialize:function(){a.prototype.initialize.call(this)},initializeView:function(){var a,b,c,d=BMP.Forms,e=this.attributes;return e.readonly?(this.removeView(),b=d._views.MultiReadOnlyElement):(c=e.mode||"collapsed",c=c[0].toUpperCase()+c.substring(1),b=d._views["Choice"+c+"Element"]),a=new b({model:this}),this.set("_view",a),a},validate:function(a){var b={},c=!1;return void 0===a&&(a=this.attributes),(a.other||a.canSpecifyOther)&&(c=!0),a.required&&(_.isEmpty(a.value)||c&&1===a.value.length&&"other"===a.value[0]&&!_.contains(a.options,"other"))&&(b.value=b.value||[],b.value.push({code:"REQUIRED"})),_.isEmpty(b)?void 0:b}});return b}),function(a,b){"use strict";"function"==typeof define&&define.amd?define("geolocation",[],b):"object"==typeof exports?module.exports=b():a.BMP?a.BMP.geolocation=b():a.geolocation=b()}(this,function(){"use strict";var a,b={setGeoLocation:function(b){a=b},getGeoLocation:function(){return a&&a.getCurrentPosition?a:"undefined"!=typeof navigator&&navigator.geolocation&&navigator.geolocation.getCurrentPosition?navigator.geolocation:!1},clonePosition:function(a){if(!a||"object"!=typeof a||!a.coords||"object"!=typeof a.coords)throw new TypeError("cannot clone non-Position object");return{coords:{latitude:a.coords.latitude,longitude:a.coords.longitude,altitude:a.coords.altitude,accuracy:a.coords.accuracy,altitudeAccuracy:a.coords.altitudeAccuracy,heading:a.coords.heading,speed:a.coords.speed}}},DEFAULT_POSITION_OPTIONS:{enableHighAccuracy:!0,maximumAge:0,timeout:1e4},POSITION_OPTION_TYPES:{enableHighAccuracy:"boolean",maximumAge:"number",timeout:"number"},mergePositionOptions:function(a){var c;return a&&"object"==typeof a?(c={},Object.keys(b.POSITION_OPTION_TYPES).forEach(function(d){var e=b.POSITION_OPTION_TYPES[d],f=a[d];c[d]=typeof a[d]!==e||"number"===e&&isNaN(f)?b.DEFAULT_POSITION_OPTIONS[d]:a[d]}),c):b.DEFAULT_POSITION_OPTIONS},requestCurrentPosition:function(a,c,d){var e=b.getGeoLocation();if(!e)throw new Error("the current web engine does not support GeoLocation");if("function"!=typeof a)throw new TypeError("getCurrentPosition(): 1st parameter must be a Function to handle success");if("function"!=typeof c)throw new TypeError("getCurrentPosition(): 2nd parameter must be a Function to handle error");return d=b.mergePositionOptions(d),e.getCurrentPosition(function(c){a(b.clonePosition(c))},c,d)},getPromiseConstructor:function(){return"undefined"!=typeof Promise?Promise:"undefined"!=typeof $&&$.Deferred?$.Deferred:!1},getCurrentPosition:function(a,c,d){var e=b.getPromiseConstructor();return e?new e(function(e,f){b.requestCurrentPosition(function(b){"function"==typeof a&&a(b),e(b)},function(a){"function"==typeof c&&c(a),f(a)},d)}):b.requestCurrentPosition(a,c,d)}};return b}),define("geo",["geolocation"],function(a){return{isSupported:!!a.getGeoLocation(),getCurrentPosition:a.getCurrentPosition,getErrorMessage:function(a){switch(a.code){case a.PERMISSION_DENIED:return window.i18n["BMP/geolocation"].PERMISSION_DENIED();case a.PERMISSION_DENIED_TIMEOUT:return window.i18n["BMP/geolocation"].PERMISSION_DENIED_TIMEOUT();case a.POSITION_UNAVAILABLE:return window.i18n["BMP/geolocation"].POSITION_UNAVAILABLE();default:return window.i18n["BMP/geolocation"].UNKNOWN_ERROR()}}}}),define("models/elements/location",["models/element","geo"],function(a,b){"use strict";var c=a.extend({initialize:function(){a.prototype.initialize.call(this)},initializeView:function(){var a,b=BMP.Forms;this.removeView(),a=this.attributes.readonly?new b._views.LocationReadOnlyElement({model:this}):new b._views.LocationElement({model:this}),this.set("_view",a)},getGeoLocation:function(a){var c=this,d={value:[]};return b.isSupported?b.getCurrentPosition(a).then(function(a){return a.coords?void c.set("currentlocation",a.coords):Promise.reject(new TypeError("position result lacks coordinates"))},function(a){return d.value.push(b.getErrorMessage(a)),c.set("errors",d),Promise.reject(a)}):(d.value.push("unsupported in this browser"),c.set("errors",d),Promise.reject(new Error(d.value[0])))}});return c}),define("models/elements/file",["models/element"],function(a){"use strict";var b=a.extend({defaults:_.extend({},a.prototype.defaults,{height:0,width:0,progress:null,uuid:"",xhr:null}),initialize:function(){a.prototype.initialize.call(this),this.on("change:value",function(){var a;a=this.get("value"),a?this.setBlobFromString(a):(this.unset("blob"),this.set({height:0,width:0,uuid:""}))},this),this.on("change:blob",function(){var a=this.get("form");a.get("isPopulating")||this.uploadBlob()},this),this.on("change:xhr",this.onChangeXHR,this)},initializeView:function(){var a,b=BMP.Forms,c=this.attributes.accept;this.removeView(),a=this.attributes.readonly?new b._views.BlobReadOnlyElement({model:this}):BMP.BlinkGap.hasCamera()&&0===c.indexOf("image")?new b._views.BGImageElement({model:this}):this.getUserMediaPresent()&&this.get("capture")===!0?new b._views.WebRTCImageElement({model:this}):new b._views.FileElement({model:this}),this.set("_view",a)},toCameraOptions:function(){var a,b={},c=BMP.BIC.attributes||{};if(_.isNumber(c.imageCaptureQuality)&&(b.quality=c.imageCaptureQuality),_.isNumber(c.imageCaptureScale)&&(b.imageScale=c.imageCaptureScale),_.isString(c.cameraOptions)){try{a=JSON.parse(c.cameraOptions),(!_.isObject(a)||_.isArray(a))&&(a={})}finally{a=a||{}}_.extend(b,a)}return b},getUserMediaPresent:function(){return window.URL&&window.URL.createObjectURL&&(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)},uploadBlob:function(a){var b=this,c=BMP.Forms,d=this.get("blob"),e=c.uuid.v4(),f=function(a,d){d.blob===e&&(c.blobUploader.removeListener("xhr",f),b.set("xhr",a))};"undefined"!=typeof navigator&&navigator.onLine&&d&&!this.get("uuid")&&d.base64&&(c.blobUploader.on("xhr",f),c.blobUploader.saveBlob({answerSpace:c.current.get("answerSpace"),tuple:c.current.get("uuid"),blob:e,file:d.base64,mime:d.type},function(c,d){var e={height:b.get("height"),width:b.get("width"),uuid:b.get("uuid")};if(b.set("xhr",null),b.set("progress",null),c)return"undefined"!=typeof console&&(console.error("uploadBlob() had error during blobUploader.saveBlob()"),console.error(c)),void(_.isFunction(a)&&a(c));try{b.set("uuid",d.blob),b.set("value","data:"+d.mime+";base64,"+d.file),d.width&&d.height&&b.set({height:d.height,width:d.width}),_.isFunction(a)&&a(null,d)}catch(f){b.set(e),"undefined"!=typeof console&&(console.error("uploadBlob() unable use server response"),console.error(f),a(f))}}))},onChangeXHR:function(){var a=this,b=this.get("xhr");b&&b.upload&&b.upload.addEventListener&&(this.set("progress",{lengthComputable:!1,loaded:0,total:0}),b.upload.addEventListener("progress",function(b){a.set("progress",{lengthComputable:b.lengthComputable,loaded:b.loaded,total:1.1*b.total})},!1))},setBlobFromString:function(a){var b;a&&("data:"!==a.substring(0,5)&&(a="data:image/jpeg;base64,"+a),b=window.BMP.Blob.fromDataURI(a),b&&this.set("blob",b))}});return b}),define("models/elements/draw",["models/elements/file"],function(a){"use strict";return a.extend({initialize:function(){a.prototype.initialize.call(this)},initializeView:function(){var a,b=BMP.Forms;this.removeView(),a=this.attributes.readonly?new b._views.BlobReadOnlyElement({model:this}):BMP.BlinkGap.hasTouchDraw()?new b._views.BGDrawElement({model:this}):new b._views.DrawElement({model:this}),this.set("_view",a)}})}),define("models/elements/button",["models/element"],function(a){"use strict";var b=a.extend({initialize:function(){a.prototype.initialize.call(this)}});return b}),function(){function a(a,b,c){var d=b&&c||0,e=0;for(b=b||[],a.toLowerCase().replace(/[0-9a-f]{2}/g,function(a){16>e&&(b[d+e++]=m[a])});16>e;)b[d+e++]=0;return b}function b(a,b){var c=b||0,d=l;return d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]}function c(a,c,d){var e=c&&d||0,f=c||[];a=a||{};var g=null!=a.clockseq?a.clockseq:q,h=null!=a.msecs?a.msecs:(new Date).getTime(),i=null!=a.nsecs?a.nsecs:s+1,j=h-r+(i-s)/1e4;if(0>j&&null==a.clockseq&&(g=g+1&16383),(0>j||h>r)&&null==a.nsecs&&(i=0),i>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");r=h,s=i,q=g,h+=122192928e5;var k=(1e4*(268435455&h)+i)%4294967296;f[e++]=k>>>24&255,f[e++]=k>>>16&255,f[e++]=k>>>8&255,f[e++]=255&k;var l=h/4294967296*1e4&268435455;f[e++]=l>>>8&255,f[e++]=255&l,f[e++]=l>>>24&15|16,f[e++]=l>>>16&255,f[e++]=g>>>8|128,f[e++]=255&g;for(var m=a.node||p,n=0;6>n;n++)f[e+n]=m[n];return c?c:b(f)}function d(a,c,d){var f=c&&d||0;"string"==typeof a&&(c="binary"==a?new k(16):null,a=null),a=a||{};var g=a.random||(a.rng||e)();if(g[6]=15&g[6]|64,g[8]=63&g[8]|128,c)for(var h=0;16>h;h++)c[f+h]=g[h];return c||b(g)}var e,f=this;if("function"==typeof f.require)try{var g=f.require("crypto").randomBytes;e=g&&function(){return g(16)}}catch(h){}if(!e&&f.crypto&&crypto.getRandomValues){var i=new Uint8Array(16);e=function(){return crypto.getRandomValues(i),i}}if(!e){var j=new Array(16);e=function(){for(var a,b=0;16>b;b++)0===(3&b)&&(a=4294967296*Math.random()),j[b]=a>>>((3&b)<<3)&255;return j}}for(var k="function"==typeof f.Buffer?f.Buffer:Array,l=[],m={},n=0;256>n;n++)l[n]=(n+256).toString(16).substr(1),m[l[n]]=n;var o=e(),p=[1|o[0],o[1],o[2],o[3],o[4],o[5]],q=16383&(o[6]<<8|o[7]),r=0,s=0,t=d;if(t.v1=c,t.v4=d,t.parse=a,t.unparse=b,t.BufferClass=k,"undefined"!=typeof module&&module.exports)module.exports=t;else if("function"==typeof define&&define.amd)define("uuid",[],function(){return t});else{var u=f.uuid;t.noConflict=function(){return f.uuid=u,t},f.uuid=t}}.call(this),define("main",["require","bicyclepump","formslib","models/form","models/subform","models/elements/subform","models/behaviour","models/page","models/section","models/element","models/elements/heading","models/elements/message","models/elements/date","models/elements/hidden","models/elements/number","models/elements/telephone","models/elements/password","models/elements/email","models/elements/url","models/elements/text","models/elements/textarea","models/elements/boolean","models/elements/select","models/elements/multi","models/elements/location","models/elements/file","models/elements/draw","models/elements/button","uuid"],function(a){"use strict";var b,c,d;return c=a("bicyclepump"),d=a("formslib"),b=window.BMP.Forms,_.extend(b,Backbone.Events),b._models={Form:a("models/form"),SubForm:a("models/subform"),SubFormElement:a("models/elements/subform"),Behaviour:a("models/behaviour"),Page:a("models/page"),Section:a("models/section"),Element:a("models/element"),HeadingElement:a("models/elements/heading"),MessageElement:a("models/elements/message"),DateElement:a("models/elements/date"),HiddenElement:a("models/elements/hidden"),NumberElement:a("models/elements/number"),TelephoneElement:a("models/elements/telephone"),PasswordElement:a("models/elements/password"),EmailElement:a("models/elements/email"),URLElement:a("models/elements/url"),TextElement:a("models/elements/text"),TextAreaElement:a("models/elements/textarea"),BooleanElement:a("models/elements/boolean"),SelectElement:a("models/elements/select"),MultiElement:a("models/elements/multi"),LocationElement:a("models/elements/location"),FileElement:a("models/elements/file"),DrawElement:a("models/elements/draw"),ButtonElement:a("models/elements/button")},b.uuid=a("uuid"),b.models=new c,b.views=new c,b.blobUploader=d.blobUploader,b.castPropertyValues=d.castPropertyValues,b.flattenDefinition=d.flattenDefinition,b.parseClass=d.parseClass,b.setAttributesFromClass=function(a,c){var d,e,f;if(a&&"object"!=typeof a)throw new TypeError("expect 1st parameter to be Backbone.Model");if(c&&!Array.isArray(c))throw new TypeError("expect 2nd parameter to be an Array, or omitted");c=c||[],c.push("id","name","label"),!a instanceof Backbone.Model||!a.attributes||(d=a.attributes["class"],"string"==typeof d&&-1!==d.indexOf(";")&&(f=b.parseClass(d),c.forEach(function(a){delete f[a]}),e=a.constructor.prototype.defaults||{},a.set(b.castPropertyValues(f,e))))},b.initialize=function(a,c){var d,e;if(!$.isPlainObject(a))throw new Error("unexpected Form definition structure");(!c||_.isEmpty(c)||["add","edit","delete"].indexOf(c)<0)&&(c="add"),d=b._models.Form.create(a,c),b.current=d,e=d.attributes._view=new b._views.Form({model:d}),d.$form=e.$el,e.render()},b.version="3.2.1",b.supports={},b.supports.blob=function(){var a;try{return a=new BMP.Blob,"number"==typeof a.size}catch(b){return!1}return!1}(),b.loaded={},b.loading={},b.loaded.googleMap=!1,b.loading.googleMap=!1,b.loadScript=function(a,b){var c=document.createElement("script");c.src=a,b&&"function"==typeof b&&(c.onload=b,c.onerror=b),document.body.appendChild(c)},b.initializeFlag=function(){b.loaded.googleMap=!0},b.loadMapScript=function(){var a="https://maps.googleapis.com/maps/api/js?v=3.exp&callback=BMP.Forms.initializeFlag";b.loaded.googleMap||b.loading.googleMap!==!1||(b.loadScript(a,function(){b.loading.googleMap=!1}),b.loading.googleMap=!0)},b}),require(["models/expression"],function(a){BMP.Expression=a}),require(["main"],function(a){try{a._views=require("views/forms3jqm")}catch(b){}}),BMP.Forms}),function(a){a.i18n={lc:{en:function(a){return 1===a?"one":"other"}},c:function(a,b){if(!a)throw new Error("MessageFormat: Data required for '"+b+"'.")},n:function(a,b,c){if(isNaN(a[b]))throw new Error("MessageFormat: '"+b+"' isn't a number.");return a[b]-(c||0)},v:function(a,b){return i18n.c(a,b),a[b]},p:function(a,b,c,d,e){return i18n.c(a,b),a[b]in e?e[a[b]]:(b=i18n.lc[d](a[b]-c),b in e?e[b]:e.other)},s:function(a,b,c){return i18n.c(a,b),a[b]in c?c[a[b]]:c.other}},i18n["BMP/Forms/elements"]={LOADING_SHORT:function(a){return"loading..."},LOCATION_BUTTON:function(a){return"Locate"},LOCATING_SHORT:function(a){return"locating..."}},i18n["BMP/Forms/validation"]={MAX:function(a){return"must not be higher than "+i18n.v(a,"MAX")},MIN:function(a){return"must not be lower than "+i18n.v(a,"MIN")},MAXDECIMALS:function(a){return"no more than "+i18n.v(a,"MAX")+" "+i18n.p(a,"MAX",0,"en",{one:"value",other:"values"})+" after the decimal"},MINDECIMALS:function(a){return"needs at least "+i18n.v(a,"MIN")+" "+i18n.p(a,"MIN",0,"en",{one:"value",other:"values"})+" after the decimal"},MAXLENGTH:function(a){return"no longer than "+i18n.v(a,"MAX")+" "+i18n.p(a,"MAX",0,"en",{
one:"character",other:"characters"})},PATTERN:function(a){return"must match this pattern: "+i18n.v(a,"PATTERN")},REQUIRED:function(a){return"must not be empty"},EMAIL:function(a){return"must contain a valid email address"},MAXSUBFORM:function(a){return"no more than "+i18n.v(a,"MAX")+" "+i18n.p(a,"MAX",0,"en",{one:"form",other:"forms"})},MINSUBFORM:function(a){return"no less than "+i18n.v(a,"MIN")+" "+i18n.p(a,"MIN",0,"en",{one:"form",other:"forms"})},SUBFORM:function(a){return"there are some errors in subform formfields"}},i18n["BMP/Forms/warning"]={NO_BLOB_PREVIEW:function(a){return"preview of existing data is not yet supported on this device"},MISSING_BLOB_MIME:function(a){return"type of data is unknown, so a preview cannot be displayed"},ERROR_GOOGLE_MAP:function(a){return"unable to load google maps due to some error"}},i18n["BMP/geolocation"]={PERMISSION_DENIED:function(a){return"user has not granted permission"},PERMISSION_DENIED_TIMEOUT:function(a){return"user did not grant permission in time"},POSITION_UNAVAILABLE:function(a){return"unable to determine position"},UNKNOWN_ERROR:function(a){return"unknown error"}}}(this);
//# sourceMappingURL=forms3jqm.min.js.map