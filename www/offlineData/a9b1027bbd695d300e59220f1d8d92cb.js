!function(){var a,b,c,d,e,f,g;for(a="//d1c6dfkb81l78v.cloudfront.net/",b="/_c_/",document.currentScript||(e=document.getElementsByTagName("script"),document.currentScript=e[e.length-1]),e=document.getElementsByTagName("script"),f=e.length;f>0;)if(f-=1,g=e[f],g.src&&/\/blink\/require\/\d+\/require\.min\.js/.test(g.src)){a=g.src.replace(/blink\/require\/\d+\/require\.min\.js[\w\.]*$/,"");break}"file:"===location.protocol&&(a=a.replace(/^\/\//,"https://")),d=function(c){var d;return d=[a+c,b+c]},c={BlinkForms:d("blink/forms/3/3.2.0/forms3jqm.min"),"BMP.Blobs":d("blink/blobs/1377493706402/bmp-blobs.min"),signaturepad:d("signaturepad/2.3.0/jq.sig.min"),jquerymobile:d("jquery.mobile/1.3.2/jquery.mobile-1.3.2.min"),jquery:d("jquery/1.9.1/jquery.min"),bluebird:d("bluebird/1.2.4/bluebird.min"),backbone:d("backbonejs/1.1.2/backbone-min"),lodash:d("lodash/2.4.1/lodash.compat.min"),modernizr:d("modernizr/2.7.1/modernizr.custom.26204.min"),mustache:d("mustache/0.7.3/mustache.min"),q:d("q/0.9.7/q.min"),underscore:d("lodash/2.4.1/lodash.underscore.min"),"es5-shim":d("es5-shim/2.3.0/es5-shim.min"),pouchdb:d("pouchdb/3.2.1/pouchdb-3.2.1.min")},require.config({paths:c})}(),require.config({shim:{"BMP.Blobs":{deps:["underscore","jquery"],exports:"BMP"},signaturepad:{deps:["jquery"],exports:"$"},backbone:{deps:["underscore","jquery"],exports:"Backbone"},modernizr:{exports:"Modernizr"},underscore:{exports:"_"},sjcl:{exports:"sjcl"}}}),define("implementations",[],function(){return{es5:[{isAvailable:function(){return!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray&&Function.prototype.bind)},implementation:"es5-shim"},{isAvailable:function(){return!0},module:function(){return{}}}],promises:[{isAvailable:function(){return"Promise"in window&&"resolve"in window.Promise&&"reject"in window.Promise&&"all"in window.Promise&&"race"in window.Promise&&function(){var a;return new window.Promise(function(b){a=b}),"function"==typeof a}()},module:function(){return Promise}},{isAvailable:function(){return!0},implementation:"bluebird"}]}}),/**
 * AMD-Feature - A loader plugin for AMD loaders.
 *
 * https://github.com/jensarps/AMD-feature
 *
 * @author Jens Arps - http://jensarps.de/
 * @license MIT or BSD - https://github.com/jensarps/AMD-feature/blob/master/LICENSE
 * @version 1.1.0
 */
define("feature",["implementations"],function(a){return{load:function(b,c,d,e){var f,g,h,i=a[b],j="[object Array]"==Object.prototype.toString.call(i);if(e.isBuild&&j)for(f=0,g=i.length;g>f;f++)i[f].implementation&&c([i[f].implementation],d);else{if(j)for(f=0,g=i.length;g>f;f++){var k=i[f];if(k.isAvailable()){if("undefined"!=typeof k.module)return void d(k.module());h=k.implementation;break}}else{if("undefined"!=typeof i.module)return void d(i.module());h=i}c([h],d)}}}}),function(a,b){"function"==typeof define&&define.amd?define("pollUntil",[],b):"object"==typeof exports?module.exports=b():a.pollUntil=b()}(this,function(){return function a(b,c,d){var e;return b&&b()?(e=null,d()):e=setTimeout(function(){a(b,c,d)},c||197),function(){clearTimeout(e)}}}),function(){var a;a=window.BMP,a.BlinkGap={},a.BlinkGap.isHere=function(){return window.isBlinkGap||window.cordova?!0:a.BIC&&a.BIC.isBlinkGap?!0:!!(window.PhoneGap&&"object"===$.type(window.device)&&window.device instanceof window.Device)},a.BlinkGap.isReady=function(){return a.BlinkGap.isHere()&&!!(window.PhoneGap&&window.PhoneGap.available||window.cordova&&window.cordova.available)},a.BlinkGap.hasCamera=function(){return a.BlinkGap.isHere()&&!!(window.Camera&&window.Camera.getPicture||navigator.camera&&navigator.camera.getPicture)},a.BlinkGap.hasTouchDraw=function(){return a.BlinkGap.isHere()&&!!(window.BGTouchDraw&&window.BGTouchDraw.getDrawing||navigator.bgtouchdraw&&navigator.bgtouchdraw.getDrawing)},a.BlinkGap.hasOffline=function(){return!!(a.BlinkGap.isHere()&&window.cordova&&window.cordova.offline)},a.BlinkGap.isOfflineReady=function(){return!!(a.BlinkGap.isReady()&&a.BlinkGap.hasOffline()&&window.cordova.offline.available)},a.BlinkGap.waitForOffline=function(b,c){var d,e;e=setTimeout(function(){!a.BlinkGap.isOfflineReady()&&d&&(d(),c(new Error("no cordova.offline.available after 5 seconds")))},5e3),d=pollUntil(a.BlinkGap.isOfflineReady,197,function(){clearTimeout(e),b()})},a.BlinkGap.whenReady=function(){var b,c,d,e;return b=new $.Deferred,c=new Date,e=function(){document.removeEventListener("deviceready",e,!1),b.resolve()},d=function(){a.BlinkGap.isHere()?a.BlinkGap.isReady()?b.resolve():document.addEventListener&&document.addEventListener("deviceready",e,!1):$.now()-c>1e4?b.reject(new Error("waitForBlinkGap(): still no PhoneGap after 10 seconds")):setTimeout(d,197)},d(),b.promise()}}(),function(){function a(){var a;if(!BMP.BlinkGap.hasOffline())throw new Error("no offline cordova plugin");if(!cordova.offline.initialURL||"string"!=typeof cordova.offline.initialURL)throw new Error("offline cordova plugin did not supply initialURL");if(a=cordova.offline.initialURL.match(/(https?:\/\/[^\/]+)/),!a)throw new Error("initialURL was malformed and could not be parsed");return a[1]}function b(){return this.plugin=window.cordova.offline,this.urlsMap={},this}BMP.BlinkGap.hasOffline()&&(b.prototype.populateURLsMap=function(a,b){var c=this;BMP.BlinkGap.waitForOffline(function(){c.plugin.listResources(function(b){c.urlsMap=b,a()},function(a){b(a)})},function(a){b(a)})},b.prototype.getURL=function(b){var c;return c=this.urlsMap[b],0===b.indexOf("//")?(c||(c=this.urlsMap["https:"+b]),c||(c=this.urlsMap["http:"+b])):0===b.indexOf("/")&&(b=a()+b,c=this.urlsMap[b]),c},BMP.BlinkGap.offline=new b)}(),define("BlinkGap",["pollUntil"],function(a){return function(){var b;return b||a.BMP.BlinkGap}}(this)),function(a,b){"function"==typeof define&&define.amd?define("bic",["feature!promises","jquery","underscore","backbone","mustache","BlinkForms","jquerymobile","BMP.Blobs","modernizr","pouchdb","pollUntil","feature!es5","BlinkGap"],b):a.bic=b()}(this,function(a,b,c,d,e,f,g,h,i,j,k){function l(a){throw a}function m(a,b,c){4!==b.length&&l(new y.exception.invalid("invalid aes block size"));var d=a.b[c],e=b[0]^d[0],f=b[c?3:1]^d[1],g=b[2]^d[2];b=b[c?1:3]^d[3];var h,i,j,k,m=d.length/4-2,n=4,o=[0,0,0,0];h=a.k[c],a=h[0];var p=h[1],q=h[2],r=h[3],s=h[4];for(k=0;m>k;k++)h=a[e>>>24]^p[f>>16&255]^q[g>>8&255]^r[255&b]^d[n],i=a[f>>>24]^p[g>>16&255]^q[b>>8&255]^r[255&e]^d[n+1],j=a[g>>>24]^p[b>>16&255]^q[e>>8&255]^r[255&f]^d[n+2],b=a[b>>>24]^p[e>>16&255]^q[f>>8&255]^r[255&g]^d[n+3],n+=4,e=h,f=i,g=j;for(k=0;4>k;k++)o[c?3&-k:k]=s[e>>>24]<<24^s[f>>16&255]<<16^s[g>>8&255]<<8^s[255&b]^d[n++],h=e,e=f,f=g,g=b,b=h;return o}function n(a,b){var c,d,e,f=b.slice(0),g=a.r,h=a.b,i=g[0],j=g[1],k=g[2],l=g[3],m=g[4],n=g[5],o=g[6],p=g[7];for(c=0;64>c;c++)16>c?d=f[c]:(d=f[c+1&15],e=f[c+14&15],d=f[15&c]=(d>>>7^d>>>18^d>>>3^d<<25^d<<14)+(e>>>17^e>>>19^e>>>10^e<<15^e<<13)+f[15&c]+f[c+9&15]|0),d=d+p+(m>>>6^m>>>11^m>>>25^m<<26^m<<21^m<<7)+(o^m&(n^o))+h[c],p=o,o=n,n=m,m=l+d|0,l=k,k=j,j=i,i=d+(j&k^l&(j^k))+(j>>>2^j>>>13^j>>>22^j<<30^j<<19^j<<10)|0;g[0]=g[0]+i|0,g[1]=g[1]+j|0,g[2]=g[2]+k|0,g[3]=g[3]+l|0,g[4]=g[4]+m|0,g[5]=g[5]+n|0,g[6]=g[6]+o|0,g[7]=g[7]+p|0}function o(a,b){var c,d=y.random.w[a],e=[];for(c in d)d.hasOwnProperty(c)&&e.push(d[c]);for(c=0;c<e.length;c++)e[c](b)}function p(a){"undefined"!=typeof window&&window.performance&&"function"==typeof window.performance.now?y.random.addEntropy(window.performance.now(),a,"loadtime"):y.random.addEntropy((new Date).valueOf(),a,"loadtime")}function q(a){a.b=r(a).concat(r(a)),a.A=new y.cipher.aes(a.b)}function r(a){for(var b=0;4>b&&(a.f[b]=a.f[b]+1|0,!a.f[b]);b++);return a.A.encrypt(a.f)}function s(a,b){return function(){b.apply(a,arguments)}}window.pollUntil=k;/**
 * @license almond 0.3.1 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */
var t,u,v;!function(a){function b(a,b){return r.call(a,b)}function c(a,b){var c,d,e,f,g,h,i,j,k,l,m,n=b&&b.split("/"),o=p.map,q=o&&o["*"]||{};if(a&&"."===a.charAt(0))if(b){for(a=a.split("/"),g=a.length-1,p.nodeIdCompat&&w.test(a[g])&&(a[g]=a[g].replace(w,"")),a=n.slice(0,n.length-1).concat(a),k=0;k<a.length;k+=1)if(m=a[k],"."===m)a.splice(k,1),k-=1;else if(".."===m){if(1===k&&(".."===a[2]||".."===a[0]))break;k>0&&(a.splice(k-1,2),k-=2)}a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((n||q)&&o){for(c=a.split("/"),k=c.length;k>0;k-=1){if(d=c.slice(0,k).join("/"),n)for(l=n.length;l>0;l-=1)if(e=o[n.slice(0,l).join("/")],e&&(e=e[d])){f=e,h=k;break}if(f)break;!i&&q&&q[d]&&(i=q[d],j=k)}!f&&i&&(f=i,h=j),f&&(c.splice(0,h,f),a=c.join("/"))}return a}function d(b,c){return function(){var d=s.call(arguments,0);return"string"!=typeof d[0]&&1===d.length&&d.push(null),k.apply(a,d.concat([b,c]))}}function e(a){return function(b){return c(b,a)}}function f(a){return function(b){n[a]=b}}function g(c){if(b(o,c)){var d=o[c];delete o[c],q[c]=!0,j.apply(a,d)}if(!b(n,c)&&!b(q,c))throw new Error("No "+c);return n[c]}function h(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function i(a){return function(){return p&&p.config&&p.config[a]||{}}}var j,k,l,m,n={},o={},p={},q={},r=Object.prototype.hasOwnProperty,s=[].slice,w=/\.js$/;l=function(a,b){var d,f=h(a),i=f[0];return a=f[1],i&&(i=c(i,b),d=g(i)),i?a=d&&d.normalize?d.normalize(a,e(b)):c(a,b):(a=c(a,b),f=h(a),i=f[0],a=f[1],i&&(d=g(i))),{f:i?i+"!"+a:a,n:a,pr:i,p:d}},m={require:function(a){return d(a)},exports:function(a){var b=n[a];return"undefined"!=typeof b?b:n[a]={}},module:function(a){return{id:a,uri:"",exports:n[a],config:i(a)}}},j=function(c,e,h,i){var j,k,p,r,s,t,u=[],v=typeof h;if(i=i||c,"undefined"===v||"function"===v){for(e=!e.length&&h.length?["require","exports","module"]:e,s=0;s<e.length;s+=1)if(r=l(e[s],i),k=r.f,"require"===k)u[s]=m.require(c);else if("exports"===k)u[s]=m.exports(c),t=!0;else if("module"===k)j=u[s]=m.module(c);else if(b(n,k)||b(o,k)||b(q,k))u[s]=g(k);else{if(!r.p)throw new Error(c+" missing "+k);r.p.load(r.n,d(i,!0),f(k),{}),u[s]=n[k]}p=h?h.apply(n[c],u):void 0,c&&(j&&j.exports!==a&&j.exports!==n[c]?n[c]=j.exports:p===a&&t||(n[c]=p))}else c&&(n[c]=h)},t=u=k=function(b,c,d,e,f){if("string"==typeof b)return m[b]?m[b](c):g(l(b,c).f);if(!b.splice){if(p=b,p.deps&&k(p.deps,p.callback),!c)return;c.splice?(b=c,c=d,d=null):b=a}return c=c||function(){},"function"==typeof d&&(d=e,e=f),e?j(a,b,c,d):setTimeout(function(){j(a,b,c,d)},4),k},k.config=function(a){return k(a)},t._defined=n,v=function(a,c,d){if("string"!=typeof a)throw new Error("See almond README: incorrect module build, no module name");c.splice||(d=c,c=[]),b(n,a)||b(o,a)||(o[a]=[a,c,d])},v.amd={jQuery:!0}}(),v("../node_modules/almond/almond",function(){}),v("mediator",[],function(){var a,b,c,d;return c={},c.channels={},d=function(a,b,c){console.log(Date.now()+": "+a+" "+b,c)},a=function(a){var b,e,f;if(!c.channels[a])return!1;for(b=Array.prototype.slice.call(arguments,1),e=0;e<c.channels[a].length;e++)f=c.channels[a][e],f.callback.apply(f.context,b);return h.Debug&&d("Publish",a,b),this},b=function(a,b){return c.channels[a]||(c.channels[a]=[]),c.channels[a].push({context:this,callback:b}),h.Debug&&d("Subscribe",a),this},{publish:a,subscribe:b}}),v("facade",["mediator"],function(a){var b,c;return b=function(){a.publish.apply(this,arguments)},c=function(b,c,d){a.subscribe(c,d)},{publish:b,subscribe:c}}),v("implementations",[],function(){return{data:[{isAvailable:function(){try{return i.indexeddb&&null===window.indexedDB.open("idbTest",1).onupgradeneeded&&-1===navigator.userAgent.indexOf("iPhone")&&-1===navigator.userAgent.indexOf("iPad")||window.BMP.BIC.isBlinkGap&&i.websqldatabase}catch(a){}return!1},implementation:"data-pouch"},{isAvailable:function(){return!0},implementation:"data-inMemory"}],api:[{isAvailable:function(){return window.cordova&&window.cordova.offline},implementation:"api-native"},{isAvailable:function(){return!0},implementation:"api-web"}]}}),/**
 * AMD-Feature - A loader plugin for AMD loaders.
 *
 * https://github.com/jensarps/AMD-feature
 *
 * @author Jens Arps - http://jensarps.de/
 * @license MIT or BSD - https://github.com/jensarps/AMD-feature/blob/master/LICENSE
 * @version 1.1.0
 */
v("feature",["implementations"],function(a){return{load:function(b,c,d,e){var f,g,h,i=a[b],j="[object Array]"==Object.prototype.toString.call(i);if(e.isBuild&&j)for(f=0,g=i.length;g>f;f++)i[f].implementation&&c([i[f].implementation],d);else{if(j)for(f=0,g=i.length;g>f;f++){var k=i[f];if(k.isAvailable()){if("undefined"!=typeof k.module)return void d(k.module());h=k.implementation;break}}else{if("undefined"!=typeof i.module)return void d(i.module());h=i}c([h],d)}}}}),function(){function a(a,b,c){var d=b&&c||0,e=0;for(b=b||[],a.toLowerCase().replace(/[0-9a-f]{2}/g,function(a){16>e&&(b[d+e++]=m[a])});16>e;)b[d+e++]=0;return b}function b(a,b){var c=b||0,d=l;return d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]}function c(a,c,d){var e=c&&d||0,f=c||[];a=a||{};var g=null!=a.clockseq?a.clockseq:q,h=null!=a.msecs?a.msecs:(new Date).getTime(),i=null!=a.nsecs?a.nsecs:s+1,j=h-r+(i-s)/1e4;if(0>j&&null==a.clockseq&&(g=g+1&16383),(0>j||h>r)&&null==a.nsecs&&(i=0),i>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");r=h,s=i,q=g,h+=122192928e5;var k=(1e4*(268435455&h)+i)%4294967296;f[e++]=k>>>24&255,f[e++]=k>>>16&255,f[e++]=k>>>8&255,f[e++]=255&k;var l=h/4294967296*1e4&268435455;f[e++]=l>>>8&255,f[e++]=255&l,f[e++]=l>>>24&15|16,f[e++]=l>>>16&255,f[e++]=g>>>8|128,f[e++]=255&g;for(var m=a.node||p,n=0;6>n;n++)f[e+n]=m[n];return c?c:b(f)}function d(a,c,d){var f=c&&d||0;"string"==typeof a&&(c="binary"==a?new k(16):null,a=null),a=a||{};var g=a.random||(a.rng||e)();if(g[6]=15&g[6]|64,g[8]=63&g[8]|128,c)for(var h=0;16>h;h++)c[f+h]=g[h];return c||b(g)}var e,f=this;if("function"==typeof f.require)try{var g=f.require("crypto").randomBytes;e=g&&function(){return g(16)}}catch(h){}if(!e&&f.crypto&&crypto.getRandomValues){var i=new Uint8Array(16);e=function(){return crypto.getRandomValues(i),i}}if(!e){var j=new Array(16);e=function(){for(var a,b=0;16>b;b++)0===(3&b)&&(a=4294967296*Math.random()),j[b]=a>>>((3&b)<<3)&255;return j}}for(var k="function"==typeof f.Buffer?f.Buffer:Array,l=[],m={},n=0;256>n;n++)l[n]=(n+256).toString(16).substr(1),m[l[n]]=n;var o=e(),p=[1|o[0],o[1],o[2],o[3],o[4],o[5]],q=16383&(o[6]<<8|o[7]),r=0,s=0,t=d;if(t.v1=c,t.v4=d,t.parse=a,t.unparse=b,t.BufferClass=k,"undefined"!=typeof module&&module.exports)module.exports=t;else if("function"==typeof v&&v.amd)v("uuid",[],function(){return t});else{var u=f.uuid;t.noConflict=function(){return f.uuid=u,t},f.uuid=t}}.call(this),v("api-native",["uuid"],function(d){var e={getAnswerSpaceMap:function(b){return new a(function(a,c){var d="";b&&(d="&_username="+b),cordova.offline.retrieveContent(function(b){a(JSON.parse(b))},c,{url:"/_R_/common/3/xhr/GetConfig.php?_asn="+window.BMP.BIC.siteVars.answerSpace.toLowerCase()+d})})},getInteractionResult:function(a,d,e){var f="";return d&&"object"==typeof d&&c.each(d,function(a,b){a&&(f+="&"+b+"="+a)}),b.ajax("/_R_/common/3/xhr/GetAnswer.php?asn="+window.BMP.BIC.siteVars.answerSpace.toLowerCase()+"&iact="+a+"&ajax=false"+f,e)},getForm:function(){return new a(function(a,b){cordova.offline.retrieveContent(function(b){a(JSON.parse(b))},b,{url:"/_R_/common/3/xhr/GetForm.php?_v=3&_aid="+window.BMP.BIC.siteVars.answerSpaceId})})},getDataSuitcase:function(b,c){return new a(function(a,d){cordova.offline.retrieveContent(a,d,{url:"/_R_/common/3/xhr/GetMoJO.php?_id="+window.BMP.BIC.siteVars.answerSpaceId+"&_m="+b+"&_lc=0"})})},setPendingItem:function(a,c,e){return e._uuid=d.v4(),e._submittedTime=b.now(),e._submittedTimezoneOffset=(new Date).getTimezoneOffset(),e._submittedTimezoneOffset/=-60,b.post("/_R_/common/3/xhr/SaveFormRecord.php?_asid="+window.BMP.BIC.siteVars.answerSpaceId+"&_fn="+a+"&_action="+c,e)},getLoginStatus:function(){return b.ajax("/_R_/common/3/xhr/GetLogin.php")},getFormList:function(c){return new a(function(a,d){cordova.offline.retrieveContent(function(c){a(b.parseXML(c))},d,{url:"/_R_/common/3/xhr/GetFormList.php?_asid="+window.BMP.BIC.siteVars.answerSpaceId+"&_fn="+c})})},getFormRecord:function(c,d,e){return new a(function(a,f){cordova.offline.retrieveContent(function(c){a(b.parseXML(c))},f,{url:"/_R_/common/3/xhr/GetFormRecord.php?_asid="+window.BMP.BIC.siteVars.answerSpaceId+"&_fn="+c+"&_tid="+e+"&action="+d})})}};return e}),v("api-web",["uuid"],function(a){var d={getAnswerSpaceMap:function(a){var c="";return a&&(c="&_username="+a),b.ajax("/_R_/common/3/xhr/GetConfig.php?_asn="+window.BMP.BIC.siteVars.answerSpace.toLowerCase()+c)},getInteractionResult:function(a,d,e){var f="";return d&&"object"==typeof d&&c.each(d,function(a,b){a&&(f+="&"+b+"="+a)}),b.ajax("/_R_/common/3/xhr/GetAnswer.php?asn="+window.BMP.BIC.siteVars.answerSpace.toLowerCase()+"&iact="+a+"&ajax=false"+f,e)},getForm:function(){return b.ajax("/_R_/common/3/xhr/GetForm.php?_v=3&_aid="+window.BMP.BIC.siteVars.answerSpaceId)},getDataSuitcase:function(a,c){return b.ajax("/_R_/common/3/xhr/GetMoJO.php?_id="+window.BMP.BIC.siteVars.answerSpaceId+"&_m="+a+"&_lc=0",{dataType:"text"})},setPendingItem:function(c,d,e){return e._uuid=a.v4(),e._submittedTime=b.now(),e._submittedTimezoneOffset=(new Date).getTimezoneOffset(),e._submittedTimezoneOffset/=-60,b.post("/_R_/common/3/xhr/SaveFormRecord.php?_asid="+window.BMP.BIC.siteVars.answerSpaceId+"&_fn="+c+"&_action="+d,e)},getLoginStatus:function(){return b.ajax("/_R_/common/3/xhr/GetLogin.php")},getFormList:function(a){return b.ajax("/_R_/common/3/xhr/GetFormList.php?_asid="+window.BMP.BIC.siteVars.answerSpaceId+"&_fn="+a)},getFormRecord:function(a,c,d){return b.ajax("/_R_/common/3/xhr/GetFormRecord.php?_asid="+window.BMP.BIC.siteVars.answerSpaceId+"&_fn="+a+"&_tid="+d+"&action="+c)}};return d}),v("model-interaction",["facade","feature!api"],function(e,f){var g=d.Model.extend({idAttribute:"_id",defaults:{header:null,content:null,contentTime:null,footer:null,name:null},inherit:function(a){var b,d=u("model-application");return this.has("parent")&&(c.each(this.attributes,function(b,d){c.has(a,d)&&a[d]||(a[d]=b)},this),"app"!==this.get("parent")?(b=d.interactions.get(this.get("parent")),b.inherit(a)):c.each(d.attributes,function(b,d){c.has(a,d)&&a[d]||(a[d]=b)},d)),a},prepareForView:function(b){var c=this;return new a(function(a,d){c.id===window.BMP.BIC.siteVars.answerSpace.toLowerCase()&&c.prepareAnswerSpace(a,d,b),"madl code"===c.get("type")&&c.prepareMADL(a,d,b),"xslt"===c.get("type")&&0===c.get("xml").indexOf("stars:")&&c.set({mojoType:"stars",xml:c.get("xml").replace(/^stars:/,"")}),"xslt"===c.get("type")&&"stars"===c.get("mojoType")&&c.prepareStars(a),"madl code"!==c.get("type")&&c.id!==window.BMP.BIC.siteVars.answerSpace.toLowerCase()&&a(c)})},prepareAnswerSpace:function(a,d,e){var f=this;u(["model-application"],function(g){var h,i,j;g.has("homeScreen")&&g.get("homeScreen")!==!1&&g.has("homeInteraction")?(h=g.interactions.findWhere({dbid:"i"+g.get("homeInteraction")}),h?(h.set({parent:f.get("parent")}),h.prepareForView(e).then(function(){a(h)})):d()):(f.set({interactionList:c.map(c.filter(g.interactions.models,function(a){return a.id!==window.BMP.BIC.siteVars.answerSpace.toLowerCase()&&"hide"!==a.get("display")&&(!a.has("tags")||a.has("tags")&&0===a.get("tags").length||c.filter(a.get("tags"),function(a){return a==="nav-"+window.BMP.BIC.siteVars.answerSpace.toLowerCase()},this).length>0)},this),function(a){return a.attributes})}),0===f.get("interactionList").length&&g.has("loginAccess")&&g.get("loginAccess")===!0&&g.has("loginPromptInteraction")?(i=g.interactions.findWhere({dbid:"i"+g.get("loginPromptInteraction")}),j=b.mobile.path.parseLocation().pathname,"/"===j.slice(-1)&&(j=j.slice(0,j.length-1)),a(f),b.mobile.changePage(j+"/"+i.id)):a(f))})},prepareMADL:function(a,b,c){var d=this;u(["model-application"],function(g){f.getInteractionResult(d.id,d.get("args"),c.options).then(function(b){d.save({content:b,contentTime:Date.now()},{success:function(){var f;a(d),g.get("loginAccess")&&"i"+g.get("loginPromptInteraction")===d.get("dbid")&&g.checkLoginStatus().then(function(){"LOGGED IN"===g.get("loginStatus")&&c.options.data?(f=d.parseAuthString(c.options.data),e.publish("storeAuth",f),d.save({"content-principal":b})):d.get("args")["args[logout]"]||d.save({"content-anonymous":b})})},error:function(){a(d)}})},function(f,h,i){var j;g.get("loginAccess")&&"i"+g.get("loginPromptInteraction")===d.get("dbid")?c.options.data?(j=d.parseAuthString(c.options.data),d.listenToOnce(g,"loginProcessed",function(){"LOGGED IN"===g.get("loginStatus")?d.set("content",d.get("content-principal")):d.set("content",d.get("content-anonymous")),a(d)}),e.publish("authenticateAuth",j)):(d.set("content",d.get("content-anonymous")),a(d)):b(i)})})},prepareStars:function(a){var b=this;u(["model-application"],function(d){var e,f;c.each(d.stars.where({type:b.get("xml")}),function(a){e+="<"+a.get("type")+" id="+a.get("_id")+">",f=c.clone(a.attributes),delete f._id,delete f._rev,delete f.type,delete f.state,c.each(f,function(a,b){e+="<"+b+">"+a+"</"+b+">"}),e+="</"+a.get("type")+">"}),e="<stars>"+e+"</stars>",b.set({starXml:e}),a(b)})},parseAuthString:function(a){var b,c,d={};for(a=a.split("&"),b=0;b<a.length;b++){switch(c=a[b].split("="),c[0]){case"username":d.principal=c[1];break;case"password":d.credential=c[1];break;case"submit":break;default:d[c[0]]=c[1]}d.expiry||(d.expiry=2592e5)}return d},performXSLT:function(){var a,d,e,f,g,h,i,j,k,l,m,n,o,p,q;if(this.has("args"))for(i=this.get("args"),a=this.get("xsl"),j=a.match(/\$args\[[\w\:][\w\:\-\.]*\]/g),k=j?j.length:0,l=0;k>l;l+=1)m="string"==typeof i[j[l].substring(1)]?i[j[l].substring(1)]:"",m=m.replace("",""),m=m.replace("",""),m=decodeURIComponent(m),a=a.replace(j[l],m);else a=this.get("xsl");o=a.match(/blink-stars\(([@\w.]+),\W*(\w+)\W*\)/),o&&u(["model-application"],function(b){var d;for(d=function(a){return p="",q=a[1],a=a[2],c.each(b.stars.where({type:a}),function(a){p+=" or "+q+"='"+a.get("_id")+"'"}),p=p.substr(4)};o;)p=d(o),a=p.length>0?a.replace(/\(?blink-stars\(([@\w.]+),\W*(\w+)\W*\)\)?/,"("+p+")"):a.replace(/\(?blink-stars\(([@\w.]+),\W*(\w+)\W*\)\)?/,"(false())"),o=a.match(/blink-stars\(([@\w.]+),\W*(\w+)\W*\)/)}),n=this,u(["model-application"],function(c){return d=n.get("starXml")||c.datasuitcases.get(n.get("xml")).get("data"),e=a,"string"!=typeof d||"string"!=typeof e?void n.set("content","XSLT failed due to poorly formed XML or XSL."):(g=b.parseXML(d),a=b.parseXML(e),window.XSLTProcessor?(h=new window.XSLTProcessor,h.importStylesheet(a),f=h.transformToFragment(g,document)):f=void 0!==g.transformNode?g.transformNode(a):window.xsltProcess?window.xsltProcess(g,a):"<p>Your browser does not support Data Suitcase keywords.</p>",void(f&&n.set("content",f)))})}});return g}),v("data-pouch",[],function(){var b=function(b){var c;this.name=this.dbAdapter&&b?b:"BlinkMobile",this.getDB=function(){var b=this;return c?a.resolve(c):new a(function(a,d){var e;j.prefix="",e=new j({name:b.name,adapter:b.dbAdapter(),auto_compaction:!0},function(b){b?d(b):(c=e,a(c))})})}};return c.extend(b.prototype,{dbAdapter:function(){var a=!1;return window.BMP.BIC.isBlinkGap===!0&&j.adapters.websql?a="websql":j.adapters.idb&&(a="idb"),a},create:function(b){var c=this;return new a(function(a,d){return b.toJSON?void c.getDB().then(function(e){e.post(b.toJSON(),function(b,e){b?d(b):c.read(e).then(function(b){a(b)})})}):d("Invalid model")})},update:function(b){var c=this;return new a(function(a,d){return b.toJSON?void c.getDB().then(function(e){e.put(b.toJSON(),function(e){e?d(e):c.read(b).then(function(b){a(b)})})}):d("Invalid model")})},read:function(b){var c=this;return new a(function(a,d){return b.id?void c.getDB().then(function(c){c.get(b.id,function(b,c){b?d(b):a(c)})}):d("Invalid model")})},readAll:function(){var b=this;return new a(function(a,d){b.getDB().then(function(b){b.allDocs({include_docs:!0},function(b,e){b?d(b):a(c.map(e.rows,function(a){return a.doc}))})})})},"delete":function(b){var c=this;return new a(function(a,d){return b.id?void c.getDB().then(function(c){c.get(b.id,function(b,e){b?d(b):c.remove(e,function(b,c){b?d(b):a(c)})})}):d("Invalid model")})},deleteAll:function(){var b=this;return new a(function(a,c){b.getDB().then(function(d){d.destroy(function(d){d?c(d):(b.db=null,a())})})})}}),b}),v("data-inMemory",[],function(){var b=function(){this.data={}};return c.extend(b.prototype,{create:function(){return a.reject("Persistent storage not available")},update:function(){return a.reject("Persistent storage not available")},read:function(){return a.reject("Persistent storage not available")},readAll:function(){return a.reject("Persistent storage not available")},"delete":function(){return a.reject("Persistent storage not available")}}),b}),v("collection-interactions",["model-interaction","feature!data"],function(b,e){var f=d.Collection.extend({model:b,datastore:function(){return this.data=new e(window.BMP.BIC.siteVars.answerSpace.toLowerCase()+"-Interaction"),this},load:function(){var b=this;return new a(function(a,c){b.fetch({success:a,error:c})})},save:function(){return a.all(c.map(this.models,function(b){return new a(function(a,c){b.save({},{success:a,error:c})})}))},comparator:"order"});return f}),v("model-datasuitcase",["feature!api"],function(b){var c=d.Model.extend({idAttribute:"_id",populate:function(){var c=this,d=0;return this.has("contentTime")&&(d=this.get("contentTime")),new a(function(a,e){b.getDataSuitcase(c.id,d).then(function(b){c.save({data:b,contentTime:Date.now()},{success:a,error:e})})})}});return c}),v("collection-datasuitcases",["model-datasuitcase","feature!data"],function(b,e){var f=d.Collection.extend({model:b,datastore:function(){return this.data=new e(window.BMP.BIC.siteVars.answerSpace.toLowerCase()+"-DataSuitcase"),this},load:function(){var b=this;return new a(function(a){b.fetch({success:a,error:a})})},save:function(){return a.all(c.map(this.models,function(b){return new a(function(a,c){b.save({},{success:a,error:c})})}))}});return f}),v("model-form",["feature!api"],function(a){var b=d.Model.extend({idAttribute:"_id",populate:function(){var b=this;a.getForm(this.id).then(function(a){b.save({definition:a.definition,contentTime:Date.now()})})}});return b}),v("collection-forms",["model-form","feature!data","feature!api"],function(b,e,g){var h=d.Collection.extend({model:b,initialize:function(){f||(window.BlinkForms={}),f.getDefinition=function(b,c){return new a(function(a,d){u(["model-application"],function(e){var g=e.forms.get(b);if(!g)return d(new Error('unable to locate "'+b+'" definition'));try{a(f.flattenDefinition(g.attributes,c))}catch(h){d(h)}})})}},datastore:function(){return this.data=new e(window.BMP.BIC.siteVars.answerSpace.toLowerCase()+"-Form"),this},load:function(){var b=this;return new a(function(a,c){b.fetch({success:a,error:c})})},download:function(){var b=this;return navigator.onLine||window.BMP.BIC.isBlinkGap?void g.getForm().then(function(a){c.each(a,function(a){var c=JSON.parse(a),d=b.findWhere({_id:c["default"].name});d?d.set(c).save():(c._id=c["default"].name,b.create(c))})}):a.resolve()}});return h}),v("model-pending",[],function(){var a=d.Model.extend({idAttribute:"_id"});return a}),v("collection-pending",["model-pending","feature!data","feature!api"],function(b,e,f){var g=d.Collection.extend({model:b,datastore:function(){return this.data=new e(window.BMP.BIC.siteVars.answerSpace.toLowerCase()+"-Pending"),this},load:function(){var b=this;return new a(function(a,c){b.fetch({success:a,error:c})})},processQueue:function(){var b,d;return b=[],d=function(a,b){return function(c,d,e){var f;c&&200===e.status?a.save({status:"Submitted",result:c}):"error"===d&&c.responseText&&(f=JSON.parse(c.responseText),a.save({status:"Failed Validation",errors:f})),a.trigger("processed"),b()}},c.each(this.where({status:"Pending"}),function(c){b.push(new a(function(a,b){f.setPendingItem(c.get("name"),c.get("action"),c.get("data")).then(d(c,a),d(c,b))}))},this),a.all(b)}});return g}),v("model-star",[],function(){var a=d.Model.extend({idAttribute:"_id",initialize:function(){this.on("add",function(){this.save()},this)},toggle:function(){var a=this;a.get("state")?this.set("state",!1):this.set("state",!0),u(["model-application"],function(b){a.get("state")?b.stars.add(a):a.destroy()})}});return a}),v("collection-stars",["model-star","feature!data"],function(b,e){var f=d.Collection.extend({model:b,datastore:function(){return this.data=new e(window.BMP.BIC.siteVars.answerSpace.toLowerCase()+"-Star"),this},load:function(){var b=this;return new a(function(a,c){b.fetch({success:a,error:c})})},clear:function(a){c.each(this.where({type:a}),function(a){a.destroy()})}});return f}),/**
 * @license RequireJS domReady 2.0.1 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/domReady for details
 */
v("domReady",[],function(){function a(a){var b;for(b=0;b<a.length;b+=1)a[b](j)}function b(){var b=k;i&&b.length&&(k=[],a(b))}function c(){i||(i=!0,g&&clearInterval(g),b())}function d(a){return i?a(j):k.push(a),d}var e,f,g,h="undefined"!=typeof window&&window.document,i=!h,j=h?document:null,k=[];if(h){if(document.addEventListener)document.addEventListener("DOMContentLoaded",c,!1),window.addEventListener("load",c,!1);else if(window.attachEvent){window.attachEvent("onload",c),f=document.createElement("div");try{e=null===window.frameElement}catch(l){}f.doScroll&&e&&window.external&&(g=setInterval(function(){try{f.doScroll(),c()}catch(a){}},30))}"complete"===document.readyState&&c()}return d.version="2.0.1",d.load=function(a,b,c,e){e.isBuild?c(null):d(c)},d}),v("model-form-record",["feature!api"],function(a){var b=d.Model.extend({idAttribute:"_id",populate:function(b,d){var e=this;a.getFormRecord(e.get("formName"),b,e.get("id")).then(function(a){var b,f,g;g={},b=a.evaluate("//"+e.get("formName"),a),f=b.iterateNext(),c.each(f.children,function(a){g[a.nodeName]=a.innerHTML}),e.set({record:g,contentTime:Date.now()}),e.save({},{success:d,error:d})})}});return b}),v("collection-form-records",["model-form-record","feature!data","feature!api"],function(b,e,f){var g=d.Collection.extend({model:b,datastore:function(){return this.data=new e(window.BMP.BIC.siteVars.answerSpace.toLowerCase()+"-FormRecord"),this},load:function(){var b=this;return new a(function(a,c){b.fetch({success:a,error:c})})},pull:function(b){var d=this;return new a(function(a,e){f.getFormList(b).then(function(e){var f,g,h,i;for(f=e.evaluate("//"+b,e),g=f.iterateNext(),i=function(a){"id"===a.nodeName?h.id=a.innerHTML:h.list[a.nodeName]=a.innerHTML};g;)h={},h.formName=b,h.list={},c.each(g.children,i),h._id=b+"-"+h.id,d.add(h,{merge:!0}),g=f.iterateNext();a()},function(){e()})})}});return g}),v("model-application",["facade","collection-interactions","collection-datasuitcases","collection-forms","collection-pending","feature!data","feature!api","collection-stars","domReady","collection-form-records"],function(e,f,g,i,j,l,m,n,o,p){var q=d.Model.extend({idAttribute:"_id",defaults:{_id:window.BMP.BIC.siteVars.answerSpace.toLowerCase(),loginStatus:!1},datastore:function(){return this.data=new l(window.BMP.BIC.siteVars.answerSpace.toLowerCase()+"-AnswerSpace"),this},collections:function(){var b=this;return this.collections._promise?this.collections._promise:(this.collections._promise=new a(function(c,d){k(function(){return!!b.data},null,function(){h.Authentication&&(b.meta=new l(window.BMP.BIC.siteVars.answerSpace.toLowerCase()+"-Meta"),h.Authentication.getRecord=function(a){b.meta.read({id:"offlineLogin"}).then(function(b){a(null,b.attributes)},function(b){a(b)})},h.Authentication.setRecord=function(a,c){var d={};d.id="offlineLogin",d.toJSON=function(){return d.attributes},d.attributes=a,d.attributes._id=d.id,b.meta.read({id:d.id}).then(function(){b.meta["delete"]({id:d.id}).then(function(){b.meta.create(d).then(function(a){c(null,a)},function(a){c(a)})},function(a){c(a)})},function(){b.meta.create(d).then(function(a){c(null,a)},function(a){c(a)})})}),b.interactions=b.interactions||new f,b.datasuitcases=b.datasuitcases||new g,b.forms=b.forms||new i,b.pending=b.pending||new j,b.stars=b.stars||new n,b.formRecords=b.formRecords||new p,a.all([b.interactions.datastore().load(),b.datasuitcases.datastore().load(),b.forms.datastore().load(),b.pending.datastore().load(),b.stars.datastore().load(),b.formRecords.datastore().load()]).then(c,d)})}),this.collections._promise)},setup:function(){var b=this;return e.subscribe("applicationModel","loggedIn",function(){b.set("loginStatus","LOGGED IN"),b.trigger("loginProcessed")}),e.subscribe("applicationModel","loggedOut",function(){b.set("loginStatus","LOGGED OUT"),b.trigger("loginProcessed")}),new a(function(a,c){b.fetch({success:a,error:c})})},populate:function(){var b=this;return navigator.onLine||h.BlinkGap.isHere()?b.collections().then(null,function(){return null}).then(function(){return a.resolve(m.getAnswerSpaceMap())}).then(function(d){return a.all(c.compact(c.map(d,function(c,d){var e;return"c"===d.substr(0,1)||"i"===d.substr(0,1)?(e=c.pertinent,e._id=e.name.toLowerCase(),e.dbid=d,b.interactions.add(e,{merge:!0}),e._id):"a"===d.substr(0,1)?new a(function(a,f){e={_id:window.BMP.BIC.siteVars.answerSpace.toLowerCase(),dbid:d},b.interactions.add(e,{merge:!0}),b.save(c.pertinent,{success:function(){a(window.BMP.BIC.siteVars.answerSpace.toLowerCase())},error:f})}):void 0})))}).then(function(d){return a.all(c.map(c.reject(b.interactions.models,function(a){return c.contains(d,a.id)}),function(b){return new a(function(a,c){b.destroy({success:a,error:c})})}))}).then(function(){return a.all(c.map(c.compact(c.uniq(b.interactions.pluck("xml"))),function(c){return new a(function(a){b.datasuitcases.get(c)?b.datasuitcases.get(c).populate().then(a,a):(b.datasuitcases.add({_id:c}),b.datasuitcases.get(c).populate().then(a,a))})}))}).then(function(){return b.datasuitcases.save()}).then(function(){return b.interactions.save()}):a.resolve()},whenPopulated:function(){var b=this;return new a(function(a,c){b.collections().then(function(){var d;b.interactions.length?a():(b.interactions.once("add",function(){clearTimeout(d),a()}),d=setTimeout(function(){c(new Error("whenPopulated timed out after 20 seconds"))},2e4))},function(){c(new Error("whenPopulated failed due to collections"))})})},checkLoginStatus:function(){var b=this;return new a(function(a){m.getLoginStatus().then(function(c){var d=c.status||c;b.get("loginStatus")!==d?b.populate().then(function(){b.set({loginStatus:d}),a()}):a()})})},initialRender:function(){var a=this;b.mobile.defaultPageTransition=a.get("defaultTransition"),o(function(){b.mobile.changePage(b.mobile.path.parseLocation().href,{changeHash:!1,reloadPage:!0,transition:"fade"}),b(document).one("pageshow",function(){window.BootStatus&&window.BootStatus.notifySuccess&&window.BootStatus.notifySuccess(),b("#temp").remove()})})}});return window.BMP.BIC3=new q,window.BMP.BIC3.history={length:0},window.onpopstate=function(){window.BMP.BIC3.history.length+=1},window.BMP.BIC3.version="3.2.2",b.extend(window.BMP.BIC3,window.BMP.BIC),window.BMP.BIC=window.BMP.BIC3,window.BMP.BIC3});var w=void 0,x=!1,y={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(a){this.toString=function(){return"CORRUPT: "+this.message},this.message=a},invalid:function(a){this.toString=function(){return"INVALID: "+this.message},this.message=a},bug:function(a){this.toString=function(){return"BUG: "+this.message},this.message=a},notReady:function(a){this.toString=function(){return"NOT READY: "+this.message},this.message=a}}};"undefined"!=typeof module&&module.exports&&(module.exports=y),"function"==typeof v&&v("sjcl",[],function(){return y}),y.cipher.aes=function(a){this.k[0][0][0]||this.D();var b,c,d,e,f=this.k[0][4],g=this.k[1];b=a.length;var h=1;for(4!==b&&6!==b&&8!==b&&l(new y.exception.invalid("invalid aes key size")),this.b=[d=a.slice(0),e=[]],a=b;4*b+28>a;a++)c=d[a-1],(0===a%b||8===b&&4===a%b)&&(c=f[c>>>24]<<24^f[c>>16&255]<<16^f[c>>8&255]<<8^f[255&c],0===a%b&&(c=c<<8^c>>>24^h<<24,h=h<<1^283*(h>>7))),d[a]=d[a-b]^c;for(b=0;a;b++,a--)c=d[3&b?a:a-4],e[b]=4>=a||4>b?c:g[0][f[c>>>24]]^g[1][f[c>>16&255]]^g[2][f[c>>8&255]]^g[3][f[255&c]]},y.cipher.aes.prototype={encrypt:function(a){return m(this,a,0)},decrypt:function(a){return m(this,a,1)},k:[[[],[],[],[],[]],[[],[],[],[],[]]],D:function(){var a,b,c,d,e,f,g,h=this.k[0],i=this.k[1],j=h[4],k=i[4],l=[],m=[];for(a=0;256>a;a++)m[(l[a]=a<<1^283*(a>>7))^a]=a;for(b=c=0;!j[b];b^=d||1,c=m[c]||1)for(f=c^c<<1^c<<2^c<<3^c<<4,f=f>>8^255&f^99,j[b]=f,k[f]=b,e=l[a=l[d=l[b]]],g=16843009*e^65537*a^257*d^16843008*b,e=257*l[f]^16843008*f,a=0;4>a;a++)h[a][b]=e=e<<24^e>>>8,i[a][f]=g=g<<24^g>>>8;for(a=0;5>a;a++)h[a]=h[a].slice(0),i[a]=i[a].slice(0)}},y.bitArray={bitSlice:function(a,b,c){return a=y.bitArray.P(a.slice(b/32),32-(31&b)).slice(1),c===w?a:y.bitArray.clamp(a,c-b)},extract:function(a,b,c){var d=Math.floor(-b-c&31);return(-32&(b+c-1^b)?a[b/32|0]<<32-d^a[b/32+1|0]>>>d:a[b/32|0]>>>d)&(1<<c)-1},concat:function(a,b){if(0===a.length||0===b.length)return a.concat(b);var c=a[a.length-1],d=y.bitArray.getPartial(c);return 32===d?a.concat(b):y.bitArray.P(b,d,0|c,a.slice(0,a.length-1))},bitLength:function(a){var b=a.length;return 0===b?0:32*(b-1)+y.bitArray.getPartial(a[b-1])},clamp:function(a,b){if(32*a.length<b)return a;a=a.slice(0,Math.ceil(b/32));var c=a.length;return b&=31,c>0&&b&&(a[c-1]=y.bitArray.partial(b,a[c-1]&2147483648>>b-1,1)),a},partial:function(a,b,c){return 32===a?b:(c?0|b:b<<32-a)+1099511627776*a},getPartial:function(a){return Math.round(a/1099511627776)||32},equal:function(a,b){if(y.bitArray.bitLength(a)!==y.bitArray.bitLength(b))return x;var c,d=0;for(c=0;c<a.length;c++)d|=a[c]^b[c];return 0===d},P:function(a,b,c,d){var e;for(e=0,d===w&&(d=[]);b>=32;b-=32)d.push(c),c=0;if(0===b)return d.concat(a);for(e=0;e<a.length;e++)d.push(c|a[e]>>>b),c=a[e]<<32-b;return e=a.length?a[a.length-1]:0,a=y.bitArray.getPartial(e),d.push(y.bitArray.partial(b+a&31,b+a>32?c:d.pop(),1)),d},l:function(a,b){return[a[0]^b[0],a[1]^b[1],a[2]^b[2],a[3]^b[3]]},byteswapM:function(a){var b,c;for(b=0;b<a.length;++b)c=a[b],a[b]=c>>>24|c>>>8&65280|(65280&c)<<8|c<<24;return a}},y.codec.utf8String={fromBits:function(a){var b,c,d="",e=y.bitArray.bitLength(a);for(b=0;e/8>b;b++)0===(3&b)&&(c=a[b/4]),d+=String.fromCharCode(c>>>24),c<<=8;return decodeURIComponent(escape(d))},toBits:function(a){a=unescape(encodeURIComponent(a));var b,c=[],d=0;for(b=0;b<a.length;b++)d=d<<8|a.charCodeAt(b),3===(3&b)&&(c.push(d),d=0);return 3&b&&c.push(y.bitArray.partial(8*(3&b),d)),c}},y.codec.hex={fromBits:function(a){var b,c="";for(b=0;b<a.length;b++)c+=((0|a[b])+0xf00000000000).toString(16).substr(4);return c.substr(0,y.bitArray.bitLength(a)/4)},toBits:function(a){var b,c,d=[];for(a=a.replace(/\s|0x/g,""),c=a.length,a+="00000000",b=0;b<a.length;b+=8)d.push(0^parseInt(a.substr(b,8),16));return y.bitArray.clamp(d,4*c)}},y.codec.base64={J:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(a,b,c){var d="",e=0,f=y.codec.base64.J,g=0,h=y.bitArray.bitLength(a);for(c&&(f=f.substr(0,62)+"-_"),c=0;6*d.length<h;)d+=f.charAt((g^a[c]>>>e)>>>26),6>e?(g=a[c]<<6-e,e+=26,c++):(g<<=6,e-=6);for(;3&d.length&&!b;)d+="=";return d},toBits:function(a,b){a=a.replace(/\s|=/g,"");var c,d,e=[],f=0,g=y.codec.base64.J,h=0;for(b&&(g=g.substr(0,62)+"-_"),c=0;c<a.length;c++)d=g.indexOf(a.charAt(c)),0>d&&l(new y.exception.invalid("this isn't base64!")),f>26?(f-=26,e.push(h^d>>>f),h=d<<32-f):(f+=6,h^=d<<32-f);return 56&f&&e.push(y.bitArray.partial(56&f,h,1)),e}},y.codec.base64url={fromBits:function(a){return y.codec.base64.fromBits(a,1,1)},toBits:function(a){return y.codec.base64.toBits(a,1)}},y.hash.sha256=function(a){this.b[0]||this.D(),a?(this.r=a.r.slice(0),this.o=a.o.slice(0),this.h=a.h):this.reset()},y.hash.sha256.hash=function(a){return(new y.hash.sha256).update(a).finalize()},y.hash.sha256.prototype={blockSize:512,reset:function(){return this.r=this.N.slice(0),this.o=[],this.h=0,this},update:function(a){"string"==typeof a&&(a=y.codec.utf8String.toBits(a));var b,c=this.o=y.bitArray.concat(this.o,a);for(b=this.h,a=this.h=b+y.bitArray.bitLength(a),b=512+b&-512;a>=b;b+=512)n(this,c.splice(0,16));return this},finalize:function(){var a,b=this.o,c=this.r,b=y.bitArray.concat(b,[y.bitArray.partial(1,1)]);for(a=b.length+2;15&a;a++)b.push(0);for(b.push(Math.floor(this.h/4294967296)),b.push(0|this.h);b.length;)n(this,b.splice(0,16));return this.reset(),c},N:[],b:[],D:function(){function a(a){return 4294967296*(a-Math.floor(a))|0}var b,c=0,d=2;a:for(;64>c;d++){for(b=2;d>=b*b;b++)if(0===d%b)continue a;8>c&&(this.N[c]=a(Math.pow(d,.5))),this.b[c]=a(Math.pow(d,1/3)),c++}}},y.mode.ccm={name:"ccm",encrypt:function(a,b,c,d,e){var f,g=b.slice(0),h=y.bitArray,i=h.bitLength(c)/8,j=h.bitLength(g)/8;for(e=e||64,d=d||[],7>i&&l(new y.exception.invalid("ccm: iv must be at least 7 bytes")),f=2;4>f&&j>>>8*f;f++);return 15-i>f&&(f=15-i),c=h.clamp(c,8*(15-f)),b=y.mode.ccm.L(a,b,c,d,e,f),g=y.mode.ccm.p(a,g,c,b,e,f),h.concat(g.data,g.tag)},decrypt:function(a,b,c,d,e){e=e||64,d=d||[];var f=y.bitArray,g=f.bitLength(c)/8,h=f.bitLength(b),i=f.clamp(b,h-e),j=f.bitSlice(b,h-e),h=(h-e)/8;for(7>g&&l(new y.exception.invalid("ccm: iv must be at least 7 bytes")),b=2;4>b&&h>>>8*b;b++);return 15-g>b&&(b=15-g),c=f.clamp(c,8*(15-b)),i=y.mode.ccm.p(a,i,c,j,e,b),a=y.mode.ccm.L(a,i.data,c,d,e,b),f.equal(i.tag,a)||l(new y.exception.corrupt("ccm: tag doesn't match")),i.data},L:function(a,b,c,d,e,f){var g=[],h=y.bitArray,i=h.l;if(e/=8,(e%2||4>e||e>16)&&l(new y.exception.invalid("ccm: invalid tag length")),(4294967295<d.length||4294967295<b.length)&&l(new y.exception.bug("ccm: can't deal with 4GiB or more data")),f=[h.partial(8,(d.length?64:0)|e-2<<2|f-1)],f=h.concat(f,c),f[3]|=h.bitLength(b)/8,f=a.encrypt(f),d.length)for(c=h.bitLength(d)/8,65279>=c?g=[h.partial(16,c)]:4294967295>=c&&(g=h.concat([h.partial(16,65534)],[c])),g=h.concat(g,d),d=0;d<g.length;d+=4)f=a.encrypt(i(f,g.slice(d,d+4).concat([0,0,0])));for(d=0;d<b.length;d+=4)f=a.encrypt(i(f,b.slice(d,d+4).concat([0,0,0])));return h.clamp(f,8*e)},p:function(a,b,c,d,e,f){var g,h=y.bitArray;g=h.l;var i=b.length,j=h.bitLength(b);if(c=h.concat([h.partial(8,f-1)],c).concat([0,0,0]).slice(0,4),d=h.bitSlice(g(d,a.encrypt(c)),0,e),!i)return{tag:d,data:[]};for(g=0;i>g;g+=4)c[3]++,e=a.encrypt(c),b[g]^=e[0],b[g+1]^=e[1],b[g+2]^=e[2],b[g+3]^=e[3];return{tag:d,data:h.clamp(b,j)}}},y.mode.ocb2={name:"ocb2",encrypt:function(a,b,c,d,e,f){128!==y.bitArray.bitLength(c)&&l(new y.exception.invalid("ocb iv must be 128 bits"));var g,h=y.mode.ocb2.H,i=y.bitArray,j=i.l,k=[0,0,0,0];c=h(a.encrypt(c));var m,n=[];for(d=d||[],e=e||64,g=0;g+4<b.length;g+=4)m=b.slice(g,g+4),k=j(k,m),n=n.concat(j(c,a.encrypt(j(c,m)))),c=h(c);return m=b.slice(g),b=i.bitLength(m),g=a.encrypt(j(c,[0,0,0,b])),m=i.clamp(j(m.concat([0,0,0]),g),b),k=j(k,j(m.concat([0,0,0]),g)),k=a.encrypt(j(k,j(c,h(c)))),d.length&&(k=j(k,f?d:y.mode.ocb2.pmac(a,d))),n.concat(i.concat(m,i.clamp(k,e)))},decrypt:function(a,b,c,d,e,f){128!==y.bitArray.bitLength(c)&&l(new y.exception.invalid("ocb iv must be 128 bits")),e=e||64;var g,h,i=y.mode.ocb2.H,j=y.bitArray,k=j.l,m=[0,0,0,0],n=i(a.encrypt(c)),o=y.bitArray.bitLength(b)-e,p=[];for(d=d||[],c=0;o/32>c+4;c+=4)g=k(n,a.decrypt(k(n,b.slice(c,c+4)))),m=k(m,g),p=p.concat(g),n=i(n);return h=o-32*c,g=a.encrypt(k(n,[0,0,0,h])),g=k(g,j.clamp(b.slice(c),h).concat([0,0,0])),m=k(m,g),m=a.encrypt(k(m,k(n,i(n)))),d.length&&(m=k(m,f?d:y.mode.ocb2.pmac(a,d))),j.equal(j.clamp(m,e),j.bitSlice(b,o))||l(new y.exception.corrupt("ocb: tag doesn't match")),p.concat(j.clamp(g,h))},pmac:function(a,b){var c,d=y.mode.ocb2.H,e=y.bitArray,f=e.l,g=[0,0,0,0],h=a.encrypt([0,0,0,0]),h=f(h,d(d(h)));for(c=0;c+4<b.length;c+=4)h=d(h),g=f(g,a.encrypt(f(h,b.slice(c,c+4))));return c=b.slice(c),128>e.bitLength(c)&&(h=f(h,d(h)),c=e.concat(c,[-2147483648,0,0,0])),g=f(g,c),a.encrypt(f(d(f(h,d(h))),g))},H:function(a){return[a[0]<<1^a[1]>>>31,a[1]<<1^a[2]>>>31,a[2]<<1^a[3]>>>31,a[3]<<1^135*(a[0]>>>31)]}},y.mode.gcm={name:"gcm",encrypt:function(a,b,c,d,e){var f=b.slice(0);return b=y.bitArray,d=d||[],a=y.mode.gcm.p(!0,a,f,d,c,e||128),b.concat(a.data,a.tag)},decrypt:function(a,b,c,d,e){var f=b.slice(0),g=y.bitArray,h=g.bitLength(f);return e=e||128,d=d||[],h>=e?(b=g.bitSlice(f,h-e),f=g.bitSlice(f,0,h-e)):(b=f,f=[]),a=y.mode.gcm.p(x,a,f,d,c,e),g.equal(a.tag,b)||l(new y.exception.corrupt("gcm: tag doesn't match")),a.data},Z:function(a,b){var c,d,e,f,g,h=y.bitArray.l;for(e=[0,0,0,0],f=b.slice(0),c=0;128>c;c++){for((d=0!==(a[Math.floor(c/32)]&1<<31-c%32))&&(e=h(e,f)),g=0!==(1&f[3]),d=3;d>0;d--)f[d]=f[d]>>>1|(1&f[d-1])<<31;f[0]>>>=1,g&&(f[0]^=-520093696)}return e},g:function(a,b,c){var d,e=c.length;for(b=b.slice(0),d=0;e>d;d+=4)b[0]^=4294967295&c[d],b[1]^=4294967295&c[d+1],b[2]^=4294967295&c[d+2],b[3]^=4294967295&c[d+3],b=y.mode.gcm.Z(b,a);return b},p:function(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o=y.bitArray;for(l=c.length,m=o.bitLength(c),n=o.bitLength(d),h=o.bitLength(e),g=b.encrypt([0,0,0,0]),96===h?(e=e.slice(0),e=o.concat(e,[1])):(e=y.mode.gcm.g(g,[0,0,0,0],e),e=y.mode.gcm.g(g,e,[0,0,Math.floor(h/4294967296),4294967295&h])),h=y.mode.gcm.g(g,[0,0,0,0],d),k=e.slice(0),d=h.slice(0),a||(d=y.mode.gcm.g(g,h,c)),j=0;l>j;j+=4)k[3]++,i=b.encrypt(k),c[j]^=i[0],c[j+1]^=i[1],c[j+2]^=i[2],c[j+3]^=i[3];return c=o.clamp(c,m),a&&(d=y.mode.gcm.g(g,h,c)),a=[Math.floor(n/4294967296),4294967295&n,Math.floor(m/4294967296),4294967295&m],d=y.mode.gcm.g(g,d,a),i=b.encrypt(e),d[0]^=i[0],d[1]^=i[1],d[2]^=i[2],d[3]^=i[3],{tag:o.bitSlice(d,0,f),data:c}}},y.misc.hmac=function(a,b){this.M=b=b||y.hash.sha256;var c,d=[[],[]],e=b.prototype.blockSize/32;for(this.n=[new b,new b],a.length>e&&(a=b.hash(a)),c=0;e>c;c++)d[0][c]=909522486^a[c],d[1][c]=1549556828^a[c];this.n[0].update(d[0]),this.n[1].update(d[1]),this.G=new b(this.n[0])},y.misc.hmac.prototype.encrypt=y.misc.hmac.prototype.mac=function(a){return this.Q&&l(new y.exception.invalid("encrypt on already updated hmac called!")),this.update(a),this.digest(a)},y.misc.hmac.prototype.reset=function(){this.G=new this.M(this.n[0]),this.Q=x},y.misc.hmac.prototype.update=function(a){this.Q=!0,this.G.update(a)},y.misc.hmac.prototype.digest=function(){var a=this.G.finalize(),a=new this.M(this.n[1]).update(a).finalize();return this.reset(),a},y.misc.pbkdf2=function(a,b,c,d,e){c=c||1e3,(0>d||0>c)&&l(y.exception.invalid("invalid params to pbkdf2")),"string"==typeof a&&(a=y.codec.utf8String.toBits(a)),"string"==typeof b&&(b=y.codec.utf8String.toBits(b)),e=e||y.misc.hmac,a=new e(a);var f,g,h,i,j=[],k=y.bitArray;for(i=1;32*j.length<(d||1);i++){for(e=f=a.encrypt(k.concat(b,[i])),g=1;c>g;g++)for(f=a.encrypt(f),h=0;h<f.length;h++)e[h]^=f[h];j=j.concat(e)}return d&&(j=k.clamp(j,d)),j},y.prng=function(a){this.c=[new y.hash.sha256],this.i=[0],this.F=0,this.s={},this.C=0,this.K={},this.O=this.d=this.j=this.W=0,this.b=[0,0,0,0,0,0,0,0],this.f=[0,0,0,0],this.A=w,this.B=a,this.q=x,this.w={progress:{},seeded:{}},this.m=this.V=0,this.t=1,this.u=2,this.S=65536,this.I=[0,48,64,96,128,192,256,384,512,768,1024],this.T=3e4,this.R=80},y.prng.prototype={randomWords:function(a,b){var c,d=[];c=this.isReady(b);var e;if(c===this.m&&l(new y.exception.notReady("generator isn't seeded")),c&this.u){c=!(c&this.t),e=[];var f,g=0;for(this.O=e[0]=(new Date).valueOf()+this.T,f=0;16>f;f++)e.push(4294967296*Math.random()|0);for(f=0;f<this.c.length&&(e=e.concat(this.c[f].finalize()),g+=this.i[f],this.i[f]=0,!(!c&&this.F&1<<f));f++);for(this.F>=1<<this.c.length&&(this.c.push(new y.hash.sha256),this.i.push(0)),this.d-=g,g>this.j&&(this.j=g),this.F++,this.b=y.hash.sha256.hash(this.b.concat(e)),this.A=new y.cipher.aes(this.b),c=0;4>c&&(this.f[c]=this.f[c]+1|0,!this.f[c]);c++);}for(c=0;a>c;c+=4)0===(c+1)%this.S&&q(this),e=r(this),d.push(e[0],e[1],e[2],e[3]);return q(this),d.slice(0,a)},setDefaultParanoia:function(a,b){0===a&&"Setting paranoia=0 will ruin your security; use it only for testing"!==b&&l("Setting paranoia=0 will ruin your security; use it only for testing"),this.B=a},addEntropy:function(a,b,c){c=c||"user";var d,e,f=(new Date).valueOf(),g=this.s[c],h=this.isReady(),i=0;switch(d=this.K[c],d===w&&(d=this.K[c]=this.W++),g===w&&(g=this.s[c]=0),this.s[c]=(this.s[c]+1)%this.c.length,typeof a){case"number":b===w&&(b=1),this.c[g].update([d,this.C++,1,b,f,1,0|a]);break;case"object":if(c=Object.prototype.toString.call(a),"[object Uint32Array]"===c){for(e=[],c=0;c<a.length;c++)e.push(a[c]);a=e}else for("[object Array]"!==c&&(i=1),c=0;c<a.length&&!i;c++)"number"!=typeof a[c]&&(i=1);if(!i){if(b===w)for(c=b=0;c<a.length;c++)for(e=a[c];e>0;)b++,e>>>=1;this.c[g].update([d,this.C++,2,b,f,a.length].concat(a))}break;case"string":b===w&&(b=a.length),this.c[g].update([d,this.C++,3,b,f,a.length]),this.c[g].update(a);break;default:i=1}i&&l(new y.exception.bug("random: addEntropy only supports number, array of numbers or string")),this.i[g]+=b,this.d+=b,h===this.m&&(this.isReady()!==this.m&&o("seeded",Math.max(this.j,this.d)),o("progress",this.getProgress()))},isReady:function(a){return a=this.I[a!==w?a:this.B],this.j&&this.j>=a?this.i[0]>this.R&&(new Date).valueOf()>this.O?this.u|this.t:this.t:this.d>=a?this.u|this.m:this.m},getProgress:function(a){return a=this.I[a?a:this.B],this.j>=a?1:this.d>a?1:this.d/a},startCollectors:function(){this.q||(this.a={loadTimeCollector:s(this,this.aa),mouseCollector:s(this,this.ba),keyboardCollector:s(this,this.$),accelerometerCollector:s(this,this.U),touchCollector:s(this,this.da)},window.addEventListener?(window.addEventListener("load",this.a.loadTimeCollector,x),window.addEventListener("mousemove",this.a.mouseCollector,x),window.addEventListener("keypress",this.a.keyboardCollector,x),window.addEventListener("devicemotion",this.a.accelerometerCollector,x),window.addEventListener("touchmove",this.a.touchCollector,x)):document.attachEvent?(document.attachEvent("onload",this.a.loadTimeCollector),document.attachEvent("onmousemove",this.a.mouseCollector),document.attachEvent("keypress",this.a.keyboardCollector)):l(new y.exception.bug("can't attach event")),this.q=!0)},stopCollectors:function(){this.q&&(window.removeEventListener?(window.removeEventListener("load",this.a.loadTimeCollector,x),window.removeEventListener("mousemove",this.a.mouseCollector,x),window.removeEventListener("keypress",this.a.keyboardCollector,x),window.removeEventListener("devicemotion",this.a.accelerometerCollector,x),window.removeEventListener("touchmove",this.a.touchCollector,x)):document.detachEvent&&(document.detachEvent("onload",this.a.loadTimeCollector),document.detachEvent("onmousemove",this.a.mouseCollector),document.detachEvent("keypress",this.a.keyboardCollector)),this.q=x)},addEventListener:function(a,b){this.w[a][this.V++]=b},removeEventListener:function(a,b){var c,d,e=this.w[a],f=[];for(d in e)e.hasOwnProperty(d)&&e[d]===b&&f.push(d);for(c=0;c<f.length;c++)d=f[c],delete e[d]},$:function(){p(1)},ba:function(a){var b,c;try{b=a.x||a.clientX||a.offsetX||0,c=a.y||a.clientY||a.offsetY||0}catch(d){c=b=0}0!=b&&0!=c&&y.random.addEntropy([b,c],2,"mouse"),p(0)},da:function(a){a=a.touches[0]||a.changedTouches[0],y.random.addEntropy([a.pageX||a.clientX,a.pageY||a.clientY],1,"touch"),p(0)},aa:function(){p(2)},U:function(a){if(a=a.accelerationIncludingGravity.x||a.accelerationIncludingGravity.y||a.accelerationIncludingGravity.z,window.orientation){var b=window.orientation;"number"==typeof b&&y.random.addEntropy(b,1,"accelerometer")}a&&y.random.addEntropy(a,2,"accelerometer"),p(0)}},y.random=new y.prng(6);a:try{var z,A,B,C;if(C="undefined"!=typeof module){var D;if(D=module.exports){var E;try{E=u("crypto")}catch(F){E=null}D=(A=E)&&A.randomBytes}C=D}if(C)z=A.randomBytes(128),z=new Uint32Array(new Uint8Array(z).buffer),y.random.addEntropy(z,1024,"crypto['randomBytes']");else if("undefined"!=typeof window&&"undefined"!=typeof Uint32Array){if(B=new Uint32Array(32),window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(B);else{if(!window.msCrypto||!window.msCrypto.getRandomValues)break a;window.msCrypto.getRandomValues(B)}y.random.addEntropy(B,1024,"crypto['getRandomValues']")}}catch(G){"undefined"!=typeof window&&window.console&&(console.log("There was an error collecting entropy from the browser:"),console.log(G))}y.json={defaults:{v:1,iter:1e3,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},Y:function(a,b,c,d){c=c||{},d=d||{};var e,f=y.json,g=f.e({iv:y.random.randomWords(4,0)},f.defaults);return f.e(g,c),c=g.adata,"string"==typeof g.salt&&(g.salt=y.codec.base64.toBits(g.salt)),"string"==typeof g.iv&&(g.iv=y.codec.base64.toBits(g.iv)),(!y.mode[g.mode]||!y.cipher[g.cipher]||"string"==typeof a&&100>=g.iter||64!==g.ts&&96!==g.ts&&128!==g.ts||128!==g.ks&&192!==g.ks&&256!==g.ks||2>g.iv.length||4<g.iv.length)&&l(new y.exception.invalid("json encrypt: invalid parameters")),"string"==typeof a?(e=y.misc.cachedPbkdf2(a,g),a=e.key.slice(0,g.ks/32),g.salt=e.salt):y.ecc&&a instanceof y.ecc.elGamal.publicKey&&(e=a.kem(),g.kemtag=e.tag,a=e.key.slice(0,g.ks/32)),"string"==typeof b&&(b=y.codec.utf8String.toBits(b)),"string"==typeof c&&(g.adata=c=y.codec.utf8String.toBits(c)),e=new y.cipher[g.cipher](a),f.e(d,g),d.key=a,g.ct=y.mode[g.mode].encrypt(e,b,g.iv,c,g.ts),g},encrypt:function(){var a=y.json,b=a.Y.apply(a,arguments);return a.encode(b)},X:function(a,b,c,d){c=c||{},d=d||{};var e=y.json;b=e.e(e.e(e.e({},e.defaults),b),c,!0);var f,g;return f=b.adata,"string"==typeof b.salt&&(b.salt=y.codec.base64.toBits(b.salt)),"string"==typeof b.iv&&(b.iv=y.codec.base64.toBits(b.iv)),(!y.mode[b.mode]||!y.cipher[b.cipher]||"string"==typeof a&&100>=b.iter||64!==b.ts&&96!==b.ts&&128!==b.ts||128!==b.ks&&192!==b.ks&&256!==b.ks||!b.iv||2>b.iv.length||4<b.iv.length)&&l(new y.exception.invalid("json decrypt: invalid parameters")),"string"==typeof a?(g=y.misc.cachedPbkdf2(a,b),a=g.key.slice(0,b.ks/32),b.salt=g.salt):y.ecc&&a instanceof y.ecc.elGamal.secretKey&&(a=a.unkem(y.codec.base64.toBits(b.kemtag)).slice(0,b.ks/32)),"string"==typeof f&&(f=y.codec.utf8String.toBits(f)),g=new y.cipher[b.cipher](a),f=y.mode[b.mode].decrypt(g,b.ct,b.iv,f,b.ts),e.e(d,b),d.key=a,1===c.raw?f:y.codec.utf8String.fromBits(f)},decrypt:function(a,b,c,d){var e=y.json;return e.X(a,e.decode(b),c,d)},encode:function(a){var b,c="{",d="";for(b in a)if(a.hasOwnProperty(b))switch(b.match(/^[a-z0-9]+$/i)||l(new y.exception.invalid("json encode: invalid property name")),c+=d+'"'+b+'":',d=",",typeof a[b]){case"number":case"boolean":c+=a[b];break;case"string":c+='"'+escape(a[b])+'"';break;case"object":c+='"'+y.codec.base64.fromBits(a[b],0)+'"';break;default:l(new y.exception.bug("json encode: unsupported type"))}return c+"}"},decode:function(a){a=a.replace(/\s/g,""),a.match(/^\{.*\}$/)||l(new y.exception.invalid("json decode: this isn't json!")),a=a.replace(/^\{|\}$/g,"").split(/,/);var b,c,d={};for(b=0;b<a.length;b++)(c=a[b].match(/^\s*(?:(["']?)([a-z][a-z0-9]*)\1)\s*:\s*(?:(-?\d+)|"([a-z0-9+\/%*_.@=\-]*)"|(true|false))$/i))||l(new y.exception.invalid("json decode: this isn't json!")),c[3]?d[c[2]]=parseInt(c[3],10):c[4]?d[c[2]]=c[2].match(/^(ct|adata|salt|iv)$/)?y.codec.base64.toBits(c[4]):unescape(c[4]):c[5]&&(d[c[2]]="true"===c[5]);return d},e:function(a,b,c){if(a===w&&(a={}),b===w)return a;for(var d in b)b.hasOwnProperty(d)&&(c&&a[d]!==w&&a[d]!==b[d]&&l(new y.exception.invalid("required parameter overridden")),a[d]=b[d]);return a},fa:function(a,b){var c,d={};for(c in a)a.hasOwnProperty(c)&&a[c]!==b[c]&&(d[c]=a[c]);return d},ea:function(a,b){var c,d={};for(c=0;c<b.length;c++)a[b[c]]!==w&&(d[b[c]]=a[b[c]]);return d}},y.encrypt=y.json.encrypt,y.decrypt=y.json.decrypt,y.misc.ca={},y.misc.cachedPbkdf2=function(a,b){var c,d=y.misc.ca;return b=b||{},c=b.iter||1e3,d=d[a]=d[a]||{},c=d[c]=d[c]||{firstSalt:b.salt&&b.salt.length?b.salt.slice(0):y.random.randomWords(2,0)},d=b.salt===w?c.firstSalt:b.salt,c[d]=c[d]||y.misc.pbkdf2(a,d,b.iter),{key:c[d].slice(0),salt:d.slice(0)}},v("authentication",["sjcl"],function(a){var b=function(a){a=a||{},this.getRecord=a.getRecord||null,this.setRecord=a.setRecord||null};return b.prototype.getCurrent=function(a,b){this.getRecord(function(c,d){return c?b(c):d?d.expiry<new Date?a(null):(d.principal&&d.expiry&&(d={principal:d.principal,expiry:d.expiry}),void a(d)):a(null)})},b.prototype.setCurrent=function(b,c,d){return b.principal&&b.credential&&b.expiry?(b.credential=a.codec.hex.fromBits(a.hash.sha256.hash(b.credential)),void this.setRecord(b,function(){c()})):d(new Error("Missing required attribute(s)"))},b.prototype.authenticate=function(b,c,d){if(!b.principal||!b.credential)return d(new Error("Missing required attribute(s)"));var e=a.codec.hex.fromBits(a.hash.sha256.hash(b.credential));this.getRecord(function(a,f){return a?d(a):f?f.expiry<new Date?c(null):void(b.principal===f.principal&&e===f.credential&&c({principal:f.principal,expiry:f.expiry})):c(null)})},b}),v("main",["model-application","authentication"],function(c,e){function f(){b.ajaxPrefilter(function(a,b,c){c.setRequestHeader("X-Blink-Config",JSON.stringify(window.BMP.BIC.siteVars))}),window.BMP.Authentication=new e,u(["router","auth"])}function g(){window.BMP.BlinkGap.isHere()?window.BMP.BlinkGap.whenReady().then(f,f):f()}return d.ajaxSync=d.sync,d.dataSync=function(b,c,d){var e,f;switch(e=c.data||c.collection.data,b){case"read":f=void 0!==c.id?e.read(c):e.readAll();break;case"create":f=e.create(c);break;case"update":f=e.update(c);break;case"patch":f=e.update(c);break;case"delete":f=e["delete"](c);break;default:f=a.reject(new Error("unknown method"))}return f.then(function(a){d.success&&d.success(a)},function(a){d.error&&d.error(a)}),c.trigger("request",c,f,d),f},d.getSyncMethod=function(a){return a.data||a.collection&&a.collection.data?d.dataSync:d.ajaxSync},d.sync=function(a,b,c){return d.getSyncMethod(b).apply(this,[a,b,c])},g(),c}),/**
 * @license RequireJS text 2.0.12 Copyright (c) 2010-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */
v("text",["module"],function(a){var b,c,d,e,f,g=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],h=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,i=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,j="undefined"!=typeof location&&location.href,k=j&&location.protocol&&location.protocol.replace(/\:/,""),l=j&&location.hostname,m=j&&(location.port||void 0),n={},o=a.config&&a.config()||{};return b={version:"2.0.12",strip:function(a){if(a){a=a.replace(h,"");var b=a.match(i);b&&(a=b[1])}else a="";return a},jsEscape:function(a){return a.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:o.createXhr||function(){var a,b,c;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(b=0;3>b;b+=1){c=g[b];try{a=new ActiveXObject(c)}catch(d){}if(a){g=[c];break}}return a},parseName:function(a){var b,c,d,e=!1,f=a.indexOf("."),g=0===a.indexOf("./")||0===a.indexOf("../");return-1!==f&&(!g||f>1)?(b=a.substring(0,f),c=a.substring(f+1,a.length)):b=a,d=c||b,f=d.indexOf("!"),-1!==f&&(e="strip"===d.substring(f+1),d=d.substring(0,f),c?c=d:b=d),{moduleName:b,ext:c,strip:e}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(a,c,d,e){var f,g,h,i=b.xdRegExp.exec(a);return i?(f=i[2],g=i[3],g=g.split(":"),h=g[1],g=g[0],!(f&&f!==c||g&&g.toLowerCase()!==d.toLowerCase()||(h||g)&&h!==e)):!0},finishLoad:function(a,c,d,e){d=c?b.strip(d):d,o.isBuild&&(n[a]=d),e(d)},load:function(a,c,d,e){if(e&&e.isBuild&&!e.inlineText)return void d();o.isBuild=e&&e.isBuild;var f=b.parseName(a),g=f.moduleName+(f.ext?"."+f.ext:""),h=c.toUrl(g),i=o.useXhr||b.useXhr;
//!strip part to avoid file system issues.
return 0===h.indexOf("empty:")?void d():void(!j||i(h,k,l,m)?b.get(h,function(c){b.finishLoad(a,f.strip,c,d)},function(a){d.error&&d.error(a)}):c([g],function(a){b.finishLoad(f.moduleName+"."+f.ext,f.strip,a,d)}))},write:function(a,c,d){if(n.hasOwnProperty(c)){var e=b.jsEscape(n[c]);d.asModule(a+"!"+c,"define(function () { return '"+e+"';});\n")}},writeFile:function(a,c,d,e,f){var g=b.parseName(c),h=g.ext?"."+g.ext:"",i=g.moduleName+h,j=d.toUrl(g.moduleName+h)+".js";b.load(i,d,function(){var c=function(a){return e(j,a)};c.asModule=function(a,b){return e.asModule(a,j,b)},b.write(a,i,c,f)},f)}},"node"===o.env||!o.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]?(c=u.nodeRequire("fs"),b.get=function(a,b,d){try{var e=c.readFileSync(a,"utf8");0===e.indexOf("\ufeff")&&(e=e.substring(1)),b(e)}catch(f){d&&d(f)}}):"xhr"===o.env||!o.env&&b.createXhr()?b.get=function(a,c,d,e){var f,g=b.createXhr();if(g.open("GET",a,!0),e)for(f in e)e.hasOwnProperty(f)&&g.setRequestHeader(f.toLowerCase(),e[f]);o.onXhr&&o.onXhr(g,a),g.onreadystatechange=function(){var b,e;4===g.readyState&&(b=g.status||0,b>399&&600>b?(e=new Error(a+" HTTP status: "+b),e.xhr=g,d&&d(e)):c(g.responseText),o.onXhrComplete&&o.onXhrComplete(g,a))},g.send(null)}:"rhino"===o.env||!o.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?b.get=function(a,b){var c,d,e="utf-8",f=new java.io.File(a),g=java.lang.System.getProperty("line.separator"),h=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(f),e)),i="";try{for(c=new java.lang.StringBuffer,d=h.readLine(),d&&d.length()&&65279===d.charAt(0)&&(d=d.substring(1)),null!==d&&c.append(d);null!==(d=h.readLine());)c.append(g),c.append(d);i=String(c.toString())}finally{h.close()}b(i)}:("xpconnect"===o.env||!o.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(d=Components.classes,e=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),f="@mozilla.org/windows-registry-key;1"in d,b.get=function(a,b){var c,g,h,i={};f&&(a=a.replace(/\//g,"\\")),h=new FileUtils.File(a);try{c=d["@mozilla.org/network/file-input-stream;1"].createInstance(e.nsIFileInputStream),c.init(h,1,0,!1),g=d["@mozilla.org/intl/converter-input-stream;1"].createInstance(e.nsIConverterInputStream),g.init(c,"utf-8",c.available(),e.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),g.readString(c.available(),i),g.close(),c.close(),b(i.value)}catch(j){throw new Error((h&&h.path||"")+": "+j)}}),b}),v("text!template-interaction.mustache",[],function(){return'{{{header}}}\n<div data-role="content">\n  <style>\n  .ui-controlgroup-controls {\n    width: 100%;\n  }\n  </style>\n  {{{content}}}\n</div>\n{{{footer}}}\n'}),v("text!template-inputPrompt.mustache",[],function(){return'<form method="get">\n    {{{inputs}}}\n    <button type="submit" data-theme="a">Go</button>\n</form>\n'}),v("text!template-form-controls.mustache",[],function(){return'{{#pages}}\n<div id="FormPageCount" data-role="controlgroup" data-type="horizontal">\n  <a id="previousFormPage" data-role="button" data-icon="back" {{^previous}}class="ui-disable"{{/previous}} style="width: 32%" data-iconpos="left">&nbsp;</a>\n  <a data-role="button" style="width: 33%"><span id="currentPage">{{current}}</span> of <span id="totalPages">{{total}}</span></a>\n  <a id="nextFormPage" data-role="button" data-icon="forward" {{^next}}class="ui-disable"{{/next}} style="width: 32%" data-iconpos="right">&nbsp;</a>\n</div>\n{{/pages}}\n\n<div id="FormControls" data-role="controlgroup" data-type="horizontal" style="width: 100%;">\n    <a id="close" data-role="button" data-icon="delete" data-iconpos="top" style="width: 49%;">Close</a>\n    <a id="submit" data-role="button" data-icon="check" data-iconpos="top" style="width: 49%;">Submit</a>\n</div>\n\n<div id="closePopup" data-role="popup" data-dismissible="false" data-overlay-theme="a" data-theme="c">\n  <div data-role="header">\n    <h1>Close</h1>\n  </div>\n  <div data-role="content">\n    <h3>Are you sure you want to close this form?</h3>\n    <div data-role="controlgroup" data-type="horizontal" style="width: 100%;">\n      <a href="#" id="save" data-role="button" data-rel="save" style="width: 49%;">Save</a>\n      <a href="#" id="discard" data-role="button" data-rel="delete" style="width: 49%;">Discard</a>\n    </div>\n    <a data-role="button" data-rel="back">Cancel</a>\n  </div>\n</div>\n'}),v("view-form-controls",["text!template-form-controls.mustache","model-application"],function(c,g){var h=d.View.extend({events:{"click #FormControls #submit":"formSubmit","click #FormControls #close":"formClose","click #nextFormPage":"nextFormPage","click #previousFormPage":"previousFormPage"},render:function(){var a,d;return a=this,d={},f.current.get("pages").length>1&&(d.pages={current:f.current.get("pages").current.index()+1,total:f.current.get("pages").length},0!==f.current.get("pages").current.index()&&(d.pages.previous=!0),f.current.get("pages").current.index()!==f.current.get("pages").length-1&&(d.pages.next=!0)),a.$el.html(e.render(c,d)),b.mobile.activePage.trigger("pagecreate"),a},nextFormPage:function(){var a,b;a=this,b=f.current.get("pages").current.index(),b<f.current.get("pages").length-1&&f.current.get("pages")["goto"](b+1),a.render()},previousFormPage:function(){var a,b;a=this,b=f.current.get("pages").current.index(),b>0&&f.current.get("pages")["goto"](b-1),a.render()},formSubmit:function(){this.addToQueue("Pending")},formClose:function(){var a=this;b("#closePopup").popup({afteropen:function(c){b(c.target).on("click","#save",{view:a},a.formSave),b(c.target).on("click","#discard",{view:a},a.formDiscard)},afterclose:function(a){b(a.target).off("click","#save"),b(a.target).off("click","#discard")}}),b("#closePopup").popup("open")},formSave:function(a){a.data.view.addToQueue("Draft"),b("#closePopup").one("popupafterclose",function(){history.back()}),b("#closePopup").popup("close")},formDiscard:function(){b("#closePopup").one("popupafterclose",function(){history.back()}),b("#closePopup").popup("close")},addToQueue:function(c,d){var e,h=this;return d=d||!1,new a(function(a,i){f.current.data().then(function(f){var j,k={};k.success=function(c){d||(b(window).one("pagechange",function(){navigator.onLine&&"Draft"!==e.get("status")?(e.once("processed",function(){"Submitted"===e.get("status")?(g.view.popup(e.get("result")),e.destroy()):g.view.pendingQueue()}),g.pending.processQueue()):g.view.pendingQueue()}),0===window.BMP.BIC3.history.length?window.BMP.BIC3.view.home():history.back()),a(c)},k.error=i,f._action=h.model.get("blinkFormAction"),j={type:"Form",status:c,name:h.model.get("blinkFormObjectName"),label:h.model.get("displayName"),action:h.model.get("blinkFormAction"),answerspaceid:g.get("dbid"),data:f},h.model.get("args")["args[pid]"]?(e=g.pending.get(h.model.get("args")["args[pid]"]),e.save(j,k)):e=g.pending.create(j,k)})})}});return h}),v("view-form-action",["model-application","view-form-controls"],function(a,b){var c=d.View.extend({id:"ActiveFormContainer",render:function(){var c=this;return f.getDefinition(c.model.get("blinkFormObjectName"),c.model.get("blinkFormAction")).then(function(d){var e;f.initialize(d,c.model.get("blinkFormAction")),c.$el.append(f.current.$form),c.subView=new b({model:c.model}),c.subView.render(),c.$el.append(c.subView.$el),c.model.get("args")["args[id]"]?(e=a.formRecords.get(c.model.get("blinkFormObjectName")+"-"+c.model.get("args")["args[id]"]),e.populate(c.model.get("blinkFormAction"),function(){f.current.setRecord(e.get("record")),c.trigger("render")})):c.model.get("args")["args[pid]"]?(f.current.setRecord(a.pending.get(c.model.get("args")["args[pid]"]).get("data")),f.current.getErrors&&f.current.getErrors(),c.trigger("render")):c.trigger("render")}).then(null,function(a){window.console.log(a)}),c}});return c}),v("text!template-form-list.mustache",[],function(){return'<table data-role="table" data-mode="columntoggle" class="ui-responsive table-stroke">\n  <thead>\n    <tr>\n      {{#headers}}\n      <th>{{.}}</th>\n      <th>Action</th>\n      {{/headers}}\n    </tr>\n  </thead>\n  <tbody>\n    {{#content}}\n    <tr>\n      {{#contents}}\n      <td>{{{.}}}</td>\n      {{/contents}}\n      <td>\n        {{#interactions.edit}}<a interaction="{{interactions.edit}}" _id="{{id}}">Edit</a>{{/interactions.edit}}\n        {{#interactions.view}}<a interaction="{{interactions.view}}" _id="{{id}}">View</a>{{/interactions.view}}\n        {{#interactions.delete}}<a interaction="{{interactions.delete}}" _id="{{id}}">Delete</a>{{/interactions.delete}}\n      </td>\n    </tr>\n    {{/content}}\n    {{^content}}\n    <tr>\n      <th>No items on the remote server</th>\n    </tr>\n    {{/content}}\n  </tbody>\n</table>\n'}),v("view-form-list",["text!template-form-list.mustache","model-application"],function(a,b){var g=d.View.extend({render:function(){var d=this;return b.formRecords.pull(d.model.get("blinkFormObjectName")).then(function(){var g={};g.headers=[],f.getDefinition(d.model.get("blinkFormObjectName"),d.model.get("blinkFormAction")).then(function(f){var h=[];c.each(f._elements,function(a){"subForm"!==a.type&&(h.push(a.name),g.headers.push(a.name))}),g.content=c.map(b.formRecords.models,function(a){var b={};return b.id=a.get("id"),b.contents=[],c.each(a.attributes.list,function(a,d){"id"!==d&&"_id"!==d&&c.contains(h,d)&&b.contents.push(a)}),b}),g.interactions={},g.interactions.edit=b.interactions.findWhere({blinkFormObjectName:d.model.get("blinkFormObjectName"),blinkFormAction:"edit"}).id,g.interactions.view=b.interactions.findWhere({blinkFormObjectName:d.model.get("blinkFormObjectName"),blinkFormAction:"view"}).id,g.interactions["delete"]=b.interactions.findWhere({blinkFormObjectName:d.model.get("blinkFormObjectName"),blinkFormAction:"delete"}).id,d.$el.html(e.render(a,g)),d.trigger("render")})},function(){d.$el.html("Cannot contact server"),d.trigger("render")}),d}});return g}),v("view-form",["view-form-action","view-form-list"],function(a,c){var e=d.View.extend({render:function(){var d,e;return d=this,e=d.model.get("blinkFormAction"),"list"===e?d.subView=new c({model:d.model}):"search"===e?d.subView=null:(b("#ActiveFormContainer").length>0&&b("#ActiveFormContainer").attr("id","FormContainer"),d.subView=new a({model:d.model})),d.listenToOnce(d.subView,"render",function(){d.$el.append(d.subView.$el),d.trigger("render")}),d.subView.render(),d}});return e}),v("text!template-category-list.mustache",[],function(){return'<ul data-role="listview">\n  {{#models}}\n  <li>\n    <a interaction="{{_id}}">\n      {{#displayName}}\n        {{displayName}}\n      {{/displayName}}\n      {{^displayName}}\n        {{_id}}\n      {{/displayName}}\n    </a>\n  </li>\n  {{/models}}\n</ul>\n'}),v("text!template-pending.mustache",[],function(){return'<div id="pendingPopup" data-role="popup">\n  <div data-role="header">\n    <h1>Pending Queue</h1>\n  </div>\n  <div id="pendingContent" data-role="content">\n    <ul data-role="listview">\n      {{#validationPresent}}<li data-role="list-divider">Failed Validation</li>{{/validationPresent}}\n      {{#validation}}\n      <li>\n        <div>\n          <h2>{{label}}</h2>\n          <div data-role="controlgroup" data-type="horizontal" style="width: 100%;">\n            <a class="clearPendingItem" _pid="{{_id}}" data-role="button" style="width: 49%;">Clear</a>\n            <a interaction="{{editInteraction}}" _pid="{{_id}}" data-role="button" style="width: 49%;">Edit</a>\n          </div>\n        </div>\n      </li>\n      {{/validation}}\n\n      <li data-role="list-divider">Pending</li>\n      {{#pending}}\n      <li>\n        <div>\n          <h2>{{label}}</h2>\n        </div>\n      </li>\n      {{/pending}}\n      {{#pendingPresent}}\n      <li>\n        <a id="submitPendingItems" href="#">Submit All</a>\n      </li>\n      {{/pendingPresent}}\n      {{^pending}}<li>No items pending transmission to server</li>{{/pending}}\n\n      <li data-role="list-divider">Draft</li>\n      {{#draft}}\n      <li>\n        <div>\n          <h2>{{label}}</h2>\n          <div data-role="controlgroup" data-type="horizontal" style="width: 100%;">\n            <a class="clearPendingItem" _pid="{{_id}}" data-role="button" style="width: 49%;">Clear</a>\n            <a interaction="{{editInteraction}}" _pid="{{_id}}" data-role="button" style="width: 49%;">Edit</a>\n          </div>\n        </div>\n      </li>\n      {{/draft}}\n      {{#draftPresent}}\n      <li>\n        <a id="clearPendingItemsConfirmation" href="#">Clear All</a>\n      </li>\n      {{/draftPresent}}\n      {{^draft}}<li>No items saved as draft.</li>{{/draft}}\n    </ul>\n  </div>\n</div>\n'}),v("view-star",[],function(){var a=d.View.extend({events:{click:"toggle"},initialize:function(){this.listenTo(this.model,"change:state",this.render)},toggle:function(a){a.preventDefault(),this.model.toggle()},render:function(){this.model.get("state")?(this.$el.addClass("blink-star-on"),this.$el.removeClass("blink-star-off")):(this.$el.addClass("blink-star-off"),this.$el.removeClass("blink-star-on"))}});return a}),v("text!template-popup.mustache",[],function(){return'<div id="popup" data-role="popup">\n{{{contents}}}\n</div>\n\n'}),v("text!template-clear-confirmation-popup.mustache",[],function(){return'<div id="clearConfirmationPopup" data-role="popup">\n  <div data-role="header">\n    <h1>Clear All Drafts</h1>\n  </div>\n  <div data-role="content">\n    <h3>Are you sure you want to delete all drafts?</h3>\n    <div data-role="controlgroup" data-type="horizontal" style="width: 100%;">\n      <a href="#" id="clearPendingItems" data-role="button" style="width: 49%;">Delete</a>\n      <a href="#" data-role="button" data-rel="back" style="width: 49%;">Cancel</a>\n    </div>\n  </div>\n</div>\n'}),function(a,b){"function"==typeof v&&v.amd?v("geolocation",[],b):"object"==typeof exports?module.exports=b():a.BMP?a.BMP.geolocation=b():a.geolocation=b()}(this,function(){var c,d={setGeoLocation:function(a){c=a},getGeoLocation:function(){return c&&c.getCurrentPosition?c:"undefined"!=typeof navigator&&navigator.geolocation&&navigator.geolocation.getCurrentPosition?navigator.geolocation:!1},clonePosition:function(a){if(!a||"object"!=typeof a||!a.coords||"object"!=typeof a.coords)throw new TypeError("cannot clone non-Position object");return{coords:{latitude:a.coords.latitude,longitude:a.coords.longitude,altitude:a.coords.altitude,accuracy:a.coords.accuracy,altitudeAccuracy:a.coords.altitudeAccuracy,heading:a.coords.heading,speed:a.coords.speed}}},DEFAULT_POSITION_OPTIONS:{enableHighAccuracy:!0,maximumAge:0,timeout:1e4},POSITION_OPTION_TYPES:{enableHighAccuracy:"boolean",maximumAge:"number",timeout:"number"},mergePositionOptions:function(a){var b;return a&&"object"==typeof a?(b={},Object.keys(d.POSITION_OPTION_TYPES).forEach(function(c){var e=d.POSITION_OPTION_TYPES[c],f=a[c];b[c]=typeof a[c]!==e||"number"===e&&isNaN(f)?d.DEFAULT_POSITION_OPTIONS[c]:a[c]}),b):d.DEFAULT_POSITION_OPTIONS},requestCurrentPosition:function(a,b,c){var e=d.getGeoLocation();if(!e)throw new Error("the current web engine does not support GeoLocation");if("function"!=typeof a)throw new TypeError("getCurrentPosition(): 1st parameter must be a Function to handle success");if("function"!=typeof b)throw new TypeError("getCurrentPosition(): 2nd parameter must be a Function to handle error");return c=d.mergePositionOptions(c),e.getCurrentPosition(function(b){a(d.clonePosition(b))},b,c)},getPromiseConstructor:function(){return"undefined"!=typeof a?a:"undefined"!=typeof b&&b.Deferred?b.Deferred:!1},getCurrentPosition:function(a,b,c){var e=d.getPromiseConstructor();return e?new e(function(e,f){d.requestCurrentPosition(function(b){"function"==typeof a&&a(b),e(b)},function(a){"function"==typeof b&&b(a),f(a)},c)}):d.requestCurrentPosition(a,b,c)}};return d}),v("view-interaction",["text!template-interaction.mustache","text!template-inputPrompt.mustache","view-form","model-application","text!template-category-list.mustache","model-star","text!template-pending.mustache","view-star","text!template-popup.mustache","text!template-clear-confirmation-popup.mustache","geolocation"],function(f,g,h,i,j,k,l,m,n,o,p){var q=d.View.extend({initialize:function(){b("body").append(this.$el),window.BMP.BIC.view=this},events:{"click [keyword]":"blinklink","click [interaction]":"blinklink","click [category]":"blinklink","click [masterCategory]":"blinklink","click [back]":"back","click [home]":"home","click [login]":"blinklink","click [pending]":"pendingQueue","click #queue":"pendingQueue","click .clearPendingItem":"clearPendingItem","click #submitPendingItems":"submitPendingItems","click #clearPendingItems":"clearPendingItems","click #clearPendingItemsConfirmation":"clearPendingItemsConfirmation",pageremove:"destroy"},attributes:{"data-role":"page"},blinklink:function(a){var c,d,e,f,g,h="",j=!0;for(a.preventDefault(),c="A"!==a.target.tagName?b(a.target).parents("a"):b(a.target),d="",c.attr("keyword")?d=c.attr("keyword"):c.attr("interaction")?d=c.attr("interaction"):c.attr("category")?d=c.attr("category"):c.attr("masterCategory")?d=c.attr("masterCategory"):""===c.attr("home")?d=i.get("siteName"):""===c.attr("login")&&(d=i.get(i.has("loginAccess")&&i.has("loginUseInteractions")&&i.has("loginUseInteractions")&&i.has("loginPromptInteraction")?"loginPromptInteraction":"siteName")),e=0;e<c[0].attributes.length;e+=1)"_"===c[0].attributes[e].name.substr(0,1)&&(j?(j=!1,h="/?args["+c[0].attributes[e].name.substr(1)+"]="+c[0].attributes[e].value):h+="&args["+c[0].attributes[e].name.substr(1)+"]="+c[0].attributes[e].value);for(f="",g=b.mobile.path.parseLocation().pathname,window.cordova&&window.cordova.offline&&window.cordova.offline.available&&-1!==g.indexOf(window.cordova.offline.filePathPrex)&&(g=g.substr(g.indexOf(window.cordova.offline.filePathPrex)+window.cordova.offline.filePathPrex.length+1),g=g.substr(g.indexOf("/")),g=g.substr(0,g.indexOf("."))),g=g.split("/"),g.shift(),""===g[g.length-1]&&g.pop(),"offlineData"===g[0]&&g[1]===window.initialURLHashed&&(g.pop(),g[0]=window.BMP.BIC.siteVars.answerSpace.toLowerCase()),e=g.length-1;-1!==e;e-=1)i.interactions.get(g[e].toLowerCase()).get("type")||-1!==f.indexOf(g[e])||-1!==f.indexOf(g[e].toLowerCase())||g[e]===d||g[e]===d.toLowerCase()||(f=""!==f?g[e]+"/"+f:g[e]);f="/"+f,b.mobile.changePage(f+"/"+d+h)},back:function(a){a.preventDefault(),history.back()},home:function(){b.mobile.changePage("/"+i.get("siteName"))},render:function(a){var d,k,l=this.model.inherit({}),m=this;return c.has(l,"themeSwatch")&&this.$el.attr("data-theme",l.themeSwatch),this.model.has("inputPrompt")&&!this.model.has("args")?(k=this.model.get("inputPrompt"),d="<form>"===k.substr(0,6)?k:e.render(g,{inputs:k}),this.$el.html(e.render(f,{header:l.header,footer:l.footer,content:d})),this.trigger("render")):m.model.has("type")&&"xslt"===m.model.get("type")?(m.model.once("change:content",function(){"object"==typeof m.model.get("content")?(m.$el.html(e.render(f,{header:l.header,footer:l.footer,content:""})),m.$el.children("[data-role=content]")[0].appendChild(m.model.get("content")),m.processStars(),m.trigger("render")):"string"==typeof m.model.get("content")?(m.$el.html(e.render(f,{header:l.header,footer:l.footer,content:m.model.get("content")})),m.trigger("render")):(m.$el.html(e.render(f,{header:l.header,footer:l.footer,content:"Unknown error rendering XSLT interaction."})),m.trigger("render"))}),this.model.performXSLT()):this.model.has("type")&&"form"===this.model.get("type")?(b("#ActiveFormContainer").length>0&&b("#ActiveFormContainer").attr("id","FormContainer"),m.$el.html(e.render(f,{header:l.header,footer:l.footer})),m.subView=new h({model:m.model,el:m.$el.children('[data-role="content"]')}),m.listenToOnce(m.subView,"render",function(){m.trigger("render")}),m.subView.render()):this.model.id.toLowerCase()===window.BMP.BIC.siteVars.answerSpace.toLowerCase()?(m.$el.html(e.render(f,{header:l.header,footer:l.footer,content:e.render(j,{models:m.model.get("interactionList"),path:"/"===a.dataUrl.substr(-1)?a.dataUrl:a.dataUrl+"/"})})),m.trigger("render")):this.model.has("type")?"message"===this.model.get("type")?(this.$el.html(e.render(f,{header:l.header,footer:l.footer,content:l.message})),this.trigger("render")):(this.$el.html(e.render(f,l)),this.model.has("content")&&(this.blinkAnswerMessages(),this.maps(),this.processStars()),this.trigger("render")):(m.$el.html(e.render(f,{header:l.header,footer:l.footer,content:e.render(j,{models:c.map(c.filter(i.interactions.models,function(a){return"hide"!==a.get("display")&&c.filter(a.get("tags"),function(a){return a==="nav-"+this.model.id.toLowerCase()},this).length>0},m),function(a){return a.attributes}),path:"/"===a.dataUrl.substr(-1)?a.dataUrl:a.dataUrl+"/"})})),m.trigger("render")),this},maps:function(){var a,c=this.$el.find("[class=googlemap]");0!==c.length&&(void 0!==c.attr("data-marker-title")?window.BMP.BIC.mapCallback=this.addressMap:void 0!==c.attr("data-kml")?window.BMP.BIC.MapCallback=this.kmlMap:window.BMP.BIC.mapCallback=void 0!==c.attr("data-map-action")?this.directionsMap:this.basicMap,void 0===window.google?(a=document.createElement("script"),a.type="text/javascript",a.src="https://maps.googleapis.com/maps/api/js?v=3&sensor=true&callback=window.BMP.BIC.mapCallback",b("body").append(a)):window.BMP.BIC.mapCallback())},blinkAnswerMessages:function(a){var d=this.model.get("content").match(/<!-- blinkAnswerMessage:\{.*\} -->/g);a?(a=JSON.parse(a),"string"==typeof a.mojotarget&&("string"==typeof a.mojoxml?i.datasuitcases.create({_id:a.mojotarget,data:a.mojoxml}):void 0!==a.mojodelete&&i.datasuitcases.remove(a.mojotarget)),a.startype&&(a.clearstars&&i.stars.clear(a.startype),"array"===b.type(a.staroff)&&c.each(a.staroff,function(a){i.stars.get(a)&&i.stars.get(a.toString()).destroy()},this),"array"===b.type(a.staron)&&c.each(a.staron,function(b){i.stars.create({_id:b.toString(),type:a.startype,state:!0})}))):"array"===b.type(d)&&c.each(d,function(a){this.blinkAnswerMessages(a.substring(24,a.length-4))},this)},pendingQueue:function(){var a=function(a){return c.map(i.pending.where({status:a}),function(a){var b=c.clone(a.attributes);return b._id||(b._id=a.cid),b.editInteraction=i.interactions.where({blinkFormObjectName:a.get("name"),blinkFormAction:a.get("action")}),b.editInteraction=b.editInteraction&&b.editInteraction.length>0?b.editInteraction[0].id:null,b.label||(b.label=b.name),b})};this.$el.append(e.render(l,{pending:a("Pending"),pendingPresent:a("Pending").length>0,draft:a("Draft"),draftPresent:a("Draft").length>0,validation:a("Failed Validation"),validationPresent:a("Failed Validation").length>0})),this.$el.trigger("pagecreate"),b("#pendingPopup").one("popupafterclose",function(){b("#pendingPopup").remove()}),b("#pendingPopup").popup("open")},clearPendingItem:function(a){var c,d=b("#pendingPopup");c="A"!==a.target.tagName?b(a.target).parents("a"):b(a.target),i.pending.get(c[0].attributes._pid.value).destroy(),d.popup("close")},submitPendingItems:function(){var a=b("#pendingPopup");b.mobile.loading("show"),i.pending.processQueue().then(null,function(){return null}).then(function(){a.one("popupafterclose",function(){b.mobile.loading("hide")}),a.popup("close")})},clearPendingItems:function(){var a,c,d=b("#clearConfirmationPopup");for(a=i.pending.where({status:"Draft"}),c=0;c<a.length;c+=1)a[c].destroy();d.one("popupafterclose",function(){d.remove()}),d.popup("close")},clearPendingItemsConfirmation:function(){var a=b("#pendingPopup");a.one("popupafterclose",function(){b("#clearConfirmationPopup").popup({afterclose:function(){b("#clearConfirmationPopup").remove()}}),setInterval(function(){b("#clearConfirmationPopup").popup("open")},100)}),this.$el.append(e.render(o,{})),this.$el.trigger("pagecreate"),a.popup("close")},popup:function(a){this.$el.append(e.render(n,{contents:a})),this.$el.trigger("pagecreate"),b("#popup").popup("open")},destroy:function(){this.remove()},processStars:function(){var a=this.$el.find(".blink-starrable");a&&a.each(function(a,c){var d,e,f=i.stars.get(b(c).data("id"));f||(d=b(c).data(),d._id=d.id.toString(),delete d.id,d.state=!1,f=new k(d)),e=new m({model:f,el:c}),e.render()})},basicMap:function(){var a,c,d=window.BMP.BIC3.view.$el.find("[class=googlemap]");a={center:new google.maps.LatLng(d.attr("data-latitude"),d.attr("data-longitude")),zoom:parseInt(d.attr("data-zoom"),10),mapTypeId:google.maps.MapTypeId[d.attr("data-type").toUpperCase()]},c=new google.maps.Map(b("[class='googlemap']")[0],a),b(document).bind("pageshow",function(){google.maps.event.trigger(c,"resize"),c.setCenter(new google.maps.LatLng(d.attr("data-latitude"),d.attr("data-longitude")))})},addressMap:function(){var a,c,d,e=window.BMP.BIC3.view.$el.find("[class=googlemap]");a=new google.maps.Geocoder,c={address:e.attr("data-marker-title")},a.geocode(c,function(a){c={center:a[0].geometry.location,zoom:parseInt(e.attr("data-zoom"),10),mapTypeId:google.maps.MapTypeId[e.attr("data-type").toUpperCase()]},d=new google.maps.Map(b("[class='googlemap']")[0],c),b(document).bind("pageshow",function(){google.maps.event.trigger(d,"resize"),d.setCenter(a[0].geometry.location)})})},kmlMap:function(){var a,c,d,e=window.BMP.BIC3.view.$el.find("[class=googlemap]");a={center:new google.maps.LatLng(e.attr("data-latitude"),e.attr("data-longitude")),zoom:parseInt(e.attr("data-zoom"),10),mapTypeId:google.maps.MapTypeId[e.attr("data-type").toUpperCase()]},c=new google.maps.Map(b("[class='googlemap']")[0],a),d=new google.maps.KmlLayer(e.attr("data-kml"),{preserveViewport:!0}),d.setMap(c),b(document).bind("pageshow",function(){google.maps.event.trigger(c,"resize"),c.setCenter(new google.maps.LatLng(e.attr("data-latitude"),e.attr("data-longitude")))})},directionsMap:function(){var a,c,d,e,f,g,h,i,j;j=window.BMP.BIC3.view.$el.find("[class=googlemap]"),d=new google.maps.DirectionsRenderer,e=new google.maps.DirectionsService,a={center:new google.maps.LatLng(-33.873658,151.206915),zoom:10,mapTypeId:google.maps.MapTypeId[j.attr("data-type").toUpperCase()]},c=new google.maps.Map(b("[class='googlemap']")[0],a),d.setPanel(b('[class="googledirections"]')[0]),b(document).bind("pageshow",function(){google.maps.event.trigger(c,"resize"),d.setMap(c)}),void 0===j.attr("data-destination-address")||void 0===j.attr("data-origin-address")?(h=window.BMP.BIC.getCurrentPosition(),h.then(function(a){void 0===j.attr("data-origin-address")?(f=new google.maps.LatLng(a.latitude,a.longitude),g=j.attr("data-destination-address")):void 0===j.attr("data-destination-address")&&(f=j.attr("data-origin-address"),g=new google.maps.LatLng(a.latitude,a.longitude)),i={origin:f,destination:g,travelMode:google.maps.TravelMode[j.attr("data-travelmode").toUpperCase()]},e.route(i,function(a,b){b===google.maps.DirectionsStatus.OK&&d.setDirections(a)})})):(i={origin:j.attr("data-origin-address"),destination:j.attr("data-destination-address"),travelMode:google.maps.TravelMode[j.attr("data-travelmode").toUpperCase()]},e.route(i,function(a,b){b===google.maps.DirectionsStatus.OK&&d.setDirections(a)}))}});return window.BMP.geolocation=p,window.BMP.BIC.getCurrentPosition=function(c){return new a(function(a,d){window.BMP.geolocation.getCurrentPosition().then(function(c){"object"===b.type(c.coords)?a(c.coords):d("GeoLocation error: blank location from browser / device")},function(a){var b;switch(a.code){case a.PERMISSION_DENIED:b="user has not granted permission";break;case a.PERMISSION_DENIED_TIMEOUT:b="user did not grant permission in time";break;case a.POSITION_UNAVAILABLE:b="unable to determine position";break;default:b="unknown error"}d("GeoLocation error: "+b)},c)})},q}),v("router",["model-application","view-interaction"],function(e,f){var g=d.Router.extend({initialize:function(){h.FileInput.initialize(),e.router=this,h.isBlinkGap&&(b(document).on("pause",this.suspendApplication),b(document).on("resume",this.resumeApplication)),void 0!==document.hidden&&b(document).on("visibilitychange",function(){document.hidden?e.router.suspendApplication():e.router.resumeApplication()}),b(document).on("pagebeforeload",function(a,c){a.preventDefault(),window.BMP.BIC3.history.length+=1,b.mobile.loading("show"),e.router.routeRequest(c)}),a.resolve(e.datastore()).then(function(){return e.collections()}).then(function(){return e.setup()}).then(null,function(){}).then(function(){return new a(function(a,b){h.BlinkGap.isHere()&&h.BlinkGap.hasOffline()?h.BlinkGap.waitForOffline(function(){a()},function(){b()}):a()})}).then(function(){return e.populate()}).then(null,function(){}).then(function(){return e.forms.download()}).then(null,function(){}).then(function(){return e.initialRender()}).then(null,function(a){throw a})},routeRequest:function(a){var c,d=b.mobile.path.parseUrl(a.absUrl);h.BlinkGap.isOfflineReady()&&-1!==d.hrefNoSearch.indexOf(window.cordova.offline.filePathPrex)&&(d.pathname=d.hrefNoSearch.substr(d.hrefNoSearch.indexOf(window.cordova.offline.filePathPrex)+window.cordova.offline.filePathPrex.length+1),d.pathname=d.pathname.substr(d.pathname.indexOf("/")),d.pathname=d.pathname.substr(0,d.pathname.indexOf("."))),e.whenPopulated().then(null,function(){return null}).then(function(){c=e.router.inheritanceChain(d.pathname),e.currentInteraction=c,e.router.parseArgs(d.search.substr(1),c),c.prepareForView(a).then(function(c){new f({tagName:"div",model:c}).once("render",function(){this.$el.attr("data-url",a.dataUrl),this.$el.attr("data-external-page",!0),this.$el.one("pagecreate",b.mobile._bindPageRemove),a.deferred.resolve(a.absUrl,a.options,this.$el)}).render(a)},function(){a.deferred.reject(a.absUrl,a.options),b.mobile.showPageLoadingMsg(b.mobile.pageLoadErrorMessageTheme,b.mobile.pageLoadErrorMessage,!0),setTimeout(b.mobile.hidePageLoadingMsg,1500)})})},inheritanceChain:function(a){var b,d,f,g;return b=a.substr(1).toLowerCase().split("/").reverse(),f=b[b.length-1],g=[],""===b[0]&&b.shift(),b[0]===window.initialURLHashed&&"offlinedata"===b[b.length-1]&&(b[0]=window.BMP.BIC.siteVars.answerSpace.toLowerCase(),b.pop()),c.each(b,function(a,h){if(!c.find(g,function(b){return b===a})){if(d=e.interactions.get(a)||e.interactions.where({dbid:"i"+a})[0]||null,!f||!d)throw"Invalid Model Name";h!==b.length-1?(d.set({parent:f}),f=d.id):(d.set({parent:"app"}),f="app"),g.push(a)}},this),e.interactions.get(b[0])},parseArgs:function(a,b){var d,e=a.split("&"),f={};return c.each(e,function(a){d=a.split("="),"args"!==d[0].substr(0,4)&&(d[0]="args["+d[0]+"]"),f[d[0]]=d[1]}),b.set(f?{args:f}:{args:null}),this},suspendApplication:function(){var a=b.mobile.path.parseLocation();localStorage.setItem("pauseURL",a.hrefNoHash),"form"===h.BIC.currentInteraction.get("type")&&(e.currentInteraction.get("args")["args[pid]"]?e.view.subView.subView.subView.addToQueue("Draft",!0):e.view.subView.subView.subView.addToQueue("Draft",!0).then(function(b){localStorage.setItem("pauseURL",a.hrefNoHash+"/?args[pid]="+b.id)}))},resumeApplication:function(){b.mobile.changePage(localStorage.getItem("pauseURL")),localStorage.removeItem("pauseURL")}});return new g}),v("auth",["facade"],function(a){var b=window.BMP.Authentication;a.subscribe("offlineAuthentication","storeAuth",function(c){b.setCurrent(c,function(){a.publish("storeAuthSuccess")},function(){a.publish("storeAuthFailure")})}),a.subscribe("offlineAuthentication","authenticateAuth",function(c){b.authenticate(c,function(){a.publish("loggedIn")},function(){a.publish("loggedOut")})})}),u("main")}),require(["bic"]);
//# sourceMappingURL=bic.min.js.map
