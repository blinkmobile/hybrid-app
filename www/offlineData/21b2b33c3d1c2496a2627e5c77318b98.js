!function(a){"function"==typeof define&&define.amd?define(["feature!promises","jquery","underscore","backbone","moment","picker.date","picker.time","jquerymobile","feature!es5","signaturepad"],a):a(Promise,$,_,Backbone,moment)}(function(Promise,$,_,Backbone,moment){var BMP=window.BMP=window.BMP||{};BMP.Forms=BMP.Forms||{};var requirejs,require,define;return function(a){function b(a,b){return r.call(a,b)}function c(a,b){var c,d,e,f,g,h,i,j,k,l,m,n=b&&b.split("/"),o=p.map,q=o&&o["*"]||{};if(a&&"."===a.charAt(0))if(b){for(n=n.slice(0,n.length-1),a=a.split("/"),g=a.length-1,p.nodeIdCompat&&t.test(a[g])&&(a[g]=a[g].replace(t,"")),a=n.concat(a),k=0;k<a.length;k+=1)if(m=a[k],"."===m)a.splice(k,1),k-=1;else if(".."===m){if(1===k&&(".."===a[2]||".."===a[0]))break;k>0&&(a.splice(k-1,2),k-=2)}a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((n||q)&&o){for(c=a.split("/"),k=c.length;k>0;k-=1){if(d=c.slice(0,k).join("/"),n)for(l=n.length;l>0;l-=1)if(e=o[n.slice(0,l).join("/")],e&&(e=e[d])){f=e,h=k;break}if(f)break;!i&&q&&q[d]&&(i=q[d],j=k)}!f&&i&&(f=i,h=j),f&&(c.splice(0,h,f),a=c.join("/"))}return a}function d(b,c){return function(){return k.apply(a,s.call(arguments,0).concat([b,c]))}}function e(a){return function(b){return c(b,a)}}function f(a){return function(b){n[a]=b}}function g(c){if(b(o,c)){var d=o[c];delete o[c],q[c]=!0,j.apply(a,d)}if(!b(n,c)&&!b(q,c))throw new Error("No "+c);return n[c]}function h(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function i(a){return function(){return p&&p.config&&p.config[a]||{}}}var j,k,l,m,n={},o={},p={},q={},r=Object.prototype.hasOwnProperty,s=[].slice,t=/\.js$/;l=function(a,b){var d,f=h(a),i=f[0];return a=f[1],i&&(i=c(i,b),d=g(i)),i?a=d&&d.normalize?d.normalize(a,e(b)):c(a,b):(a=c(a,b),f=h(a),i=f[0],a=f[1],i&&(d=g(i))),{f:i?i+"!"+a:a,n:a,pr:i,p:d}},m={require:function(a){return d(a)},exports:function(a){var b=n[a];return"undefined"!=typeof b?b:n[a]={}},module:function(a){return{id:a,uri:"",exports:n[a],config:i(a)}}},j=function(c,e,h,i){var j,k,p,r,s,t,u=[],v=typeof h;if(i=i||c,"undefined"===v||"function"===v){for(e=!e.length&&h.length?["require","exports","module"]:e,s=0;s<e.length;s+=1)if(r=l(e[s],i),k=r.f,"require"===k)u[s]=m.require(c);else if("exports"===k)u[s]=m.exports(c),t=!0;else if("module"===k)j=u[s]=m.module(c);else if(b(n,k)||b(o,k)||b(q,k))u[s]=g(k);else{if(!r.p)throw new Error(c+" missing "+k);r.p.load(r.n,d(i,!0),f(k),{}),u[s]=n[k]}p=h?h.apply(n[c],u):void 0,c&&(j&&j.exports!==a&&j.exports!==n[c]?n[c]=j.exports:p===a&&t||(n[c]=p))}else c&&(n[c]=h)},requirejs=require=k=function(b,c,d,e,f){if("string"==typeof b)return m[b]?m[b](c):g(l(b,c).f);if(!b.splice){if(p=b,p.deps&&k(p.deps,p.callback),!c)return;c.splice?(b=c,c=d,d=null):b=a}return c=c||function(){},"function"==typeof d&&(d=e,e=f),e?j(a,b,c,d):setTimeout(function(){j(a,b,c,d)},4),k},k.config=function(a){return k(a)},requirejs._defined=n,define=function(a,c,d){c.splice||(d=c,c=[]),b(n,a)||b(o,a)||(o[a]=[a,c,d])},define.amd={jQuery:!0}}(),function(){var a,b,c,d,e=function(a,b){return function(){return a.apply(b,arguments)}},f=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1},g=[].slice,h={}.hasOwnProperty,i=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};a={binders:{},components:{},formatters:{},adapters:{},config:{prefix:"rv",templateDelimiters:["{","}"],rootInterface:".",preloadData:!0,handler:function(a,b,c){return this.call(a,b,c.view.models)}}},"jQuery"in window?(d="on"in jQuery.prototype?["on","off"]:["bind","unbind"],b=d[0],c=d[1],a.Util={bindEvent:function(a,c,d){return jQuery(a)[b](c,d)},unbindEvent:function(a,b,d){return jQuery(a)[c](b,d)},getInputValue:function(a){var b;return b=jQuery(a),"checkbox"===b.attr("type")?b.is(":checked"):b.val()}}):a.Util={bindEvent:function(){return"addEventListener"in window?function(a,b,c){return a.addEventListener(b,c,!1)}:function(a,b,c){return a.attachEvent("on"+b,c)}}(),unbindEvent:function(){return"removeEventListener"in window?function(a,b,c){return a.removeEventListener(b,c,!1)}:function(a,b,c){return a.detachEvent("on"+b,c)}}(),getInputValue:function(a){var b,c,d,e;if("checkbox"===a.type)return a.checked;if("select-multiple"===a.type){for(e=[],c=0,d=a.length;d>c;c++)b=a[c],b.selected&&e.push(b.value);return e}return a.value}},a.View=function(){function b(b,c,d){var f,g,h,i,j,k,l,m,n;for(this.els=b,this.models=c,this.options=null!=d?d:{},this.update=e(this.update,this),this.publish=e(this.publish,this),this.sync=e(this.sync,this),this.unbind=e(this.unbind,this),this.bind=e(this.bind,this),this.select=e(this.select,this),this.build=e(this.build,this),this.componentRegExp=e(this.componentRegExp,this),this.bindingRegExp=e(this.bindingRegExp,this),this.els.jquery||this.els instanceof Array||(this.els=[this.els]),l=["config","binders","formatters","adapters"],j=0,k=l.length;k>j;j++){if(g=l[j],this[g]={},this.options[g]){m=this.options[g];for(f in m)h=m[f],this[g][f]=h}n=a[g];for(f in n)h=n[f],null==(i=this[g])[f]&&(i[f]=h)}this.build()}return b.prototype.bindingRegExp=function(){return new RegExp("^"+this.config.prefix+"-")},b.prototype.componentRegExp=function(){return new RegExp("^"+this.config.prefix.toUpperCase()+"-")},b.prototype.build=function(){var b,c,d,e,g,h,i,j,k,l=this;for(this.bindings=[],h=[],b=this.bindingRegExp(),d=this.componentRegExp(),c=function(b,c,d,e){var f,g,h,i,j,k,m;return j={},m=function(){var a,b,c,d;for(c=e.split("|"),d=[],a=0,b=c.length;b>a;a++)k=c[a],d.push(k.trim());return d}(),f=function(){var a,b,c,d;for(c=m.shift().split("<"),d=[],a=0,b=c.length;b>a;a++)g=c[a],d.push(g.trim());return d}(),i=f.shift(),j.formatters=m,(h=f.shift())&&(j.dependencies=h.split(/\s+/)),l.bindings.push(new a[b](l,c,d,i,j))},g=function(e){var i,j,k,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M;if(f.call(h,e)<0){if(3===e.nodeType){if(q=a.TextTemplateParser,(n=l.config.templateDelimiters)&&(u=q.parse(e.data,n)).length&&(1!==u.length||u[0].type!==q.types.text)){for(x=0,B=u.length;B>x;x++)t=u[x],s=document.createTextNode(t.value),e.parentNode.insertBefore(s,e),1===t.type&&c("TextBinding",s,null,t.value);e.parentNode.removeChild(e)}}else if(d.test(e.tagName))v=e.tagName.replace(d,"").toLowerCase(),l.bindings.push(new a.ComponentBinding(l,e,v));else if(null!=e.attributes){for(H=e.attributes,y=0,C=H.length;C>y;y++)if(i=H[y],b.test(i.name)){if(v=i.name.replace(b,""),!(k=l.binders[v])){I=l.binders;for(o in I)w=I[o],"*"!==o&&-1!==o.indexOf("*")&&(r=new RegExp("^"+o.replace("*",".+")+"$"),r.test(v)&&(k=w))}if(k||(k=l.binders["*"]),k.block){for(J=e.childNodes,z=0,D=J.length;D>z;z++)p=J[z],h.push(p);j=[i]}}for(K=j||e.attributes,A=0,E=K.length;E>A;A++)i=K[A],b.test(i.name)&&(v=i.name.replace(b,""),c("Binding",e,v,i.value))}for(L=function(){var a,b,c,d;for(c=e.childNodes,d=[],b=0,a=c.length;a>b;b++)p=c[b],d.push(p);return d}(),M=[],G=0,F=L.length;F>G;G++)m=L[G],M.push(g(m));return M}},k=this.els,i=0,j=k.length;j>i;i++)e=k[i],g(e)},b.prototype.select=function(a){var b,c,d,e,f;for(e=this.bindings,f=[],c=0,d=e.length;d>c;c++)b=e[c],a(b)&&f.push(b);return f},b.prototype.bind=function(){var a,b,c,d,e;for(d=this.bindings,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.bind());return e},b.prototype.unbind=function(){var a,b,c,d,e;for(d=this.bindings,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.unbind());return e},b.prototype.sync=function(){var a,b,c,d,e;for(d=this.bindings,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.sync());return e},b.prototype.publish=function(){var a,b,c,d,e;for(d=this.select(function(a){return a.binder.publishes}),e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.publish());return e},b.prototype.update=function(a){var b,c,d,e,f,g,h;null==a&&(a={});for(c in a)d=a[c],this.models[c]=d;for(g=this.bindings,h=[],e=0,f=g.length;f>e;e++)b=g[e],h.push(b.update(a));return h},b}(),a.Binding=function(){function b(a,b,c,d,f){this.view=a,this.el=b,this.type=c,this.keypath=d,this.options=null!=f?f:{},this.update=e(this.update,this),this.unbind=e(this.unbind,this),this.bind=e(this.bind,this),this.publish=e(this.publish,this),this.sync=e(this.sync,this),this.set=e(this.set,this),this.eventHandler=e(this.eventHandler,this),this.formattedValue=e(this.formattedValue,this),this.setBinder=e(this.setBinder,this),this.formatters=this.options.formatters||[],this.dependencies=[],this.model=void 0,this.setBinder()}return b.prototype.setBinder=function(){var a,b,c,d;if(!(this.binder=this.view.binders[this.type])){d=this.view.binders;for(a in d)c=d[a],"*"!==a&&-1!==a.indexOf("*")&&(b=new RegExp("^"+a.replace("*",".+")+"$"),b.test(this.type)&&(this.binder=c,this.args=new RegExp("^"+a.replace("*","(.+)")+"$").exec(this.type),this.args.shift()))}return this.binder||(this.binder=this.view.binders["*"]),this.binder instanceof Function?this.binder={routine:this.binder}:void 0},b.prototype.formattedValue=function(a){var b,c,d,e,f,h;for(h=this.formatters,e=0,f=h.length;f>e;e++)c=h[e],b=c.split(/\s+/),d=b.shift(),c=this.view.formatters[d],(null!=c?c.read:void 0)instanceof Function?a=c.read.apply(c,[a].concat(g.call(b))):c instanceof Function&&(a=c.apply(null,[a].concat(g.call(b))));return a},b.prototype.eventHandler=function(a){var b,c;return c=(b=this).view.config.handler,function(d){return c.call(a,this,d,b)}},b.prototype.set=function(a){var b;return a=this.formattedValue(a instanceof Function&&!this.binder["function"]?a.call(this.model):a),null!=(b=this.binder.routine)?b.call(this,this.el,a):void 0},b.prototype.sync=function(){var b,c,d,e,f,g,h,i,j;if(this.model!==this.observer.target){for(h=this.dependencies,d=0,f=h.length;f>d;d++)c=h[d],c.unobserve();if(this.dependencies=[],null!=(this.model=this.observer.target)&&(null!=(i=this.options.dependencies)?i.length:void 0))for(j=this.options.dependencies,e=0,g=j.length;g>e;e++)b=j[e],c=new a.Observer(this.view,this.model,b,this.sync),this.dependencies.push(c)}return this.set(this.observer.value())},b.prototype.publish=function(){var b,c,d,e,f,h,i,j,k;for(e=a.Util.getInputValue(this.el),i=this.formatters.slice(0).reverse(),f=0,h=i.length;h>f;f++)c=i[f],b=c.split(/\s+/),d=b.shift(),(null!=(j=this.view.formatters[d])?j.publish:void 0)&&(e=(k=this.view.formatters[d]).publish.apply(k,[e].concat(g.call(b))));return this.observer.publish(e)},b.prototype.bind=function(){var b,c,d,e,f,g,h;if(null!=(f=this.binder.bind)&&f.call(this,this.el),this.observer=new a.Observer(this.view,this.view.models,this.keypath,this.sync),this.model=this.observer.target,null!=this.model&&(null!=(g=this.options.dependencies)?g.length:void 0))for(h=this.options.dependencies,d=0,e=h.length;e>d;d++)b=h[d],c=new a.Observer(this.view,this.model,b,this.sync),this.dependencies.push(c);return this.view.config.preloadData?this.sync():void 0},b.prototype.unbind=function(){var a,b,c,d,e;for(null!=(d=this.binder.unbind)&&d.call(this,this.el),this.observer.unobserve(),e=this.dependencies,b=0,c=e.length;c>b;b++)a=e[b],a.unobserve();return this.dependencies=[]},b.prototype.update=function(a){var b;return null==a&&(a={}),this.model=this.observer.target,null!=(b=this.binder.update)?b.call(this,a):void 0},b}(),a.ComponentBinding=function(b){function c(b,c,d){var g,h,i,j,k;for(this.view=b,this.el=c,this.type=d,this.unbind=e(this.unbind,this),this.bind=e(this.bind,this),this.update=e(this.update,this),this.locals=e(this.locals,this),this.component=a.components[this.type],this.attributes={},this.inflections={},j=this.el.attributes||[],h=0,i=j.length;i>h;h++)g=j[h],k=g.name,f.call(this.component.attributes,k)>=0?this.attributes[g.name]=g.value:this.inflections[g.name]=g.value}return i(c,b),c.prototype.sync=function(){},c.prototype.locals=function(a){var b,c,d,e,f,g,h,i,j;null==a&&(a=this.view.models),f={},i=this.inflections;for(c in i)for(b=i[c],j=b.split("."),g=0,h=j.length;h>g;g++)e=j[g],f[c]=(f[c]||a)[e];for(c in a)d=a[c],null==f[c]&&(f[c]=d);return f},c.prototype.update=function(a){var b;return null!=(b=this.componentView)?b.update(this.locals(a)):void 0},c.prototype.bind=function(){var b,c;return null!=this.componentView?null!=(c=this.componentView)?c.bind():void 0:(b=this.component.build.call(this.attributes),(this.componentView=new a.View(b,this.locals(),this.view.options)).bind(),this.el.parentNode.replaceChild(b,this.el))},c.prototype.unbind=function(){var a;return null!=(a=this.componentView)?a.unbind():void 0},c}(a.Binding),a.TextBinding=function(a){function b(a,b,c,d,f){this.view=a,this.el=b,this.type=c,this.keypath=d,this.options=null!=f?f:{},this.sync=e(this.sync,this),this.formatters=this.options.formatters||[],this.dependencies=[]}return i(b,a),b.prototype.binder={routine:function(a,b){return a.data=null!=b?b:""}},b.prototype.sync=function(){return b.__super__.sync.apply(this,arguments)},b}(a.Binding),a.KeypathParser=function(){function a(){}return a.parse=function(a,b,c){var d,e,g,h,i,j;for(h=[],e={"interface":c,path:""},g=i=0,j=a.length;j>i;g=i+=1)d=a.charAt(g),f.call(b,d)>=0?(h.push(e),e={"interface":d,path:""}):e.path+=d;return h.push(e),h},a}(),a.TextTemplateParser=function(){function a(){}return a.types={text:0,binding:1},a.parse=function(a,b){var c,d,e,f,g,h,i;for(h=[],f=a.length,c=0,d=0;f>d;){if(c=a.indexOf(b[0],d),0>c){h.push({type:this.types.text,value:a.slice(d)});break}if(c>0&&c>d&&h.push({type:this.types.text,value:a.slice(d,c)}),d=c+b[0].length,c=a.indexOf(b[1],d),0>c){g=a.slice(d-b[1].length),e=h[h.length-1],(null!=e?e.type:void 0)===this.types.text?e.value+=g:h.push({type:this.types.text,value:g});break}i=a.slice(d,c).trim(),h.push({type:this.types.binding,value:i}),d=c+b[1].length}return h},a}(),a.Observer=function(){function b(a,b,c,d){this.view=a,this.model=b,this.keypath=c,this.callback=d,this.unobserve=e(this.unobserve,this),this.realize=e(this.realize,this),this.value=e(this.value,this),this.publish=e(this.publish,this),this.read=e(this.read,this),this.set=e(this.set,this),this.adapter=e(this.adapter,this),this.update=e(this.update,this),this.initialize=e(this.initialize,this),this.parse=e(this.parse,this),this.parse(),this.initialize()}return b.prototype.parse=function(){var b,c,d,e,g,h;return b=function(){var a,b;a=this.view.adapters,b=[];for(c in a)g=a[c],b.push(c);return b}.call(this),h=this.keypath[0],f.call(b,h)>=0?(e=this.keypath[0],d=this.keypath.substr(1)):(e=this.view.config.rootInterface,d=this.keypath),this.tokens=a.KeypathParser.parse(d,b,e),this.key=this.tokens.pop()},b.prototype.initialize=function(){return this.objectPath=[],this.target=this.realize(),null!=this.target?this.set(!0,this.key,this.target,this.callback):void 0},b.prototype.update=function(){var a,b;return(a=this.realize())!==this.target&&(null!=this.target&&this.set(!1,this.key,this.target,this.callback),null!=a&&this.set(!0,this.key,a,this.callback),b=this.value(),this.target=a,this.value()!==b)?this.callback():void 0},b.prototype.adapter=function(a){return this.view.adapters[a["interface"]]},b.prototype.set=function(a,b,c,d){var e;return e=a?"subscribe":"unsubscribe",this.adapter(b)[e](c,b.path,d)},b.prototype.read=function(a,b){return this.adapter(a).read(b,a.path)},b.prototype.publish=function(a){return null!=this.target?this.adapter(this.key).publish(this.target,this.key.path,a):void 0},b.prototype.value=function(){return null!=this.target?this.read(this.key,this.target):void 0},b.prototype.realize=function(){var a,b,c,d,e,f,g,h;for(a=this.model,e=null,h=this.tokens,b=f=0,g=h.length;g>f;b=++f)d=h[b],null!=a?(null!=this.objectPath[b]?a!==(c=this.objectPath[b])&&(this.set(!1,d,c,this.update),this.set(!0,d,a,this.update),this.objectPath[b]=a):(this.set(!0,d,a,this.update),this.objectPath[b]=a),a=this.read(d,a)):(null==e&&(e=b),(c=this.objectPath[b])&&this.set(!1,d,c,this.update));return null!=e&&this.objectPath.splice(e),a},b.prototype.unobserve=function(){var a,b,c,d,e,f;for(f=this.tokens,a=d=0,e=f.length;e>d;a=++d)c=f[a],(b=this.objectPath[a])&&this.set(!1,c,b,this.update);return null!=this.target?this.set(!1,this.key,this.target,this.callback):void 0},b}(),a.binders.text=function(a,b){return null!=a.textContent?a.textContent=null!=b?b:"":a.innerText=null!=b?b:""},a.binders.html=function(a,b){return a.innerHTML=null!=b?b:""},a.binders.show=function(a,b){return a.style.display=b?"":"none"},a.binders.hide=function(a,b){return a.style.display=b?"none":""},a.binders.enabled=function(a,b){return a.disabled=!b},a.binders.disabled=function(a,b){return a.disabled=!!b},a.binders.checked={publishes:!0,bind:function(b){return a.Util.bindEvent(b,"change",this.publish)},unbind:function(b){return a.Util.unbindEvent(b,"change",this.publish)},routine:function(a,b){var c;return a.checked="radio"===a.type?(null!=(c=a.value)?c.toString():void 0)===(null!=b?b.toString():void 0):!!b}},a.binders.unchecked={publishes:!0,bind:function(b){return a.Util.bindEvent(b,"change",this.publish)},unbind:function(b){return a.Util.unbindEvent(b,"change",this.publish)},routine:function(a,b){var c;return a.checked="radio"===a.type?(null!=(c=a.value)?c.toString():void 0)!==(null!=b?b.toString():void 0):!b}},a.binders.value={publishes:!0,bind:function(b){return a.Util.bindEvent(b,"change",this.publish)},unbind:function(b){return a.Util.unbindEvent(b,"change",this.publish)},routine:function(a,b){var c,d,e,g,h,i,j;if(null!=window.jQuery){if(a=jQuery(a),(null!=b?b.toString():void 0)!==(null!=(g=a.val())?g.toString():void 0))return a.val(null!=b?b:"")}else if("select-multiple"===a.type){if(null!=b){for(j=[],d=0,e=a.length;e>d;d++)c=a[d],j.push(c.selected=(h=c.value,f.call(b,h)>=0));return j}}else if((null!=b?b.toString():void 0)!==(null!=(i=a.value)?i.toString():void 0))return a.value=null!=b?b:""}},a.binders["if"]={block:!0,bind:function(a){var b,c;return null==this.marker?(b=[this.view.config.prefix,this.type].join("-").replace("--","-"),c=a.getAttribute(b),this.marker=document.createComment(" rivets: "+this.type+" "+c+" "),a.removeAttribute(b),a.parentNode.insertBefore(this.marker,a),a.parentNode.removeChild(a)):void 0},unbind:function(){var a;return null!=(a=this.nested)?a.unbind():void 0},routine:function(b,c){var d,e,f,g,h;if(!!c==(null==this.nested)){if(c){f={},h=this.view.models;for(d in h)e=h[d],f[d]=e;return g={binders:this.view.options.binders,formatters:this.view.options.formatters,adapters:this.view.options.adapters,config:this.view.options.config},(this.nested=new a.View(b,f,g)).bind(),this.marker.parentNode.insertBefore(b,this.marker.nextSibling)}return b.parentNode.removeChild(b),this.nested.unbind(),delete this.nested}},update:function(a){var b;return null!=(b=this.nested)?b.update(a):void 0}},a.binders.unless={block:!0,bind:function(b){return a.binders["if"].bind.call(this,b)},unbind:function(){return a.binders["if"].unbind.call(this)},routine:function(b,c){return a.binders["if"].routine.call(this,b,!c)},update:function(b){return a.binders["if"].update.call(this,b)}},a.binders["on-*"]={"function":!0,unbind:function(b){return this.handler?a.Util.unbindEvent(b,this.args[0],this.handler):void 0},routine:function(b,c){return this.handler&&a.Util.unbindEvent(b,this.args[0],this.handler),a.Util.bindEvent(b,this.args[0],this.handler=this.eventHandler(c))}},a.binders["each-*"]={block:!0,bind:function(a){var b;return null==this.marker?(b=[this.view.config.prefix,this.type].join("-").replace("--","-"),this.marker=document.createComment(" rivets: "+this.type+" "),this.iterated=[],a.removeAttribute(b),a.parentNode.insertBefore(this.marker,a),a.parentNode.removeChild(a)):void 0},unbind:function(){var a,b,c,d,e;if(null!=this.iterated){for(d=this.iterated,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.unbind());return e}},routine:function(b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A;if(k=this.args[0],c=c||[],this.iterated.length>c.length)for(w=Array(this.iterated.length-c.length),q=0,t=w.length;t>q;q++)f=w[q],p=this.iterated.pop(),p.unbind(),this.marker.parentNode.removeChild(p.els[0]);for(g=r=0,u=c.length;u>r;g=++r)if(j=c[g],e={index:g},e[k]=j,null==this.iterated[g]){x=this.view.models;for(i in x)j=x[i],null==e[i]&&(e[i]=j);m=this.iterated.length?this.iterated[this.iterated.length-1].els[0]:this.marker,l={binders:this.view.options.binders,formatters:this.view.options.formatters,adapters:this.view.options.adapters,config:{}},y=this.view.options.config;for(h in y)o=y[h],l.config[h]=o;l.config.preloadData=!0,n=b.cloneNode(!0),p=new a.View(n,e,l),p.bind(),this.iterated.push(p),this.marker.parentNode.insertBefore(n,m.nextSibling)}else this.iterated[g].models[k]!==j&&this.iterated[g].update(e);if("OPTION"===b.nodeName){for(z=this.view.bindings,A=[],s=0,v=z.length;v>s;s++)d=z[s],A.push(d.el===this.marker.parentNode&&"value"===d.type?d.sync():void 0);return A}},update:function(a){var b,c,d,e,f,g,h,i;b={};for(c in a)d=a[c],c!==this.args[0]&&(b[c]=d);for(h=this.iterated,i=[],f=0,g=h.length;g>f;f++)e=h[f],i.push(e.update(b));return i}},a.binders["class-*"]=function(a,b){var c;return c=" "+a.className+" ",!b==(-1!==c.indexOf(" "+this.args[0]+" "))?a.className=b?""+a.className+" "+this.args[0]:c.replace(" "+this.args[0]+" "," ").trim():void 0},a.binders["*"]=function(a,b){return null!=b?a.setAttribute(this.type,b):a.removeAttribute(this.type)},a.adapters["."]={id:"_rv",counter:0,weakmap:{},weakReference:function(a){var b;return null==a[this.id]&&(b=this.counter++,this.weakmap[b]={callbacks:{}},Object.defineProperty(a,this.id,{value:b})),this.weakmap[a[this.id]]},stubFunction:function(a,b){var c,d,e;return d=a[b],c=this.weakReference(a),e=this.weakmap,a[b]=function(){var b,f,g,h,i,j,k,l,m,n;h=d.apply(a,arguments),k=c.pointers;for(g in k)for(f=k[g],n=null!=(l=null!=(m=e[g])?m.callbacks[f]:void 0)?l:[],i=0,j=n.length;j>i;i++)(b=n[i])();return h}},observeMutations:function(a,b,c){var d,e,g,h,i,j;if(Array.isArray(a)){if(g=this.weakReference(a),null==g.pointers)for(g.pointers={},e=["push","pop","shift","unshift","sort","reverse","splice"],i=0,j=e.length;j>i;i++)d=e[i],this.stubFunction(a,d);if(null==(h=g.pointers)[b]&&(h[b]=[]),f.call(g.pointers[b],c)<0)return g.pointers[b].push(c)}},unobserveMutations:function(a,b,c){var d,e;return Array.isArray(a&&null!=a[this.id])&&(d=null!=(e=this.weakReference(a).pointers)?e[b]:void 0)?d.splice(d.indexOf(c),1):void 0},subscribe:function(a,b,c){var d,e,g=this;return d=this.weakReference(a).callbacks,null==d[b]&&(d[b]=[],e=a[b],Object.defineProperty(a,b,{enumerable:!0,get:function(){return e},set:function(f){var h,i,j;if(f!==e){for(e=f,j=d[b],h=0,i=j.length;i>h;h++)(c=j[h])();return g.observeMutations(f,a[g.id],b)}}})),f.call(d[b],c)<0&&d[b].push(c),this.observeMutations(a[b],a[this.id],b)},unsubscribe:function(a,b,c){var d;return d=this.weakmap[a[this.id]].callbacks[b],d.splice(d.indexOf(c),1),this.unobserveMutations(a[b],a[this.id],b)},read:function(a,b){return a[b]},publish:function(a,b,c){return a[b]=c}},a.factory=function(b){return b._=a,b.binders=a.binders,b.components=a.components,b.formatters=a.formatters,b.adapters=a.adapters,b.config=a.config,b.configure=function(b){var c,d;null==b&&(b={});for(c in b)d=b[c],a.config[c]=d},b.bind=function(b,c,d){var e;return null==c&&(c={}),null==d&&(d={}),e=new a.View(b,c,d),e.bind(),e}},"object"==typeof exports?a.factory(exports):"function"==typeof define&&define.amd?define("rivets",["exports"],function(b){return a.factory(this.rivets=b),b}):a.factory(this.rivets={})}.call(this),define("views/jqm/form",[],function(){var a=Backbone.View.extend({tagName:"form",attributes:{novalidate:"novalidate"},remove:function(){return this.$el.removeData("model"),this.model.unset("_view"),Backbone.View.prototype.remove.call(this)},render:function(){var a=this.model.attributes.pages,b=$("<header></header>"),c=$("<footer></footer>");this.$el.empty(),this.$el.attr("data-form",this.model.attributes.name),this.$el.data("model",this.model),this.model.attributes.header&&(b.append(this.model.attributes.header),this.$el.append(b)),a&&"function"==typeof a.goto&&a.goto(0),this.model.attributes.footer&&(c.append(this.model.attributes.footer),this.$el.append(c))}});return a}),define("views/jqm/subform",["require","views/jqm/form"],function(a){var b=a("views/jqm/form");return b.extend({tagName:"section",attributes:{},remove:function(){return this.$el.children(".ui-btn").children("button").off("click"),b.prototype.remove.call(this)},render:function(){var a,c=this.model.parentElement,d=c.attributes.minusButtonLabel;_.isEmpty(d)&&c.attributes.label&&(d=c.attributes.label),_.isEmpty(d)&&(d=c.attributes.name),a=$("<button></button>").attr({type:"button","data-icon":"minus","data-action":"remove"}).text(d),a.on("click",this.onRemoveClick.bind(this)),b.prototype.render.call(this),this.$el.prepend(a)},onRemoveClick:function(){this.model.parentElement.remove(this.model)}})}),define("views/jqm/element",["rivets"],function(a){return Backbone.View.extend({tagName:"div",attributes:{"data-role":"fieldcontain","rv-class":"m:class"},initialize:function(){var a=this.model;this.$el.attr("data-name",a.attributes.name),this.$el.data("model",a),this.bindRivets(),this.onChangeHidden(),a.on("change:errors",this.renderErrors,this),a.on("change:hidden",this.onChangeHidden,this)},remove:function(){return this.$el.removeData("model"),this.model.off(null,null,this),this.rivet&&this.rivet.unbind(),this.model.unset("_view"),Backbone.View.prototype.remove.call(this)},renderLabel:function(){var a=$(document.createElement("label"));a.attr({"rv-text":"m:label","class":"ui-input-text"}),this.$el.append(a)},render:function(){throw new Error("Element.render is only an interface")},renderWarning:function(){var a,b,c,d,e;a=this.model.attributes,e=window.i18n["BMP/Forms/warning"],this.$el.children("ul").length>0&&this.$el.children("ul").remove(),b=$(document.createElement("ul")),c=a.warning||{},_.isEmpty(c)||_.each(c.value,function(a){var c,f;f=_.isFunction(e[a.code])&&e[a.code],c||(c=f?f(a):JSON.stringify(a)),d=$(document.createElement("li")),d.text(c),b.append(d)}),0!==this.$el.children("ul").length||_.isEmpty(c)||this.$el.append(b)},renderErrors:function(){var a,b,c,d,e;a=this.model.attributes,e=window.i18n["BMP/Forms/validation"],this.$el.children("ul").length>0&&this.$el.children("ul").remove(),b=$(document.createElement("ul")),c=a.errors||{},_.isEmpty(c)||_.each(c.value,function(c){var f,g;d=$(document.createElement("li")),g=_.isFunction(e[c.code])&&e[c.code],"PATTERN"===c.code&&(f=a.hint||a.toolTip||a.title),f||(f=g?g(c):JSON.stringify(c)),d.text(f),b.append(d)}),0!==this.$el.children("ul").length||_.isEmpty(c)||this.$el.append(b)},onChangeHidden:function(){var a=this.model.attributes.hidden;a?this.$el.hide():this.$el.show()},isHidden:function(){return this.$el&&"none"===this.$el.css("display")},bindRivets:function(){this.rivet&&this.rivet.unbind(),this.rivet=a.bind(this.el,{m:this.model})}})}),define("views/jqm/elements/subform",["require","views/jqm/element"],function(a){var b=a("views/jqm/element");return b.extend({tagName:"section",remove:function(){return this.$el.children(".ui-btn").children("button").off("click"),this.model.attributes.forms.off("change",this.onFormsChange,this),b.prototype.remove.call(this)},render:function(){var a,b=this.model.attributes.plusButtonLabel;_.isEmpty(b)&&this.model.attributes.label&&(b=this.model.attributes.label),_.isEmpty(b)&&(b=this.model.attributes.name),a=$("<button></button>").attr({type:"button","data-icon":"plus","data-action":"add"}).text(b),a.on("click",this.onAddClick.bind(this)),this.$el.attr("data-form",b),this.$el.prepend(a),this.model.attributes.forms.on("add remove",this.onFormsChange,this),this.onFormsChange()},onAddClick:function(){this.model.add()},onFormsChange:function(){var a,b,c;a=BMP.Forms,b=this,this.model.attributes.forms.forEach(function(d){var e,f,g;d.attributes._view||(d.attributes._view=new a._views.SubForm({model:d})),c=d.attributes._view,g=d.attributes._action,"remove"!==g&&(c&&c.$el&&c.$el.children().length||(d.$form=c.$el,c.render()),e=c.$el.closest("body"),e.length&&e[0]===document.body||(f=b.$el.children("section[data-form]").last(),f.length?f.after(c.$el):b.$el.prepend(c.$el)))}),this.$el.trigger("create")}})}),define("views/jqm/section",[],function(){var a=Backbone.View.extend({tagName:"section",initialize:function(){var a=this.model.attributes;a["class"]&&this.$el.addClass(a["class"])},render:function(){var a=this;this.$el.empty(),this.model.get("elements").forEach(function(b){var c,d;d=b.attributes.type,b.attributes._view||"function"!=typeof b.initializeView||b.initializeView(),c=b.attributes._view,c.render(),"hidden"===d?a.$el.prepend(c.el):a.$el.append(c.el)})},show:function(){this.$el.show()},hide:function(){this.$el.hide()},remove:function(){var a;return this.model.get("elements").forEach(function(a){a.attributes._view.remove()}),this.model.unset("_view"),a=Backbone.View.prototype.remove.call(this),delete this.model,delete this.$el,delete this.el,a}});return a}),define("views/jqm/page",["views/jqm/section"],function(a){var b=a.extend({tagName:"section",initialize:function(){var b=this.model;this.$el.attr("data-name",b.attributes.name),a.prototype.initialize.call(this)},render:function(){a.prototype.render.call(this)}});return b}),define("views/jqm/elements/heading",["views/jqm/element"],function(a){var b=a.extend({attributes:{"rv-text":"m:text"},initialize:function(){var b;this.model&&_.isNumber(this.model.attributes.level)&&(this.tagName="h"+this.model.attributes.level,b=$("<"+this.tagName+"></"+this.tagName+">"),b.attr(this.attributes),this.setElement(b[0])),a.prototype.initialize.call(this)},render:function(){this.bindRivets()}});return b}),define("views/jqm/elements/message",["views/jqm/element"],function(a){var b=a.extend({tagName:"div",attributes:{"rv-class":"m:class"},render:function(){var a,b=this.model;b.attributes.label?(this.$el.attr({"data-role":"fieldcontain"}),this.$el.empty(),this.renderLabel(),a=$("<div></div>").attr({"rv-html":"m:html","class":"ui-input-text"}),this.$el.append(a)):this.$el.attr({"rv-html":"m:html"}),this.bindRivets()}});return b}),define("views/jqm/elements/date",["views/jqm/element"],function(a){var b=a.extend({renderDate:function(){var a,b=this.model.attributes.name;return a=$('<input type="date" />'),a.attr({name:b+"_date","rv-value":"m:_date"}),this.$el.append(a),this},renderTime:function(){var a,b=this.model.attributes.name;return a=$('<input type="time" />'),a.attr({name:b+"_time","rv-value":"m:_time"}),this.$el.append(a),this},render:function(){var a=this.model.get("type");return this.$el.empty(),this.renderLabel(),"time"!==a&&this.renderDate(),"date"!==a&&this.renderTime(),this.bindRivets(),this}});return b}),define("views/jqm/elements/date_pickadate",["views/jqm/elements/date"],function(a){var b=a.extend({renderDate:function(){var a,b=this.model.attributes,c=b.name,d=this;return a=$('<input type="text" />'),a.attr({name:c+"_date","rv-value":"m:_date"}),this.$el.append(a),BMP.Forms.once("formInjected",function(){a.pickadate(d.prepareDateSettings())}),this},renderTime:function(){var a,b=this.model.attributes,c=b.name,d=this;return a=$('<input type="text" />'),a.attr({name:c+"_time","rv-value":"m:_time"}),this.$el.append(a),BMP.Forms.once("formInjected",function(){a.pickatime(d.prepareTimeSettings())}),this},render:function(){var a,b=this.model.get("type");return this.$el.empty(),this.renderLabel(),"time"!==b&&this.renderDate(),"datetime"===b&&(a=$(document.createElement("label")),a.attr({"class":"ui-input-text"}),this.$el.append(a)),"date"!==b&&this.renderTime(),this.bindRivets(),this},prepareDateSettings:function(){var a=this.model.attributes,b={};if(b.format=this.mapDateFormats[a.dateFormat]||"yyyy-mm-dd",a.dateAllowFrom)switch(a.dateAllowFrom){case"now":b.min=new Date;break;case"now_plus":b.min=parseInt(a.dateAllowFromNowPlus,10);break;case"date":b.min=new Date(a.dateAllowFromDate)}if(a.dateAllowTo)switch(a.dateAllowTo){case"now":b.max=new Date;break;case"now_plus":b.max=parseInt(a.dateAllowToNowPlus,10);break;case"date":b.max=new Date(a.dateAllowToDate)
}return b},prepareTimeSettings:function(){var a=this.model.attributes,b={};return b.format=this.mapTimeFormats[a.timeFormat]||"HH:i",a.minuteStep&&(b.interval=parseInt(a.minuteStep,10)),b},mapDateFormats:{yyyy_mm_dd:"yyyy-mm-dd",mm_dd_yyyy:"mm-dd-yyyy",dd_mm_yyyy2:"dd/mm/yyyy",yyyy_mm_dd2:"yyyy/mm/dd",mm_dd_yyyy2:"mm/dd/yyyy",dd_mm_yyyy:"dd-mm-yyyy"},mapTimeFormats:{"hh:mm":"HH:i",hh_mm_ss:"HH:i",h_mm_ss:"hh:i A",h_mm:"hh:i A"}});return b}),define("views/jqm/elements/hidden",["views/jqm/element"],function(a){var b=a.extend({initialize:function(){this.setElement($('<input type="hidden" />')[0]),a.prototype.initialize.call(this)},render:function(){var a=this.model.get("name");this.$el.attr({name:a,"rv-value":"m:value"}),this.bindRivets()}});return b}),define("views/jqm/elements/number",["views/jqm/element"],function(a){var b=a.extend({render:function(){var a,b=this.model.attributes,c=b.name,d=b.min,e=b.max;this.$el.empty(),this.renderLabel(),_.isNumber(d)&&_.isNumber(e)?(a=$('<input type="range" />'),a.attr({"data-highlight":!0}),$(document).one("pageinit",$.proxy(this.bindRivets,this))):a=$('<input type="number" />'),a.attr({name:c,"rv-min":"m:min","rv-max":"m:max","rv-value":"m:value","rv-step":"m:step","rv-placeholder":"m:placeholderText"}),a.on("keyup",function(){this.hasOwnProperty("valueAsNumber")?isNaN(this.valueAsNumber)&&(a.prop("value",""),$(this).trigger("change")):"string"!=typeof this.value||this.value.length||(a.prop("value",""),$(this).trigger("change"))}),this.$el.append(a),this.bindRivets()},remove:function(){return this.$el.children("input").off("keyup"),a.prototype.remove.call(this)}});return b}),define("views/jqm/elements/telephone",["views/jqm/element"],function(a){var b=a.extend({render:function(){var a,b=this.model.get("name");this.$el.empty(),this.renderLabel(),a=$('<input type="tel" />'),a.attr({name:b,"rv-value":"m:value","rv-placeholder":"m:placeholderText"}),this.$el.append(a),this.bindRivets()}});return b}),define("views/jqm/elements/text",["views/jqm/element"],function(a){var b=a.extend({render:function(){var a,b=this.model.get("name");this.$el.empty(),this.renderLabel(),a=$('<input type="text" />'),a.attr({name:b,"rv-value":"m:value","rv-placeholder":"m:placeholderText"}),this.$el.append(a),this.bindRivets()}});return b}),define("views/jqm/elements/password",["views/jqm/elements/text"],function(a){var b=a.extend({render:function(){var a,b=this.model.get("name");this.$el.empty(),this.renderLabel(),a=$('<input type="password" />'),a.attr({name:b,"rv-value":"m:value","rv-placeholder":"m:placeholderText"}),this.$el.append(a),this.bindRivets()}});return b}),define("views/jqm/elements/email",["views/jqm/elements/text"],function(a){var b=a.extend({render:function(){var a,b=this.model.get("name");this.$el.empty(),this.renderLabel(),a=$('<input type="email" />'),a.attr({name:b,"rv-value":"m:value","rv-placeholder":"m:placeholderText"}),this.$el.append(a),this.bindRivets()}});return b}),define("views/jqm/elements/url",["views/jqm/elements/text"],function(a){var b=a.extend({render:function(){var a,b=this.model.get("name");this.$el.empty(),this.renderLabel(),a=$('<input type="text" />'),a.attr({name:b,"rv-value":"m:value","rv-placeholder":"m:placeholderText"}),this.$el.append(a),this.bindRivets()}});return b}),define("views/jqm/elements/textarea",["views/jqm/elements/text"],function(a){var b=a.extend({render:function(){var a,b=this.model.get("name");this.$el.empty(),this.renderLabel(),a=$("<textarea></textarea>"),a.attr({name:b,"rv-value":"m:value","rv-placeholder":"m:placeholderText"}),this.$el.append(a),this.bindRivets()}});return b}),define("views/jqm/elements/boolean",["views/jqm/element"],function(a){var b=a.extend({render:function(){var a;this.$el.empty(),this.renderLabel(),a=$("<select></select>"),a.attr({"rv-value":"m:value","data-role":"slider"}),_.forEach(this.model.attributes.options,function(b,c){var d=$('<option value="'+c+'">'+b+"</option>");a.append(d)}),this.$el.append(a),this.bindRivets(),this.model.on("change:value",this.onValueChange,this)},onValueChange:function(){this.$el.children("select").slider("refresh")}});return b}),define("views/jqm/elements/choice",["views/jqm/element"],function(a){var b=a.extend({renderOtherText:function(a){var b=this.model.attributes.name,c=$('<input type="text" />'),d='<label rv-text="m:label" class="ui-input-text"></label>',e=$('<div data-role="fieldcontain"></div>'),f=$('<div class="ui-input-text"></div>'),g=!!this.$el.find("div[data-role=fieldcontain]").length,h=this.model;e.addClass("ui-field-contain ui-body ui-br"),f.addClass("ui-shadow-inset ui-corner-all ui-btn-shadow ui-body-c"),c.attr({name:b+"_other","class":"ui-input-text ui-body-c"}),a&&!g?(e.append(d),f.append(c),e.append(f),this.$el.append(e),c.on("change",function(){var a=h.attributes;_.isArray(a.value)?(a.value.indexOf("other")&&a.value.splice(a.value.indexOf("other"),1),a.value.push(c.val())):a.value=c.val()})):!a&&g&&this.$el.children("div[data-role=fieldcontain]").remove()}});return b}),define("views/jqm/elements/choicecollapsed",["views/jqm/elements/choice"],function(a){var b=a.extend({render:function(){var a,b,c=this,d=this.model.attributes,e=this.model.attributes.type,f=this.model.attributes.name;this.$el.empty(),this.renderLabel(),a=$("<select></select>"),"select"===e?(a.attr({name:f}),a.append("<option>select one...</option>")):(a.attr({name:f+"[]",multiple:"multiple","data-native-menu":!1}),a.append("<option>select one or more...</option>")),d.nativeMenu&&a.attr({"data-role":"none"}),_.forEach(this.model.attributes.options,function(b,c){var d=$('<option value="'+c+'">'+b+"</option>");a.append(d)}),this.model.attributes.other&&(b=$('<option value="other">other</option>'),a.append(b)),this.$el.append(a),this.bindRivets(),a.on("change",function(){var b;_.isArray(a.val())&&_.contains(a.val(),"other")?(b=a.val(),-1!==b.indexOf("other")&&c.$el.find("input[type = text]").val()&&(b.splice(b.indexOf("other"),1),b.push(c.$el.find("input[type = text]").val())),c.model.set("value",b)):"select one..."===a.val()?c.model.set("value",""):c.model.set("value",a.val())}),this.model.on("change:value",this.onValueChange,this)},onValueChange:function(){var b=!1,c=this.model.attributes,d=this.$el.find("select");"select"===c.type?$.inArray(c.value,_.keys(c.options))<0?""===c.value?d.find("option:not([value])").prop("selected",!0):(b=!0,d.val("other")):d.val(c.value):(d.val(c.value),_.difference(c.value,_.keys(c.options)).length>0&&(b=!0,d.val(_.union(c.value,["other"])))),c.nativeMenu||(d.selectmenu(),d.selectmenu("refresh")),a.prototype.renderOtherText.call(this,b),"select"===c.type?$.inArray(c.value,_.keys(c.options))<0&&"other"!==c.value&&this.$el.find("input[type = text]").val(c.value):_.difference(c.value,_.keys(c.options)).length>0&&!_.contains(c.value,"other")&&this.$el.find("input[type = text]").val(_.difference(c.value,_.keys(c.options)))}});return b}),define("views/jqm/elements/choiceexpanded",["views/jqm/elements/choice"],function(a){var b=a.extend({remove:function(){var b=this.attributes.type;return"select"!==b&&this.$el.find("input").off("click"),a.prototype.remove.call(this)},render:function(){var a,b,c=this,d=this.model.attributes,e=d.type,f=d.name,g=d.options,h="select"===e?"radio":"checkbox",i="select"===e?f+"_"+c.cid:f+"[]";this.$el.empty(),a=$("<fieldset></fieldset>").attr({"data-role":"controlgroup"}),"horizontal"===d.layout&&a.attr({"data-type":"horizontal"}),b=$("<legend></legend>").text(d.label),a.prepend(b),this.model.attributes.other&&(g.other="other"),_.forEach(g,function(b,c){var d=$("<label>"+b+"</label>"),e=$('<input type="'+h+'" />');e.attr({name:i,value:c}),d.prepend(e),a.append(d)}),this.$el.append(a),"select"===e?(this.bindRivets(),this.model.on("change:value",this.onSelectValueChange,this),a.find("input").on("click",function(){c.model.set("value",c.$el.find("input:checked").val())})):(a.find("input").on("click",{view:this,model:this.model},this.onMultiInputClick),this.model.on("change:value",this.onMultiValueChange,this))},onMultiInputClick:function(a){var b,c=a.data.view,d=a.data.model,e=c.$el.find("input:checked");b=_.map(e,function(a){return $(a).val()}),-1!==b.indexOf("other")&&c.$el.find("input[type = text]").val()&&(b.splice(b.indexOf("other"),1),b.push(c.$el.find("input[type = text]").val())),d.set("value",b)},onMultiValueChange:function(){var b=this,c=this.model,d=b.$el.find("input[type=radio],input[type=checkbox]"),e=c.attributes.value,f=!1;_.isArray(e)||(e=[]),d.each(function(a,b){var c=$(b);c.prop("checked",-1!==_.indexOf(e,c.val()))}),(_.contains(e,"other")||_.difference(e,_.keys(c.attributes.options)).length>0)&&(f=!0,b.$el.find("input[value = other]").prop("checked",!0)),d.checkboxradio("refresh"),a.prototype.renderOtherText.call(this,f),_.difference(e,_.keys(c.attributes.options)).length>0&&b.$el.find("input[type = text]").val(_.difference(e,_.keys(c.attributes.options)))},onSelectValueChange:function(){var b,c,d=this,e=d.$el.find("input[type=radio],input[type=checkbox]");_.contains(_.keys(this.model.get("options")),this.model.get("value"))?this.$el.find("[value = "+this.model.get("value")+"]").prop("checked",!0):""===this.model.get("value")?this.$el.find("input:checked").prop("checked",!1):this.$el.find("[value = other]").prop("checked",!0),e.checkboxradio("refresh"),b=this.$el.find("label[data-icon=radio-on]"),c=$.map(b,function(a){return $(a).text().trim()}),a.prototype.renderOtherText.call(this,_.contains(c,"other")),_.contains(_.keys(this.model.get("options")),this.model.get("value"))||"other"===this.model.get("value")||this.$el.find("input[type = text]").val(this.model.get("value"))}});return b}),define("views/jqm/elements/location",["views/jqm/element"],function(a){var b=a.extend({render:function(){var a,c;this.$el.empty(),this.renderLabel(),a=$("<button />"),a.text("Detect Location"),c=$('<div class="ui-input-text"></div>'),c.append(a),this.$el.append(c),a.on("click",$.proxy(b.onButtonClick,this)),this.bindRivets(),this.model.on("change:value",this.renderFigure,this)},renderFigure:function(){var a,b,c,d,e,f;c="string"==typeof this.model.attributes.value?JSON.parse(this.model.attributes.value):this.model.attributes.value,this.$el.children("figure").remove(),c&&c.latitude&&c.longitude&&(a=$("<figure></figure>"),b=$("<figcaption></figcaption>").appendTo(a),e="lat: "+c.latitude+"; long: "+c.longitude,c.accuracy&&(e+="; &plusmn;"+c.accuracy+"M"),b.html(e),d=$("<img />"),f="http://maps.google.com/maps/api/staticmap?markers=",f+=c.latitude+","+c.longitude,f+="&size=300x200&zoom=20&maptype=hybrid&sensor=true",d.attr("src",f),d.css({"max-height":"7em","max-width":"100%"}),a.append(d),this.$el.append(a))},remove:function(){return this.$el.children("button").off("click"),this.model.off("change:value",this.renderFigure,this),a.prototype.remove.call(this)}},{onButtonClick:function(a){return this.model.getGeoLocation(),a.preventDefault(),!1}});return b}),define("views/jqm/elements/file",["views/jqm/element"],function(a){var b,c;return c=function(a){for(var b=["bytes","KB","MB","GB"],c=0,d=1;a>1024*d&&c<b.length;)d*=1024,c+=1;return a=Math.round(10*a/d)/10,a+" "+b[c]},b=a.extend({render:function(){var a,b=this,c=this.model.get("name");this.$el.empty(),this.renderLabel(),a=$('<input type="file" />'),a.attr({name:c,"rv-accept":"m:accept"}),a.prop("capture",!!this.model.get("capture")),this.$el.append(a),this.bindRivets(),a.on("change",function(a){b.onInputChange(a)}),this.model.on("change:blob",function(){this.model.updateWarning(),_.isEmpty(this.model.attributes.warning)?this.renderWarning():this.renderFigure()},this)},renderFigure:function(){var a,b,d,e,f;d=this.model.attributes.blob,this.$el.children("figure").remove(),d&&(e=[],a=$("<figure></figure>"),b=$("<figcaption></figcaption>").appendTo(a),d.type&&e.push(d.type),d.size&&_.isNumber(d.size)&&e.push(c(d.size)),b.html(e.join(" &mdash; ")),_.isString(d.type)&&0===d.type.indexOf("image/")&&(f=$("<img />"),f.attr("src",d.toDataURI()),f.css({"max-height":"6em","max-width":"100%"}),a.append(f)),this.$el.append(a))},remove:function(){return this.$el.children("input").off("change"),this.model.off("change:blob",this.renderFigure,this),a.prototype.remove.call(this)},onInputChange:function(a){var b=this,c=a&&$(a.target),d=c.data("fileInput");d.size()&&d.getBlob().then(function(a){b.model.set("blob",a)})}})}),define("text",["module"],function(a){var b,c,d,e,f,g=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],h=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,i=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,j="undefined"!=typeof location&&location.href,k=j&&location.protocol&&location.protocol.replace(/\:/,""),l=j&&location.hostname,m=j&&(location.port||void 0),n={},o=a.config&&a.config()||{};return b={version:"2.0.12",strip:function(a){if(a){a=a.replace(h,"");var b=a.match(i);b&&(a=b[1])}else a="";return a},jsEscape:function(a){return a.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:o.createXhr||function(){var a,b,c;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(b=0;3>b;b+=1){c=g[b];try{a=new ActiveXObject(c)}catch(d){}if(a){g=[c];break}}return a},parseName:function(a){var b,c,d,e=!1,f=a.indexOf("."),g=0===a.indexOf("./")||0===a.indexOf("../");return-1!==f&&(!g||f>1)?(b=a.substring(0,f),c=a.substring(f+1,a.length)):b=a,d=c||b,f=d.indexOf("!"),-1!==f&&(e="strip"===d.substring(f+1),d=d.substring(0,f),c?c=d:b=d),{moduleName:b,ext:c,strip:e}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(a,c,d,e){var f,g,h,i=b.xdRegExp.exec(a);return i?(f=i[2],g=i[3],g=g.split(":"),h=g[1],g=g[0],!(f&&f!==c||g&&g.toLowerCase()!==d.toLowerCase()||(h||g)&&h!==e)):!0},finishLoad:function(a,c,d,e){d=c?b.strip(d):d,o.isBuild&&(n[a]=d),e(d)},load:function(a,c,d,e){if(e&&e.isBuild&&!e.inlineText)return void d();o.isBuild=e&&e.isBuild;var f=b.parseName(a),g=f.moduleName+(f.ext?"."+f.ext:""),h=c.toUrl(g),i=o.useXhr||b.useXhr;return 0===h.indexOf("empty:")?void d():void(!j||i(h,k,l,m)?b.get(h,function(c){b.finishLoad(a,f.strip,c,d)},function(a){d.error&&d.error(a)}):c([g],function(a){b.finishLoad(f.moduleName+"."+f.ext,f.strip,a,d)}))},write:function(a,c,d){if(n.hasOwnProperty(c)){var e=b.jsEscape(n[c]);d.asModule(a+"!"+c,"define(function () { return '"+e+"';});\n")}},writeFile:function(a,c,d,e,f){var g=b.parseName(c),h=g.ext?"."+g.ext:"",i=g.moduleName+h,j=d.toUrl(g.moduleName+h)+".js";b.load(i,d,function(){var c=function(a){return e(j,a)};c.asModule=function(a,b){return e.asModule(a,j,b)},b.write(a,i,c,f)},f)}},"node"===o.env||!o.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]?(c=require.nodeRequire("fs"),b.get=function(a,b,d){try{var e=c.readFileSync(a,"utf8");0===e.indexOf("ï»¿")&&(e=e.substring(1)),b(e)}catch(f){d&&d(f)}}):"xhr"===o.env||!o.env&&b.createXhr()?b.get=function(a,c,d,e){var f,g=b.createXhr();if(g.open("GET",a,!0),e)for(f in e)e.hasOwnProperty(f)&&g.setRequestHeader(f.toLowerCase(),e[f]);o.onXhr&&o.onXhr(g,a),g.onreadystatechange=function(){var b,e;4===g.readyState&&(b=g.status||0,b>399&&600>b?(e=new Error(a+" HTTP status: "+b),e.xhr=g,d&&d(e)):c(g.responseText),o.onXhrComplete&&o.onXhrComplete(g,a))},g.send(null)}:"rhino"===o.env||!o.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?b.get=function(a,b){var c,d,e="utf-8",f=new java.io.File(a),g=java.lang.System.getProperty("line.separator"),h=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(f),e)),i="";try{for(c=new java.lang.StringBuffer,d=h.readLine(),d&&d.length()&&65279===d.charAt(0)&&(d=d.substring(1)),null!==d&&c.append(d);null!==(d=h.readLine());)c.append(g),c.append(d);i=String(c.toString())}finally{h.close()}b(i)}:("xpconnect"===o.env||!o.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(d=Components.classes,e=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),f="@mozilla.org/windows-registry-key;1"in d,b.get=function(a,b){var c,g,h,i={};f&&(a=a.replace(/\//g,"\\")),h=new FileUtils.File(a);try{c=d["@mozilla.org/network/file-input-stream;1"].createInstance(e.nsIFileInputStream),c.init(h,1,0,!1),g=d["@mozilla.org/intl/converter-input-stream;1"].createInstance(e.nsIConverterInputStream),g.init(c,"utf-8",c.available(),e.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),g.readString(c.available(),i),g.close(),c.close(),b(i.value)}catch(j){throw new Error((h&&h.path||"")+": "+j)}}),b}),define("text!views/jqm/templates/signaturePad.html",[],function(){return'<div id="bmp-forms-dialog-signature" data-role="popup" class="ui-content">\n    <form method="post" action="" class="sigPad">\n        <div class="sig sigWrapper">\n            <div class="typed"></div>\n            <canvas class="pad" style="cursor: crosshair; -ms-touch-action: none;"></canvas>\n            <input type="hidden" name="output" class="output">\n        </div>\n        <fieldset class="ui-grid-a">\n            <div class="ui-block-a">\n                <button type="submit" data-role="button">Done</button>\n            </div>\n            <div class="ui-block-b">\n                <!--<button type="reset" data-role="button">Reset</button>-->\n                <button data-action="clear" data-role="button">Clear</button>\n            </div>\n        </fieldset>\n    </form>\n</div>\n'}),define("views/jqm/elements/draw",["views/jqm/element","views/jqm/elements/file","text!views/jqm/templates/signaturePad.html"],function(a,b,c){var d,e;return e=b.extend({render:function(){var a,b;this.$el.empty(),this.renderLabel(),a=$("<button />"),a.text("Signature"),b=$('<div class="ui-input-text"></div>'),b.append(a),this.$el.append(b),a.on("click",$.proxy(e.onButtonClick,this)),this.bindRivets(),this.model.on("change:blob",function(){this.model.updateWarning(),_.isEmpty(this.model.attributes.warning)?this.renderWarning():this.renderFigure()},this)},remove:function(){return this.$el.children("button").off("click"),this.model.off("change:blob",this.renderFigure,this),a.prototype.remove.call(this)}},{onSignatureSubmit:function(a){var b,c=d.getSignatureImage("image/jpeg");return 0!==c.indexOf("data:")&&(c="data:image/jpeg;base64,"+c),b=BMP.Blob.fromDataURI(c),this.model.set("blob",b),$("#bmp-forms-dialog-signature").popup("close"),a.preventDefault(),!1},onSignatureClear:function(a){return this.model.unset("blob"),$("#bmp-forms-dialog-signature").popup("close"),a.preventDefault(),!1},onButtonClick:function(a){var b,f=$(c),g={dismissible:!0,history:!1,afterclose:function(a,b){a&&b&&(f.remove(),d=null)}},h=$(window),i=h.innerWidth(),j=h.innerHeight();return f.find("[data-role=header] > h2").text(this.model.get("label")),$(document.body).append(f),f.find("canvas").attr({height:Math.min(Math.floor(4*(i-60)/9),j-60),width:i-60}),b=f.children("form"),b.on("submit",$.proxy(e.onSignatureSubmit,this)),d=b.signaturePad({drawOnly:!0,validateFields:!1,lineWidth:0,output:null,sigNav:null,name:null,typed:null,clear:"input[type=reset]",typeIt:null,drawIt:null,typeItDesc:null,drawItDesc:null}),b.trigger("create"),f.popup(g),f.popup("open"),b.on("click","[data-action=clear]",$.proxy(e.onSignatureClear,this)),a.preventDefault(),!1}})}),define("views/jqm/elements/bg_draw",["views/jqm/element","views/jqm/elements/file"],function(a,b){var c;return c=b.extend({render:function(){var a,b;this.$el.empty(),this.renderLabel(),a=$("<button />"),a.text("Signature"),b=$('<div class="ui-input-text"></div>'),b.append(a),this.$el.append(b),a.on("click",$.proxy(c.onButtonClick,this)),this.bindRivets(),this.model.on("change:blob",this.renderFigure,this)},remove:function(){return this.$el.children("button").off("click"),this.model.off("change:blob",this.renderFigure,this),a.prototype.remove.call(this)}},{onButtonClick:function(a){var b=this.model,c=$(a.target),d=$(window),e=c.offset(),f=c.width(),g={canvasButtonOriginX:320,canvasButtonOriginY:320,canvasWidth:600,canvasHeight:300,destinationType:window.BGTouchDraw.DestinationType.DATA_URL,encodingType:window.BGTouchDraw.EncodingType.JPEG},h={};return h.canvasButtonOriginX=e.left+Math.floor(f/2),h.canvasButtonOriginY=e.top-d.scrollTop(),h=$.extend({},g,h),window.navigator.bgtouchdraw.getDrawing(function(a){var c=window.BMP.Blob.fromDataURI(a);c&&b.set("blob",c)},$.noop,h),a.preventDefault(),!1}})}),define("text!views/jqm/templates/bg_image.html",[],function(){return'<div class="ui-grid-a">\n    <div class="ui-block-a">\n        <button></button>\n    </div>\n    <div class="ui-block-b">\n        <button></button>\n    </div>\n</div>'}),define("views/jqm/elements/bg_image",["views/jqm/element","views/jqm/elements/file","text!views/jqm/templates/bg_image.html"],function(a,b,c){var d;return d=b.extend({render:function(){var a,b,e,f;try{f=window.PictureSourceType||navigator.camera.PictureSourceType}catch(g){}f=f||{},this.$el.empty(),this.renderLabel(),e=$('<div class="ui-input-text"></div>'),e.append(c),a=e.find("button").first(),a.text("Camera"),a.data("SourceType",f.CAMERA),b=e.find("button").last(),b.text("Gallery"),b.data("SourceType",f.PHOTO_LIBRARY),this.$el.append(e),a.on("click",$.proxy(d.onButtonClick,this)),b.on("click",$.proxy(d.onButtonClick,this)),this.bindRivets(),this.model.on("change:blob",this.renderFigure,this)},remove:function(){return this.$el.find("button").off("click"),this.model.off("change:blob",this.renderFigure,this),a.prototype.remove.call(this)}},{onButtonClick:function(a){var b=this.model,c=$(a.target),d={};return d.sourceType=c.data("SourceType"),window.navigator.camera.getPicture(function(a){var c=window.BMP.Blob.fromDataURI(a);c&&b.set("blob",c)},$.noop,d),a.preventDefault(),!1}})}),define("views/jqm/elements/button",["views/jqm/element"],function(a){var b=a.extend({remove:function(){return this.$el.children(".ui-btn").children("button").off("click"),a.prototype.remove.call(this)},render:function(){var a,b,c=this.model.get("name"),d=this.model.attributes,e=this;b=c,_.isEmpty(d.label)||(b=d.label),this.$el.empty(),a=$("<button></button>").attr({type:"button",name:c}).text(b),a.on("click",function(){e.model.trigger("change")}),this.$el.append(a),this.bindRivets()}});return b}),define("views/jqm/elements/webrtc_image",["views/jqm/element","views/jqm/elements/file"],function(a,b){var c;return c=b.extend({render:function(){var a,b;this.$el.empty(),this.renderLabel(),b=$('<a class="webrtc_image ui-icon-camera" data-role="button">Camera</a>'),a=$('<div class="ui-input-text"></div>'),a.append(b),this.$el.append(a),b.on("click",$.proxy(c.onButtonClick,this)),this.bindRivets(),this.model.on("change:blob",this.renderFigure,this)},remove:function(){return a.prototype.remove.call(this)}},{onButtonClick:function(){var a,b,c,d,e,f,g,h=this,i=$('<div data-role="popup"><h1>Tap to snap</h1></div>'),j=$("<select></select>"),k=$('<video autoplay width="100%"/>'),l=$('<img style="display: none;"/>'),m=$("<div></div>"),n=$("<div></div>"),o=$('<a data-role="button" data-inline="true">Rotate</a>'),p=$('<a data-rel="back" data-role="button" data-inline="true">Cancel</a>'),q=$('<a class="ui-disabled" data-role="button" data-inline="true">Recapture</a>'),r=$('<a class="ui-disabled" data-role="button" data-inline="true">Use</a>'),s=$("<canvas></canvas>"),t=0;navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,n.append(o,p,q,r),i.append(k,l,n),this.$el.append(i),d=function(){var a,b,c,d=k[0];0===t||180===t?(a=d.videoHeight,b=d.videoWidth):(a=d.videoWidth,b=d.videoHeight),s.attr("width",b),s.attr("height",a),c=s[0].getContext("2d"),0===t?c.drawImage(d,0,0):90===t?(c.rotate(t*Math.PI/180),c.drawImage(d,0,-b)):180===t?(c.rotate(t*Math.PI/180),c.drawImage(d,-b,-a)):270===t&&(c.rotate(t*Math.PI/180),c.drawImage(d,-a,0)),l.attr("src",s[0].toDataURL("image/png")),k.hide(),l.show(),q.removeClass("ui-disabled"),r.removeClass("ui-disabled")},e=function(){l.hide(),k.show()},g=function(){var a=window.BMP.Blob.fromDataURI(s[0].toDataURL());a&&h.model.set("blob",a),i.popup("close")},f=function(){var a;t=(t+90)%360,a="rotate("+t+"deg)",k.css({"-webkit-transform":a,transform:a}),90===t||270===t?k.css("padding","13% 0"):k.css("padding","0 0")},a=function(a){var c={video:!0,audio:!1};a&&(c.video={optional:[{sourceId:a}]}),navigator.getMedia(c,function(a){b=a,k.attr("src",window.URL.createObjectURL(b)),k.on("click",d),l.hide(),k.show()},function(){m.append("Please allow access to the camera"),i.prepend(m),i.popup("open")})},c=function(){b.stop&&b.stop(),i.remove(),i=j=k=l=m=n=o=p=q=r=s=null},i.popup({afteropen:function(){a(),o.on("click",f),q.on("click",e),r.on("click",g)},afterclose:function(){o.off(),q.off(),r.off(),c()}}),"undefined"!=typeof MediaStreamTrack&&"undefined"!=typeof MediaStreamTrack.getSources?MediaStreamTrack.getSources(function(b){var d,e,f=0,g=0;for(f=0;f<b.length;f++)d=b[f],"video"===d.kind&&(g++,e=d.label||"Camera "+g,j.append('<option value="'+d.id+'">'+e+"</option>"));g>1&&(i.prepend(j),j.on("change",function(){c(),a(j.val())})),i.trigger("create"),i.popup("open")}):(i.trigger("create"),i.popup("open"))}})}),define("views/forms3jqm",["require","rivets","views/jqm/form","views/jqm/subform","views/jqm/elements/subform","views/jqm/page","views/jqm/section","views/jqm/element","views/jqm/elements/heading","views/jqm/elements/message","views/jqm/elements/date","views/jqm/elements/date_pickadate","views/jqm/elements/hidden","views/jqm/elements/number","views/jqm/elements/telephone","views/jqm/elements/password","views/jqm/elements/email","views/jqm/elements/url","views/jqm/elements/text","views/jqm/elements/textarea","views/jqm/elements/boolean","views/jqm/elements/choicecollapsed","views/jqm/elements/choiceexpanded","views/jqm/elements/location","views/jqm/elements/file","views/jqm/elements/draw","views/jqm/elements/bg_draw","views/jqm/elements/bg_image","views/jqm/elements/button","views/jqm/elements/webrtc_image"],function(a){var b=a("rivets");return $.mobile.page.prototype.options.keepNative="[type^=time], [type^=date]",b.adapters[":"]={subscribe:function(a,b,c){a.on("change:"+b,c)},unsubscribe:function(a,b,c){a.off("change:"+b,c)},read:function(a,b){return a.get(b)},publish:function(a,b,c){a.set(b,c)}},{Form:a("views/jqm/form"),SubForm:a("views/jqm/subform"),SubFormElement:a("views/jqm/elements/subform"),Page:a("views/jqm/page"),Section:a("views/jqm/section"),Element:a("views/jqm/element"),HeadingElement:a("views/jqm/elements/heading"),MessageElement:a("views/jqm/elements/message"),DateElement:a("views/jqm/elements/date"),DatePickadateElement:a("views/jqm/elements/date_pickadate"),HiddenElement:a("views/jqm/elements/hidden"),NumberElement:a("views/jqm/elements/number"),TelephoneElement:a("views/jqm/elements/telephone"),PasswordElement:a("views/jqm/elements/password"),EmailElement:a("views/jqm/elements/email"),URLElement:a("views/jqm/elements/url"),TextElement:a("views/jqm/elements/text"),TextAreaElement:a("views/jqm/elements/textarea"),BooleanElement:a("views/jqm/elements/boolean"),ChoiceCollapsedElement:a("views/jqm/elements/choicecollapsed"),ChoiceExpandedElement:a("views/jqm/elements/choiceexpanded"),LocationElement:a("views/jqm/elements/location"),FileElement:a("views/jqm/elements/file"),DrawElement:a("views/jqm/elements/draw"),BGDrawElement:a("views/jqm/elements/bg_draw"),BGImageElement:a("views/jqm/elements/bg_image"),ButtonElement:a("views/jqm/elements/button"),WebRTCImageElement:a("views/jqm/elements/webrtc_image")}}),function(a,b){"function"==typeof define&&define.amd?define("bicyclepump",[],b):"object"==typeof exports?module.exports=b():a.BicyclePump=b()}(this,function(){var a,b,c;return b="function"==typeof setImmediate?function(a){setImmediate(a)}:"object"==typeof process&&process&&process.nextTick?process.nextTick:function(a){setTimeout(a,0)},c=function(a,c,d){var e,f,g,h,i,j;e=a.length,h=function(){return!0},d=d||h,i=function(a){a=a||new Error("inflation returned no result"),a instanceof Error?(d(a),d=h):b(function(){d(null,a)})},j=function(){b(g)},(g=function(){e-=1,(f=a[e])(c,i,j)})()},a=function(){var a;return a=[],this.addInflator=function(b){"function"==typeof b&&a.push(b)},this.removeInflator=function(b){var c;c=a.indexOf(b),a.splice(c,1)},this.getInflators=function(){var b;return b=[],b.push.apply(b,a),b},this.inflate=function(b,d){var e;if(!b)throw new Error("need something to inflate");if(!a.length)throw new Error("need to register an Inflator first");return e=function(a,b){"function"==typeof d&&d(a,b)},"function"==typeof Promise?new Promise(function(d,f){c(a,b,function(a,b){e(a,b),a?f(a):d(b)})}):void c(a,b,e)},this}}),define("formslib/castPropertyValues",[],function(){function a(a,c){var e;if(!a||"object"!=typeof a)throw new TypeError("1st argument must be an Object");if(!c||"object"!=typeof c)throw new TypeError("1st argument must be an Object");return e={},Object.keys(a).forEach(function(f){var g;if(a.hasOwnProperty(f))return c.hasOwnProperty(f)?(g=typeof c[f],-1!==b.indexOf(g)||typeof a[f]===g?void(e[f]=a[f]):void(e[f]=d[g](a[f]))):void(e[f]=a[f])}),e}var b=["array","function","object"],c=[0,"0","","false",null,void 0],d={"boolean":function(a){return-1!==c.indexOf(a)?!1:!0},number:function(a){var b;return"boolean"==typeof a?a?1:0:(b=parseFloat(a),isNaN(b)?0:b)},string:function(a){return a&&"object"==typeof a&&a.toString?a.toString():""+a}};return a}),define("formslib/clone",[],function(){function a(a){return JSON.parse(JSON.stringify(a))}return a}),define("formslib/flattenDefinition",["./clone"],function(a){function b(a,b){if(!a||"object"!=typeof a)throw new TypeError("1st argument must be an Object");if(!b||"object"!=typeof b)throw new TypeError("1st argument must be an Object");return Object.keys(b).forEach(function(c){var d=b[c];"string"==typeof d?d&&(a[c]=d.trim()):a[c]=d}),a}function c(a,b){var c;return c=a.filter(function(a){return-1!==b.indexOf(a.name)}),c.sort(function(a,c){var d,e;return d=b.indexOf(a.name),e=b.indexOf(c.name),d-e}),c}function d(d,e){function f(a){var c=a["default"]||{};return e&&a[e]&&b(c,a[e]),c}if(!d||"object"!=typeof d)throw new TypeError("1st argument should be an Object");if(!d["default"])throw new TypeError('Object is missing the "default" property');if(!d["default"].name||"string"!=typeof d["default"].name)throw new TypeError('"default" Object is missing the "name" String');return d=a(d),["_elements","_sections","_pages","_behaviours","_checks","_actions"].forEach(function(a){Array.isArray(d["default"][a])&&(d["default"][a]=d["default"][a].map(f))}),e?(d[e]&&(Array.isArray(d[e]._elements)&&(d["default"]._elements=c(d["default"]._elements,d[e]._elements),delete d[e]._elements),b(d["default"],d[e])),d["default"]):d["default"]}return d}),define("formslib/parseClass",[],function(){function a(a){var b;return b=a.toLowerCase().trim(),b=b.replace(/[^a-z0-9]/g,"-"),b=b.replace(/\W(\w)/g,function(a,b){return b.toUpperCase()})}function b(b){var d,e,f=b.lastIndexOf(";"),g={};if(-1===f)return g["class"]=b,g;for(g["class"]=b.substring(f+1,b.length).trim(),b=b.substring(0,f+1),b=b.replace(/\s/g,""),b=b.replace(/\:;/g,";"),d=c.exec(b);Array.isArray(d);)e=a(d[1]),g[e]=void 0===d[2]?!0:d[2],d=c.exec(b);return g}var c=/([\w\-]+)(?:\:([^;]+))?;?/g;return b}),define("formslib/main",["./castPropertyValues","./flattenDefinition","./parseClass"],function(a,b,c){return{castPropertyValues:a,flattenDefinition:b,parseClass:c}}),define("models/element",[],function(){var a;return a=Backbone.Model.extend({defaults:{page:0,"class":"",defaultValue:"",value:"",pattern:"",hidden:!1,persist:!0},idAttribute:"name",initialize:function(){var a=this.attributes,b=a.form,c=a.page,d=BMP.Forms,e=$.trim(a.section||"");d.setAttributesFromClass(this),this.initializeView(),b&&(c=a.page=b.getPage(a.page),c&&e?(e=a.section=c.getSection(e),e.add(this)):(c.add(this),delete a.section)),this.set("value",a.defaultValue),a.label||"message"===a.type||(a.prefix?this.set("label",a.name+" "+a.prefix):this.set("label",a.name)),this.on("change",this.updateErrors,this)
},validate:function(a){var b={};return void 0===a&&(a=this.attributes),a.required&&!a.value&&(b.value=b.value||[],b.value.push({code:"REQUIRED"})),a.pattern&&a.value&&!new RegExp(a.pattern).test(a.value)&&(b.value=b.value||[],b.value.push({code:"PATTERN",PATTERN:a.pattern})),_.isEmpty(b)?void 0:b},updateErrors:function(){this.set("errors",this.validate())},warn:function(){var a={};return a.value=a.value||[],BMP.Forms.supports.blob||a.value.push({code:"NO_BLOB_PREVIEW"}),_.isEmpty(a)?void 0:a},updateWarning:function(){this.set("warning",this.warn())},removeView:function(){var a=this.attributes;a._view&&(a._view.remove(),delete a._view)},destroy:function(a){var b=this.attributes;return delete b.form,delete b.page,delete b.section,this.id=null,this.off(null,null,this),Backbone.Model.prototype.destroy.call(this,a)},initializeView:function(){var a,b,c,d=BMP.Forms,e=this.attributes;switch(this.removeView(),e.type){case"subForm":a=d._views.SubFormElement;break;case"heading":a=d._views.HeadingElement;break;case"message":a=d._views.MessageElement;break;case"boolean":a=d._views.BooleanElement;break;case"select":c=e.mode||"collapsed",c=c[0].toUpperCase()+c.substring(1),a=d._views["Choice"+c+"Element"];break;case"multi":c=e.mode||"collapsed",c=c[0].toUpperCase()+c.substring(1),a=d._views["Choice"+c+"Element"];break;case"hidden":a=d._views.HiddenElement;break;case"number":a=d._views.NumberElement;break;case"telephone":a=d._views.TelephoneElement;break;case"password":a=d._views.PasswordElement;break;case"email":a=d._views.EmailElement;break;case"url":a=d._views.URLElement;break;case"text":a=d._views.TextElement;break;case"textarea":a=d._views.TextAreaElement;break;case"button":a=d._views.ButtonElement;break;default:a=d._views.Element}return b=new a({model:this}),this.set("_view",b),b},val:function(a){return void 0===a?this.get("value"):(this.set("value",a),a)}},{create:function(b,c){var d,e,f=BMP.Forms,g=["date","time","datetime"];if(!b||!_.isObject(b))return new a;switch(c&&(b.form=c),b.type){case"draw":e=f._models.DrawElement;break;case"file":e=f._models.FileElement;break;case"location":e=f._models.LocationElement;break;case"subForm":e=f._models.SubFormElement;break;case"heading":e=f._models.HeadingElement;break;case"message":e=f._models.MessageElement;break;case"boolean":e=f._models.BooleanElement;break;case"select":e=f._models.SelectElement;break;case"multi":e=f._models.MultiElement;break;case"hidden":e=f._models.HiddenElement;break;case"number":e=f._models.NumberElement;break;case"telephone":e=f._models.TelephoneElement;break;case"password":e=f._models.PasswordElement;break;case"email":e=f._models.EmailElement;break;case"url":e=f._models.URLElement;break;case"text":e=f._models.TextElement;break;case"button":e=f._models.ButtonElement;break;case"textarea":e=f._models.TextAreaElement;break;default:e=-1!==_.indexOf(g,b.type)?f._models.DateElement:f._models.Element}return d=new e(b)}})}),define("collections/elements",["models/element"],function(a){return Backbone.Collection.extend({model:a})}),define("models/section",["require","models/element","collections/elements"],function(a){var b,c=a("models/element");return b=c.extend({initialize:function(){var b=a("collections/elements"),c=this.attributes;c.elements=new b,this.initializeView()},initializeView:function(){var a,b=BMP.Forms;a=new b._views.Section({model:this}),this.set("_view",a)},destroy:function(a){var b=this.attributes;return b._view&&(b._view.remove(),delete b._view),delete b.form,b.elements.forEach(function(b){b.destroy(a)}),Backbone.Model.prototype.destroy.call(this,a)},add:function(a){this.attributes.elements.add(a)}},{create:function(a,c){var d;return a&&_.isObject(a)?(c&&(a.form=c),d=new b(a)):new b}})}),define("models/page",["require","collections/elements","models/section"],function(a){var b,c,d=a("collections/elements"),e=a("models/section");return b=Backbone.Collection.extend({model:e}),c=Backbone.Model.extend({defaults:{"class":""},initialize:function(){var a,c=this.attributes,f=BMP.Forms,g=c.form;f.setAttributesFromClass(this,["_sections"]),c.elements=new d,this.initializeView(),a=g.attributes._sections,a&&_.isArray(a)?(a=_.map(a,function(a){return e.create(a,g)}),a=new b(a)):a=new b,a.forEach(function(b){var c,d=b.attributes;d.section&&(c=a.get(d.section),c&&(d.section=c,c.add(b))),!d.section instanceof e&&delete d.section}),c.sections=a},initializeView:function(){var a,b=BMP.Forms;a=new b._views.Page({model:this}),this.set("_view",a)},destroy:function(a){var b=this.attributes;return b._view&&(b._view.remove(),delete b._view),delete b.form,delete b.section,b.elements.forEach(function(b){b&&b.destroy(a)}),b.elements.reset(),Backbone.Model.prototype.destroy.call(this,a)},add:function(a){a instanceof e&&this.attributes.sections.add(a),a.attributes.section?this.add(a.attributes.section):this.attributes.elements.add(a)},getSection:function(a){var b,c=this.attributes.sections;return b=c.get(a),this.add(b),b},show:function(){var a=this.attributes._view;a.show()},hide:function(){var a=this.attributes._view;a.hide()},index:function(){var a=this.attributes.form,b=a.attributes.pages;return b.indexOf(this)}},{create:function(a,b){var d;return a&&_.isObject(a)?(b&&(a.form=b),d=new c(a)):new c}})}),define("waitfor",[],function(){function a(b,c,d){b&&b()?d():setTimeout(function(){a(b,c,d)},c||197)}return a}),define("collections/pages",["models/page","waitfor"],function(a,b){return Backbone.Collection.extend({model:a,"goto":function(a){var c,d,e;c=this,_.isNumber(a)||(a=0),c.current=null,this.forEach(function(b,d){var e,f=b.attributes.form;d===a?(c.current=b,b.initializeView(),e=b.attributes._view,e.render(),f.attributes._view.$el.append(e.el),f.attributes._view.$el.trigger("create")):(e=b.attributes._view,e&&(e.remove(),b.unset("_view")))}),e=c.current,d=e.attributes.form,b(function(){var a;return e.attributes._view&&(a=e.attributes._view.$el.closest("body")),a&&a.length&&a[0]===document.body},null,function(){BMP.Forms.trigger("formInjected",d.model),BMP.Forms.trigger("pageInjected",e)})}})}),define("models/form",["require","collections/elements","collections/pages"],function(a){var b,c=a("collections/elements"),d=a("collections/pages");return b=Backbone.Model.extend({defaults:{"class":""},initialize:function(){var a,b,e,f=BMP.Forms,g=this,h=f._models.Page,i=f._models.Element,j=f._models.Behaviour;f.setAttributesFromClass(this,["_actions","_checks","_behaviours","_elements","_pages","_sections"]),a=this.attributes._pages,delete this.attributes._pages,a=a&&_.isArray(a)?new d(_.map(a,function(a){return h.create(a,g)})):new d,this.attributes.pages=a,b=this.attributes._elements,delete this.attributes._elements,b=b&&_.isArray(b)?_.map(b,function(a){return i.create(a,g)}):[],this.attributes.elements=new c(b),e=this.attributes._behaviours,delete this.attributes._behaviours,e=e&&_.isArray(e)?_.map(e,function(a){return j.create(a,g)}):[],this.attributes.behaviours=e},destroy:function(a){var b=this.attributes;return b._view&&(b._view.remove(),delete b._view),delete this.$form,b.pages&&(b.pages.forEach(function(b){b.destroy(a)}),b.pages.reset()),b.behaviours&&b.behaviours.forEach(function(b){b.destroy(a)}),Backbone.Model.prototype.destroy.call(this,a)},getPage:function(a){for(var b=BMP.Forms,c=b._models.Page,d=this.get("pages");d.length<=a;)d.push(c.create({},this));return d.at(a)},getElement:function(a){var b=this.attributes.elements.get(a);return b||"id"!==a||(b=this.attributes.elements.add({name:a,type:"hidden"}),b=this.attributes.elements.get(a)),b},getRecord:function(){var a=this,b={},c=[];return new Promise(function(d){a.attributes.elements?a.attributes.elements.forEach(function(a){var d,e,f,g;if(d=a.attributes,e=d.type,d.persist){if("subForm"===e)return void c.push(new Promise(function(c){a.getRecord().then(function(d){b[a.attributes.name]=d,c()})}));if("file"===e||"draw"===e)return g=d.blob,void(g&&g.type&&(g.base64||g.text)&&(b[a.attributes.name]=g.base64||g.text,b[a.attributes.name+"_mimetype"]=g.type));if("location"===e)return f=d.value,void(f&&(b[a.attributes.name]=JSON.stringify(f)));f=a.val(),(f||"number"==typeof f)&&(b[a.attributes.name]=f)}}):a.attributes.id&&(b.id=a.attributes.id),b._action=a.attributes._action,Promise.all(c).then(function(){d(b)})})},setRecord:function(a){var c=this,d=[];return new Promise(function(e,f){return _.isObject(a)?(_.each(a,function(e,f){var g,h,i,j=c.getElement(f);j&&("subForm"===j.attributes.type?("string"==typeof e&&(g="<"+f+">"+e+"</"+f+">",h=$.parseXML(g),e=b.xmlToJson(h.firstElementChild||h.documentElement),e=e[f]),d.push(j.setRecords(e))):(_.contains(["file","draw"],j.attributes.type)&&(i=a[f+"_mimetype"]||"image/jpeg",e=b.addMimetype(e,i)),j.val(e)))}),void Promise.all(d).then(function(){e(a)})):void f()})},data:function(){return arguments.length?void 0:this.getRecord()},getErrors:function(){var a,b=this,c={};return b.attributes.elements.forEach(function(b){a=b.validate(),a&&(c[b.attributes.name]=a.value)}),_.isEmpty(c)?void 0:c}},{create:function(a,c){var d;return a&&_.isObject(a)?(a._action=c,d=new b(a)):new b},addMimetype:function(a,b){return-1===a.indexOf("data:")?"data:"+b+";base64,"+a:a},xmlToJson:function(a){var c,d,e,f,g={},h=[],i={};return a.hasChildNodes()&&(c=a.childNodes,_.each(c,function(a){a.hasChildNodes()&&(e=a.childNodes,f=a.nodeName,_.each(e,function(a){a.childElementCount>0?(d=b.xmlToJson(a),i[a.nodeName]=d[a.nodeName]):null!==a.firstChild&&(i[a.nodeName]=a.firstChild.nodeValue)}),h.push(i))})),g[f]=h,g}})}),define("models/subform",["models/form"],function(a){var b=a.extend({initialize:function(){this.parentElement=null,a.prototype.initialize.call(this)}});return b}),define("models/elements/subform",["models/subform","models/element"],function(a,b){var c;return c=Backbone.Collection.extend({model:a}),b.extend({initialize:function(){b.prototype.initialize.call(this),this.attributes.forms=new c},add:function(){var b=this,c=b.attributes,d=c.subForm,e=c.forms,f=c.form.attributes._action,g=BMP.Forms;return new Promise(function(c,h){g.getDefinition(d,f).then(function(d){var g;try{g=a.create(d,f),g.parentElement=b,e&&e.add(g),c()}catch(i){h(i)}},function(a){h(a)})})},indexOf:function(a){var b=this.attributes.forms;return b.models.indexOf(a)},remove:function(a){var b,c=this.attributes.forms;"number"==typeof a?b=c.at(a):a instanceof Backbone.Model&&(b=a),-1!==this.indexOf(b)&&("edit"===b.get("_action")?(b.attributes._view&&b.attributes._view.remove(),b.attributes={_action:"remove",id:b.attributes.id}):(b.destroy(),c.remove(b)))},size:function(){return this.attributes.forms.length},getForm:function(a){return this.attributes.forms.at(a)},getRecord:function(){var a;return a=this.attributes.forms.map(function(a){return a.data()}),new Promise(function(b,c){Promise.all(a).then(function(a){b(a)},function(){c()})})},setRecords:function(a){var b,c=this,d=this.attributes.forms,e=[];return new Promise(function(f,g){if(!_.isArray(a))return void f();for(;d.length>a.length;)c.remove(d.length-1);for(;d.length+e.length<a.length;)e.push(c.add());Promise.all(e).then(function(){b=[],a.forEach(function(a,c){b.push(d.at(c).setRecord(a))}),Promise.all(b).then(function(a){f(a)},function(){g()})},function(){g()})})},data:function(){return arguments.length?void 0:this.getRecord()},validate:function(a){var b,c=this.attributes.forms,d={};return void 0===a&&(a=this.attributes),c.models.forEach(function(a,c){b=a.getErrors(),b&&(d.value=d.value||{},d.value[c]=b)}),_.isEmpty(d)?void 0:d}})}),define("models/expression",[],function(){var a;return a=function(b){var c=this,d=JSON.parse(JSON.stringify(b));this.operator=d.operator.toLowerCase(),this.operands=d.operands||[],this.operands.forEach(function(b,d){_.isObject(b)&&_.isString(b.operator)&&(c.operands[d]=new a(b))})},a.prototype.evaluate=function(){var b;if(!this.operator)throw new Error("missing operator");if(!a.fn[this.operator])throw new Error("unknown operator: "+this.operator);return b=this.operands.map(function(a){if(_.isString(a)||_.isNumber(a)||_.isBoolean(a)||_.isNull(a))return a;if(a.evaluate)return a.evaluate();throw new Error("unexpected operand type")}),a.fn[this.operator].apply(this,b)},a.fn={},a.fn.and=function(){var a=Array.prototype.slice.call(arguments);return a.every(function(a){return!!a})},a.fn.or=function(){var a=Array.prototype.slice.call(arguments);return a.some(function(a){return!!a})},a.fn.not=function(a){return!a},a.fn.empty=function(a){return _.isObject(a)||_.isString(a)||_.isArray(a)?_.isEmpty(a):_.isNumber(a)?_.isNaN(a):!a},a.fn["!empty"]=function(b){return!a.fn.empty.call(this,b)},a.fn["=="]=function(a,b){return a==b},a.fn["!="]=function(a,b){return a!=b},a.fn["<"]=function(a,b){return b>a},a.fn["<="]=function(a,b){return b>=a},a.fn[">"]=function(a,b){return a>b},a.fn[">="]=function(a,b){return a>=b},a.fn.contains=function(a,b){var c;if(!a||_.isEmpty(a))return!1;if("string"==typeof a)return-1!==a.indexOf(b);if(_.isArray(a))return c=!1,a.forEach(function(a){a==b&&(c=!0)}),c;throw new Error("contains: unexpected operand type")},a.fn["!contains"]=function(b,c){return!a.fn.contains.call(this,b,c)},a}),define("models/behaviour",["require","collections/elements","models/expression"],function(require){var Elements=require("collections/elements"),Behaviour,Expression=require("models/expression");return Expression.fn["formelement.value"]=function(a){return this.getElement(a).val()},Behaviour=Backbone.Model.extend({initialize:function(){var a=this.attributes;a.elements=new Elements,a.actions=Behaviour.normalizeActions(a.actions),a.actionsIfFalse=Behaviour.normalizeActions(a.actionsIfFalse),!a.trigger&&a.formElements&&(a.trigger={formElements:a.formElements}),Array.isArray(a.trigger.formElements)||(a.trigger.formElements=[a.trigger.formElements]),a.isLegacy=-1!==a.trigger.formElements.indexOf("*"),a.event=a.isLegacy?"change:value change:html":"change",this.hookupTriggers(),setTimeout(function(){a.elements.trigger(a.event)},0)},hookupTriggers:function(){var a,b=this.attributes,c=b.form,d=b.elements;d.off(b.event,this.runCheck,this),a=this.getOutputTargets(),-1!==b.trigger.formElements.indexOf("*")?d.set(c.attributes.elements.models.filter(function(b){return-1===a.indexOf(b.attributes.name)})):b.trigger.formElements.filter(function(b){return-1===a.indexOf(b)}).forEach(function(a){d.add(c.getElement(a))}),d.on(b.event,this.runCheck,this)},runCheck:function(){var a,b;return this.attributes.check?this.attributes.check&&(a=this.getCheck(this.attributes.check),a&&a.exp)?(this.bindExpressions(),b=new Expression(a.exp),this.runActions(b.evaluate()),void this.unbindExpressions()):void 0:void this.runActions(!0)},runActions:function(a){var b=this;Array.isArray(this.attributes.actions)&&this.attributes.actions.forEach(function(c){c&&c.action&&(a?b.runAction(c.action):c.autoReverse&&b.runAction(c.action,!0))}),Array.isArray(this.attributes.actionsIfFalse)&&this.attributes.actionsIfFalse.forEach(function(c){c&&c.action&&(a?c.autoReverse&&b.runAction(c.action,!0):b.runAction(c.action))})},runAction:function(a,b){var c,d=this.getAction(a),e=this.attributes.form;b&&(d=this.getReversedAction(d)),d&&(d.javascript&&(c=this.runJavaScript(e,d.javascript)),Array.isArray(d.manipulations)&&d.manipulations.forEach(function(a){e.getElement(a.target).set(_.clone(a.properties))}),void 0!==c&&d.outputTarget&&e.getElement(d.outputTarget).val(c))},runJavaScript:function(form,string){var js,result,placeholders,value;js=null,placeholders=string.match(/\[[\w\/\[\]]+\]/g),_.isArray(placeholders)&&placeholders.forEach(function(a){a=a.substring(1,a.length-1);try{value=form.getElement(a).val(),string=string.replace("["+a+"]",value)}catch(b){window.console.warn(b,string)}});try{eval("js = "+string),result=_.isFunction(js)?js.call(form):js}catch(err){window.console.warn(err,string)}return result},getCheck:function(a){try{return this.attributes.form.attributes._checks.filter(function(b){return b.name===a})[0]}catch(b){return null}},getAction:function(a){try{return this.attributes.form.attributes._actions.filter(function(b){return b.name===a})[0]}catch(b){return null}},getActionsNames:function(){return this.attributes.actions.map(function(a){return a.action}).concat(this.attributes.actionsIfFalse.map(function(a){return a.action}))},getOutputTargets:function(){var a,b,c;try{return a=this.attributes.form.attributes._actions,b=this.getActionsNames(),c=a.filter(function(a){return-1!==b.indexOf(a.name)}),c.filter(function(a){return!!a.outputTarget}).map(function(a){return a.outputTarget})}catch(d){return[]}},getReversedAction:function(a){var b;return!a||a.javascript?null:(b=!0,a=JSON.parse(JSON.stringify(a)),Array.isArray(a.manipulations)&&a.manipulations.forEach(function(a){a.properties=a.properties||{},Object.keys(a.properties).forEach(function(c){_.isBoolean(a.properties[c])?a.properties[c]=!a.properties[c]:b=!1})}),b?a:null)},destroy:function(){var a=this.attributes;a.elements.off(a.event,this.runCheck,this),a.elements.reset()},bindExpressions:function(){var a=Expression.fn["formelement.value"];Expression.fn["formelement.value"]=_.bind(Expression.fn["formelement.value"],this.attributes.form),Expression.fn["formelement.value"]._unbound=a},unbindExpressions:function(){var a=Expression.fn["formelement.value"]._unbound;delete Expression.fn["formelement.value"]._unbound,Expression.fn["formelement.value"]=a}},{create:function(a,b){var c;return a&&_.isObject(a)?(b&&(a.form=b),c=new Behaviour(a)):new Behaviour},normalizeActions:function(a){return a&&Array.isArray(a)?a.map(function(a){return a&&"string"==typeof a&&(a={action:a,autoReverse:!1}),a&&"object"==typeof a&&a.action&&"string"==typeof a.action&&"boolean"==typeof a.autoReverse?a:{}}):[]}})}),define("models/elements/heading",["models/element"],function(a){var b=a.extend({defaults:{page:0,persist:!1,level:1},initialize:function(){var b,c,d;b=this,c={headingText:"text",headingPosition:"position",headingFontFace:"fontFace"},Object.keys(c).forEach(function(a){c[a]&&b.attributes[a]&&(b.attributes[c[a]]=b.attributes[a])}),b.attributes.hasOwnProperty("headingType")&&(d=b.attributes.headingType,"number"!=typeof d&&(d=parseInt(d,10)),"number"!=typeof d||isNaN(d)||(b.attributes.level=d+1)),a.prototype.initialize.call(this)}});return b}),define("models/elements/message",["models/element"],function(a){var b=a.extend({defaults:{page:0,persist:!1},initialize:function(){var b=this,c={messageText:"html"};Object.keys(c).forEach(function(a){c[a]&&b.attributes[a]&&(b.attributes[c[a]]=b.attributes[a])}),a.prototype.initialize.call(this)},val:function(a){return void 0===a?this.get("html"):(this.set("html",a),a)}});return b}),define("models/elements/date",["models/element"],function(a){var b=a.extend({initialize:function(){var b,c,d=this.attributes,e=null,f=null;if(a.prototype.initialize.call(this),this.on("change:_date change:_time",this.prepareValue),this.on("change:value",this.prepareDateTime),d.defaultValue)switch(d.type){case"date":b=this.mapDateFormats[d.dateFormat]||"YYYY-MM-DD","now"===d.defaultValue?e=moment():"now_plus"===d.defaultValue?e=moment().add("d",parseInt(d.defaultDateNowPlus,10)):"date"===d.defaultValue&&(e=moment(d.defaultDateDate)),null!==e&&this.set("value",e.format(b));break;case"time":c=this.mapTimeFormats[d.timeFormat]||"HH:mm","now"===d.defaultValue?f=moment():"now_plus"===d.defaultValue&&(f=moment().add("m",parseInt(d.nowPlusAmount,10))),null!==f&&this.set("value",f.format(c));break;case"datetime":b=this.mapDateFormats[d.dateFormat]||"YYYY-MM-DD",c=this.mapTimeFormats[d.timeFormat]||"HH:mm","now"===d.defaultValue?f=e=moment():"now_plus"===d.defaultValue&&(f=e=moment(),f.add("m",parseInt(d.nowPlusAmount,10))),null!==e&&(this.attributes._date=e.format(b),this.trigger("change:_date")),null!==f&&(this.attributes._time=f.format(c),this.trigger("change:_time"))}},initializeView:function(){var a,b=BMP.Forms,c=this.attributes;this.removeView(),a=1===parseInt(c.nativeDatetimePicker,10)||1===parseInt(c.nativeDatePicker,10)||1===parseInt(c.nativeTimePicker,10)?new b._views.DateElement({model:this}):new b._views.DatePickadateElement({model:this}),this.set("_view",a)},prepareValue:function(){var a,b,c=this.attributes.type;"date"===c?this.set("value",this.attributes._date):"time"===c?this.set("value",this.attributes._time):(a=this.attributes._date,b=this.attributes._time,a||(a="0000-00-00"),b||(b="00:00"),this.set("value",a+"T"+b))},prepareDateTime:function(){var a,b,c,d=this.attributes.type,e=this.attributes.value;"date"===d?this.set("_date",e):"time"===d?this.set("_time",e):(a=this.attributes._time,b=this.attributes._date,c=e.split("T"),c[0]&&this.set("_date",c[0],{silent:!0}),c[1]&&this.set("_time",c[1],{silent:!0}),a!==this.attributes._time&&this.trigger("change:_time"),b!==this.attributes._date&&this.trigger("change:_date"))},toDate:function(){var a,b=this.attributes.type;return"date"===b?new Date(this.attributes._date):"time"===b?(a=(new Date).toISOString(),a.replace(/T[0-9.:Z+\-]*$/,"T"+this.attributes._time)):new Date(this.attributes._date+"T"+this.attributes._time)},mapDateFormats:{yyyy_mm_dd:"YYYY-MM-DD",mm_dd_yyyy:"MM-DD-YYYY",dd_mm_yyyy2:"DD/MM/YYYY",yyyy_mm_dd2:"YYYY/MM/DD",mm_dd_yyyy2:"MM/DD/YYYY",dd_mm_yyyy:"DD-MM-YYYY"},mapTimeFormats:{"hh:mm":"HH:mm",hh_mm_ss:"HH:mm",h_mm_ss:"hh:mm A",h_mm:"hh:mm A"}});return b}),define("models/elements/hidden",["models/element"],function(a){var b=a.extend({initialize:function(){a.prototype.initialize.call(this)}});return b}),define("models/elements/number",["models/element"],function(a){var b=a.extend({initialize:function(){var b=this,c={maxDecimalPlaces:"maxDecimals",minDecimalPlaces:"minDecimals"};Object.keys(c).forEach(function(a){c[a]&&b.attributes[a]&&(b.attributes[c[a]]=b.attributes[a])}),a.prototype.initialize.call(this)},set:function(b,c,d){var e;return null===b?this:(_.isObject(b)?(e=b,d=c):(e={},e[b]=c),d=d||{},e.hasOwnProperty("value")&&"undefined"!==e.value&&null!==e.value&&(e.value=Number(e.value)),a.prototype.set.call(this,e,d))},validators:{minValue:function(a,b){return b>a},maxValue:function(a,b){return a>b},maxDecimals:function(a,b){var c=new RegExp("^(?:(-)?\\d*\\.\\d{1,"+b+"}|\\d+)$");return c.test(a)},minDecimals:function(a,b){var c=new RegExp("^(?:(-)?\\d*\\.\\d{"+b+",}|\\d+)$");return c.test(a)}},validate:function(b){var c=a.prototype.validate.call(this)||{};return void 0===b&&(b=this.attributes),b.value&&(this.validators.maxValue(b.value,b.max)&&(c.value=c.value||[],c.value.push({code:"MAX",MAX:b.max})),this.validators.minValue(b.value,b.min)&&(c.value=c.value||[],c.value.push({code:"MIN",MIN:b.min})),b.maxDecimals&&!this.validators.maxDecimals(b.value,b.maxDecimals)&&(c.value=c.value||[],c.value.push({code:"MAXDECIMALS",MAX:b.maxDecimals})),b.minDecimals&&!this.validators.minDecimals(b.value,b.minDecimals)&&(c.value=c.value||[],c.value.push({code:"MINDECIMALS",MIN:b.minDecimals}))),_.isEmpty(c)?void 0:c}});return b}),define("models/elements/telephone",["models/element"],function(a){var b=a.extend({initialize:function(){a.prototype.initialize.call(this)}});return b}),define("models/elements/text",["models/element"],function(a){var b=a.extend({initialize:function(){a.prototype.initialize.call(this)},validate:function(b){var c=a.prototype.validate.call(this)||{};return void 0===b&&(b=this.attributes),b.value&&b.maxLength?b.value.length>b.maxLength&&(c.value=c.value||[],c.value.push({code:"MAXLENGTH",MAX:b.maxLength})):b.value&&b.characterLimit&&b.value.length>b.characterLimit&&(c.value=c.value||[],c.value.push({code:"MAXLENGTH",MAX:b.characterLimit})),_.isEmpty(c)?void 0:c}});return b}),define("models/elements/password",["models/elements/text"],function(a){var b=a.extend({initialize:function(){a.prototype.initialize.call(this)}});return b}),define("models/elements/email",["models/elements/text"],function(a){var b=a.extend({initialize:function(){a.prototype.initialize.call(this)},validate:function(b){var c=a.prototype.validate.call(this)||{},d=new RegExp('^(([^<>()[\\]\\.,;:\\s@\\"]+(\\.[^<>()[\\]\\.,;:\\s@\\"]+)*)|(\\".+\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$',"i");return void 0===b&&(b=this.attributes),b.value&&!d.test(b.value)&&(c.value=c.value||[],c.value.push({code:"EMAIL"})),_.isEmpty(c)?void 0:c}});return b}),define("models/elements/url",["models/elements/text"],function(a){var b=a.extend({initialize:function(){a.prototype.initialize.call(this)}});return b}),define("models/elements/textarea",["models/elements/text"],function(a){var b=a.extend({initialize:function(){a.prototype.initialize.call(this)}});return b}),define("models/elements/boolean",["models/element"],function(a){var b=a.extend({initialize:function(){a.prototype.initialize.call(this)}});return b}),define("models/elements/select",["models/element"],function(a){var b=_.clone(a.prototype.defaults);return b.mode="collapsed",b.layout="vertical",b.other=!1,b.nativeMenu=!1,a.extend({defaults:b,initialize:function(){a.prototype.initialize.call(this)}})}),define("models/elements/multi",["models/elements/select"],function(a){var b=a.extend({initialize:function(){a.prototype.initialize.call(this)}});return b}),define("models/elements/location",["models/element"],function(a){var b=a.extend({initialize:function(){a.prototype.initialize.call(this)},initializeView:function(){var a,b=BMP.Forms;this.removeView(),a=new b._views.LocationElement({model:this}),this.set("_view",a)},getGeoLocation:function(a){var b=this,c=window.navigator&&window.navigator.geolocation,d={enableHighAccuracy:!0,maximumAge:3e5,timeout:5e3},e={value:[]};return c&&c.getCurrentPosition?(a=$.isPlainObject(a)?a:{},a=$.extend({},d,a),void c.getCurrentPosition(function(a){var c;a.coords?(c={latitude:a.coords.latitude,longitude:a.coords.longitude,altitude:a.coords.altitude,accuracy:a.coords.accuracy,altitudeAccuracy:a.coords.altitudeAccuracy,heading:a.coords.heading,speed:a.coords.speed},b.set("value",c)):(e.value.push("unable to determine position"),b.set("errors",e))},function(a){var c;switch(a.code){case a.PERMISSION_DENIED:c="user has not granted permission";break;case a.PERMISSION_DENIED_TIMEOUT:c="user did not grant permission in time";break;case a.POSITION_UNAVAILABLE:c="unable to determine position";break;default:c="unknown error"}e.value.push(c),b.set("errors",e)},a)):(e.value.push("unsupported in this browser"),void b.set("errors",e))}});return b}),define("models/elements/file",["models/element"],function(a){var b=a.extend({initialize:function(){a.prototype.initialize.call(this),this.on("change:value",function(){var a,b;a=this.get("value"),a?(b=BMP.Blob.fromDataURI(a),this.set("blob",b)):this.unset("blob")},this)},initializeView:function(){var a,b=BMP.Forms,c=this.attributes.accept;this.removeView(),a=BMP.BlinkGap.hasCamera()&&0===c.indexOf("image")?new b._views.BGImageElement({model:this}):this.getUserMediaPresent()&&this.get("capture")===!0?new b._views.WebRTCImageElement({model:this}):new b._views.FileElement({model:this}),this.set("_view",a)},getUserMediaPresent:function(){return window.URL&&window.URL.createObjectURL&&(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)}});return b}),define("models/elements/draw",["models/element"],function(a){var b=a.extend({initialize:function(){a.prototype.initialize.call(this),this.on("change:value",function(){var a,b;a=this.get("value"),a?(b=BMP.Blob.fromDataURI(a),this.set("blob",b)):this.unset("blob")},this)},initializeView:function(){var a,b=BMP.Forms;this.removeView(),a=BMP.BlinkGap.hasTouchDraw()?new b._views.BGDrawElement({model:this}):new b._views.DrawElement({model:this}),this.set("_view",a)}});return b}),define("models/elements/button",["models/element"],function(a){var b=a.extend({initialize:function(){a.prototype.initialize.call(this)}});return b}),define("main",["require","bicyclepump","formslib/main","models/form","models/subform","models/elements/subform","models/behaviour","models/page","models/section","models/element","models/elements/heading","models/elements/message","models/elements/date","models/elements/hidden","models/elements/number","models/elements/telephone","models/elements/password","models/elements/email","models/elements/url","models/elements/text","models/elements/textarea","models/elements/boolean","models/elements/select","models/elements/multi","models/elements/location","models/elements/file","models/elements/draw","models/elements/button"],function(a){var b,c,d;return c=a("bicyclepump"),d=a("formslib/main"),b=window.BMP.Forms,_.extend(b,Backbone.Events),b._models={Form:a("models/form"),SubForm:a("models/subform"),SubFormElement:a("models/elements/subform"),Behaviour:a("models/behaviour"),Page:a("models/page"),Section:a("models/section"),Element:a("models/element"),HeadingElement:a("models/elements/heading"),MessageElement:a("models/elements/message"),DateElement:a("models/elements/date"),HiddenElement:a("models/elements/hidden"),NumberElement:a("models/elements/number"),TelephoneElement:a("models/elements/telephone"),PasswordElement:a("models/elements/password"),EmailElement:a("models/elements/email"),URLElement:a("models/elements/url"),TextElement:a("models/elements/text"),TextAreaElement:a("models/elements/textarea"),BooleanElement:a("models/elements/boolean"),SelectElement:a("models/elements/select"),MultiElement:a("models/elements/multi"),LocationElement:a("models/elements/location"),FileElement:a("models/elements/file"),DrawElement:a("models/elements/draw"),ButtonElement:a("models/elements/button")},b.models=new c,b.views=new c,b.castPropertyValues=d.castPropertyValues,b.flattenDefinition=d.flattenDefinition,b.parseClass=d.parseClass,b.setAttributesFromClass=function(a,c){var d,e,f;if(a&&"object"!=typeof a)throw new TypeError("expect 1st parameter to be Backbone.Model");if(c&&!Array.isArray(c))throw new TypeError("expect 2nd parameter to be an Array, or omitted");c=c||[],c.push("id","name","label"),!a instanceof Backbone.Model||!a.attributes||(d=a.attributes.class,"string"==typeof d&&-1!==d.indexOf(";")&&(f=b.parseClass(d),c.forEach(function(a){delete f[a]}),e=a.constructor.prototype.defaults||{},a.set(b.castPropertyValues(f,e))))},b.initialize=function(a,c){var d,e;if(!$.isPlainObject(a))throw new Error("unexpected Form definition structure");(!c||_.isEmpty(c)||["add","edit","delete"].indexOf(c)<0)&&(c="add"),d=b._models.Form.create(a,c),b.current=d,e=d.attributes._view=new b._views.Form({model:d}),d.$form=e.$el,e.render()},b.version="3.1.7",b.supports={},b.supports.blob=function(){var a;try{return a=new BMP.Blob,"number"==typeof a.size}catch(b){}return!1}(),b}),require(["models/expression"],function(a){BMP.Expression=a}),require(["main"],function(a){try{a._views=require("views/forms3jqm")}catch(b){}}),BMP.Forms}),function(a){a.i18n={lc:{en:function(a){return 1===a?"one":"other"}},c:function(a,b){if(!a)throw new Error("MessageFormat: Data required for '"+b+"'.")},n:function(a,b,c){if(isNaN(a[b]))throw new Error("MessageFormat: '"+b+"' isn't a number.");return a[b]-(c||0)},v:function(a,b){return i18n.c(a,b),a[b]},p:function(a,b,c,d,e){return i18n.c(a,b),a[b]in e?e[a[b]]:(b=i18n.lc[d](a[b]-c),b in e?e[b]:e.other)},s:function(a,b,c){return i18n.c(a,b),a[b]in c?c[a[b]]:c.other}},i18n["BMP/Forms/validation"]={MAX:function(a){return"must not be higher than "+i18n.v(a,"MAX")},MIN:function(a){return"must not be lower than "+i18n.v(a,"MIN")},MAXDECIMALS:function(a){return"no more than "+i18n.v(a,"MAX")+" "+i18n.p(a,"MAX",0,"en",{one:"value",other:"values"})+" after the decimal"},MINDECIMALS:function(a){return"needs at least "+i18n.v(a,"MIN")+" "+i18n.p(a,"MIN",0,"en",{one:"value",other:"values"})+" after the decimal"},MAXLENGTH:function(a){return"no longer than "+i18n.v(a,"MAX")+" "+i18n.p(a,"MAX",0,"en",{one:"character",other:"characters"})},PATTERN:function(a){return"must match this pattern: "+i18n.v(a,"PATTERN")},REQUIRED:function(){return"must not be empty"},EMAIL:function(){return"must contain a valid email address"}},i18n["BMP/Forms/warning"]={NO_BLOB_PREVIEW:function(){return"preview of existing data is not yet supported on this device"
},MISSING_BLOB_MIME:function(){return"type of data is unknown, so a preview cannot be displayed"}}}(this);
//# sourceMappingURL=forms3jqm.min.js.map